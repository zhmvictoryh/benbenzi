// lo-th.github.io/Oimo.js/license
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i(t.OIMO=t.OIMO||{})}(this,function(t){"use strict";function i(t,i){console.error("[OIMO] "+t+": "+i)}function s(t){this.parent=t,this.infos=new Float32Array(13),this.f=[0,0,0],this.times=[0,0,0,0],this.broadPhase=this.parent.broadPhaseType,this.version=ot,this.fps=0,this.tt=0,this.broadPhaseTime=0,this.narrowPhaseTime=0,this.solvingTime=0,this.totalTime=0,this.updateTime=0,this.MaxBroadPhaseTime=0,this.MaxNarrowPhaseTime=0,this.MaxSolvingTime=0,this.MaxTotalTime=0,this.MaxUpdateTime=0}function h(t,i,s){this.x=t||0,this.y=i||0,this.z=s||0}function e(t,i,s,h){this.x=t||0,this.y=i||0,this.z=s||0,this.w=void 0!==h?h:1}function a(t,i,s,h,e,a,o,n,r){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&console.error("OIMO.Mat33: the constructor no longer reads arguments. use .set() instead.")}function o(t,i,s,h,e,a){this.elements=new Float32Array(6);var o=this.elements;o[0]=t||0,o[1]=s||0,o[2]=e||0,o[3]=i||0,o[4]=h||0,o[5]=a||0}function n(){return Vt++}function r(t){this.type=dt,this.id=n(),this.prev=null,this.next=null,this.proxy=null,this.parent=null,this.contactLink=null,this.numContacts=0,this.position=new h,this.rotation=new a,this.relativePosition=(new h).copy(t.relativePosition),this.relativeRotation=(new a).copy(t.relativeRotation),this.aabb=new o,this.density=t.density,this.friction=t.friction,this.restitution=t.restitution,this.belongsTo=t.belongsTo,this.collidesWith=t.collidesWith}function l(t,i,s,h){r.call(this,t),this.type=Nt,this.width=i,this.height=s,this.depth=h,this.halfWidth=.5*i,this.halfHeight=.5*s,this.halfDepth=.5*h,this.dimentions=new Float32Array(18),this.elements=new Float32Array(24)}function m(t,i){r.call(this,t),this.type=ft,this.radius=i}function c(t,i,s){r.call(this,t),this.type=vt,this.radius=i,this.height=s,this.halfHeight=.5*s,this.normalDirection=new h,this.halfDirection=new h}function p(){this.relativePosition=new h,this.relativeRotation=new a,this.friction=.2,this.restitution=.2,this.density=1,this.belongsTo=1,this.collidesWith=4294967295}function u(t,i){i=i||!1,this.axis=t,this.angle=0,this.lowerLimit=i?0:1,this.upperLimit=0,this.motorSpeed=0,this.maxMotorForce=0,this.frequency=0,this.dampingRatio=0}function y(){this.parent=null,this.body1=null,this.body2=null,this.addedToIsland=!1}function x(t){this.prev=null,this.next=null,this.body=null,this.joint=t}function d(t){y.call(this),this.scale=t.scale,this.invScale=t.invScale,this.name="",this.type=zt,this.prev=null,this.next=null,this.body1=t.body1,this.body2=t.body2,this.localAnchorPoint1=(new h).copy(t.localAnchorPoint1),this.localAnchorPoint2=(new h).copy(t.localAnchorPoint2),this.relativeAnchorPoint1=new h,this.relativeAnchorPoint2=new h,this.anchorPoint1=new h,this.anchorPoint2=new h,this.allowCollision=t.allowCollision,this.b1Link=new x(this),this.b2Link=new x(this)}function f(t){this.m1=NaN,this.m2=NaN,this.ii1=null,this.ii2=null,this.dd=null,this.r1x=NaN,this.r1y=NaN,this.r1z=NaN,this.r2x=NaN,this.r2y=NaN,this.r2z=NaN,this.ax1x=NaN,this.ax1y=NaN,this.ax1z=NaN,this.ay1x=NaN,this.ay1y=NaN,this.ay1z=NaN,this.az1x=NaN,this.az1y=NaN,this.az1z=NaN,this.ax2x=NaN,this.ax2y=NaN,this.ax2z=NaN,this.ay2x=NaN,this.ay2y=NaN,this.ay2z=NaN,this.az2x=NaN,this.az2y=NaN,this.az2z=NaN,this.vel=NaN,this.velx=NaN,this.vely=NaN,this.velz=NaN,this.joint=t,this.r1=t.relativeAnchorPoint1,this.r2=t.relativeAnchorPoint2,this.p1=t.anchorPoint1,this.p2=t.anchorPoint2,this.b1=t.body1,this.b2=t.body2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.impx=0,this.impy=0,this.impz=0}function N(t,i,s,h){this.cfm1=NaN,this.cfm2=NaN,this.cfm3=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.ax1=NaN,this.ay1=NaN,this.az1=NaN,this.ax2=NaN,this.ay2=NaN,this.az2=NaN,this.ax3=NaN,this.ay3=NaN,this.az3=NaN,this.a1x1=NaN,this.a1y1=NaN,this.a1z1=NaN,this.a2x1=NaN,this.a2y1=NaN,this.a2z1=NaN,this.a1x2=NaN,this.a1y2=NaN,this.a1z2=NaN,this.a2x2=NaN,this.a2y2=NaN,this.a2z2=NaN,this.a1x3=NaN,this.a1y3=NaN,this.a1z3=NaN,this.a2x3=NaN,this.a2y3=NaN,this.a2z3=NaN,this.lowerLimit1=NaN,this.upperLimit1=NaN,this.limitVelocity1=NaN,this.limitState1=0,this.enableMotor1=!1,this.motorSpeed1=NaN,this.maxMotorForce1=NaN,this.maxMotorImpulse1=NaN,this.lowerLimit2=NaN,this.upperLimit2=NaN,this.limitVelocity2=NaN,this.limitState2=0,this.enableMotor2=!1,this.motorSpeed2=NaN,this.maxMotorForce2=NaN,this.maxMotorImpulse2=NaN,this.lowerLimit3=NaN,this.upperLimit3=NaN,this.limitVelocity3=NaN,this.limitState3=0,this.enableMotor3=!1,this.motorSpeed3=NaN,this.maxMotorForce3=NaN,this.maxMotorImpulse3=NaN,this.k00=NaN,this.k01=NaN,this.k02=NaN,this.k10=NaN,this.k11=NaN,this.k12=NaN,this.k20=NaN,this.k21=NaN,this.k22=NaN,this.kv00=NaN,this.kv11=NaN,this.kv22=NaN,this.dv00=NaN,this.dv11=NaN,this.dv22=NaN,this.d00=NaN,this.d01=NaN,this.d02=NaN,this.d10=NaN,this.d11=NaN,this.d12=NaN,this.d20=NaN,this.d21=NaN,this.d22=NaN,this.limitMotor1=i,this.limitMotor2=s,this.limitMotor3=h,this.b1=t.body1,this.b2=t.body2,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse1=0,this.motorImpulse1=0,this.limitImpulse2=0,this.motorImpulse2=0,this.limitImpulse3=0,this.motorImpulse3=0}function v(t,i,s){d.call(this,t),this.type=Mt,this.localAxis1=t.localAxis1.clone().normalize(),this.localAxis2=t.localAxis2.clone().normalize();var o=(new a).setQuat((new e).arc(this.localAxis1,this.localAxis2));this.localAngle1=(new h).tangent(this.localAxis1).normalize(),this.localAngle2=(new h).mulMat(o,this.localAngle1),this.ax1=new h,this.ax2=new h,this.an1=new h,this.an2=new h,this.tmp=new h,this.nor=new h,this.tan=new h,this.bin=new h,this.limitMotor=new u(this.nor,!1),this.limitMotor.lowerLimit=i,this.limitMotor.upperLimit=s,this.lc=new f(this),this.r3=new N(this,this.limitMotor,new u(this.tan,!0),new u(this.bin,!0))}function b(t){d.call(this,t),this.type=wt,this.lc=new f(this)}function z(t,i){this.cfm=NaN,this.m1=NaN,this.m2=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.motorDenom=NaN,this.invMotorDenom=NaN,this.invDenom=NaN,this.ax=NaN,this.ay=NaN,this.az=NaN,this.r1x=NaN,this.r1y=NaN,this.r1z=NaN,this.r2x=NaN,this.r2y=NaN,this.r2z=NaN,this.t1x=NaN,this.t1y=NaN,this.t1z=NaN,this.t2x=NaN,this.t2y=NaN,this.t2z=NaN,this.l1x=NaN,this.l1y=NaN,this.l1z=NaN,this.l2x=NaN,this.l2y=NaN,this.l2z=NaN,this.a1x=NaN,this.a1y=NaN,this.a1z=NaN,this.a2x=NaN,this.a2y=NaN,this.a2z=NaN,this.lowerLimit=NaN,this.upperLimit=NaN,this.limitVelocity=NaN,this.limitState=0,this.enableMotor=!1,this.motorSpeed=NaN,this.maxMotorForce=NaN,this.maxMotorImpulse=NaN,this.limitMotor=i,this.b1=t.body1,this.b2=t.body2,this.p1=t.anchorPoint1,this.p2=t.anchorPoint2,this.r1=t.relativeAnchorPoint1,this.r2=t.relativeAnchorPoint2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse=0,this.motorImpulse=0}function k(t,i,s){d.call(this,t),this.type=kt,this.nor=new h,this.limitMotor=new u(this.nor,!0),this.limitMotor.lowerLimit=i,this.limitMotor.upperLimit=s,this.t=new z(this,this.limitMotor)}function w(t,i){this.joint=t,this.targetOrientation=(new e).invert(i),this.relativeOrientation=new e,this.ii1=null,this.ii2=null,this.dd=null,this.vel=new h,this.imp=new h,this.rn0=new h,this.rn1=new h,this.rn2=new h,this.b1=t.body1,this.b2=t.body2,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia}function M(t,i,s,h){this.m1=NaN,this.m2=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.ax1=NaN,this.ay1=NaN,this.az1=NaN,this.ax2=NaN,this.ay2=NaN,this.az2=NaN,this.ax3=NaN,this.ay3=NaN,this.az3=NaN,this.r1x=NaN,this.r1y=NaN,this.r1z=NaN,this.r2x=NaN,this.r2y=NaN,this.r2z=NaN,this.t1x1=NaN,this.t1y1=NaN,this.t1z1=NaN,this.t2x1=NaN,this.t2y1=NaN,this.t2z1=NaN,this.l1x1=NaN,this.l1y1=NaN,this.l1z1=NaN,this.l2x1=NaN,this.l2y1=NaN,this.l2z1=NaN,this.a1x1=NaN,this.a1y1=NaN,this.a1z1=NaN,this.a2x1=NaN,this.a2y1=NaN,this.a2z1=NaN,this.t1x2=NaN,this.t1y2=NaN,this.t1z2=NaN,this.t2x2=NaN,this.t2y2=NaN,this.t2z2=NaN,this.l1x2=NaN,this.l1y2=NaN,this.l1z2=NaN,this.l2x2=NaN,this.l2y2=NaN,this.l2z2=NaN,this.a1x2=NaN,this.a1y2=NaN,this.a1z2=NaN,this.a2x2=NaN,this.a2y2=NaN,this.a2z2=NaN,this.t1x3=NaN,this.t1y3=NaN,this.t1z3=NaN,this.t2x3=NaN,this.t2y3=NaN,this.t2z3=NaN,this.l1x3=NaN,this.l1y3=NaN,this.l1z3=NaN,this.l2x3=NaN,this.l2y3=NaN,this.l2z3=NaN,this.a1x3=NaN,this.a1y3=NaN,this.a1z3=NaN,this.a2x3=NaN,this.a2y3=NaN,this.a2z3=NaN,this.lowerLimit1=NaN,this.upperLimit1=NaN,this.limitVelocity1=NaN,this.limitState1=0,this.enableMotor1=!1,this.motorSpeed1=NaN,this.maxMotorForce1=NaN,this.maxMotorImpulse1=NaN,this.lowerLimit2=NaN,this.upperLimit2=NaN,this.limitVelocity2=NaN,this.limitState2=0,this.enableMotor2=!1,this.motorSpeed2=NaN,this.maxMotorForce2=NaN,this.maxMotorImpulse2=NaN,this.lowerLimit3=NaN,this.upperLimit3=NaN,this.limitVelocity3=NaN,this.limitState3=0,this.enableMotor3=!1,this.motorSpeed3=NaN,this.maxMotorForce3=NaN,this.maxMotorImpulse3=NaN,this.k00=NaN,this.k01=NaN,this.k02=NaN,this.k10=NaN,this.k11=NaN,this.k12=NaN,this.k20=NaN,this.k21=NaN,this.k22=NaN,this.kv00=NaN,this.kv11=NaN,this.kv22=NaN,this.dv00=NaN,this.dv11=NaN,this.dv22=NaN,this.d00=NaN,this.d01=NaN,this.d02=NaN,this.d10=NaN,this.d11=NaN,this.d12=NaN,this.d20=NaN,this.d21=NaN,this.d22=NaN,this.limitMotor1=i,this.limitMotor2=s,this.limitMotor3=h,this.b1=t.body1,this.b2=t.body2,this.p1=t.anchorPoint1,this.p2=t.anchorPoint2,this.r1=t.relativeAnchorPoint1,this.r2=t.relativeAnchorPoint2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse1=0,this.motorImpulse1=0,this.limitImpulse2=0,this.motorImpulse2=0,this.limitImpulse3=0,this.motorImpulse3=0,this.cfm1=0,this.cfm2=0,this.cfm3=0,this.weight=-1}function I(t,i,s){d.call(this,t),this.type=Lt,this.localAxis1=t.localAxis1.clone().normalize(),this.localAxis2=t.localAxis2.clone().normalize(),this.ax1=new h,this.ax2=new h,this.nor=new h,this.tan=new h,this.bin=new h,this.ac=new w(this,(new e).arc(this.localAxis1,this.localAxis2)),this.limitMotor=new u(this.nor,!0),this.limitMotor.lowerLimit=i,this.limitMotor.upperLimit=s,this.t3=new M(this,this.limitMotor,new u(this.tan,!0),new u(this.bin,!0))}function g(t,i,s){d.call(this,t),this.type=gt,this.localAxis1=t.localAxis1.clone().normalize(),this.localAxis2=t.localAxis2.clone().normalize();var o=(new a).setQuat((new e).arc(this.localAxis1,this.localAxis2));this.localAngle1=(new h).tangent(this.localAxis1).normalize(),this.localAngle2=(new h).mulMat(o,this.localAngle1),this.ax1=new h,this.ax2=new h,this.an1=new h,this.an2=new h,this.tmp=new h,this.nor=new h,this.tan=new h,this.bin=new h,this.rotationalLimitMotor=new u(this.nor,!1),this.r3=new N(this,this.rotationalLimitMotor,new u(this.tan,!0),new u(this.bin,!0)),this.translationalLimitMotor=new u(this.nor,!0),this.translationalLimitMotor.lowerLimit=i,this.translationalLimitMotor.upperLimit=s,this.t3=new M(this,this.translationalLimitMotor,new u(this.tan,!0),new u(this.bin,!0))}function L(t){d.call(this,t),this.type=It,this.localAxis1=t.localAxis1.clone().normalize(),this.localAxis2=t.localAxis2.clone().normalize(),this.localAngle1=new h,this.localAngle2=new h;var i=Pt.dotVectors(this.localAxis1,this.localAxis2);if(i>-1&&i<1)this.localAngle1.set(this.localAxis2.x-i*this.localAxis1.x,this.localAxis2.y-i*this.localAxis1.y,this.localAxis2.z-i*this.localAxis1.z).normalize(),this.localAngle2.set(this.localAxis1.x-i*this.localAxis2.x,this.localAxis1.y-i*this.localAxis2.y,this.localAxis1.z-i*this.localAxis2.z).normalize();else{var s=(new a).setQuat((new e).arc(this.localAxis1,this.localAxis2));this.localAngle1.tangent(this.localAxis1).normalize(),this.localAngle2.mulMat(s,this.localAngle1)}this.ax1=new h,this.ax2=new h,this.an1=new h,this.an2=new h,this.tmp=new h,this.nor=new h,this.tan=new h,this.bin=new h,this.translationalLimitMotor=new u(this.tan,!0),this.translationalLimitMotor.frequency=8,this.translationalLimitMotor.dampingRatio=1,this.rotationalLimitMotor1=new u(this.tan,!1),this.rotationalLimitMotor2=new u(this.bin,!1),this.t3=new M(this,new u(this.nor,!0),this.translationalLimitMotor,new u(this.bin,!0)),this.t3.weight=1,this.r3=new N(this,new u(this.nor,!0),this.rotationalLimitMotor1,this.rotationalLimitMotor2)}function S(){this.scale=1,this.invScale=1,this.body1=null,this.body2=null,this.localAnchorPoint1=new h,this.localAnchorPoint2=new h,this.localAxis1=new h,this.localAxis2=new h,this.allowCollision=!1}function P(){this.mass=0,this.inertia=new a}function V(t){this.prev=null,this.next=null,this.shape=null,this.body=null,this.contact=t}function T(){this.lp1X=NaN,this.lp1Y=NaN,this.lp1Z=NaN,this.lp2X=NaN,this.lp2Y=NaN,this.lp2Z=NaN,this.impulse=NaN}function A(){this.warmStarted=!1,this.position=new h,this.localPoint1=new h,this.localPoint2=new h,this.normal=new h,this.tangent=new h,this.binormal=new h,this.normalImpulse=0,this.tangentImpulse=0,this.binormalImpulse=0,this.normalDenominator=0,this.tangentDenominator=0,this.binormalDenominator=0,this.penetration=0}function U(){this.body1=null,this.body2=null,this.numPoints=0,this.points=[new A,new A,new A,new A]}function D(){this.norX=NaN,this.norY=NaN,this.norZ=NaN,this.tanX=NaN,this.tanY=NaN,this.tanZ=NaN,this.binX=NaN,this.binY=NaN,this.binZ=NaN,this.rp1X=NaN,this.rp1Y=NaN,this.rp1Z=NaN,this.rp2X=NaN,this.rp2Y=NaN,this.rp2Z=NaN,this.norU1X=NaN,this.norU1Y=NaN,this.norU1Z=NaN,this.norU2X=NaN,this.norU2Y=NaN,this.norU2Z=NaN,this.tanU1X=NaN,this.tanU1Y=NaN,this.tanU1Z=NaN,this.tanU2X=NaN,this.tanU2Y=NaN,this.tanU2Z=NaN,this.binU1X=NaN,this.binU1Y=NaN,this.binU1Z=NaN,this.binU2X=NaN,this.binU2Y=NaN,this.binU2Z=NaN,this.norT1X=NaN,this.norT1Y=NaN,this.norT1Z=NaN,this.norT2X=NaN,this.norT2Y=NaN,this.norT2Z=NaN,this.tanT1X=NaN,this.tanT1Y=NaN,this.tanT1Z=NaN,this.tanT2X=NaN,this.tanT2Y=NaN,this.tanT2Z=NaN,this.binT1X=NaN,this.binT1Y=NaN,this.binT1Z=NaN,this.binT2X=NaN,this.binT2Y=NaN,this.binT2Z=NaN,this.norTU1X=NaN,this.norTU1Y=NaN,this.norTU1Z=NaN,this.norTU2X=NaN,this.norTU2Y=NaN,this.norTU2Z=NaN,this.tanTU1X=NaN,this.tanTU1Y=NaN,this.tanTU1Z=NaN,this.tanTU2X=NaN,this.tanTU2Y=NaN,this.tanTU2Z=NaN,this.binTU1X=NaN,this.binTU1Y=NaN,this.binTU1Z=NaN,this.binTU2X=NaN,this.binTU2Y=NaN,this.binTU2Z=NaN,this.norImp=NaN,this.tanImp=NaN,this.binImp=NaN,this.norDen=NaN,this.tanDen=NaN,this.binDen=NaN,this.norTar=NaN,this.next=null,this.last=!1}function O(t){y.call(this),this.manifold=t,this.restitution=NaN,this.friction=NaN,this.p1=null,this.p2=null,this.lv1=null,this.lv2=null,this.av1=null,this.av2=null,this.i1=null,this.i2=null,this.ii1=null,this.ii2=null,this.m1=NaN,this.m2=NaN,this.num=0,this.ps=t.points,this.cs=new D,this.cs.next=new D,this.cs.next.next=new D,this.cs.next.next.next=new D}function j(){this.shape1=null,this.shape2=null,this.body1=null,this.body2=null,this.prev=null,this.next=null,this.persisting=!1,this.sleeping=!1,this.detector=null,this.constraint=null,this.touching=!1,this.b1Link=new V(this),this.b2Link=new V(this),this.s1Link=new V(this),this.s2Link=new V(this),this.manifold=new U,this.buffer=[new T,new T,new T,new T],this.points=this.manifold.points,this.constraint=new O(this.manifold)}function C(t,i,s,o){this.position=t||new h,this.orientation=i||new e,this.scale=s||1,this.invScale=o||1,this.name="",this.prev=null,this.next=null,this.type=ct,this.massInfo=new P,this.newPosition=new h,this.controlPos=!1,this.newOrientation=new e,this.newRotation=new h,this.currentRotation=new h,this.controlRot=!1,this.controlRotInTime=!1,this.linearVelocity=new h,this.angularVelocity=new h,this.parent=null,this.contactLink=null,this.numContacts=0,this.shapes=null,this.numShapes=0,this.jointLink=null,this.numJoints=0,this.sleepPosition=new h,this.sleepOrientation=new e,this.isStatic=!1,this.isDynamic=!1,this.rotation=new a,this.mass=NaN,this.inverseMass=NaN,this.inverseInertia=new a,this.localInertia=new a,this.inverseLocalInertia=new a,this.tmpInertia=new a,this.addedToIsland=!1,this.allowSleep=!0,this.sleepTime=0,this.sleeping=!1}function E(t,i){this.shape1=t||null,this.shape2=i||null}function B(){this.types=nt,this.numPairChecks=0,this.numPairs=0,this.pairs=[]}function q(){return Tt++}function Y(t){this.shape=t,this.aabb=t.aabb}function X(t){Y.call(this,t),this.id=q()}function F(){B.call(this),this.types=rt,this.proxies=[]}function R(){this.numElements=0,this.bufferSize=256,this.elements=[],this.elements.length=this.bufferSize,this.stack=new Float32Array(64)}function Z(t,i){this.proxy=t,this.pair=null,this.min1=null,this.max1=null,this.min2=null,this.max2=null,this.max=i,this.value=0}function J(t,i){Y.call(this,i),this.belongsTo=0,this.max=[],this.min=[],this.sap=t,this.min[0]=new Z(this,!1),this.max[0]=new Z(this,!0),this.min[1]=new Z(this,!1),this.max[1]=new Z(this,!0),this.min[2]=new Z(this,!1),this.max[2]=new Z(this,!0),this.max[0].pair=this.min[0],this.max[1].pair=this.min[1],this.max[2].pair=this.min[2],this.min[0].min1=this.min[1],this.min[0].max1=this.max[1],this.min[0].min2=this.min[2],this.min[0].max2=this.max[2],this.min[1].min1=this.min[0],this.min[1].max1=this.max[0],this.min[1].min2=this.min[2],this.min[1].max2=this.max[2],this.min[2].min1=this.min[0],this.min[2].max1=this.max[0],this.min[2].min2=this.min[1],this.min[2].max2=this.max[1]}function W(){B.call(this),this.types=lt,this.numElementsD=0,this.numElementsS=0,this.axesD=[new R,new R,new R],this.axesS=[new R,new R,new R],this.index1=0,this.index2=1}function _(){this.child1=null,this.child2=null,this.parent=null,this.proxy=null,this.height=0,this.aabb=new o}function H(){this.root=null,this.freeNodes=[],this.freeNodes.length=16384,this.numFreeNodes=0,this.aabb=new o}function Q(t){Y.call(this,t),this.leaf=new _,this.leaf.proxy=this}function G(){B.call(this),this.types=mt,this.tree=new H,this.stack=[],this.leaves=[],this.numLeaves=0}function K(){this.flip=!1}function $(){K.call(this),this.clipVertices1=new Float32Array(24),this.clipVertices2=new Float32Array(24),this.used=new Float32Array(8),this.INF=1/0}function tt(t){K.call(this),this.flip=t}function it(){K.call(this)}function st(t){K.call(this),this.flip=t}function ht(t){K.call(this),this.flip=t}function et(){K.call(this)}function at(t){switch(t instanceof Object||(t={}),this.scale=t.worldscale||1,this.invScale=1/this.scale,this.timeStep=t.timestep||.01666,this.numIterations=t.iterations||8,t.broadphase||2){case 1:this.broadPhase=new F;break;case 2:default:this.broadPhase=new W;break;case 3:this.broadPhase=new G}this.Btypes=["None","BruteForce","Sweep & Prune","Bounding Volume Tree"],this.broadPhaseType=this.Btypes[t.broadphase||2],this.performance=null,this.isStat=void 0!==t.info&&t.info,this.isStat&&(this.performance=new s(this)),this.enableRandomizer=void 0===t.random||t.random,this.rigidBodies=null,this.numRigidBodies=0,this.contacts=null,this.unusedContacts=null,this.numContacts=0,this.numContactPoints=0,this.joints=null,this.numJoints=0,this.numIslands=0,this.gravity=new h(0,-9.8,0),void 0!==t.gravity&&this.gravity.fromArray(t.gravity);var i=5;this.detectors=[],this.detectors.length=i;for(var e=i;e--;)this.detectors[e]=[],this.detectors[e].length=i;this.detectors[ft][ft]=new et,this.detectors[ft][Nt]=new st(!1),this.detectors[Nt][ft]=new st(!0),this.detectors[Nt][Nt]=new $,this.detectors[vt][vt]=new it,this.detectors[vt][Nt]=new tt(!0),this.detectors[Nt][vt]=new tt(!1),this.detectors[vt][ft]=new ht(!0),this.detectors[ft][vt]=new ht(!1),this.randX=65535,this.randA=98765,this.randB=123456789,this.islandRigidBodies=[],this.islandStack=[],this.islandConstraints=[]}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&!function(){Object.assign=function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),s=1;s<arguments.length;s++){var h=arguments[s];if(void 0!==h&&null!==h)for(var e in h)Object.prototype.hasOwnProperty.call(h,e)&&(i[e]=h[e])}return i}}();var ot="1.0.4",nt=0,rt=1,lt=2,mt=3,ct=0,pt=1,ut=2,yt=3,xt=4,dt=0,ft=1,Nt=2,vt=3,bt=4,zt=0,kt=1,wt=2,Mt=3,It=4,gt=5,Lt=6,St=.005,Pt={sqrt:Math.sqrt,abs:Math.abs,floor:Math.floor,cos:Math.cos,sin:Math.sin,acos:Math.acos,asin:Math.asin,atan2:Math.atan2,round:Math.round,pow:Math.pow,max:Math.max,min:Math.min,random:Math.random,lerp:function(t,i,s){return(1-s)*t+s*i},randInt:function(t,i){return t+Pt.floor(Pt.random()*(i-t+1))},rand:function(t,i){return t+Pt.random()*(i-t)},int:function(t){return Pt.floor(t)},fix:function(t,i){return t.toFixed(i||3,10)},clamp:function(t,i,s){return Pt.max(i,Pt.min(s,t))},degtorad:.017453292519943295,radtodeg:57.29577951308232,PI:3.141592653589793,TwoPI:6.283185307179586,PI90:1.570796326794896,PI270:4.712388980384689,distance:function(t,i){var s=i[0]-t[0],h=i[1]-t[1],e=i[2]-t[2];return Pt.sqrt(s*s+h*h+e*e)},acosClamp:function(t){return t>1?0:t<-1?Pt.PI:Pt.acos(t)},dotVectors:function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z}};Object.assign(s.prototype,{setTime:function(t){this.times[t||0]=performance.now()},resetMax:function(){this.MaxBroadPhaseTime=0,this.MaxNarrowPhaseTime=0,this.MaxSolvingTime=0,this.MaxTotalTime=0,this.MaxUpdateTime=0},calcBroadPhase:function(){this.setTime(2),this.broadPhaseTime=this.times[2]-this.times[1]},calcNarrowPhase:function(){this.setTime(3),this.narrowPhaseTime=this.times[3]-this.times[2]},calcEnd:function(){this.setTime(2),this.solvingTime=this.times[2]-this.times[1],this.totalTime=this.times[2]-this.times[0],this.updateTime=this.totalTime-(this.broadPhaseTime+this.narrowPhaseTime+this.solvingTime),100===this.tt&&this.resetMax(),this.tt>100&&(this.broadPhaseTime>this.MaxBroadPhaseTime&&(this.MaxBroadPhaseTime=this.broadPhaseTime),this.narrowPhaseTime>this.MaxNarrowPhaseTime&&(this.MaxNarrowPhaseTime=this.narrowPhaseTime),this.solvingTime>this.MaxSolvingTime&&(this.MaxSolvingTime=this.solvingTime),this.totalTime>this.MaxTotalTime&&(this.MaxTotalTime=this.totalTime),this.updateTime>this.MaxUpdateTime&&(this.MaxUpdateTime=this.updateTime)),this.upfps(),this.tt++,this.tt>500&&(this.tt=0)},upfps:function(){this.f[1]=Date.now(),this.f[1]-1e3>this.f[0]&&(this.f[0]=this.f[1],this.fps=this.f[2],this.f[2]=0),this.f[2]++},show:function(){var t=["Oimo.js "+this.version+"<br>",this.broadPhase+"<br><br>","FPS: "+this.fps+" fps<br><br>","rigidbody "+this.parent.numRigidBodies+"<br>","contact &nbsp;&nbsp;"+this.parent.numContacts+"<br>","ct-point &nbsp;"+this.parent.numContactPoints+"<br>","paircheck "+this.parent.broadPhase.numPairChecks+"<br>","island &nbsp;&nbsp;&nbsp;"+this.parent.numIslands+"<br><br>","Time in milliseconds<br><br>","broadphase &nbsp;"+Pt.fix(this.broadPhaseTime)+" | "+Pt.fix(this.MaxBroadPhaseTime)+"<br>","narrowphase "+Pt.fix(this.narrowPhaseTime)+" | "+Pt.fix(this.MaxNarrowPhaseTime)+"<br>","solving &nbsp;&nbsp;&nbsp;&nbsp;"+Pt.fix(this.solvingTime)+" | "+Pt.fix(this.MaxSolvingTime)+"<br>","total &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+Pt.fix(this.totalTime)+" | "+Pt.fix(this.MaxTotalTime)+"<br>","updating &nbsp;&nbsp;&nbsp;"+Pt.fix(this.updateTime)+" | "+Pt.fix(this.MaxUpdateTime)+"<br>"].join("\n");return t},toArray:function(){return this.infos[0]=this.parent.broadPhase.types,this.infos[1]=this.parent.numRigidBodies,this.infos[2]=this.parent.numContacts,this.infos[3]=this.parent.broadPhase.numPairChecks,this.infos[4]=this.parent.numContactPoints,this.infos[5]=this.parent.numIslands,this.infos[6]=this.broadPhaseTime,this.infos[7]=this.narrowPhaseTime,this.infos[8]=this.solvingTime,this.infos[9]=this.updateTime,this.infos[10]=this.totalTime,this.infos[11]=this.fps,this.infos}}),Object.assign(h.prototype,{Vec3:!0,set:function(t,i,s){return this.x=t,this.y=i,this.z=s,this},add:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},addEqual:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},addTime:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this},sub:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},subEqual:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},addScale:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this},scale:function(t,i){return this.x=t.x*i,this.y=t.y*i,this.z=t.z*i,this},scaleEqual:function(t){return this.x*=t,this.y*=t,this.z*=t,this},cross:function(t,i){var s=t.x,h=t.y,e=t.z,a=i.x,o=i.y,n=i.z;return this.x=h*n-e*o,this.y=e*a-s*n,this.z=s*o-h*a,this},crossVectors:function(t,i){var s=t.x,h=t.y,e=t.z,a=i.x,o=i.y,n=i.z;return this.x=h*n-e*o,this.y=e*a-s*n,this.z=s*o-h*a,this},tangent:function(t){var i=t.x,s=t.y,h=t.z;return this.x=s*i-h*h,this.y=-h*s-i*i,this.z=i*h+s*s,this},mul:function(t,i,s){var h=s.elements;return this.x=t.x+i.x*h[0]+i.y*h[1]+i.z*h[2],this.y=t.y+i.x*h[3]+i.y*h[4]+i.z*h[5],this.z=t.z+i.x*h[6]+i.y*h[7]+i.z*h[8],this},mulMat:function(t,i){var s=t.elements;return this.x=s[0]*i.x+s[1]*i.y+s[2]*i.z,this.y=s[3]*i.x+s[4]*i.y+s[5]*i.z,this.z=s[6]*i.x+s[7]*i.y+s[8]*i.z,this},mulManifold:function(t,i){var s=t.elements;return this.x=s[0]*i.x+s[3]*i.y+s[6]*i.z,this.y=s[1]*i.x+s[4]*i.y+s[7]*i.z,this.z=s[2]*i.x+s[5]*i.y+s[8]*i.z,this},invert:function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Pt.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},applyQuaternion:function(t){var i=this.x,s=this.y,h=this.z,e=t.x,a=t.y,o=t.z,n=t.w,r=n*i+a*h-o*s,l=n*s+o*i-e*h,m=n*h+e*s-a*i,c=-e*i-a*s-o*h;return this.x=r*n+c*-e+l*-o-m*-a,this.y=l*n+c*-a+m*-e-r*-o,this.z=m*n+c*-o+r*-a-l*-e,this},testZero:function(){return 0!==this.x||0!==this.y||0!==this.z},testDiff:function(t){return t.x!==this.x||t.y!==this.y||t.z!==this.z},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},clone:function(){return new this.constructor(this.x,this.y,this.z)},toString:function(){return"Vec3["+this.x.toFixed(4)+", "+this.y.toFixed(4)+", "+this.z.toFixed(4)+"]"},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),this},divideScalar:function(t){return this.multiplyScalar(1/t)},normalize:function(){return this.divideScalar(this.length())},toArray:function(t,i){void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z},fromArray:function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}}),Object.assign(e.prototype,{Quat:!0,set:function(t,i,s,h){return this.x=t,this.y=i,this.z=s,this.w=h,this},add:function(t,i){return this.w=t.w+i.w,this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},addTime:function(t,i){var s=t.x,h=t.y,e=t.z,a=this.w,o=this.x,n=this.y,r=this.z;i*=.5;var l=(-s*o-h*n-e*r)*i,m=(s*a+h*r-e*n)*i,c=(-s*r+h*a+e*o)*i,p=(s*n-h*o+e*a)*i;a+=l,o+=m,n+=c,r+=p;var u=1/Pt.sqrt(a*a+o*o+n*n+r*r);return this.w=a*u,this.x=o*u,this.y=n*u,this.z=r*u,this},sub:function(t,i){return this.w=t.w-i.w,this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},scale:function(t,i){return this.w=t.w*i,this.x=t.x*i,this.y=t.y*i,this.z=t.z*i,this},mul:function(t,i){var s=t.x,h=t.y,e=t.z,a=t.w,o=i.x,n=i.y,r=i.z,l=i.w;return this.x=s*l+a*o+h*r-e*n,this.y=h*l+a*n+e*o-s*r,this.z=e*l+a*r+s*n-h*o,this.w=a*l-s*o-h*n-e*r,this},arc:function(t,i){var s=t.x,h=t.y,e=t.z,a=i.x,o=i.y,n=i.z,r=s*a+h*o+e*n;if(r==-1)return a=h*s-e*e,o=-e*h-s*s,n=s*e+h*h,r=1/Pt.sqrt(a*a+o*o+n*n),this.w=0,this.x=a*r,this.y=o*r,this.z=n*r,this;var l=h*n-e*o,m=e*a-s*n,c=s*o-h*a;return this.w=Pt.sqrt(.5*(1+r)),r=.5/this.w,this.x=l*r,this.y=m*r,this.z=c*r,this},normalize:function(){var t=Pt.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),this.w=this.w*t,this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this},invert:function(t){return this.w=t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,this},length:function(){return Pt.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z)},copy:function(t){return this.w=t.w,this.x=t.x,this.y=t.y,this.z=t.z,this},testDiff:function(t){return this.w!==t.w||this.x!==t.x||this.y!==t.y||this.z!==t.z},clone:function(t){return new e(this.x,this.y,this.z,this.w)},toString:function(){return"Quat["+this.x.toFixed(4)+", ("+this.y.toFixed(4)+", "+this.z.toFixed(4)+", "+this.w.toFixed(4)+")]"},setFromEuler:function(t,i,s){var h=Math.cos(.5*t),e=Math.cos(.5*i),a=Math.cos(.5*s),o=Math.sin(.5*t),n=Math.sin(.5*i),r=Math.sin(.5*s);return this.x=o*e*a+h*n*r,this.y=h*n*a-o*e*r,this.z=h*e*r+o*n*a,this.w=h*e*a-o*n*r,this},setFromAxis:function(t,i,s,h){var e=i*i+s*s+h*h;e>0&&(e=1/Pt.sqrt(e),i*=e,s*=e,h*=e);var a=Pt.sin(.5*t);return this.x=a*i,this.y=a*s,this.z=a*h,this.w=Pt.cos(.5*t),this},setFromRotationMatrix:function(t){var i,s=t.elements,h=s[0],e=s[1],a=s[2],o=s[3],n=s[4],r=s[5],l=s[6],m=s[7],c=s[8],p=h+n+c;return p>0?(i=.5/Pt.sqrt(p+1),this.w=.25/i,this.x=(m-r)*i,this.y=(a-l)*i,this.z=(o-e)*i):h>n&&h>c?(i=2*Pt.sqrt(1+h-n-c),this.w=(m-r)/i,this.x=.25*i,this.y=(e+o)/i,this.z=(a+l)/i):n>c?(i=2*Pt.sqrt(1+n-h-c),this.w=(a-l)/i,this.x=(e+o)/i,this.y=.25*i,this.z=(r+m)/i):(i=2*Pt.sqrt(1+c-h-n),this.w=(o-e)/i,this.x=(a+l)/i,this.y=(r+m)/i,this.z=.25*i),this},toArray:function(t,i){i=i||0,t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w},fromArray:function(t,i){return i=i||0,this.set(t[i],t[i+1],t[i+2],t[i+3]),this}}),Object.assign(a.prototype,{Mat33:!0,set:function(t,i,s,h,e,a,o,n,r){var l=this.elements;return l[0]=t,l[1]=i,l[2]=s,l[3]=h,l[4]=e,l[5]=a,l[6]=o,l[7]=n,l[8]=r,this},multiply:function(t){var i=this.elements;return i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=t,i[4]*=t,i[5]*=t,i[6]*=t,i[7]*=t,i[8]*=t,this},add:function(t,i){var s=this.elements,h=t.elements,e=i.elements;return s[0]=h[0]+e[0],s[1]=h[1]+e[1],s[2]=h[2]+e[2],s[3]=h[3]+e[3],s[4]=h[4]+e[4],s[5]=h[5]+e[5],s[6]=h[6]+e[6],s[7]=h[7]+e[7],s[8]=h[8]+e[8],this},addEqual:function(t){var i=this.elements,s=t.elements;return i[0]+=s[0],i[1]+=s[1],i[2]+=s[2],i[3]+=s[3],i[4]+=s[4],i[5]+=s[5],i[6]+=s[6],i[7]+=s[7],i[8]+=s[8],this},sub:function(t,i){var s=this.elements,h=t.elements,e=i.elements;return s[0]=h[0]-e[0],s[1]=h[1]-e[1],s[2]=h[2]-e[2],s[3]=h[3]-e[3],s[4]=h[4]-e[4],s[5]=h[5]-e[5],s[6]=h[6]-e[6],s[7]=h[7]-e[7],s[8]=h[8]-e[8],this},subEqual:function(t){var i=this.elements,s=t.elements;return i[0]-=s[0],i[1]-=s[1],i[2]-=s[2],i[3]-=s[3],i[4]-=s[4],i[5]-=s[5],i[6]-=s[6],i[7]-=s[7],i[8]-=s[8],this},scale:function(t,i){var s=this.elements,h=t.elements;return s[0]=h[0]*i,s[1]=h[1]*i,s[2]=h[2]*i,s[3]=h[3]*i,s[4]=h[4]*i,s[5]=h[5]*i,s[6]=h[6]*i,s[7]=h[7]*i,s[8]=h[8]*i,this},scaleEqual:function(t){var i=this.elements;return i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=t,i[4]*=t,i[5]*=t,
i[6]*=t,i[7]*=t,i[8]*=t,this},mul:function(t,i,s){var h,e=this.elements,a=t.elements,o=i.elements,n=a[0],r=a[3],l=a[6],m=a[1],c=a[4],p=a[7],u=a[2],y=a[5],x=a[8],d=o[0],f=o[3],N=o[6],v=o[1],b=o[4],z=o[7],k=o[2],w=o[5],M=o[8];return s&&(h=v,v=f,f=h,h=k,k=N,N=h,h=w,w=z,z=h),e[0]=n*d+m*f+u*N,e[1]=n*v+m*b+u*z,e[2]=n*k+m*w+u*M,e[3]=r*d+c*f+y*N,e[4]=r*v+c*b+y*z,e[5]=r*k+c*w+y*M,e[6]=l*d+p*f+x*N,e[7]=l*v+p*b+x*z,e[8]=l*k+p*w+x*M,this},setQuat:function(t){var i=this.elements,s=t.x,h=t.y,e=t.z,a=t.w,o=s+s,n=h+h,r=e+e,l=s*o,m=s*n,c=s*r,p=h*n,u=h*r,y=e*r,x=a*o,d=a*n,f=a*r;return i[0]=1-(p+y),i[1]=m-f,i[2]=c+d,i[3]=m+f,i[4]=1-(l+y),i[5]=u-x,i[6]=c-d,i[7]=u+x,i[8]=1-(l+p),this},invert:function(t){var i=this.elements,s=t.elements,h=s[0],e=s[3],a=s[6],o=s[1],n=s[4],r=s[7],l=s[2],m=s[5],c=s[8],p=n*c-r*m,u=r*l-o*c,y=o*m-n*l,x=h*p+e*u+a*y;return 0!=x&&(x=1/x),i[0]=x*p,i[1]=x*u,i[2]=x*y,i[3]=x*(m*a-e*c),i[4]=x*(h*c-l*a),i[5]=x*(l*e-h*m),i[6]=x*(e*r-n*a),i[7]=x*(o*a-h*r),i[8]=x*(h*n-o*e),this},addOffset:function(t,i){var s=i.x,h=i.y,e=i.z,a=this.elements;a[0]+=t*(h*h+e*e),a[4]+=t*(s*s+e*e),a[8]+=t*(s*s+h*h);var o=t*s*h,n=t*h*e,r=t*e*s;return a[1]-=o,a[3]-=o,a[2]-=n,a[6]-=n,a[5]-=r,a[7]-=r,this},subOffset:function(t,i){var s=i.x,h=i.y,e=i.z,a=this.elements;a[0]-=t*(h*h+e*e),a[4]-=t*(s*s+e*e),a[8]-=t*(s*s+h*h);var o=t*s*h,n=t*h*e,r=t*e*s;return a[1]+=o,a[3]+=o,a[2]+=n,a[6]+=n,a[5]+=r,a[7]+=r,this},multiplyScalar:function(t){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new a).fromArray(this.elements)},copy:function(t){return this.elements.set(t.elements),this},fromArray:function(t,i){void 0===i&&(i=0);for(var s=0;s<9;s++)this.elements[s]=t[s+i];return this},toArray:function(t,i){void 0===t&&(t=[]),void 0===i&&(i=0);var s=this.elements;return t[i]=s[0],t[i+1]=s[1],t[i+2]=s[2],t[i+3]=s[3],t[i+4]=s[4],t[i+5]=s[5],t[i+6]=s[6],t[i+7]=s[7],t[i+8]=s[8],t}}),Object.assign(o.prototype,{AABB:!0,set:function(t,i,s,h,e,a){var o=this.elements;return o[0]=t,o[3]=i,o[1]=s,o[4]=h,o[2]=e,o[5]=a,this},intersectTest:function(t){var i=this.elements,s=t.elements;return!(i[0]>s[3]||i[1]>s[4]||i[2]>s[5]||i[3]<s[0]||i[4]<s[1]||i[5]<s[2])},intersectTestTwo:function(t){var i=this.elements,s=t.elements;return!(i[0]<s[0]||i[1]<s[1]||i[2]<s[2]||i[3]>s[3]||i[4]>s[4]||i[5]>s[5])},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t,i){var s=i||0,h=t.elements;return this.set(h[0]-s,h[3]+s,h[1]-s,h[4]+s,h[2]-s,h[5]+s),this},fromArray:function(t){return this.elements.set(t),this},combine:function(t,i){var s=t.elements,h=i.elements,e=this.elements;return e[0]=s[0]<h[0]?s[0]:h[0],e[1]=s[1]<h[1]?s[1]:h[1],e[2]=s[2]<h[2]?s[2]:h[2],e[3]=s[3]>h[3]?s[3]:h[3],e[4]=s[4]>h[4]?s[4]:h[4],e[5]=s[5]>h[5]?s[5]:h[5],this},surfaceArea:function(){var t=this.elements,i=t[3]-t[0],s=t[4]-t[1],h=t[5]-t[2];return 2*(i*(s+h)+s*h)},intersectsWithPoint:function(t,i,s){var h=this.elements;return t>=h[0]&&t<=h[3]&&i>=h[1]&&i<=h[4]&&s>=h[2]&&s<=h[5]},setFromPoints:function(t){this.makeEmpty();for(var i=0;i<t.length;i++)this.expandByPoint(t[i])},makeEmpty:function(){this.set(-(1/0),-(1/0),-(1/0),1/0,1/0,1/0)},expandByPoint:function(t){var i=this.elements;this.set(Pt.min(i[0],t.x),Pt.min(i[1],t.y),Pt.min(i[2],t.z),Pt.max(i[3],t.x),Pt.max(i[4],t.y),Pt.max(i[5],t.z))},expandByScalar:function(t){var i=this.elements;i[0]+=-t,i[1]+=-t,i[2]+=-t,i[3]+=t,i[4]+=t,i[5]+=t}});var Vt=0;Object.assign(r.prototype,{calculateMassInfo:function(t){i("Shape","Inheritance error.")},updateProxy:function(){i("Shape","Inheritance error.")}}),l.prototype=Object.assign(Object.create(r.prototype),{constructor:l,calculateMassInfo:function(t){var i=this.width*this.height*this.depth*this.density,s=1/12;t.mass=i,t.inertia.set(i*(this.height*this.height+this.depth*this.depth)*s,0,0,0,i*(this.width*this.width+this.depth*this.depth)*s,0,0,0,i*(this.width*this.width+this.height*this.height)*s)},updateProxy:function(){var t=this.rotation.elements,i=this.dimentions;i[0]=t[0],i[1]=t[3],i[2]=t[6],i[3]=t[1],i[4]=t[4],i[5]=t[7],i[6]=t[2],i[7]=t[5],i[8]=t[8],i[9]=t[0]*this.halfWidth,i[10]=t[3]*this.halfWidth,i[11]=t[6]*this.halfWidth,i[12]=t[1]*this.halfHeight,i[13]=t[4]*this.halfHeight,i[14]=t[7]*this.halfHeight,i[15]=t[2]*this.halfDepth,i[16]=t[5]*this.halfDepth,i[17]=t[8]*this.halfDepth;var s=i[9],h=i[10],e=i[11],a=i[12],o=i[13],n=i[14],r=i[15],l=i[16],m=i[17],c=this.position.x,p=this.position.y,u=this.position.z,y=this.elements;y[0]=c+s+a+r,y[1]=p+h+o+l,y[2]=u+e+n+m,y[3]=c+s+a-r,y[4]=p+h+o-l,y[5]=u+e+n-m,y[6]=c+s-a+r,y[7]=p+h-o+l,y[8]=u+e-n+m,y[9]=c+s-a-r,y[10]=p+h-o-l,y[11]=u+e-n-m,y[12]=c-s+a+r,y[13]=p-h+o+l,y[14]=u-e+n+m,y[15]=c-s+a-r,y[16]=p-h+o-l,y[17]=u-e+n-m,y[18]=c-s-a+r,y[19]=p-h-o+l,y[20]=u-e-n+m,y[21]=c-s-a-r,y[22]=p-h-o-l,y[23]=u-e-n-m;var x=i[9]<0?-i[9]:i[9],d=i[10]<0?-i[10]:i[10],f=i[11]<0?-i[11]:i[11];x=i[12]<0?x-i[12]:x+i[12],d=i[13]<0?d-i[13]:d+i[13],f=i[14]<0?f-i[14]:f+i[14],x=i[15]<0?x-i[15]:x+i[15],d=i[16]<0?d-i[16]:d+i[16],f=i[17]<0?f-i[17]:f+i[17];var N=St;this.aabb.set(this.position.x-x-N,this.position.x+x+N,this.position.y-d-N,this.position.y+d+N,this.position.z-f-N,this.position.z+f+N),null!=this.proxy&&this.proxy.update()}}),m.prototype=Object.assign(Object.create(r.prototype),{constructor:m,calculateMassInfo:function(t){var i=1.333*Pt.PI*this.radius*this.radius*this.radius*this.density;t.mass=i;var s=i*this.radius*this.radius*.4;t.inertia.set(s,0,0,0,s,0,0,0,s)},updateProxy:function(){var t=St;this.aabb.set(this.position.x-this.radius-t,this.position.x+this.radius+t,this.position.y-this.radius-t,this.position.y+this.radius+t,this.position.z-this.radius-t,this.position.z+this.radius+t),null!=this.proxy&&this.proxy.update()}}),c.prototype=Object.assign(Object.create(r.prototype),{constructor:c,calculateMassInfo:function(t){var i=this.radius*this.radius,s=Pt.PI*i*this.height*this.density,h=(.25*i+.0833*this.height*this.height)*s,e=.5*i;t.mass=s,t.inertia.set(h,0,0,0,e,0,0,0,h)},updateProxy:function(){var t,i,s,h,e,a,o,n,r,l,m,c=this.rotation.elements;e=c[1]*c[1],a=c[4]*c[4],o=c[7]*c[7],this.normalDirection.set(c[1],c[4],c[7]),this.halfDirection.scale(this.normalDirection,this.halfHeight),i=1-e,t=Pt.sqrt(i*i+e*a+e*o),t>0&&(t=this.radius/t),i*=t,s=1-a,t=Pt.sqrt(a*e+s*s+a*o),t>0&&(t=this.radius/t),s*=t,h=1-o,t=Pt.sqrt(o*e+o*a+h*h),t>0&&(t=this.radius/t),h*=t,n=this.halfDirection.x<0?-this.halfDirection.x:this.halfDirection.x,r=this.halfDirection.y<0?-this.halfDirection.y:this.halfDirection.y,l=this.halfDirection.z<0?-this.halfDirection.z:this.halfDirection.z,n=i<0?n-i:n+i,r=s<0?r-s:r+s,l=h<0?l-h:l+h,m=St,this.aabb.set(this.position.x-n-m,this.position.x+n+m,this.position.y-r-m,this.position.y+r+m,this.position.z-l-m,this.position.z+l+m),null!=this.proxy&&this.proxy.update()}}),u.prototype={constructor:u,setLimit:function(t,i){this.lowerLimit=t,this.upperLimit=i},setMotor:function(t,i){this.motorSpeed=t,this.maxMotorForce=i},setSpring:function(t,i){this.frequency=t,this.dampingRatio=i}},Object.assign(y.prototype,{preSolve:function(t,s){i("Constraint","Inheritance error.")},solve:function(){i("Constraint","Inheritance error.")},postSolve:function(){i("Constraint","Inheritance error.")}}),d.prototype=Object.assign(Object.create(y.prototype),{constructor:d,updateAnchorPoints:function(){this.relativeAnchorPoint1.mulMat(this.body1.rotation,this.localAnchorPoint1),this.relativeAnchorPoint2.mulMat(this.body2.rotation,this.localAnchorPoint2),this.anchorPoint1.add(this.relativeAnchorPoint1,this.body1.position),this.anchorPoint2.add(this.relativeAnchorPoint2,this.body2.position)},attach:function(t){this.b1Link.body=this.body2,this.b2Link.body=this.body1,t?(this.body1.jointLink.push(this.b1Link),this.body2.jointLink.push(this.b2Link)):(null!=this.body1.jointLink?(this.b1Link.next=this.body1.jointLink).prev=this.b1Link:this.b1Link.next=null,this.body1.jointLink=this.b1Link,this.body1.numJoints++,null!=this.body2.jointLink?(this.b2Link.next=this.body2.jointLink).prev=this.b2Link:this.b2Link.next=null,this.body2.jointLink=this.b2Link,this.body2.numJoints++)},detach:function(t){if(t)this.body1.jointLink.splice(this.body1.jointLink.indexOf(this.b1Link),1),this.body2.jointLink.splice(this.body2.jointLink.indexOf(this.b2Link),1);else{var i=this.b1Link.prev,s=this.b1Link.next;null!=i&&(i.next=s),null!=s&&(s.prev=i),this.body1.jointLink==this.b1Link&&(this.body1.jointLink=s),this.b1Link.prev=null,this.b1Link.next=null,this.b1Link.body=null,this.body1.numJoints--,i=this.b2Link.prev,s=this.b2Link.next,null!=i&&(i.next=s),null!=s&&(s.prev=i),this.body2.jointLink==this.b2Link&&(this.body2.jointLink=s),this.b2Link.prev=null,this.b2Link.next=null,this.b2Link.body=null,this.body2.numJoints--}this.b1Link.body=null,this.b2Link.body=null},awake:function(){this.body1.awake(),this.body2.awake()},preSolve:function(t,i){},solve:function(){},postSolve:function(){},remove:function(){this.dispose()},dispose:function(){this.parent.removeJoint(this)},getPosition:function(){var t=(new h).scale(this.anchorPoint1,this.scale),i=(new h).scale(this.anchorPoint2,this.scale);return[t,i]}}),Object.assign(f.prototype,{LinearConstraint:!0,preSolve:function(t,i){this.r1x=this.r1.x,this.r1y=this.r1.y,this.r1z=this.r1.z,this.r2x=this.r2.x,this.r2y=this.r2.y,this.r2z=this.r2.z,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass,this.ii1=this.i1.clone(),this.ii2=this.i2.clone();var s=this.ii1.elements,h=this.ii2.elements;this.ax1x=this.r1z*s[1]+-this.r1y*s[2],this.ax1y=this.r1z*s[4]+-this.r1y*s[5],this.ax1z=this.r1z*s[7]+-this.r1y*s[8],this.ay1x=-this.r1z*s[0]+this.r1x*s[2],this.ay1y=-this.r1z*s[3]+this.r1x*s[5],this.ay1z=-this.r1z*s[6]+this.r1x*s[8],this.az1x=this.r1y*s[0]+-this.r1x*s[1],this.az1y=this.r1y*s[3]+-this.r1x*s[4],this.az1z=this.r1y*s[6]+-this.r1x*s[7],this.ax2x=this.r2z*h[1]+-this.r2y*h[2],this.ax2y=this.r2z*h[4]+-this.r2y*h[5],this.ax2z=this.r2z*h[7]+-this.r2y*h[8],this.ay2x=-this.r2z*h[0]+this.r2x*h[2],this.ay2y=-this.r2z*h[3]+this.r2x*h[5],this.ay2z=-this.r2z*h[6]+this.r2x*h[8],this.az2x=this.r2y*h[0]+-this.r2x*h[1],this.az2y=this.r2y*h[3]+-this.r2x*h[4],this.az2z=this.r2y*h[6]+-this.r2x*h[7];var e=this.m1+this.m2,o=(new a).set(e,0,0,0,e,0,0,0,e),n=o.elements;n[0]+=s[4]*this.r1z*this.r1z-(s[7]+s[5])*this.r1y*this.r1z+s[8]*this.r1y*this.r1y,n[1]+=(s[6]*this.r1y+s[5]*this.r1x)*this.r1z-s[3]*this.r1z*this.r1z-s[8]*this.r1x*this.r1y,n[2]+=(s[3]*this.r1y-s[4]*this.r1x)*this.r1z-s[6]*this.r1y*this.r1y+s[7]*this.r1x*this.r1y,n[3]+=(s[2]*this.r1y+s[7]*this.r1x)*this.r1z-s[1]*this.r1z*this.r1z-s[8]*this.r1x*this.r1y,n[4]+=s[0]*this.r1z*this.r1z-(s[6]+s[2])*this.r1x*this.r1z+s[8]*this.r1x*this.r1x,n[5]+=(s[1]*this.r1x-s[0]*this.r1y)*this.r1z-s[7]*this.r1x*this.r1x+s[6]*this.r1x*this.r1y,n[6]+=(s[1]*this.r1y-s[4]*this.r1x)*this.r1z-s[2]*this.r1y*this.r1y+s[5]*this.r1x*this.r1y,n[7]+=(s[3]*this.r1x-s[0]*this.r1y)*this.r1z-s[5]*this.r1x*this.r1x+s[2]*this.r1x*this.r1y,n[8]+=s[0]*this.r1y*this.r1y-(s[3]+s[1])*this.r1x*this.r1y+s[4]*this.r1x*this.r1x,n[0]+=h[4]*this.r2z*this.r2z-(h[7]+h[5])*this.r2y*this.r2z+h[8]*this.r2y*this.r2y,n[1]+=(h[6]*this.r2y+h[5]*this.r2x)*this.r2z-h[3]*this.r2z*this.r2z-h[8]*this.r2x*this.r2y,n[2]+=(h[3]*this.r2y-h[4]*this.r2x)*this.r2z-h[6]*this.r2y*this.r2y+h[7]*this.r2x*this.r2y,n[3]+=(h[2]*this.r2y+h[7]*this.r2x)*this.r2z-h[1]*this.r2z*this.r2z-h[8]*this.r2x*this.r2y,n[4]+=h[0]*this.r2z*this.r2z-(h[6]+h[2])*this.r2x*this.r2z+h[8]*this.r2x*this.r2x,n[5]+=(h[1]*this.r2x-h[0]*this.r2y)*this.r2z-h[7]*this.r2x*this.r2x+h[6]*this.r2x*this.r2y,n[6]+=(h[1]*this.r2y-h[4]*this.r2x)*this.r2z-h[2]*this.r2y*this.r2y+h[5]*this.r2x*this.r2y,n[7]+=(h[3]*this.r2x-h[0]*this.r2y)*this.r2z-h[5]*this.r2x*this.r2x+h[2]*this.r2x*this.r2y,n[8]+=h[0]*this.r2y*this.r2y-(h[3]+h[1])*this.r2x*this.r2y+h[4]*this.r2x*this.r2x;var r=1/(n[0]*(n[4]*n[8]-n[7]*n[5])+n[3]*(n[7]*n[2]-n[1]*n[8])+n[6]*(n[1]*n[5]-n[4]*n[2]));this.dd=(new a).set(n[4]*n[8]-n[5]*n[7],n[2]*n[7]-n[1]*n[8],n[1]*n[5]-n[2]*n[4],n[5]*n[6]-n[3]*n[8],n[0]*n[8]-n[2]*n[6],n[2]*n[3]-n[0]*n[5],n[3]*n[7]-n[4]*n[6],n[1]*n[6]-n[0]*n[7],n[0]*n[4]-n[1]*n[3]).multiply(r),this.velx=this.p2.x-this.p1.x,this.vely=this.p2.y-this.p1.y,this.velz=this.p2.z-this.p1.z;var l=Pt.sqrt(this.velx*this.velx+this.vely*this.vely+this.velz*this.velz);l>.005?(l=(.005-l)/l*i*.05,this.velx*=l,this.vely*=l,this.velz*=l):(this.velx=0,this.vely=0,this.velz=0),this.impx*=.95,this.impy*=.95,this.impz*=.95,this.l1.x+=this.impx*this.m1,this.l1.y+=this.impy*this.m1,this.l1.z+=this.impz*this.m1,this.a1.x+=this.impx*this.ax1x+this.impy*this.ay1x+this.impz*this.az1x,this.a1.y+=this.impx*this.ax1y+this.impy*this.ay1y+this.impz*this.az1y,this.a1.z+=this.impx*this.ax1z+this.impy*this.ay1z+this.impz*this.az1z,this.l2.x-=this.impx*this.m2,this.l2.y-=this.impy*this.m2,this.l2.z-=this.impz*this.m2,this.a2.x-=this.impx*this.ax2x+this.impy*this.ay2x+this.impz*this.az2x,this.a2.y-=this.impx*this.ax2y+this.impy*this.ay2y+this.impz*this.az2y,this.a2.z-=this.impx*this.ax2z+this.impy*this.ay2z+this.impz*this.az2z},solve:function(){var t=this.dd.elements,i=this.l2.x-this.l1.x+this.a2.y*this.r2z-this.a2.z*this.r2y-this.a1.y*this.r1z+this.a1.z*this.r1y-this.velx,s=this.l2.y-this.l1.y+this.a2.z*this.r2x-this.a2.x*this.r2z-this.a1.z*this.r1x+this.a1.x*this.r1z-this.vely,h=this.l2.z-this.l1.z+this.a2.x*this.r2y-this.a2.y*this.r2x-this.a1.x*this.r1y+this.a1.y*this.r1x-this.velz,e=i*t[0]+s*t[1]+h*t[2],a=i*t[3]+s*t[4]+h*t[5],o=i*t[6]+s*t[7]+h*t[8];this.impx+=e,this.impy+=a,this.impz+=o,this.l1.x+=e*this.m1,this.l1.y+=a*this.m1,this.l1.z+=o*this.m1,this.a1.x+=e*this.ax1x+a*this.ay1x+o*this.az1x,this.a1.y+=e*this.ax1y+a*this.ay1y+o*this.az1y,this.a1.z+=e*this.ax1z+a*this.ay1z+o*this.az1z,this.l2.x-=e*this.m2,this.l2.y-=a*this.m2,this.l2.z-=o*this.m2,this.a2.x-=e*this.ax2x+a*this.ay2x+o*this.az2x,this.a2.y-=e*this.ax2y+a*this.ay2y+o*this.az2y,this.a2.z-=e*this.ax2z+a*this.ay2z+o*this.az2z}}),Object.assign(N.prototype,{Rotational3Constraint:!0,preSolve:function(t,i){this.ax1=this.limitMotor1.axis.x,this.ay1=this.limitMotor1.axis.y,this.az1=this.limitMotor1.axis.z,this.ax2=this.limitMotor2.axis.x,this.ay2=this.limitMotor2.axis.y,this.az2=this.limitMotor2.axis.z,this.ax3=this.limitMotor3.axis.x,this.ay3=this.limitMotor3.axis.y,this.az3=this.limitMotor3.axis.z,this.lowerLimit1=this.limitMotor1.lowerLimit,this.upperLimit1=this.limitMotor1.upperLimit,this.motorSpeed1=this.limitMotor1.motorSpeed,this.maxMotorForce1=this.limitMotor1.maxMotorForce,this.enableMotor1=this.maxMotorForce1>0,this.lowerLimit2=this.limitMotor2.lowerLimit,this.upperLimit2=this.limitMotor2.upperLimit,this.motorSpeed2=this.limitMotor2.motorSpeed,this.maxMotorForce2=this.limitMotor2.maxMotorForce,this.enableMotor2=this.maxMotorForce2>0,this.lowerLimit3=this.limitMotor3.lowerLimit,this.upperLimit3=this.limitMotor3.upperLimit,this.motorSpeed3=this.limitMotor3.motorSpeed,this.maxMotorForce3=this.limitMotor3.maxMotorForce,this.enableMotor3=this.maxMotorForce3>0;var s=this.i1.elements,h=this.i2.elements;this.i1e00=s[0],this.i1e01=s[1],this.i1e02=s[2],this.i1e10=s[3],this.i1e11=s[4],this.i1e12=s[5],this.i1e20=s[6],this.i1e21=s[7],this.i1e22=s[8],this.i2e00=h[0],this.i2e01=h[1],this.i2e02=h[2],this.i2e10=h[3],this.i2e11=h[4],this.i2e12=h[5],this.i2e20=h[6],this.i2e21=h[7],this.i2e22=h[8];var e=this.limitMotor1.frequency,a=this.limitMotor2.frequency,o=this.limitMotor3.frequency,n=e>0,r=a>0,l=o>0,m=this.lowerLimit1<=this.upperLimit1,c=this.lowerLimit2<=this.upperLimit2,p=this.lowerLimit3<=this.upperLimit3,u=this.limitMotor1.angle;m?(this.lowerLimit1==this.upperLimit1?(0!=this.limitState1&&(this.limitState1=0,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-u):u<this.lowerLimit1?(this.limitState1!=-1&&(this.limitState1=-1,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-u):u>this.upperLimit1?(1!=this.limitState1&&(this.limitState1=1,this.limitImpulse1=0),this.limitVelocity1=this.upperLimit1-u):(this.limitState1=2,this.limitImpulse1=0,this.limitVelocity1=0),n||(this.limitVelocity1>.02?this.limitVelocity1-=.02:this.limitVelocity1<-.02?this.limitVelocity1+=.02:this.limitVelocity1=0)):(this.limitState1=2,this.limitImpulse1=0);var y=this.limitMotor2.angle;c?(this.lowerLimit2==this.upperLimit2?(0!=this.limitState2&&(this.limitState2=0,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-y):y<this.lowerLimit2?(this.limitState2!=-1&&(this.limitState2=-1,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-y):y>this.upperLimit2?(1!=this.limitState2&&(this.limitState2=1,this.limitImpulse2=0),this.limitVelocity2=this.upperLimit2-y):(this.limitState2=2,this.limitImpulse2=0,this.limitVelocity2=0),r||(this.limitVelocity2>.02?this.limitVelocity2-=.02:this.limitVelocity2<-.02?this.limitVelocity2+=.02:this.limitVelocity2=0)):(this.limitState2=2,this.limitImpulse2=0);var x=this.limitMotor3.angle;if(p?(this.lowerLimit3==this.upperLimit3?(0!=this.limitState3&&(this.limitState3=0,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-x):x<this.lowerLimit3?(this.limitState3!=-1&&(this.limitState3=-1,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-x):x>this.upperLimit3?(1!=this.limitState3&&(this.limitState3=1,this.limitImpulse3=0),this.limitVelocity3=this.upperLimit3-x):(this.limitState3=2,this.limitImpulse3=0,this.limitVelocity3=0),l||(this.limitVelocity3>.02?this.limitVelocity3-=.02:this.limitVelocity3<-.02?this.limitVelocity3+=.02:this.limitVelocity3=0)):(this.limitState3=2,this.limitImpulse3=0),this.enableMotor1&&(0!=this.limitState1||n)?this.maxMotorImpulse1=this.maxMotorForce1*t:(this.motorImpulse1=0,this.maxMotorImpulse1=0),this.enableMotor2&&(0!=this.limitState2||r)?this.maxMotorImpulse2=this.maxMotorForce2*t:(this.motorImpulse2=0,this.maxMotorImpulse2=0),this.enableMotor3&&(0!=this.limitState3||l)?this.maxMotorImpulse3=this.maxMotorForce3*t:(this.motorImpulse3=0,this.maxMotorImpulse3=0),this.a1x1=this.ax1*this.i1e00+this.ay1*this.i1e01+this.az1*this.i1e02,this.a1y1=this.ax1*this.i1e10+this.ay1*this.i1e11+this.az1*this.i1e12,this.a1z1=this.ax1*this.i1e20+this.ay1*this.i1e21+this.az1*this.i1e22,this.a2x1=this.ax1*this.i2e00+this.ay1*this.i2e01+this.az1*this.i2e02,this.a2y1=this.ax1*this.i2e10+this.ay1*this.i2e11+this.az1*this.i2e12,this.a2z1=this.ax1*this.i2e20+this.ay1*this.i2e21+this.az1*this.i2e22,this.a1x2=this.ax2*this.i1e00+this.ay2*this.i1e01+this.az2*this.i1e02,this.a1y2=this.ax2*this.i1e10+this.ay2*this.i1e11+this.az2*this.i1e12,this.a1z2=this.ax2*this.i1e20+this.ay2*this.i1e21+this.az2*this.i1e22,this.a2x2=this.ax2*this.i2e00+this.ay2*this.i2e01+this.az2*this.i2e02,this.a2y2=this.ax2*this.i2e10+this.ay2*this.i2e11+this.az2*this.i2e12,this.a2z2=this.ax2*this.i2e20+this.ay2*this.i2e21+this.az2*this.i2e22,this.a1x3=this.ax3*this.i1e00+this.ay3*this.i1e01+this.az3*this.i1e02,this.a1y3=this.ax3*this.i1e10+this.ay3*this.i1e11+this.az3*this.i1e12,this.a1z3=this.ax3*this.i1e20+this.ay3*this.i1e21+this.az3*this.i1e22,this.a2x3=this.ax3*this.i2e00+this.ay3*this.i2e01+this.az3*this.i2e02,this.a2y3=this.ax3*this.i2e10+this.ay3*this.i2e11+this.az3*this.i2e12,this.a2z3=this.ax3*this.i2e20+this.ay3*this.i2e21+this.az3*this.i2e22,this.k00=this.ax1*(this.a1x1+this.a2x1)+this.ay1*(this.a1y1+this.a2y1)+this.az1*(this.a1z1+this.a2z1),this.k01=this.ax1*(this.a1x2+this.a2x2)+this.ay1*(this.a1y2+this.a2y2)+this.az1*(this.a1z2+this.a2z2),this.k02=this.ax1*(this.a1x3+this.a2x3)+this.ay1*(this.a1y3+this.a2y3)+this.az1*(this.a1z3+this.a2z3),this.k10=this.ax2*(this.a1x1+this.a2x1)+this.ay2*(this.a1y1+this.a2y1)+this.az2*(this.a1z1+this.a2z1),this.k11=this.ax2*(this.a1x2+this.a2x2)+this.ay2*(this.a1y2+this.a2y2)+this.az2*(this.a1z2+this.a2z2),this.k12=this.ax2*(this.a1x3+this.a2x3)+this.ay2*(this.a1y3+this.a2y3)+this.az2*(this.a1z3+this.a2z3),this.k20=this.ax3*(this.a1x1+this.a2x1)+this.ay3*(this.a1y1+this.a2y1)+this.az3*(this.a1z1+this.a2z1),this.k21=this.ax3*(this.a1x2+this.a2x2)+this.ay3*(this.a1y2+this.a2y2)+this.az3*(this.a1z2+this.a2z2),this.k22=this.ax3*(this.a1x3+this.a2x3)+this.ay3*(this.a1y3+this.a2y3)+this.az3*(this.a1z3+this.a2z3),this.kv00=this.k00,this.kv11=this.k11,this.kv22=this.k22,this.dv00=1/this.kv00,this.dv11=1/this.kv11,this.dv22=1/this.kv22,n&&2!=this.limitState1){var d=6.2831853*e,f=d*d*t,N=i/(f+2*this.limitMotor1.dampingRatio*d);this.cfm1=this.kv00*N,this.limitVelocity1*=f*N}else this.cfm1=0,this.limitVelocity1*=.05*i;r&&2!=this.limitState2?(d=6.2831853*a,f=d*d*t,N=i/(f+2*this.limitMotor2.dampingRatio*d),this.cfm2=this.kv11*N,this.limitVelocity2*=f*N):(this.cfm2=0,this.limitVelocity2*=.05*i),l&&2!=this.limitState3?(d=6.2831853*o,f=d*d*t,N=i/(f+2*this.limitMotor3.dampingRatio*d),this.cfm3=this.kv22*N,this.limitVelocity3*=f*N):(this.cfm3=0,this.limitVelocity3*=.05*i),this.k00+=this.cfm1,this.k11+=this.cfm2,this.k22+=this.cfm3;var v=1/(this.k00*(this.k11*this.k22-this.k21*this.k12)+this.k10*(this.k21*this.k02-this.k01*this.k22)+this.k20*(this.k01*this.k12-this.k11*this.k02));this.d00=(this.k11*this.k22-this.k12*this.k21)*v,this.d01=(this.k02*this.k21-this.k01*this.k22)*v,this.d02=(this.k01*this.k12-this.k02*this.k11)*v,this.d10=(this.k12*this.k20-this.k10*this.k22)*v,this.d11=(this.k00*this.k22-this.k02*this.k20)*v,this.d12=(this.k02*this.k10-this.k00*this.k12)*v,this.d20=(this.k10*this.k21-this.k11*this.k20)*v,this.d21=(this.k01*this.k20-this.k00*this.k21)*v,this.d22=(this.k00*this.k11-this.k01*this.k10)*v,this.limitImpulse1*=.95,this.motorImpulse1*=.95,this.limitImpulse2*=.95,this.motorImpulse2*=.95,this.limitImpulse3*=.95,this.motorImpulse3*=.95;var b=this.limitImpulse1+this.motorImpulse1,z=this.limitImpulse2+this.motorImpulse2,k=this.limitImpulse3+this.motorImpulse3;this.a1.x+=b*this.a1x1+z*this.a1x2+k*this.a1x3,this.a1.y+=b*this.a1y1+z*this.a1y2+k*this.a1y3,this.a1.z+=b*this.a1z1+z*this.a1z2+k*this.a1z3,this.a2.x-=b*this.a2x1+z*this.a2x2+k*this.a2x3,this.a2.y-=b*this.a2y1+z*this.a2y2+k*this.a2y3,this.a2.z-=b*this.a2z1+z*this.a2z2+k*this.a2z3},solve_:function(){var t=this.a2.x-this.a1.x,i=this.a2.y-this.a1.y,s=this.a2.z-this.a1.z;this.limitVelocity3=30;var h=t*this.ax1+i*this.ay1+s*this.az1-this.limitVelocity1,e=t*this.ax2+i*this.ay2+s*this.az2-this.limitVelocity2,a=t*this.ax3+i*this.ay3+s*this.az3-this.limitVelocity3,o=h*this.d00+e*this.d01+a*this.d02,n=h*this.d10+e*this.d11+a*this.d12,r=h*this.d20+e*this.d21+a*this.d22;this.limitImpulse1+=o,this.limitImpulse2+=n,this.limitImpulse3+=r,this.a1.x+=o*this.a1x1+n*this.a1x2+r*this.a1x3,this.a1.y+=o*this.a1y1+n*this.a1y2+r*this.a1y3,this.a1.z+=o*this.a1z1+n*this.a1z2+r*this.a1z3,this.a2.x-=o*this.a2x1+n*this.a2x2+r*this.a2x3,this.a2.y-=o*this.a2y1+n*this.a2y2+r*this.a2y3,this.a2.z-=o*this.a2z1+n*this.a2z2+r*this.a2z3},solve:function(){var t=this.a2.x-this.a1.x,i=this.a2.y-this.a1.y,s=this.a2.z-this.a1.z,h=t*this.ax1+i*this.ay1+s*this.az1,e=t*this.ax2+i*this.ay2+s*this.az2,a=t*this.ax3+i*this.ay3+s*this.az3,o=this.motorImpulse1,n=this.motorImpulse2,r=this.motorImpulse3,l=0,m=0,c=0;this.enableMotor1&&(l=(h-this.motorSpeed1)*this.dv00,this.motorImpulse1+=l,this.motorImpulse1>this.maxMotorImpulse1?this.motorImpulse1=this.maxMotorImpulse1:this.motorImpulse1<-this.maxMotorImpulse1&&(this.motorImpulse1=-this.maxMotorImpulse1),l=this.motorImpulse1-o),this.enableMotor2&&(m=(e-this.motorSpeed2)*this.dv11,this.motorImpulse2+=m,this.motorImpulse2>this.maxMotorImpulse2?this.motorImpulse2=this.maxMotorImpulse2:this.motorImpulse2<-this.maxMotorImpulse2&&(this.motorImpulse2=-this.maxMotorImpulse2),m=this.motorImpulse2-n),this.enableMotor3&&(c=(a-this.motorSpeed3)*this.dv22,this.motorImpulse3+=c,this.motorImpulse3>this.maxMotorImpulse3?this.motorImpulse3=this.maxMotorImpulse3:this.motorImpulse3<-this.maxMotorImpulse3&&(this.motorImpulse3=-this.maxMotorImpulse3),c=this.motorImpulse3-r),h+=l*this.kv00+m*this.k01+c*this.k02,e+=l*this.k10+m*this.kv11+c*this.k12,a+=l*this.k20+m*this.k21+c*this.kv22,h-=this.limitVelocity1+this.limitImpulse1*this.cfm1,e-=this.limitVelocity2+this.limitImpulse2*this.cfm2,a-=this.limitVelocity3+this.limitImpulse3*this.cfm3;var p=this.limitImpulse1,u=this.limitImpulse2,y=this.limitImpulse3,x=h*this.d00+e*this.d01+a*this.d02,d=h*this.d10+e*this.d11+a*this.d12,f=h*this.d20+e*this.d21+a*this.d22;this.limitImpulse1+=x,this.limitImpulse2+=d,this.limitImpulse3+=f;var N=0;(2==this.limitState1||this.limitImpulse1*this.limitState1<0)&&(x=-p,e+=x*this.k10,a+=x*this.k20,N|=1),(2==this.limitState2||this.limitImpulse2*this.limitState2<0)&&(d=-u,h+=d*this.k01,a+=d*this.k21,N|=2),(2==this.limitState3||this.limitImpulse3*this.limitState3<0)&&(f=-y,h+=f*this.k02,e+=f*this.k12,N|=4);var v;switch(N){case 1:v=1/(this.k11*this.k22-this.k12*this.k21),d=(this.k22*e+-this.k12*a)*v,f=(-this.k21*e+this.k11*a)*v;break;case 2:v=1/(this.k00*this.k22-this.k02*this.k20),x=(this.k22*h+-this.k02*a)*v,f=(-this.k20*h+this.k00*a)*v;break;case 3:f=a/this.k22;break;case 4:v=1/(this.k00*this.k11-this.k01*this.k10),x=(this.k11*h+-this.k01*e)*v,d=(-this.k10*h+this.k00*e)*v;break;case 5:d=e/this.k11;break;case 6:x=h/this.k00}this.limitImpulse1=x+p,this.limitImpulse2=d+u,this.limitImpulse3=f+y;var b=l+x,z=m+d,k=c+f;this.a1.x+=b*this.a1x1+z*this.a1x2+k*this.a1x3,this.a1.y+=b*this.a1y1+z*this.a1y2+k*this.a1y3,this.a1.z+=b*this.a1z1+z*this.a1z2+k*this.a1z3,this.a2.x-=b*this.a2x1+z*this.a2x2+k*this.a2x3,this.a2.y-=b*this.a2y1+z*this.a2y2+k*this.a2y3,this.a2.z-=b*this.a2z1+z*this.a2z2+k*this.a2z3,t=this.a2.x-this.a1.x,i=this.a2.y-this.a1.y,s=this.a2.z-this.a1.z,e=t*this.ax2+i*this.ay2+s*this.az2}}),v.prototype=Object.assign(Object.create(d.prototype),{constructor:v,preSolve:function(t,i){this.updateAnchorPoints(),this.ax1.mulMat(this.body1.rotation,this.localAxis1),this.ax2.mulMat(this.body2.rotation,this.localAxis2),this.an1.mulMat(this.body1.rotation,this.localAngle1),this.an2.mulMat(this.body2.rotation,this.localAngle2),this.nor.set(this.ax1.x*this.body2.inverseMass+this.ax2.x*this.body1.inverseMass,this.ax1.y*this.body2.inverseMass+this.ax2.y*this.body1.inverseMass,this.ax1.z*this.body2.inverseMass+this.ax2.z*this.body1.inverseMass).normalize(),this.tan.tangent(this.nor).normalize(),this.bin.crossVectors(this.nor,this.tan);var s=Pt.acosClamp(Pt.dotVectors(this.an1,this.an2));this.tmp.crossVectors(this.an1,this.an2),Pt.dotVectors(this.nor,this.tmp)<0?this.limitMotor.angle=-s:this.limitMotor.angle=s,this.tmp.crossVectors(this.ax1,this.ax2),this.r3.limitMotor2.angle=Pt.dotVectors(this.tan,this.tmp),this.r3.limitMotor3.angle=Pt.dotVectors(this.bin,this.tmp),this.r3.preSolve(t,i),this.lc.preSolve(t,i)},solve:function(){this.r3.solve(),this.lc.solve()},postSolve:function(){}}),b.prototype=Object.assign(Object.create(d.prototype),{constructor:b,preSolve:function(t,i){this.updateAnchorPoints(),this.lc.preSolve(t,i)},solve:function(){this.lc.solve()},postSolve:function(){}}),Object.assign(z.prototype,{TranslationalConstraint:!0,preSolve:function(t,i){this.ax=this.limitMotor.axis.x,this.ay=this.limitMotor.axis.y,this.az=this.limitMotor.axis.z,this.lowerLimit=this.limitMotor.lowerLimit,this.upperLimit=this.limitMotor.upperLimit,this.motorSpeed=this.limitMotor.motorSpeed,this.maxMotorForce=this.limitMotor.maxMotorForce,this.enableMotor=this.maxMotorForce>0,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass;var s=this.i1.elements,h=this.i2.elements;this.i1e00=s[0],this.i1e01=s[1],this.i1e02=s[2],this.i1e10=s[3],this.i1e11=s[4],this.i1e12=s[5],this.i1e20=s[6],this.i1e21=s[7],this.i1e22=s[8],this.i2e00=h[0],this.i2e01=h[1],this.i2e02=h[2],this.i2e10=h[3],this.i2e11=h[4],this.i2e12=h[5],this.i2e20=h[6],this.i2e21=h[7],this.i2e22=h[8];var e=this.p2.x-this.p1.x,a=this.p2.y-this.p1.y,o=this.p2.z-this.p1.z,n=e*this.ax+a*this.ay+o*this.az,r=this.limitMotor.frequency,l=r>0,m=this.lowerLimit<=this.upperLimit;(l&&n>20||n<-20)&&(l=!1),m?(this.lowerLimit==this.upperLimit?(0!=this.limitState&&(this.limitState=0,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-n,l||(n=this.lowerLimit)):n<this.lowerLimit?(this.limitState!=-1&&(this.limitState=-1,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-n,l||(n=this.lowerLimit)):n>this.upperLimit?(1!=this.limitState&&(this.limitState=1,this.limitImpulse=0),this.limitVelocity=this.upperLimit-n,l||(n=this.upperLimit)):(this.limitState=2,this.limitImpulse=0,this.limitVelocity=0),l||(this.limitVelocity>.005?this.limitVelocity-=.005:this.limitVelocity<-.005?this.limitVelocity+=.005:this.limitVelocity=0)):(this.limitState=2,this.limitImpulse=0),this.enableMotor&&(0!=this.limitState||l)?this.maxMotorImpulse=this.maxMotorForce*t:(this.motorImpulse=0,this.maxMotorImpulse=0);var c=n*this.ax,p=n*this.ay,u=n*this.az,y=this.m1/(this.m1+this.m2),x=1-y;if(this.r1x=this.r1.x+c*y,this.r1y=this.r1.y+p*y,this.r1z=this.r1.z+u*y,this.r2x=this.r2.x-c*x,this.r2y=this.r2.y-p*x,this.r2z=this.r2.z-u*x,this.t1x=this.r1y*this.az-this.r1z*this.ay,this.t1y=this.r1z*this.ax-this.r1x*this.az,this.t1z=this.r1x*this.ay-this.r1y*this.ax,this.t2x=this.r2y*this.az-this.r2z*this.ay,this.t2y=this.r2z*this.ax-this.r2x*this.az,this.t2z=this.r2x*this.ay-this.r2y*this.ax,this.l1x=this.ax*this.m1,this.l1y=this.ay*this.m1,this.l1z=this.az*this.m1,this.l2x=this.ax*this.m2,this.l2y=this.ay*this.m2,this.l2z=this.az*this.m2,this.a1x=this.t1x*this.i1e00+this.t1y*this.i1e01+this.t1z*this.i1e02,this.a1y=this.t1x*this.i1e10+this.t1y*this.i1e11+this.t1z*this.i1e12,this.a1z=this.t1x*this.i1e20+this.t1y*this.i1e21+this.t1z*this.i1e22,this.a2x=this.t2x*this.i2e00+this.t2y*this.i2e01+this.t2z*this.i2e02,this.a2y=this.t2x*this.i2e10+this.t2y*this.i2e11+this.t2z*this.i2e12,this.a2z=this.t2x*this.i2e20+this.t2y*this.i2e21+this.t2z*this.i2e22,this.motorDenom=this.m1+this.m2+this.ax*(this.a1y*this.r1z-this.a1z*this.r1y+this.a2y*this.r2z-this.a2z*this.r2y)+this.ay*(this.a1z*this.r1x-this.a1x*this.r1z+this.a2z*this.r2x-this.a2x*this.r2z)+this.az*(this.a1x*this.r1y-this.a1y*this.r1x+this.a2x*this.r2y-this.a2y*this.r2x),this.invMotorDenom=1/this.motorDenom,l&&2!=this.limitState){var d=6.2831853*r,f=d*d*t,N=i/(f+2*this.limitMotor.dampingRatio*d);this.cfm=this.motorDenom*N,this.limitVelocity*=f*N}else this.cfm=0,this.limitVelocity*=.05*i;this.invDenom=1/(this.motorDenom+this.cfm);var v=this.limitImpulse+this.motorImpulse;this.l1.x+=v*this.l1x,this.l1.y+=v*this.l1y,this.l1.z+=v*this.l1z,this.a1.x+=v*this.a1x,this.a1.y+=v*this.a1y,this.a1.z+=v*this.a1z,this.l2.x-=v*this.l2x,this.l2.y-=v*this.l2y,this.l2.z-=v*this.l2z,this.a2.x-=v*this.a2x,this.a2.y-=v*this.a2y,this.a2.z-=v*this.a2z},solve:function(){var t,i=this.ax*(this.l2.x-this.l1.x)+this.ay*(this.l2.y-this.l1.y)+this.az*(this.l2.z-this.l1.z)+this.t2x*this.a2.x-this.t1x*this.a1.x+this.t2y*this.a2.y-this.t1y*this.a1.y+this.t2z*this.a2.z-this.t1z*this.a1.z;if(this.enableMotor){t=(i-this.motorSpeed)*this.invMotorDenom;var s=this.motorImpulse;this.motorImpulse+=t,this.motorImpulse>this.maxMotorImpulse?this.motorImpulse=this.maxMotorImpulse:this.motorImpulse<-this.maxMotorImpulse&&(this.motorImpulse=-this.maxMotorImpulse),t=this.motorImpulse-s,i-=t*this.motorDenom}else t=0;var h;if(2!=this.limitState){h=(i-this.limitVelocity-this.limitImpulse*this.cfm)*this.invDenom;var e=this.limitImpulse;this.limitImpulse+=h,this.limitImpulse*this.limitState<0&&(this.limitImpulse=0),h=this.limitImpulse-e}else h=0;var a=h+t;this.l1.x+=a*this.l1x,this.l1.y+=a*this.l1y,this.l1.z+=a*this.l1z,this.a1.x+=a*this.a1x,this.a1.y+=a*this.a1y,this.a1.z+=a*this.a1z,this.l2.x-=a*this.l2x,this.l2.y-=a*this.l2y,this.l2.z-=a*this.l2z,this.a2.x-=a*this.a2x,this.a2.y-=a*this.a2y,this.a2.z-=a*this.a2z}}),k.prototype=Object.assign(Object.create(d.prototype),{constructor:k,preSolve:function(t,i){this.updateAnchorPoints(),this.nor.sub(this.anchorPoint2,this.anchorPoint1).normalize(),this.t.preSolve(t,i)},solve:function(){this.t.solve()},postSolve:function(){}}),Object.assign(w.prototype,{AngularConstraint:!0,preSolve:function(t,i){var s,h,e;this.ii1=this.i1.clone(),this.ii2=this.i2.clone(),e=(new a).add(this.ii1,this.ii2).elements,s=1/(e[0]*(e[4]*e[8]-e[7]*e[5])+e[3]*(e[7]*e[2]-e[1]*e[8])+e[6]*(e[1]*e[5]-e[4]*e[2])),
this.dd=(new a).set(e[4]*e[8]-e[5]*e[7],e[2]*e[7]-e[1]*e[8],e[1]*e[5]-e[2]*e[4],e[5]*e[6]-e[3]*e[8],e[0]*e[8]-e[2]*e[6],e[2]*e[3]-e[0]*e[5],e[3]*e[7]-e[4]*e[6],e[1]*e[6]-e[0]*e[7],e[0]*e[4]-e[1]*e[3]).multiply(s),this.relativeOrientation.invert(this.b1.orientation),this.relativeOrientation.mul(this.targetOrientation,this.relativeOrientation),this.relativeOrientation.mul(this.b2.orientation,this.relativeOrientation),s=2*this.relativeOrientation.w,this.vel.scale(this.relativeOrientation,s),h=this.vel.length(),h>.02?(h=(.02-h)/h*i*.05,this.vel.scaleEqual(h)):this.vel.set(0,0,0),this.rn1.mulMat(this.ii1,this.imp),this.rn2.mulMat(this.ii2,this.imp),this.a1.addEqual(this.rn1),this.a2.subEqual(this.rn2)},solve:function(){var t=this.a2.clone().subEqual(this.a1).subEqual(this.vel);this.rn0.mulMat(this.dd,t),this.rn1.mulMat(this.ii1,this.rn0),this.rn2.mulMat(this.ii2,this.rn0),this.imp.addEqual(this.rn0),this.a1.addEqual(this.rn1),this.a2.subEqual(this.rn2)}}),Object.assign(M.prototype,{Translational3Constraint:!0,preSolve:function(t,i){this.ax1=this.limitMotor1.axis.x,this.ay1=this.limitMotor1.axis.y,this.az1=this.limitMotor1.axis.z,this.ax2=this.limitMotor2.axis.x,this.ay2=this.limitMotor2.axis.y,this.az2=this.limitMotor2.axis.z,this.ax3=this.limitMotor3.axis.x,this.ay3=this.limitMotor3.axis.y,this.az3=this.limitMotor3.axis.z,this.lowerLimit1=this.limitMotor1.lowerLimit,this.upperLimit1=this.limitMotor1.upperLimit,this.motorSpeed1=this.limitMotor1.motorSpeed,this.maxMotorForce1=this.limitMotor1.maxMotorForce,this.enableMotor1=this.maxMotorForce1>0,this.lowerLimit2=this.limitMotor2.lowerLimit,this.upperLimit2=this.limitMotor2.upperLimit,this.motorSpeed2=this.limitMotor2.motorSpeed,this.maxMotorForce2=this.limitMotor2.maxMotorForce,this.enableMotor2=this.maxMotorForce2>0,this.lowerLimit3=this.limitMotor3.lowerLimit,this.upperLimit3=this.limitMotor3.upperLimit,this.motorSpeed3=this.limitMotor3.motorSpeed,this.maxMotorForce3=this.limitMotor3.maxMotorForce,this.enableMotor3=this.maxMotorForce3>0,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass;var s=this.i1.elements,h=this.i2.elements;this.i1e00=s[0],this.i1e01=s[1],this.i1e02=s[2],this.i1e10=s[3],this.i1e11=s[4],this.i1e12=s[5],this.i1e20=s[6],this.i1e21=s[7],this.i1e22=s[8],this.i2e00=h[0],this.i2e01=h[1],this.i2e02=h[2],this.i2e10=h[3],this.i2e11=h[4],this.i2e12=h[5],this.i2e20=h[6],this.i2e21=h[7],this.i2e22=h[8];var e=this.p2.x-this.p1.x,a=this.p2.y-this.p1.y,o=this.p2.z-this.p1.z,n=e*this.ax1+a*this.ay1+o*this.az1,r=e*this.ax2+a*this.ay2+o*this.az2,l=e*this.ax3+a*this.ay3+o*this.az3,m=this.limitMotor1.frequency,c=this.limitMotor2.frequency,p=this.limitMotor3.frequency,u=m>0,y=c>0,x=p>0,d=this.lowerLimit1<=this.upperLimit1,f=this.lowerLimit2<=this.upperLimit2,N=this.lowerLimit3<=this.upperLimit3;(u&&n>20||n<-20)&&(u=!1),(y&&r>20||r<-20)&&(y=!1),(x&&l>20||l<-20)&&(x=!1),d?(this.lowerLimit1==this.upperLimit1?(0!=this.limitState1&&(this.limitState1=0,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-n,u||(n=this.lowerLimit1)):n<this.lowerLimit1?(this.limitState1!=-1&&(this.limitState1=-1,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-n,u||(n=this.lowerLimit1)):n>this.upperLimit1?(1!=this.limitState1&&(this.limitState1=1,this.limitImpulse1=0),this.limitVelocity1=this.upperLimit1-n,u||(n=this.upperLimit1)):(this.limitState1=2,this.limitImpulse1=0,this.limitVelocity1=0),u||(this.limitVelocity1>.005?this.limitVelocity1-=.005:this.limitVelocity1<-.005?this.limitVelocity1+=.005:this.limitVelocity1=0)):(this.limitState1=2,this.limitImpulse1=0),f?(this.lowerLimit2==this.upperLimit2?(0!=this.limitState2&&(this.limitState2=0,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-r,y||(r=this.lowerLimit2)):r<this.lowerLimit2?(this.limitState2!=-1&&(this.limitState2=-1,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-r,y||(r=this.lowerLimit2)):r>this.upperLimit2?(1!=this.limitState2&&(this.limitState2=1,this.limitImpulse2=0),this.limitVelocity2=this.upperLimit2-r,y||(r=this.upperLimit2)):(this.limitState2=2,this.limitImpulse2=0,this.limitVelocity2=0),y||(this.limitVelocity2>.005?this.limitVelocity2-=.005:this.limitVelocity2<-.005?this.limitVelocity2+=.005:this.limitVelocity2=0)):(this.limitState2=2,this.limitImpulse2=0),N?(this.lowerLimit3==this.upperLimit3?(0!=this.limitState3&&(this.limitState3=0,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-l,x||(l=this.lowerLimit3)):l<this.lowerLimit3?(this.limitState3!=-1&&(this.limitState3=-1,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-l,x||(l=this.lowerLimit3)):l>this.upperLimit3?(1!=this.limitState3&&(this.limitState3=1,this.limitImpulse3=0),this.limitVelocity3=this.upperLimit3-l,x||(l=this.upperLimit3)):(this.limitState3=2,this.limitImpulse3=0,this.limitVelocity3=0),x||(this.limitVelocity3>.005?this.limitVelocity3-=.005:this.limitVelocity3<-.005?this.limitVelocity3+=.005:this.limitVelocity3=0)):(this.limitState3=2,this.limitImpulse3=0),this.enableMotor1&&(0!=this.limitState1||u)?this.maxMotorImpulse1=this.maxMotorForce1*t:(this.motorImpulse1=0,this.maxMotorImpulse1=0),this.enableMotor2&&(0!=this.limitState2||y)?this.maxMotorImpulse2=this.maxMotorForce2*t:(this.motorImpulse2=0,this.maxMotorImpulse2=0),this.enableMotor3&&(0!=this.limitState3||x)?this.maxMotorImpulse3=this.maxMotorForce3*t:(this.motorImpulse3=0,this.maxMotorImpulse3=0);var v=n*this.ax1+r*this.ax2+l*this.ax2,b=n*this.ay1+r*this.ay2+l*this.ay2,z=n*this.az1+r*this.az2+l*this.az2,k=this.m2/(this.m1+this.m2);this.weight>=0&&(k=this.weight);var w=1-k;this.r1x=this.r1.x+v*k,this.r1y=this.r1.y+b*k,this.r1z=this.r1.z+z*k,this.r2x=this.r2.x-v*w,this.r2y=this.r2.y-b*w,this.r2z=this.r2.z-z*w,this.t1x1=this.r1y*this.az1-this.r1z*this.ay1,this.t1y1=this.r1z*this.ax1-this.r1x*this.az1,this.t1z1=this.r1x*this.ay1-this.r1y*this.ax1,this.t2x1=this.r2y*this.az1-this.r2z*this.ay1,this.t2y1=this.r2z*this.ax1-this.r2x*this.az1,this.t2z1=this.r2x*this.ay1-this.r2y*this.ax1,this.l1x1=this.ax1*this.m1,this.l1y1=this.ay1*this.m1,this.l1z1=this.az1*this.m1,this.l2x1=this.ax1*this.m2,this.l2y1=this.ay1*this.m2,this.l2z1=this.az1*this.m2,this.a1x1=this.t1x1*this.i1e00+this.t1y1*this.i1e01+this.t1z1*this.i1e02,this.a1y1=this.t1x1*this.i1e10+this.t1y1*this.i1e11+this.t1z1*this.i1e12,this.a1z1=this.t1x1*this.i1e20+this.t1y1*this.i1e21+this.t1z1*this.i1e22,this.a2x1=this.t2x1*this.i2e00+this.t2y1*this.i2e01+this.t2z1*this.i2e02,this.a2y1=this.t2x1*this.i2e10+this.t2y1*this.i2e11+this.t2z1*this.i2e12,this.a2z1=this.t2x1*this.i2e20+this.t2y1*this.i2e21+this.t2z1*this.i2e22,this.t1x2=this.r1y*this.az2-this.r1z*this.ay2,this.t1y2=this.r1z*this.ax2-this.r1x*this.az2,this.t1z2=this.r1x*this.ay2-this.r1y*this.ax2,this.t2x2=this.r2y*this.az2-this.r2z*this.ay2,this.t2y2=this.r2z*this.ax2-this.r2x*this.az2,this.t2z2=this.r2x*this.ay2-this.r2y*this.ax2,this.l1x2=this.ax2*this.m1,this.l1y2=this.ay2*this.m1,this.l1z2=this.az2*this.m1,this.l2x2=this.ax2*this.m2,this.l2y2=this.ay2*this.m2,this.l2z2=this.az2*this.m2,this.a1x2=this.t1x2*this.i1e00+this.t1y2*this.i1e01+this.t1z2*this.i1e02,this.a1y2=this.t1x2*this.i1e10+this.t1y2*this.i1e11+this.t1z2*this.i1e12,this.a1z2=this.t1x2*this.i1e20+this.t1y2*this.i1e21+this.t1z2*this.i1e22,this.a2x2=this.t2x2*this.i2e00+this.t2y2*this.i2e01+this.t2z2*this.i2e02,this.a2y2=this.t2x2*this.i2e10+this.t2y2*this.i2e11+this.t2z2*this.i2e12,this.a2z2=this.t2x2*this.i2e20+this.t2y2*this.i2e21+this.t2z2*this.i2e22,this.t1x3=this.r1y*this.az3-this.r1z*this.ay3,this.t1y3=this.r1z*this.ax3-this.r1x*this.az3,this.t1z3=this.r1x*this.ay3-this.r1y*this.ax3,this.t2x3=this.r2y*this.az3-this.r2z*this.ay3,this.t2y3=this.r2z*this.ax3-this.r2x*this.az3,this.t2z3=this.r2x*this.ay3-this.r2y*this.ax3,this.l1x3=this.ax3*this.m1,this.l1y3=this.ay3*this.m1,this.l1z3=this.az3*this.m1,this.l2x3=this.ax3*this.m2,this.l2y3=this.ay3*this.m2,this.l2z3=this.az3*this.m2,this.a1x3=this.t1x3*this.i1e00+this.t1y3*this.i1e01+this.t1z3*this.i1e02,this.a1y3=this.t1x3*this.i1e10+this.t1y3*this.i1e11+this.t1z3*this.i1e12,this.a1z3=this.t1x3*this.i1e20+this.t1y3*this.i1e21+this.t1z3*this.i1e22,this.a2x3=this.t2x3*this.i2e00+this.t2y3*this.i2e01+this.t2z3*this.i2e02,this.a2y3=this.t2x3*this.i2e10+this.t2y3*this.i2e11+this.t2z3*this.i2e12,this.a2z3=this.t2x3*this.i2e20+this.t2y3*this.i2e21+this.t2z3*this.i2e22;var M=this.m1+this.m2;if(this.k00=(this.ax1*this.ax1+this.ay1*this.ay1+this.az1*this.az1)*M,this.k01=(this.ax1*this.ax2+this.ay1*this.ay2+this.az1*this.az2)*M,this.k02=(this.ax1*this.ax3+this.ay1*this.ay3+this.az1*this.az3)*M,this.k10=(this.ax2*this.ax1+this.ay2*this.ay1+this.az2*this.az1)*M,this.k11=(this.ax2*this.ax2+this.ay2*this.ay2+this.az2*this.az2)*M,this.k12=(this.ax2*this.ax3+this.ay2*this.ay3+this.az2*this.az3)*M,this.k20=(this.ax3*this.ax1+this.ay3*this.ay1+this.az3*this.az1)*M,this.k21=(this.ax3*this.ax2+this.ay3*this.ay2+this.az3*this.az2)*M,this.k22=(this.ax3*this.ax3+this.ay3*this.ay3+this.az3*this.az3)*M,this.k00+=this.t1x1*this.a1x1+this.t1y1*this.a1y1+this.t1z1*this.a1z1,this.k01+=this.t1x1*this.a1x2+this.t1y1*this.a1y2+this.t1z1*this.a1z2,this.k02+=this.t1x1*this.a1x3+this.t1y1*this.a1y3+this.t1z1*this.a1z3,this.k10+=this.t1x2*this.a1x1+this.t1y2*this.a1y1+this.t1z2*this.a1z1,this.k11+=this.t1x2*this.a1x2+this.t1y2*this.a1y2+this.t1z2*this.a1z2,this.k12+=this.t1x2*this.a1x3+this.t1y2*this.a1y3+this.t1z2*this.a1z3,this.k20+=this.t1x3*this.a1x1+this.t1y3*this.a1y1+this.t1z3*this.a1z1,this.k21+=this.t1x3*this.a1x2+this.t1y3*this.a1y2+this.t1z3*this.a1z2,this.k22+=this.t1x3*this.a1x3+this.t1y3*this.a1y3+this.t1z3*this.a1z3,this.k00+=this.t2x1*this.a2x1+this.t2y1*this.a2y1+this.t2z1*this.a2z1,this.k01+=this.t2x1*this.a2x2+this.t2y1*this.a2y2+this.t2z1*this.a2z2,this.k02+=this.t2x1*this.a2x3+this.t2y1*this.a2y3+this.t2z1*this.a2z3,this.k10+=this.t2x2*this.a2x1+this.t2y2*this.a2y1+this.t2z2*this.a2z1,this.k11+=this.t2x2*this.a2x2+this.t2y2*this.a2y2+this.t2z2*this.a2z2,this.k12+=this.t2x2*this.a2x3+this.t2y2*this.a2y3+this.t2z2*this.a2z3,this.k20+=this.t2x3*this.a2x1+this.t2y3*this.a2y1+this.t2z3*this.a2z1,this.k21+=this.t2x3*this.a2x2+this.t2y3*this.a2y2+this.t2z3*this.a2z2,this.k22+=this.t2x3*this.a2x3+this.t2y3*this.a2y3+this.t2z3*this.a2z3,this.kv00=this.k00,this.kv11=this.k11,this.kv22=this.k22,this.dv00=1/this.kv00,this.dv11=1/this.kv11,this.dv22=1/this.kv22,u&&2!=this.limitState1){var I=6.2831853*m,g=I*I*t,L=i/(g+2*this.limitMotor1.dampingRatio*I);this.cfm1=this.kv00*L,this.limitVelocity1*=g*L}else this.cfm1=0,this.limitVelocity1*=.05*i;y&&2!=this.limitState2?(I=6.2831853*c,g=I*I*t,L=i/(g+2*this.limitMotor2.dampingRatio*I),this.cfm2=this.kv11*L,this.limitVelocity2*=g*L):(this.cfm2=0,this.limitVelocity2*=.05*i),x&&2!=this.limitState3?(I=6.2831853*p,g=I*I*t,L=i/(g+2*this.limitMotor3.dampingRatio*I),this.cfm3=this.kv22*L,this.limitVelocity3*=g*L):(this.cfm3=0,this.limitVelocity3*=.05*i),this.k00+=this.cfm1,this.k11+=this.cfm2,this.k22+=this.cfm3;var S=1/(this.k00*(this.k11*this.k22-this.k21*this.k12)+this.k10*(this.k21*this.k02-this.k01*this.k22)+this.k20*(this.k01*this.k12-this.k11*this.k02));this.d00=(this.k11*this.k22-this.k12*this.k21)*S,this.d01=(this.k02*this.k21-this.k01*this.k22)*S,this.d02=(this.k01*this.k12-this.k02*this.k11)*S,this.d10=(this.k12*this.k20-this.k10*this.k22)*S,this.d11=(this.k00*this.k22-this.k02*this.k20)*S,this.d12=(this.k02*this.k10-this.k00*this.k12)*S,this.d20=(this.k10*this.k21-this.k11*this.k20)*S,this.d21=(this.k01*this.k20-this.k00*this.k21)*S,this.d22=(this.k00*this.k11-this.k01*this.k10)*S;var P=this.limitImpulse1+this.motorImpulse1,V=this.limitImpulse2+this.motorImpulse2,T=this.limitImpulse3+this.motorImpulse3;this.l1.x+=P*this.l1x1+V*this.l1x2+T*this.l1x3,this.l1.y+=P*this.l1y1+V*this.l1y2+T*this.l1y3,this.l1.z+=P*this.l1z1+V*this.l1z2+T*this.l1z3,this.a1.x+=P*this.a1x1+V*this.a1x2+T*this.a1x3,this.a1.y+=P*this.a1y1+V*this.a1y2+T*this.a1y3,this.a1.z+=P*this.a1z1+V*this.a1z2+T*this.a1z3,this.l2.x-=P*this.l2x1+V*this.l2x2+T*this.l2x3,this.l2.y-=P*this.l2y1+V*this.l2y2+T*this.l2y3,this.l2.z-=P*this.l2z1+V*this.l2z2+T*this.l2z3,this.a2.x-=P*this.a2x1+V*this.a2x2+T*this.a2x3,this.a2.y-=P*this.a2y1+V*this.a2y2+T*this.a2y3,this.a2.z-=P*this.a2z1+V*this.a2z2+T*this.a2z3},solve:function(){var t=this.l2.x-this.l1.x+this.a2.y*this.r2z-this.a2.z*this.r2y-this.a1.y*this.r1z+this.a1.z*this.r1y,i=this.l2.y-this.l1.y+this.a2.z*this.r2x-this.a2.x*this.r2z-this.a1.z*this.r1x+this.a1.x*this.r1z,s=this.l2.z-this.l1.z+this.a2.x*this.r2y-this.a2.y*this.r2x-this.a1.x*this.r1y+this.a1.y*this.r1x,h=t*this.ax1+i*this.ay1+s*this.az1,e=t*this.ax2+i*this.ay2+s*this.az2,a=t*this.ax3+i*this.ay3+s*this.az3,o=this.motorImpulse1,n=this.motorImpulse2,r=this.motorImpulse3,l=0,m=0,c=0;this.enableMotor1&&(l=(h-this.motorSpeed1)*this.dv00,this.motorImpulse1+=l,this.motorImpulse1>this.maxMotorImpulse1?this.motorImpulse1=this.maxMotorImpulse1:this.motorImpulse1<-this.maxMotorImpulse1&&(this.motorImpulse1=-this.maxMotorImpulse1),l=this.motorImpulse1-o),this.enableMotor2&&(m=(e-this.motorSpeed2)*this.dv11,this.motorImpulse2+=m,this.motorImpulse2>this.maxMotorImpulse2?this.motorImpulse2=this.maxMotorImpulse2:this.motorImpulse2<-this.maxMotorImpulse2&&(this.motorImpulse2=-this.maxMotorImpulse2),m=this.motorImpulse2-n),this.enableMotor3&&(c=(a-this.motorSpeed3)*this.dv22,this.motorImpulse3+=c,this.motorImpulse3>this.maxMotorImpulse3?this.motorImpulse3=this.maxMotorImpulse3:this.motorImpulse3<-this.maxMotorImpulse3&&(this.motorImpulse3=-this.maxMotorImpulse3),c=this.motorImpulse3-r),h+=l*this.kv00+m*this.k01+c*this.k02,e+=l*this.k10+m*this.kv11+c*this.k12,a+=l*this.k20+m*this.k21+c*this.kv22,h-=this.limitVelocity1+this.limitImpulse1*this.cfm1,e-=this.limitVelocity2+this.limitImpulse2*this.cfm2,a-=this.limitVelocity3+this.limitImpulse3*this.cfm3;var p=this.limitImpulse1,u=this.limitImpulse2,y=this.limitImpulse3,x=h*this.d00+e*this.d01+a*this.d02,d=h*this.d10+e*this.d11+a*this.d12,f=h*this.d20+e*this.d21+a*this.d22;this.limitImpulse1+=x,this.limitImpulse2+=d,this.limitImpulse3+=f;var N=0;(2==this.limitState1||this.limitImpulse1*this.limitState1<0)&&(x=-p,e+=x*this.k10,a+=x*this.k20,N|=1),(2==this.limitState2||this.limitImpulse2*this.limitState2<0)&&(d=-u,h+=d*this.k01,a+=d*this.k21,N|=2),(2==this.limitState3||this.limitImpulse3*this.limitState3<0)&&(f=-y,h+=f*this.k02,e+=f*this.k12,N|=4);var v;switch(N){case 1:v=1/(this.k11*this.k22-this.k12*this.k21),d=(this.k22*e+-this.k12*a)*v,f=(-this.k21*e+this.k11*a)*v;break;case 2:v=1/(this.k00*this.k22-this.k02*this.k20),x=(this.k22*h+-this.k02*a)*v,f=(-this.k20*h+this.k00*a)*v;break;case 3:f=a/this.k22;break;case 4:v=1/(this.k00*this.k11-this.k01*this.k10),x=(this.k11*h+-this.k01*e)*v,d=(-this.k10*h+this.k00*e)*v;break;case 5:d=e/this.k11;break;case 6:x=h/this.k00}this.limitImpulse1=p+x,this.limitImpulse2=u+d,this.limitImpulse3=y+f;var b=l+x,z=m+d,k=c+f;this.l1.x+=b*this.l1x1+z*this.l1x2+k*this.l1x3,this.l1.y+=b*this.l1y1+z*this.l1y2+k*this.l1y3,this.l1.z+=b*this.l1z1+z*this.l1z2+k*this.l1z3,this.a1.x+=b*this.a1x1+z*this.a1x2+k*this.a1x3,this.a1.y+=b*this.a1y1+z*this.a1y2+k*this.a1y3,this.a1.z+=b*this.a1z1+z*this.a1z2+k*this.a1z3,this.l2.x-=b*this.l2x1+z*this.l2x2+k*this.l2x3,this.l2.y-=b*this.l2y1+z*this.l2y2+k*this.l2y3,this.l2.z-=b*this.l2z1+z*this.l2z2+k*this.l2z3,this.a2.x-=b*this.a2x1+z*this.a2x2+k*this.a2x3,this.a2.y-=b*this.a2y1+z*this.a2y2+k*this.a2y3,this.a2.z-=b*this.a2z1+z*this.a2z2+k*this.a2z3}}),I.prototype=Object.assign(Object.create(d.prototype),{constructor:I,preSolve:function(t,i){this.updateAnchorPoints(),this.ax1.mulMat(this.body1.rotation,this.localAxis1),this.ax2.mulMat(this.body2.rotation,this.localAxis2),this.nor.set(this.ax1.x*this.body2.inverseMass+this.ax2.x*this.body1.inverseMass,this.ax1.y*this.body2.inverseMass+this.ax2.y*this.body1.inverseMass,this.ax1.z*this.body2.inverseMass+this.ax2.z*this.body1.inverseMass).normalize(),this.tan.tangent(this.nor).normalize(),this.bin.crossVectors(this.nor,this.tan),this.ac.preSolve(t,i),this.t3.preSolve(t,i)},solve:function(){this.ac.solve(),this.t3.solve()},postSolve:function(){}}),g.prototype=Object.assign(Object.create(d.prototype),{constructor:g,preSolve:function(t,i){this.updateAnchorPoints(),this.ax1.mulMat(this.body1.rotation,this.localAxis1),this.an1.mulMat(this.body1.rotation,this.localAngle1),this.ax2.mulMat(this.body2.rotation,this.localAxis2),this.an2.mulMat(this.body2.rotation,this.localAngle2),this.nor.set(this.ax1.x*this.body2.inverseMass+this.ax2.x*this.body1.inverseMass,this.ax1.y*this.body2.inverseMass+this.ax2.y*this.body1.inverseMass,this.ax1.z*this.body2.inverseMass+this.ax2.z*this.body1.inverseMass).normalize(),this.tan.tangent(this.nor).normalize(),this.bin.crossVectors(this.nor,this.tan),this.tmp.crossVectors(this.an1,this.an2);var s=Pt.acosClamp(Pt.dotVectors(this.an1,this.an2));Pt.dotVectors(this.nor,this.tmp)<0?this.rotationalLimitMotor.angle=-s:this.rotationalLimitMotor.angle=s,this.tmp.crossVectors(this.ax1,this.ax2),this.r3.limitMotor2.angle=Pt.dotVectors(this.tan,this.tmp),this.r3.limitMotor3.angle=Pt.dotVectors(this.bin,this.tmp),this.r3.preSolve(t,i),this.t3.preSolve(t,i)},solve:function(){this.r3.solve(),this.t3.solve()},postSolve:function(){}}),L.prototype=Object.assign(Object.create(d.prototype),{constructor:L,preSolve:function(t,i){this.updateAnchorPoints(),this.ax1.mulMat(this.body1.rotation,this.localAxis1),this.ax2.mulMat(this.body2.rotation,this.localAxis2),this.an1.mulMat(this.body1.rotation,this.localAngle1),this.an2.mulMat(this.body2.rotation,this.localAngle2),this.r3.limitMotor1.angle=Pt.dotVectors(this.ax1,this.ax2);var s=Pt.dotVectors(this.an1,this.ax2);Pt.dotVectors(this.ax1,this.tmp.crossVectors(this.an1,this.ax2))<0?this.rotationalLimitMotor1.angle=-s:this.rotationalLimitMotor1.angle=s,s=Pt.dotVectors(this.an2,this.ax1),Pt.dotVectors(this.ax2,this.tmp.crossVectors(this.an2,this.ax1))<0?this.rotationalLimitMotor2.angle=-s:this.rotationalLimitMotor2.angle=s,this.nor.crossVectors(this.ax1,this.ax2).normalize(),this.tan.crossVectors(this.nor,this.ax2).normalize(),this.bin.crossVectors(this.nor,this.ax1).normalize(),this.r3.preSolve(t,i),this.t3.preSolve(t,i)},solve:function(){this.r3.solve(),this.t3.solve()},postSolve:function(){}}),U.prototype={constructor:U,reset:function(t,i){this.body1=t.parent,this.body2=i.parent,this.numPoints=0},addPoint:function(t,i,s,e,a,o,n,r){var l=this.points[this.numPoints++];l.position.set(t,i,s),l.localPoint1.mulManifold(this.body1.rotation,(new h).sub(l.position,this.body1.position)),l.localPoint2.mulManifold(this.body2.rotation,(new h).sub(l.position,this.body2.position)),l.normalImpulse=0,l.normal.set(e,a,o),r&&l.normal.negate(),l.penetration=n,l.warmStarted=!1}},O.prototype=Object.create(y.prototype),O.prototype.constructor=O,O.prototype.attach=function(){this.p1=this.body1.position,this.p2=this.body2.position,this.lv1=this.body1.linearVelocity,this.av1=this.body1.angularVelocity,this.lv2=this.body2.linearVelocity,this.av2=this.body2.angularVelocity,this.i1=this.body1.inverseInertia,this.i2=this.body2.inverseInertia},O.prototype.detach=function(){this.p1=null,this.p2=null,this.lv1=null,this.lv2=null,this.av1=null,this.av2=null,this.i1=null,this.i2=null},O.prototype.preSolve=function(t,i){this.m1=this.body1.inverseMass,this.m2=this.body2.inverseMass,this.ii1=this.i1.clone(),this.ii2=this.i2.clone();var s=this.ii1.elements,h=this.ii2.elements,e=this.p1.x,a=this.p1.y,o=this.p1.z,n=this.p2.x,r=this.p2.y,l=this.p2.z,m=this.m1+this.m2;this.num=this.manifold.numPoints;for(var c=this.cs,p=0;p<this.num;p++){var u,y,x,d,f,N,v=this.ps[p];u=v.position.x,y=v.position.y,x=v.position.z;var b=u-e,z=y-a,k=x-o,w=u-n,M=y-r,I=x-l;c.rp1X=b,c.rp1Y=z,c.rp1Z=k,c.rp2X=w,c.rp2Y=M,c.rp2Z=I,c.norImp=v.normalImpulse,c.tanImp=v.tangentImpulse,c.binImp=v.binormalImpulse;var g=v.normal.x,L=v.normal.y,S=v.normal.z,P=this.lv2.x+this.av2.y*I-this.av2.z*M-(this.lv1.x+this.av1.y*k-this.av1.z*z),V=this.lv2.y+this.av2.z*w-this.av2.x*I-(this.lv1.y+this.av1.z*b-this.av1.x*k),T=this.lv2.z+this.av2.x*M-this.av2.y*w-(this.lv1.z+this.av1.x*z-this.av1.y*b),A=g*P+L*V+S*T,U=P-A*g,D=V-A*L,O=T-A*S,j=U*U+D*D+O*O;j>.04?j=1/Pt.sqrt(j):(U=L*g-S*S,D=-S*L-g*g,O=g*S+L*L,j=1/Pt.sqrt(U*U+D*D+O*O)),U*=j,D*=j,O*=j;var C=L*O-S*D,E=S*U-g*O,B=g*D-L*U;c.norX=g,c.norY=L,c.norZ=S,c.tanX=U,c.tanY=D,c.tanZ=O,c.binX=C,c.binY=E,c.binZ=B,c.norU1X=g*this.m1,c.norU1Y=L*this.m1,c.norU1Z=S*this.m1,c.norU2X=g*this.m2,c.norU2Y=L*this.m2,c.norU2Z=S*this.m2,c.tanU1X=U*this.m1,c.tanU1Y=D*this.m1,c.tanU1Z=O*this.m1,c.tanU2X=U*this.m2,c.tanU2Y=D*this.m2,c.tanU2Z=O*this.m2,c.binU1X=C*this.m1,c.binU1Y=E*this.m1,c.binU1Z=B*this.m1,c.binU2X=C*this.m2,c.binU2Y=E*this.m2,c.binU2Z=B*this.m2;var q=z*S-k*L,Y=k*g-b*S,X=b*L-z*g,F=M*S-I*L,R=I*g-w*S,Z=w*L-M*g,J=z*O-k*D,W=k*U-b*O,_=b*D-z*U,H=M*O-I*D,Q=I*U-w*O,G=w*D-M*U,K=z*B-k*E,$=k*C-b*B,tt=b*E-z*C,it=M*B-I*E,st=I*C-w*B,ht=w*E-M*C,et=q*s[0]+Y*s[1]+X*s[2],at=q*s[3]+Y*s[4]+X*s[5],ot=q*s[6]+Y*s[7]+X*s[8],nt=F*h[0]+R*h[1]+Z*h[2],rt=F*h[3]+R*h[4]+Z*h[5],lt=F*h[6]+R*h[7]+Z*h[8],mt=J*s[0]+W*s[1]+_*s[2],ct=J*s[3]+W*s[4]+_*s[5],pt=J*s[6]+W*s[7]+_*s[8],ut=H*h[0]+Q*h[1]+G*h[2],yt=H*h[3]+Q*h[4]+G*h[5],xt=H*h[6]+Q*h[7]+G*h[8],dt=K*s[0]+$*s[1]+tt*s[2],ft=K*s[3]+$*s[4]+tt*s[5],Nt=K*s[6]+$*s[7]+tt*s[8],vt=it*h[0]+st*h[1]+ht*h[2],bt=it*h[3]+st*h[4]+ht*h[5],zt=it*h[6]+st*h[7]+ht*h[8];c.norT1X=q,c.norT1Y=Y,c.norT1Z=X,c.tanT1X=J,c.tanT1Y=W,c.tanT1Z=_,c.binT1X=K,c.binT1Y=$,c.binT1Z=tt,c.norT2X=F,c.norT2Y=R,c.norT2Z=Z,c.tanT2X=H,c.tanT2Y=Q,c.tanT2Z=G,c.binT2X=it,c.binT2Y=st,c.binT2Z=ht,c.norTU1X=et,c.norTU1Y=at,c.norTU1Z=ot,c.tanTU1X=mt,c.tanTU1Y=ct,c.tanTU1Z=pt,c.binTU1X=dt,c.binTU1Y=ft,c.binTU1Z=Nt,c.norTU2X=nt,c.norTU2Y=rt,c.norTU2Z=lt,c.tanTU2X=ut,c.tanTU2Y=yt,c.tanTU2Z=xt,c.binTU2X=vt,c.binTU2Y=bt,c.binTU2Z=zt,u=q*s[0]+Y*s[1]+X*s[2],y=q*s[3]+Y*s[4]+X*s[5],x=q*s[6]+Y*s[7]+X*s[8],d=y*k-x*z,f=x*b-u*k,N=u*z-y*b,u=F*h[0]+R*h[1]+Z*h[2],y=F*h[3]+R*h[4]+Z*h[5],x=F*h[6]+R*h[7]+Z*h[8],d+=y*I-x*M,f+=x*w-u*I,N+=u*M-y*w;var kt=1/(m+g*d+L*f+S*N);u=J*s[0]+W*s[1]+_*s[2],y=J*s[3]+W*s[4]+_*s[5],x=J*s[6]+W*s[7]+_*s[8],d=y*k-x*z,f=x*b-u*k,N=u*z-y*b,u=H*h[0]+Q*h[1]+G*h[2],y=H*h[3]+Q*h[4]+G*h[5],x=H*h[6]+Q*h[7]+G*h[8],d+=y*I-x*M,f+=x*w-u*I,N+=u*M-y*w;var wt=1/(m+U*d+D*f+O*N);u=K*s[0]+$*s[1]+tt*s[2],y=K*s[3]+$*s[4]+tt*s[5],x=K*s[6]+$*s[7]+tt*s[8],d=y*k-x*z,f=x*b-u*k,N=u*z-y*b,u=it*h[0]+st*h[1]+ht*h[2],y=it*h[3]+st*h[4]+ht*h[5],x=it*h[6]+st*h[7]+ht*h[8],d+=y*I-x*M,f+=x*w-u*I,N+=u*M-y*w;var Mt=1/(m+C*d+E*f+B*N);if(c.norDen=kt,c.tanDen=wt,c.binDen=Mt,v.warmStarted){var It=v.normalImpulse;this.lv1.x+=c.norU1X*It,this.lv1.y+=c.norU1Y*It,this.lv1.z+=c.norU1Z*It,this.av1.x+=et*It,this.av1.y+=at*It,this.av1.z+=ot*It,this.lv2.x-=c.norU2X*It,this.lv2.y-=c.norU2Y*It,this.lv2.z-=c.norU2Z*It,this.av2.x-=nt*It,this.av2.y-=rt*It,this.av2.z-=lt*It,c.norImp=It,c.tanImp=0,c.binImp=0,A=0}else c.norImp=0,c.tanImp=0,c.binImp=0;A>-1&&(A=0);var gt=this.restitution*-A,Lt=-(v.penetration+.005)*i*.05;gt<Lt&&(gt=Lt),c.norTar=gt,c.last=p==this.num-1,c=c.next}},O.prototype.solve=function(){for(var t=this.lv1.x,i=this.lv1.y,s=this.lv1.z,h=this.lv2.x,e=this.lv2.y,a=this.lv2.z,o=this.av1.x,n=this.av1.y,r=this.av1.z,l=this.av2.x,m=this.av2.y,c=this.av2.z,p=this.cs;;){var u,y,x,d,f,N=p.norImp,v=p.tanImp,b=p.binImp,z=-N*this.friction,k=h-t,w=e-i,M=a-s;f=k*p.tanX+w*p.tanY+M*p.tanZ+l*p.tanT2X+m*p.tanT2Y+c*p.tanT2Z-o*p.tanT1X-n*p.tanT1Y-r*p.tanT1Z,u=v,y=f*p.tanDen,v+=y,f=k*p.binX+w*p.binY+M*p.binZ+l*p.binT2X+m*p.binT2Y+c*p.binT2Z-o*p.binT1X-n*p.binT1Y-r*p.binT1Z,x=b,d=f*p.binDen,b+=d;var I=v*v+b*b;if(I>z*z&&(I=z/Pt.sqrt(I),v*=I,b*=I),y=v-u,d=b-x,t+=p.tanU1X*y+p.binU1X*d,i+=p.tanU1Y*y+p.binU1Y*d,s+=p.tanU1Z*y+p.binU1Z*d,o+=p.tanTU1X*y+p.binTU1X*d,n+=p.tanTU1Y*y+p.binTU1Y*d,r+=p.tanTU1Z*y+p.binTU1Z*d,h-=p.tanU2X*y+p.binU2X*d,e-=p.tanU2Y*y+p.binU2Y*d,a-=p.tanU2Z*y+p.binU2Z*d,l-=p.tanTU2X*y+p.binTU2X*d,m-=p.tanTU2Y*y+p.binTU2Y*d,c-=p.tanTU2Z*y+p.binTU2Z*d,f=(h-t)*p.norX+(e-i)*p.norY+(a-s)*p.norZ+l*p.norT2X+m*p.norT2Y+c*p.norT2Z-o*p.norT1X-n*p.norT1Y-r*p.norT1Z,u=N,y=(f-p.norTar)*p.norDen,N+=y,N>0&&(N=0),y=N-u,t+=p.norU1X*y,i+=p.norU1Y*y,s+=p.norU1Z*y,o+=p.norTU1X*y,n+=p.norTU1Y*y,r+=p.norTU1Z*y,h-=p.norU2X*y,e-=p.norU2Y*y,a-=p.norU2Z*y,l-=p.norTU2X*y,m-=p.norTU2Y*y,c-=p.norTU2Z*y,p.norImp=N,p.tanImp=v,p.binImp=b,p.last)break;p=p.next}this.lv1.x=t,this.lv1.y=i,this.lv1.z=s,this.lv2.x=h,this.lv2.y=e,this.lv2.z=a,this.av1.x=o,this.av1.y=n,this.av1.z=r,this.av2.x=l,this.av2.y=m,this.av2.z=c},O.prototype.postSolve=function(){for(var t=this.cs,i=this.num;i--;){var s=this.ps[i];s.normal.x=t.norX,s.normal.y=t.norY,s.normal.z=t.norZ,s.tangent.x=t.tanX,s.tangent.y=t.tanY,s.tangent.z=t.tanZ,s.binormal.x=t.binX,s.binormal.y=t.binY,s.binormal.z=t.binZ,s.normalImpulse=t.norImp,s.tangentImpulse=t.tanImp,s.binormalImpulse=t.binImp,s.normalDenominator=t.norDen,s.tangentDenominator=t.tanDen,s.binormalDenominator=t.binDen,t=t.next}},Object.assign(j.prototype,{Contact:!0,mixRestitution:function(t,i){return Pt.sqrt(t*i)},mixFriction:function(t,i){return Pt.sqrt(t*i)},updateManifold:function(){this.constraint.restitution=this.mixRestitution(this.shape1.restitution,this.shape2.restitution),this.constraint.friction=this.mixFriction(this.shape1.friction,this.shape2.friction);for(var t=this.manifold.numPoints,i=t;i--;){var s=this.buffer[i],h=this.points[i];s.lp1X=h.localPoint1.x,s.lp1Y=h.localPoint1.y,s.lp1Z=h.localPoint1.z,s.lp2X=h.localPoint2.x,s.lp2Y=h.localPoint2.y,s.lp2Z=h.localPoint2.z,s.impulse=h.normalImpulse}this.manifold.numPoints=0,this.detector.detectCollision(this.shape1,this.shape2,this.manifold);var e=this.manifold.numPoints;if(0==e)return void(this.touching=!1);for(this.touching=!0,i=e;i--;){h=this.points[i];for(var a=h.localPoint1.x,o=h.localPoint1.y,n=h.localPoint1.z,r=h.localPoint2.x,l=h.localPoint2.y,m=h.localPoint2.z,c=-1,p=4e-4,u=t;u--;){s=this.buffer[u];var y=s.lp1X-a,x=s.lp1Y-o,d=s.lp1Z-n,f=y*y+x*x+d*d;y=s.lp2X-r,x=s.lp2Y-l,d=s.lp2Z-m;var N=y*y+x*x+d*d;f<N?f<p&&(p=f,c=u):N<p&&(p=N,c=u)}if(c!=-1){var v=this.buffer[c];this.buffer[c]=this.buffer[--t],this.buffer[t]=v,h.normalImpulse=v.impulse,h.warmStarted=!0}else h.normalImpulse=0,h.warmStarted=!1}},attach:function(t,i){this.shape1=t,this.shape2=i,this.body1=t.parent,this.body2=i.parent,this.manifold.body1=this.body1,this.manifold.body2=this.body2,this.constraint.body1=this.body1,this.constraint.body2=this.body2,this.constraint.attach(),this.s1Link.shape=i,this.s1Link.body=this.body2,this.s2Link.shape=t,this.s2Link.body=this.body1,null!=t.contactLink?(this.s1Link.next=t.contactLink).prev=this.s1Link:this.s1Link.next=null,t.contactLink=this.s1Link,t.numContacts++,null!=i.contactLink?(this.s2Link.next=i.contactLink).prev=this.s2Link:this.s2Link.next=null,i.contactLink=this.s2Link,i.numContacts++,this.b1Link.shape=i,this.b1Link.body=this.body2,this.b2Link.shape=t,this.b2Link.body=this.body1,null!=this.body1.contactLink?(this.b1Link.next=this.body1.contactLink).prev=this.b1Link:this.b1Link.next=null,this.body1.contactLink=this.b1Link,this.body1.numContacts++,null!=this.body2.contactLink?(this.b2Link.next=this.body2.contactLink).prev=this.b2Link:this.b2Link.next=null,this.body2.contactLink=this.b2Link,this.body2.numContacts++,this.prev=null,this.next=null,this.persisting=!0,this.sleeping=this.body1.sleeping&&this.body2.sleeping,this.manifold.numPoints=0},detach:function(){var t=this.s1Link.prev,i=this.s1Link.next;null!==t&&(t.next=i),null!==i&&(i.prev=t),this.shape1.contactLink==this.s1Link&&(this.shape1.contactLink=i),this.s1Link.prev=null,this.s1Link.next=null,this.s1Link.shape=null,this.s1Link.body=null,this.shape1.numContacts--,t=this.s2Link.prev,i=this.s2Link.next,null!==t&&(t.next=i),null!==i&&(i.prev=t),this.shape2.contactLink==this.s2Link&&(this.shape2.contactLink=i),this.s2Link.prev=null,this.s2Link.next=null,this.s2Link.shape=null,this.s2Link.body=null,this.shape2.numContacts--,t=this.b1Link.prev,i=this.b1Link.next,null!==t&&(t.next=i),null!==i&&(i.prev=t),this.body1.contactLink==this.b1Link&&(this.body1.contactLink=i),this.b1Link.prev=null,this.b1Link.next=null,this.b1Link.shape=null,this.b1Link.body=null,this.body1.numContacts--,t=this.b2Link.prev,i=this.b2Link.next,null!==t&&(t.next=i),null!==i&&(i.prev=t),this.body2.contactLink==this.b2Link&&(this.body2.contactLink=i),this.b2Link.prev=null,this.b2Link.next=null,this.b2Link.shape=null,this.b2Link.body=null,this.body2.numContacts--,this.manifold.body1=null,this.manifold.body2=null,this.constraint.body1=null,this.constraint.body2=null,this.constraint.detach(),this.shape1=null,this.shape2=null,this.body1=null,this.body2=null}}),Object.assign(C.prototype,{addShape:function(t){t.parent&&i("RigidBody","It is not possible that you add a shape which already has an associated body."),null!=this.shapes&&((this.shapes.prev=t).next=this.shapes),this.shapes=t,t.parent=this,this.parent&&this.parent.addShape(t),this.numShapes++},removeShape:function(t){var i=t;if(i.parent==this){var s=i.prev,h=i.next;null!=s&&(s.next=h),null!=h&&(h.prev=s),this.shapes==i&&(this.shapes=h),i.prev=null,i.next=null,i.parent=null,this.parent&&this.parent.removeShape(i),this.numShapes--}},remove:function(){this.dispose()},dispose:function(){this.parent.removeRigidBody(this)},checkContact:function(t){this.parent.checkContact(this.name,t)},setupMass:function(t,i){var s=void 0===i||i;this.type=t||ut,this.isDynamic=this.type===pt,this.isStatic=this.type===ut,this.mass=0,this.localInertia.set(0,0,0,0,0,0,0,0,0);for(var e=new a,o=new h,n=this.shapes;null!==n;n=n.next){n.calculateMassInfo(this.massInfo);var r=this.massInfo.mass;o.addScale(n.relativePosition,r),this.mass+=r,this.rotateInertia(n.relativeRotation,this.massInfo.inertia,e),this.localInertia.addEqual(e),this.localInertia.addOffset(r,n.relativePosition)}if(this.inverseMass=1/this.mass,o.scaleEqual(this.inverseMass),s){for(this.position.addEqual(o),n=this.shapes;null!==n;n=n.next)n.relativePosition.subEqual(o);this.localInertia.subOffset(this.mass,o)}this.inverseLocalInertia.invert(this.localInertia),this.type===ut&&(this.inverseMass=0,this.inverseLocalInertia.set(0,0,0,0,0,0,0,0,0)),this.syncShapes(),this.awake()},awake:function(){if(this.allowSleep&&this.sleeping){this.sleeping=!1,this.sleepTime=0;for(var t=this.contactLink;null!=t;)t.body.sleepTime=0,t.body.sleeping=!1,t=t.next;for(var i=this.jointLink;null!=i;)i.body.sleepTime=0,i.body.sleeping=!1,i=i.next;for(var s=this.shapes;null!=s;s=s.next)s.updateProxy()}},sleep:function(){if(this.allowSleep&&!this.sleeping){this.linearVelocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.sleepPosition.copy(this.position),this.sleepOrientation.copy(this.orientation),this.sleepTime=0,this.sleeping=!0;for(var t=this.shapes;null!=t;t=t.next)t.updateProxy()}},testWakeUp:function(){(this.linearVelocity.testZero()||this.angularVelocity.testZero()||this.position.testDiff(this.sleepPosition)||this.orientation.testDiff(this.sleepOrientation))&&this.awake()},isLonely:function(){return 0==this.numJoints&&0==this.numContacts},updatePosition:function(t){switch(this.type){case ut:this.linearVelocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.controlPos&&(this.position.copy(this.newPosition),this.controlPos=!1),this.controlRot&&(this.orientation.copy(this.newOrientation),this.controlRot=!1);break;case pt:this.controlPos&&(this.angularVelocity.set(0,0,0),this.linearVelocity.set(0,0,0),this.linearVelocity.x=(this.newPosition.x-this.position.x)/t,this.linearVelocity.y=(this.newPosition.y-this.position.y)/t,this.linearVelocity.z=(this.newPosition.z-this.position.z)/t,this.controlPos=!1),this.controlRot&&(this.angularVelocity.set(0,0,0),this.orientation.copy(this.newOrientation),this.controlRot=!1),this.position.addTime(this.linearVelocity,t),this.orientation.addTime(this.angularVelocity,t);break;default:i("RigidBody","Invalid type.")}this.syncShapes()},rotateInertia:function(t,i,s){this.tmpInertia.mul(t,i),s.mul(this.tmpInertia,t,!0)},syncShapes:function(){this.rotation.setQuat(this.orientation),this.rotateInertia(this.rotation,this.inverseLocalInertia,this.inverseInertia);for(var t=this.shapes;null!=t;t=t.next)t.position.mul(this.position,t.relativePosition,this.rotation),
t.rotation.mul(this.rotation,t.relativeRotation),t.updateProxy()},applyImpulse:function(t,i){this.linearVelocity.addScale(i,this.inverseMass);var s=new h;s.sub(t,this.position).cross(s,i).mulMat(this.inverseInertia,s),this.angularVelocity.addEqual(s)},setPosition:function(t){this.newPosition.copy(t).multiplyScalar(this.invScale),this.controlPos=!0},setQuaternion:function(t){this.newOrientation.set(t.x,t.y,t.z,t.w),this.controlRot=!0},setRotation:function(t){this.newOrientation=(new e).setFromEuler(t.x*Pt.degtorad,t.y*Pt.degtorad,t.y*Pt.degtorad),this.controlRot=!0},resetPosition:function(t,i,s){this.linearVelocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.position.set(t,i,s).multiplyScalar(this.invScale),this.awake()},resetQuaternion:function(t){this.angularVelocity.set(0,0,0),this.orientation=new e(t.x,t.y,t.z,t.w),this.awake()},resetRotation:function(t,i,s){this.angularVelocity.set(0,0,0),this.orientation=(new e).setFromEuler(t*Pt.degtorad,i*Pt.degtorad,s*Pt.degtorad),this.awake()},getPosition:function(){return(new h).scale(this.position,this.scale)},getQuaternion:function(){return(new e).setFromRotationMatrix(this.rotation)}}),Object.assign(B.prototype,{BroadPhase:!0,createProxy:function(t){i("BroadPhase","Inheritance error.")},addProxy:function(t){i("BroadPhase","Inheritance error.")},removeProxy:function(t){i("BroadPhase","Inheritance error.")},isAvailablePair:function(t,i){var s=t.parent,h=i.parent;if(s==h||!s.isDynamic&&!h.isDynamic||0==(t.belongsTo&i.collidesWith)||0==(i.belongsTo&t.collidesWith))return!1;var e;for(e=s.numJoints<h.numJoints?s.jointLink:h.jointLink;null!==e;){var a=e.joint;if(!a.allowCollision&&(a.body1==s&&a.body2==h||a.body1==h&&a.body2==s))return!1;e=e.next}return!0},detectPairs:function(){this.pairs=[],this.numPairs=0,this.numPairChecks=0,this.collectPairs()},collectPairs:function(){Error("BroadPhase","Inheritance error.")},addPair:function(t,i){var s=new E(t,i);this.pairs.push(s),this.numPairs++}});var Tt=0;Object.assign(Y.prototype,{Proxy:!0,update:function(){i("Proxy","Inheritance error.")}}),X.prototype=Object.create(Y.prototype),X.prototype.constructor=X,X.prototype.update=function(){},F.prototype=Object.create(B.prototype),F.prototype.constructor=F,F.prototype.createProxy=function(t){return new X(t)},F.prototype.addProxy=function(t){this.proxies.push(t)},F.prototype.removeProxy=function(t){var i=this.proxies.indexOf(t);i>-1&&this.proxies.splice(i,1)},F.prototype.collectPairs=function(){var t,i,s,h=0,e=this.proxies,a=e.length;for(this.numPairChecks=a*(a-1)>>1;h<a;)for(i=e[h++],t=h+1;t<a;)s=e[t++],!i.aabb.intersectTest(s.aabb)&&this.isAvailablePair(i.shape,s.shape)&&this.addPair(i.shape,s.shape)},Object.assign(R.prototype,{SAPAxis:!0,addElements:function(t,i){if(this.numElements+2>=this.bufferSize){this.bufferSize*=2;for(var s=[],h=this.numElements;h--;)s[h]=this.elements[h]}this.elements[this.numElements++]=t,this.elements[this.numElements++]=i},removeElements:function(t,i){for(var s=-1,h=-1,e=0,a=this.numElements;e<a;e++){var o=this.elements[e];if(o==t||o==i){if(s!=-1){h=e;break}s=e}}for(e=s+1,a=h;e<a;e++)this.elements[e-1]=this.elements[e];for(e=h+1,a=this.numElements;e<a;e++)this.elements[e-2]=this.elements[e];this.elements[--this.numElements]=null,this.elements[--this.numElements]=null},sort:function(){for(var t=0,i=1;this.numElements>>i!=0;)i++;i=i*this.numElements>>2,t=0;for(var s=!1,h=this.elements,e=1,a=this.numElements;e<a;e++){var o=h[e],n=o.value,r=h[e-1];if(r.value>n){var l=e;do{if(h[l]=r,0==--l)break;r=h[l-1]}while(r.value>n);if(h[l]=o,t+=e-l,t>i){s=!0;break}}}if(s){t=2;var m=this.stack;for(m[0]=0,m[1]=this.numElements-1;t>0;){var c=m[--t],p=m[--t],u=c-p;if(u>16){var y=p+Pt.floor(.5*u);for(o=h[y],h[y]=h[c],h[c]=o,n=o.value,e=p-1,l=c;;){var x,d;do x=h[++e];while(x.value<n);do d=h[--l];while(n<d.value&&l!=p);if(e>=l)break;h[e]=d,h[l]=x}h[c]=h[e],h[e]=o,e-p>c-e?(m[t++]=p,m[t++]=e-1,m[t++]=e+1,m[t++]=c):(m[t++]=e+1,m[t++]=c,m[t++]=p,m[t++]=e-1)}else for(e=p+1;e<=c;e++)if(o=h[e],n=o.value,r=h[e-1],r.value>n){l=e;do{if(h[l]=r,0==--l)break;r=h[l-1]}while(r.value>n);h[l]=o}}}},calculateTestCount:function(){for(var t=1,i=0,s=1,h=this.numElements;s<h;s++)this.elements[s].max?t--:(i+=t,t++);return i}}),J.prototype=Object.create(Y.prototype),J.prototype.constructor=J,J.prototype.isDynamic=function(){var t=this.shape.parent;return t.isDynamic&&!t.sleeping},J.prototype.update=function(){var t=this.aabb.elements;this.min[0].value=t[0],this.min[1].value=t[1],this.min[2].value=t[2],this.max[0].value=t[3],this.max[1].value=t[4],this.max[2].value=t[5],(1==this.belongsTo&&!this.isDynamic()||2==this.belongsTo&&this.isDynamic())&&(this.sap.removeProxy(this),this.sap.addProxy(this))},W.prototype=Object.create(B.prototype),W.prototype.constructor=W,W.prototype.createProxy=function(t){return new J(this,t)},W.prototype.addProxy=function(t){var i=t;i.isDynamic()?(this.axesD[0].addElements(i.min[0],i.max[0]),this.axesD[1].addElements(i.min[1],i.max[1]),this.axesD[2].addElements(i.min[2],i.max[2]),i.belongsTo=1,this.numElementsD+=2):(this.axesS[0].addElements(i.min[0],i.max[0]),this.axesS[1].addElements(i.min[1],i.max[1]),this.axesS[2].addElements(i.min[2],i.max[2]),i.belongsTo=2,this.numElementsS+=2)},W.prototype.removeProxy=function(t){var i=t;if(0!=i.belongsTo){switch(i.belongsTo){case 1:this.axesD[0].removeElements(i.min[0],i.max[0]),this.axesD[1].removeElements(i.min[1],i.max[1]),this.axesD[2].removeElements(i.min[2],i.max[2]),this.numElementsD-=2;break;case 2:this.axesS[0].removeElements(i.min[0],i.max[0]),this.axesS[1].removeElements(i.min[1],i.max[1]),this.axesS[2].removeElements(i.min[2],i.max[2]),this.numElementsS-=2}i.belongsTo=0}},W.prototype.collectPairs=function(){if(0!=this.numElementsD){var t=this.axesD[this.index1],i=this.axesD[this.index2];t.sort(),i.sort();var s,h,e=t.calculateTestCount(),a=i.calculateTestCount();e<=a?(i=this.axesS[this.index1],i.sort(),s=t.elements,h=i.elements):(t=this.axesS[this.index2],t.sort(),s=i.elements,h=t.elements,this.index1^=this.index2,this.index2^=this.index1,this.index1^=this.index2);for(var o,n,r=0,l=0;r<this.numElementsD;){var m,c;if(l==this.numElementsS)m=s[r],c=!0,r++;else{var p=s[r],u=h[l];p.value<u.value?(m=p,c=!0,r++):(m=u,c=!1,l++)}if(m.max){var y=m.pair;if(c){if(y==o){o=o.pair;continue}m=o}else{if(y==n){n=n.pair;continue}m=n}do{if(b=m.pair,b==y){m.pair=b.pair;break}m=b}while(null!=m)}else{for(var x=m.proxy.shape,d=m.min1.value,f=m.max1.value,N=m.min2.value,v=m.max2.value,b=o;null!=b;b=b.pair){var z=b.proxy.shape;this.numPairChecks++,d>b.max1.value||f<b.min1.value||N>b.max2.value||v<b.min2.value||!this.isAvailablePair(x,z)||this.addPair(x,z)}if(c){for(b=n;null!=b;b=b.pair)z=b.proxy.shape,this.numPairChecks++,d>b.max1.value||f<b.min1.value||N>b.max2.value||v<b.min2.value||!this.isAvailablePair(x,z)||this.addPair(x,z);m.pair=o,o=m}else m.pair=n,n=m}}this.index2=3^(this.index1|this.index2)}},Object.assign(H.prototype,{DBVT:!0,moveLeaf:function(t){this.deleteLeaf(t),this.insertLeaf(t)},insertLeaf:function(t){if(null==this.root)return void(this.root=t);for(var i,s,h=t.aabb,e=this.root;null==e.proxy;){var a=e.child1,o=e.child2,n=e.aabb,r=a.aabb,l=o.aabb;i=n.surfaceArea(),this.aabb.combine(h,n),s=this.aabb.surfaceArea();var m=2*s,c=2*(s-i),p=c;this.aabb.combine(h,r),p+=null!=a.proxy?this.aabb.surfaceArea():this.aabb.surfaceArea()-r.surfaceArea();var u=c;if(this.aabb.combine(h,l),u+=null!=o.proxy?this.aabb.surfaceArea():this.aabb.surfaceArea()-l.surfaceArea(),p<u){if(m<p)break;e=a}else{if(m<u)break;e=o}}var y,x=e.parent;y=this.numFreeNodes>0?this.freeNodes[--this.numFreeNodes]:new _,y.parent=x,y.child1=t,y.child2=e,y.aabb.combine(t.aabb,e.aabb),y.height=e.height+1,e.parent=y,t.parent=y,e==this.root?this.root=y:x.child1==e?x.child1=y:x.child2=y;do y=this.balance(y),this.fix(y),y=y.parent;while(null!=y)},getBalance:function(t){return null!=t.proxy?0:t.child1.height-t.child2.height},deleteLeaf:function(t){if(t==this.root)return void(this.root=null);var i,s=t.parent;if(i=s.child1==t?s.child2:s.child1,s==this.root)return this.root=i,void(i.parent=null);var h=s.parent;i.parent=h,h.child1==s?h.child1=i:h.child2=i,this.numFreeNodes<16384&&(this.freeNodes[this.numFreeNodes++]=s);do h=this.balance(h),this.fix(h),h=h.parent;while(null!=h)},balance:function(t){var i=t.height;if(i<2)return t;var s,h=t.parent,e=t.child1,a=t.child2,o=e.height,n=a.height,r=o-n;if(r>1){var l=e.child1,m=e.child2,c=l.height,p=m.height;return c>p?(e.child2=t,t.parent=e,t.child1=m,m.parent=t,t.aabb.combine(m.aabb,a.aabb),s=p-n,t.height=p-(s&s>>31)+1,e.aabb.combine(l.aabb,t.aabb),s=c-i,e.height=c-(s&s>>31)+1):(e.child1=t,t.parent=e,t.child1=l,l.parent=t,t.aabb.combine(l.aabb,a.aabb),s=c-n,t.height=c-(s&s>>31)+1,e.aabb.combine(t.aabb,m.aabb),s=i-p,e.height=i-(s&s>>31)+1),null!=h?h.child1==t?h.child1=e:h.child2=e:this.root=e,e.parent=h,e}if(r<-1){var u=a.child1,y=a.child2,x=u.height,d=y.height;return x>d?(a.child2=t,t.parent=a,t.child2=y,y.parent=t,t.aabb.combine(e.aabb,y.aabb),s=o-d,t.height=o-(s&s>>31)+1,a.aabb.combine(u.aabb,t.aabb),s=x-i,a.height=x-(s&s>>31)+1):(a.child1=t,t.parent=a,t.child2=u,u.parent=t,t.aabb.combine(e.aabb,u.aabb),s=o-x,t.height=o-(s&s>>31)+1,a.aabb.combine(t.aabb,y.aabb),s=i-d,a.height=i-(s&s>>31)+1),null!=h?h.child1==t?h.child1=a:h.child2=a:this.root=a,a.parent=h,a}return t},fix:function(t){var i=t.child1,s=t.child2;t.aabb.combine(i.aabb,s.aabb),t.height=i.height<s.height?s.height+1:i.height+1}}),Q.prototype=Object.create(Y.prototype),Q.prototype.constructor=Q,Q.prototype.update=function(){},G.prototype=Object.create(B.prototype),G.prototype.constructor=G,G.prototype.createProxy=function(t){return new Q(t)},G.prototype.addProxy=function(t){this.tree.insertLeaf(t.leaf),this.leaves.push(t.leaf),this.numLeaves++},G.prototype.removeProxy=function(t){this.tree.deleteLeaf(t.leaf);var i=this.leaves.indexOf(t.leaf);i>-1&&(this.leaves.splice(i,1),this.numLeaves--)},G.prototype.collectPairs=function(){if(!(this.numLeaves<2))for(var t,i=.1,s=this.numLeaves;s--;)t=this.leaves[s],t.proxy.aabb.intersectTestTwo(t.aabb)&&(t.aabb.copy(t.proxy.aabb,i),this.tree.deleteLeaf(t),this.tree.insertLeaf(t),this.collide(t,this.tree.root))},G.prototype.collide=function(t,i){var s,h,e,a,o,n,r=2;for(this.stack[0]=t,this.stack[1]=i;r>0;)if(e=this.stack[--r],a=this.stack[--r],o=null!=e.proxy,n=null!=a.proxy,this.numPairChecks++,o&&n){if(s=e.proxy.shape,h=a.proxy.shape,s==h||s.aabb.intersectTest(h.aabb)||!this.isAvailablePair(s,h))continue;this.addPair(s,h)}else{if(e.aabb.intersectTest(a.aabb))continue;n||!o&&e.aabb.surfaceArea()>a.aabb.surfaceArea()?(this.stack[r++]=e.child1,this.stack[r++]=a,this.stack[r++]=e.child2,this.stack[r++]=a):(this.stack[r++]=e,this.stack[r++]=a.child1,this.stack[r++]=e,this.stack[r++]=a.child2)}},Object.assign(K.prototype,{CollisionDetector:!0,detectCollision:function(t,s,h){i("CollisionDetector","Inheritance error.")}}),$.prototype=Object.create(K.prototype),$.prototype.constructor=$,$.prototype.detectCollision=function(t,i,s){var h,e;t.id<i.id?(h=t,e=i):(h=i,e=t);var a,o,n,r,l,m,c,p,u,y,x,d,f,N,v,b,z,k,w,M,I,g,L,S,P,V,T,A,U,D,O,j,C,E,B,q,Y=h.elements,X=e.elements,F=h.dimentions,R=e.dimentions,Z=h.position,J=e.position,W=Z.x,_=Z.y,H=Z.z,Q=J.x,G=J.y,K=J.z,$=Q-W,tt=G-_,it=K-H,st=h.halfWidth,ht=h.halfHeight,et=h.halfDepth,at=e.halfWidth,ot=e.halfHeight,nt=e.halfDepth,rt=F[0],lt=F[1],mt=F[2],ct=F[3],pt=F[4],ut=F[5],yt=F[6],xt=F[7],dt=F[8],ft=F[9],Nt=F[10],vt=F[11],bt=F[12],zt=F[13],kt=F[14],wt=F[15],Mt=F[16],It=F[17],gt=R[0],Lt=R[1],St=R[2],Vt=R[3],Tt=R[4],At=R[5],Ut=R[6],Dt=R[7],Ot=R[8],jt=R[9],Ct=R[10],Et=R[11],Bt=R[12],qt=R[13],Yt=R[14],Xt=R[15],Ft=R[16],Rt=R[17],Zt=lt*St-mt*Lt,Jt=mt*gt-rt*St,Wt=rt*Lt-lt*gt,_t=lt*At-mt*Tt,Ht=mt*Vt-rt*At,Qt=rt*Tt-lt*Vt,Gt=lt*Ot-mt*Dt,Kt=mt*Ut-rt*Ot,$t=rt*Dt-lt*Ut,ti=pt*St-ut*Lt,ii=ut*gt-ct*St,si=ct*Lt-pt*gt,hi=pt*At-ut*Tt,ei=ut*Vt-ct*At,ai=ct*Tt-pt*Vt,oi=pt*Ot-ut*Dt,ni=ut*Ut-ct*Ot,ri=ct*Dt-pt*Ut,li=xt*St-dt*Lt,mi=dt*gt-yt*St,ci=yt*Lt-xt*gt,pi=xt*At-dt*Tt,ui=dt*Vt-yt*At,yi=yt*Tt-xt*Vt,xi=xt*Ot-dt*Dt,di=dt*Ut-yt*Ot,fi=yt*Dt-xt*Ut,Ni=!1,vi=!1,bi=!1,zi=!1,ki=!1,wi=!1,Mi=!1,Ii=!1,gi=!1;if(O=rt*$+lt*tt+mt*it,a=O>0,a||(O=-O),j=st,E=rt*gt+lt*Lt+mt*St,B=rt*Vt+lt*Tt+mt*At,q=rt*Ut+lt*Dt+mt*Ot,E<0&&(E=-E),B<0&&(B=-B),q<0&&(q=-q),C=E*at+B*ot+q*nt,b=O-j-C,!(b>0||(O=ct*$+pt*tt+ut*it,o=O>0,o||(O=-O),j=ht,E=ct*gt+pt*Lt+ut*St,B=ct*Vt+pt*Tt+ut*At,q=ct*Ut+pt*Dt+ut*Ot,E<0&&(E=-E),B<0&&(B=-B),q<0&&(q=-q),C=E*at+B*ot+q*nt,z=O-j-C,z>0||(O=yt*$+xt*tt+dt*it,n=O>0,n||(O=-O),j=et,E=yt*gt+xt*Lt+dt*St,B=yt*Vt+xt*Tt+dt*At,q=yt*Ut+xt*Dt+dt*Ot,E<0&&(E=-E),B<0&&(B=-B),q<0&&(q=-q),C=E*at+B*ot+q*nt,k=O-j-C,k>0||(O=gt*$+Lt*tt+St*it,r=O>0,r||(O=-O),E=gt*rt+Lt*lt+St*mt,B=gt*ct+Lt*pt+St*ut,q=gt*yt+Lt*xt+St*dt,E<0&&(E=-E),B<0&&(B=-B),q<0&&(q=-q),j=E*st+B*ht+q*et,C=at,w=1*(O-j-C),w>0||(O=Vt*$+Tt*tt+At*it,l=O>0,l||(O=-O),E=Vt*rt+Tt*lt+At*mt,B=Vt*ct+Tt*pt+At*ut,q=Vt*yt+Tt*xt+At*dt,E<0&&(E=-E),B<0&&(B=-B),q<0&&(q=-q),j=E*st+B*ht+q*et,C=ot,M=1*(O-j-C),M>0||(O=Ut*$+Dt*tt+Ot*it,m=O>0,m||(O=-O),E=Ut*rt+Dt*lt+Ot*mt,B=Ut*ct+Dt*pt+Ot*ut,q=Ut*yt+Dt*xt+Ot*dt,E<0&&(E=-E),B<0&&(B=-B),q<0&&(q=-q),j=E*st+B*ht+q*et,C=nt,I=1*(O-j-C),I>0))))))){if(O=Zt*Zt+Jt*Jt+Wt*Wt,O>1e-5){if(O=1/Pt.sqrt(O),Zt*=O,Jt*=O,Wt*=O,O=Zt*$+Jt*tt+Wt*it,c=O>0,c||(O=-O),E=Zt*ct+Jt*pt+Wt*ut,B=Zt*yt+Jt*xt+Wt*dt,E<0&&(E=-E),B<0&&(B=-B),j=E*ht+B*et,E=Zt*Vt+Jt*Tt+Wt*At,B=Zt*Ut+Jt*Dt+Wt*Ot,E<0&&(E=-E),B<0&&(B=-B),C=E*ot+B*nt,g=O-j-C,g>0)return}else c=!1,g=0,Ni=!0;if(O=_t*_t+Ht*Ht+Qt*Qt,O>1e-5){if(O=1/Pt.sqrt(O),_t*=O,Ht*=O,Qt*=O,O=_t*$+Ht*tt+Qt*it,p=O>0,p||(O=-O),E=_t*ct+Ht*pt+Qt*ut,B=_t*yt+Ht*xt+Qt*dt,E<0&&(E=-E),B<0&&(B=-B),j=E*ht+B*et,E=_t*gt+Ht*Lt+Qt*St,B=_t*Ut+Ht*Dt+Qt*Ot,E<0&&(E=-E),B<0&&(B=-B),C=E*at+B*nt,L=O-j-C,L>0)return}else p=!1,L=0,vi=!0;if(O=Gt*Gt+Kt*Kt+$t*$t,O>1e-5){if(O=1/Pt.sqrt(O),Gt*=O,Kt*=O,$t*=O,O=Gt*$+Kt*tt+$t*it,u=O>0,u||(O=-O),E=Gt*ct+Kt*pt+$t*ut,B=Gt*yt+Kt*xt+$t*dt,E<0&&(E=-E),B<0&&(B=-B),j=E*ht+B*et,E=Gt*gt+Kt*Lt+$t*St,B=Gt*Vt+Kt*Tt+$t*At,E<0&&(E=-E),B<0&&(B=-B),C=E*at+B*ot,S=O-j-C,S>0)return}else u=!1,S=0,bi=!0;if(O=ti*ti+ii*ii+si*si,O>1e-5){if(O=1/Pt.sqrt(O),ti*=O,ii*=O,si*=O,O=ti*$+ii*tt+si*it,y=O>0,y||(O=-O),E=ti*rt+ii*lt+si*mt,B=ti*yt+ii*xt+si*dt,E<0&&(E=-E),B<0&&(B=-B),j=E*st+B*et,E=ti*Vt+ii*Tt+si*At,B=ti*Ut+ii*Dt+si*Ot,E<0&&(E=-E),B<0&&(B=-B),C=E*ot+B*nt,P=O-j-C,P>0)return}else y=!1,P=0,zi=!0;if(O=hi*hi+ei*ei+ai*ai,O>1e-5){if(O=1/Pt.sqrt(O),hi*=O,ei*=O,ai*=O,O=hi*$+ei*tt+ai*it,x=O>0,x||(O=-O),E=hi*rt+ei*lt+ai*mt,B=hi*yt+ei*xt+ai*dt,E<0&&(E=-E),B<0&&(B=-B),j=E*st+B*et,E=hi*gt+ei*Lt+ai*St,B=hi*Ut+ei*Dt+ai*Ot,E<0&&(E=-E),B<0&&(B=-B),C=E*at+B*nt,V=O-j-C,V>0)return}else x=!1,V=0,ki=!0;if(O=oi*oi+ni*ni+ri*ri,O>1e-5){if(O=1/Pt.sqrt(O),oi*=O,ni*=O,ri*=O,O=oi*$+ni*tt+ri*it,d=O>0,d||(O=-O),E=oi*rt+ni*lt+ri*mt,B=oi*yt+ni*xt+ri*dt,E<0&&(E=-E),B<0&&(B=-B),j=E*st+B*et,E=oi*gt+ni*Lt+ri*St,B=oi*Vt+ni*Tt+ri*At,E<0&&(E=-E),B<0&&(B=-B),C=E*at+B*ot,T=O-j-C,T>0)return}else d=!1,T=0,wi=!0;if(O=li*li+mi*mi+ci*ci,O>1e-5){if(O=1/Pt.sqrt(O),li*=O,mi*=O,ci*=O,O=li*$+mi*tt+ci*it,f=O>0,f||(O=-O),E=li*rt+mi*lt+ci*mt,B=li*ct+mi*pt+ci*ut,E<0&&(E=-E),B<0&&(B=-B),j=E*st+B*ht,E=li*Vt+mi*Tt+ci*At,B=li*Ut+mi*Dt+ci*Ot,E<0&&(E=-E),B<0&&(B=-B),C=E*ot+B*nt,A=O-j-C,A>0)return}else f=!1,A=0,Mi=!0;if(O=pi*pi+ui*ui+yi*yi,O>1e-5){if(O=1/Pt.sqrt(O),pi*=O,ui*=O,yi*=O,O=pi*$+ui*tt+yi*it,N=O>0,N||(O=-O),E=pi*rt+ui*lt+yi*mt,B=pi*ct+ui*pt+yi*ut,E<0&&(E=-E),B<0&&(B=-B),j=E*st+B*ht,E=pi*gt+ui*Lt+yi*St,B=pi*Ut+ui*Dt+yi*Ot,E<0&&(E=-E),B<0&&(B=-B),C=E*at+B*nt,U=O-j-C,U>0)return}else N=!1,U=0,Ii=!0;if(O=xi*xi+di*di+fi*fi,O>1e-5){if(O=1/Pt.sqrt(O),xi*=O,di*=O,fi*=O,O=xi*$+di*tt+fi*it,v=O>0,v||(O=-O),E=xi*rt+di*lt+fi*mt,B=xi*ct+di*pt+fi*ut,E<0&&(E=-E),B<0&&(B=-B),j=E*st+B*ht,E=xi*gt+di*Lt+fi*St,B=xi*Vt+di*Tt+fi*At,E<0&&(E=-E),B<0&&(B=-B),C=E*at+B*ot,D=O-j-C,D>0)return}else v=!1,D=0,gi=!0;var Li=b,Si=b,Pi=0,Vi=a;z>Si&&(Li=z,Si=z,Pi=1,Vi=o),k>Si&&(Li=k,Si=k,Pi=2,Vi=n),w>Si&&(Li=w,Si=w,Pi=3,Vi=r),M>Si&&(Li=M,Si=M,Pi=4,Vi=l),I>Si&&(Li=I,Si=I,Pi=5,Vi=m),g-.01>Si&&!Ni&&(Li=g,Si=g-.01,Pi=6,Vi=c),L-.01>Si&&!vi&&(Li=L,Si=L-.01,Pi=7,Vi=p),S-.01>Si&&!bi&&(Li=S,Si=S-.01,Pi=8,Vi=u),P-.01>Si&&!zi&&(Li=P,Si=P-.01,Pi=9,Vi=y),V-.01>Si&&!ki&&(Li=V,Si=V-.01,Pi=10,Vi=x),T-.01>Si&&!wi&&(Li=T,Si=T-.01,Pi=11,Vi=d),A-.01>Si&&!Mi&&(Li=A,Si=A-.01,Pi=12,Vi=f),U-.01>Si&&!Ii&&(Li=U,Si=U-.01,Pi=13,Vi=N),D-.01>Si&&!gi&&(Li=D,Pi=14,Vi=v);var Ti=0,Ai=0,Ui=0,Di=0,Oi=0,ji=0,Ci=0,Ei=0,Bi=0,qi=0,Yi=0,Xi=0,Fi=0,Ri=0,Zi=0,Ji=0,Wi=0,_i=0,Hi=!1;if(0==Pi?(Vi?(qi=W+ft,Yi=_+Nt,Xi=H+vt,Ti=rt,Ai=lt,Ui=mt):(qi=W-ft,Yi=_-Nt,Xi=H-vt,Ti=-rt,Ai=-lt,Ui=-mt),Fi=bt,Ri=zt,Zi=kt,Di=-ct,Oi=-pt,ji=-ut,Ji=wt,Wi=Mt,_i=It,Ci=-yt,Ei=-xt,Bi=-dt):1==Pi?(Vi?(qi=W+bt,Yi=_+zt,Xi=H+kt,Ti=ct,Ai=pt,Ui=ut):(qi=W-bt,Yi=_-zt,Xi=H-kt,Ti=-ct,Ai=-pt,Ui=-ut),Fi=ft,Ri=Nt,Zi=vt,Di=-rt,Oi=-lt,ji=-mt,Ji=wt,Wi=Mt,_i=It,Ci=-yt,Ei=-xt,Bi=-dt):2==Pi?(Vi?(qi=W+wt,Yi=_+Mt,Xi=H+It,Ti=yt,Ai=xt,Ui=dt):(qi=W-wt,Yi=_-Mt,Xi=H-It,Ti=-yt,Ai=-xt,Ui=-dt),Fi=ft,Ri=Nt,Zi=vt,Di=-rt,Oi=-lt,ji=-mt,Ji=bt,Wi=zt,_i=kt,Ci=-ct,Ei=-pt,Bi=-ut):3==Pi?(Hi=!0,Vi?(qi=Q-jt,Yi=G-Ct,Xi=K-Et,Ti=-gt,Ai=-Lt,Ui=-St):(qi=Q+jt,Yi=G+Ct,Xi=K+Et,Ti=gt,Ai=Lt,Ui=St),Fi=Bt,Ri=qt,Zi=Yt,Di=-Vt,Oi=-Tt,ji=-At,Ji=Xt,Wi=Ft,_i=Rt,Ci=-Ut,Ei=-Dt,Bi=-Ot):4==Pi?(Hi=!0,Vi?(qi=Q-Bt,Yi=G-qt,Xi=K-Yt,Ti=-Vt,Ai=-Tt,Ui=-At):(qi=Q+Bt,Yi=G+qt,Xi=K+Yt,Ti=Vt,Ai=Tt,Ui=At),Fi=jt,Ri=Ct,Zi=Et,Di=-gt,Oi=-Lt,ji=-St,Ji=Xt,Wi=Ft,_i=Rt,Ci=-Ut,Ei=-Dt,Bi=-Ot):5==Pi?(Hi=!0,Vi?(qi=Q-Xt,Yi=G-Ft,Xi=K-Rt,Ti=-Ut,Ai=-Dt,Ui=-Ot):(qi=Q+Xt,Yi=G+Ft,Xi=K+Rt,Ti=Ut,Ai=Dt,Ui=Ot),Fi=jt,Ri=Ct,Zi=Et,Di=-gt,Oi=-Lt,ji=-St,Ji=Bt,Wi=qt,_i=Yt,Ci=-Vt,Ei=-Tt,Bi=-At):6==Pi?(Ti=Zt,Ai=Jt,Ui=Wt,Di=rt,Oi=lt,ji=mt,Ci=gt,Ei=Lt,Bi=St):7==Pi?(Ti=_t,Ai=Ht,Ui=Qt,Di=rt,Oi=lt,ji=mt,Ci=Vt,Ei=Tt,Bi=At):8==Pi?(Ti=Gt,Ai=Kt,Ui=$t,Di=rt,Oi=lt,ji=mt,Ci=Ut,Ei=Dt,Bi=Ot):9==Pi?(Ti=ti,Ai=ii,Ui=si,Di=ct,Oi=pt,ji=ut,Ci=gt,Ei=Lt,Bi=St):10==Pi?(Ti=hi,Ai=ei,Ui=ai,Di=ct,Oi=pt,ji=ut,Ci=Vt,Ei=Tt,Bi=At):11==Pi?(Ti=oi,Ai=ni,Ui=ri,Di=ct,Oi=pt,ji=ut,Ci=Ut,Ei=Dt,Bi=Ot):12==Pi?(Ti=li,Ai=mi,Ui=ci,Di=yt,Oi=xt,ji=dt,Ci=gt,Ei=Lt,Bi=St):13==Pi?(Ti=pi,Ai=ui,Ui=yi,Di=yt,Oi=xt,ji=dt,Ci=Vt,Ei=Tt,Bi=At):14==Pi&&(Ti=xi,Ai=di,Ui=fi,Di=yt,Oi=xt,ji=dt,Ci=Ut,Ei=Dt,Bi=Ot),Pi>5){Vi||(Ti=-Ti,Ai=-Ai,Ui=-Ui);var Qi,Gi,Ki,$i,ts,is,ss,hs,es,as,os;is=Y[0],ss=Y[1],hs=Y[2],Gi=Ti*is+Ai*ss+Ui*hs,Ki=Y[3],$i=Y[4],ts=Y[5],Qi=Ti*Ki+Ai*$i+Ui*ts,Qi>Gi&&(Gi=Qi,is=Ki,ss=$i,hs=ts),Ki=Y[6],$i=Y[7],ts=Y[8],Qi=Ti*Ki+Ai*$i+Ui*ts,Qi>Gi&&(Gi=Qi,is=Ki,ss=$i,hs=ts),Ki=Y[9],$i=Y[10],ts=Y[11],Qi=Ti*Ki+Ai*$i+Ui*ts,Qi>Gi&&(Gi=Qi,is=Ki,ss=$i,hs=ts),Ki=Y[12],$i=Y[13],ts=Y[14],Qi=Ti*Ki+Ai*$i+Ui*ts,Qi>Gi&&(Gi=Qi,is=Ki,ss=$i,hs=ts),Ki=Y[15],$i=Y[16],ts=Y[17],Qi=Ti*Ki+Ai*$i+Ui*ts,Qi>Gi&&(Gi=Qi,is=Ki,ss=$i,hs=ts),Ki=Y[18],$i=Y[19],ts=Y[20],Qi=Ti*Ki+Ai*$i+Ui*ts,Qi>Gi&&(Gi=Qi,is=Ki,ss=$i,hs=ts),Ki=Y[21],$i=Y[22],ts=Y[23],Qi=Ti*Ki+Ai*$i+Ui*ts,Qi>Gi&&(Gi=Qi,is=Ki,ss=$i,hs=ts),es=X[0],as=X[1],os=X[2],Gi=Ti*es+Ai*as+Ui*os,Ki=X[3],$i=X[4],ts=X[5],Qi=Ti*Ki+Ai*$i+Ui*ts,Qi<Gi&&(Gi=Qi,es=Ki,as=$i,os=ts),Ki=X[6],$i=X[7],ts=X[8],Qi=Ti*Ki+Ai*$i+Ui*ts,Qi<Gi&&(Gi=Qi,es=Ki,as=$i,os=ts),Ki=X[9],$i=X[10],ts=X[11],Qi=Ti*Ki+Ai*$i+Ui*ts,Qi<Gi&&(Gi=Qi,es=Ki,as=$i,os=ts),Ki=X[12],$i=X[13],ts=X[14],Qi=Ti*Ki+Ai*$i+Ui*ts,Qi<Gi&&(Gi=Qi,es=Ki,as=$i,os=ts),Ki=X[15],$i=X[16],ts=X[17],Qi=Ti*Ki+Ai*$i+Ui*ts,Qi<Gi&&(Gi=Qi,es=Ki,as=$i,os=ts),Ki=X[18],$i=X[19],ts=X[20],Qi=Ti*Ki+Ai*$i+Ui*ts,Qi<Gi&&(Gi=Qi,es=Ki,as=$i,os=ts),Ki=X[21],$i=X[22],ts=X[23],Qi=Ti*Ki+Ai*$i+Ui*ts,Qi<Gi&&(Gi=Qi,es=Ki,as=$i,os=ts),Ki=es-is,$i=as-ss,ts=os-hs,E=Di*Ci+Oi*Ei+ji*Bi;var ns=(Ki*(Di-Ci*E)+$i*(Oi-Ei*E)+ts*(ji-Bi*E))/(1-E*E);return void s.addPoint(is+Di*ns+Ti*Li*.5,ss+Oi*ns+Ai*Li*.5,hs+ji*ns+Ui*Li*.5,Ti,Ai,Ui,Li,!1)}var rs,ls,ms,cs,ps,us,ys,xs,ds,fs,Ns,vs,bs=1,zs=0,ks=0;Hi?(zs=rt*Ti+lt*Ai+mt*Ui,zs<bs&&(bs=zs,ks=0),-zs<bs&&(bs=-zs,ks=1),zs=ct*Ti+pt*Ai+ut*Ui,zs<bs&&(bs=zs,ks=2),-zs<bs&&(bs=-zs,ks=3),zs=yt*Ti+xt*Ai+dt*Ui,zs<bs&&(bs=zs,ks=4),-zs<bs&&(bs=-zs,ks=5),0==ks?(rs=Y[0],ls=Y[1],ms=Y[2],cs=Y[6],ps=Y[7],us=Y[8],ys=Y[9],xs=Y[10],ds=Y[11],fs=Y[3],Ns=Y[4],vs=Y[5]):1==ks?(rs=Y[15],ls=Y[16],ms=Y[17],cs=Y[21],ps=Y[22],us=Y[23],ys=Y[18],xs=Y[19],ds=Y[20],fs=Y[12],Ns=Y[13],vs=Y[14]):2==ks?(rs=Y[12],ls=Y[13],ms=Y[14],cs=Y[0],ps=Y[1],us=Y[2],ys=Y[3],xs=Y[4],ds=Y[5],fs=Y[15],Ns=Y[16],vs=Y[17]):3==ks?(rs=Y[21],ls=Y[22],ms=Y[23],cs=Y[9],ps=Y[10],us=Y[11],ys=Y[6],xs=Y[7],ds=Y[8],fs=Y[18],Ns=Y[19],vs=Y[20]):4==ks?(rs=Y[12],ls=Y[13],ms=Y[14],cs=Y[18],ps=Y[19],us=Y[20],ys=Y[6],xs=Y[7],ds=Y[8],fs=Y[0],Ns=Y[1],vs=Y[2]):5==ks&&(rs=Y[3],ls=Y[4],ms=Y[5],cs=Y[6],ps=Y[7],us=Y[8],ys=Y[21],xs=Y[22],ds=Y[23],fs=Y[15],Ns=Y[16],vs=Y[17])):(zs=gt*Ti+Lt*Ai+St*Ui,zs<bs&&(bs=zs,ks=0),-zs<bs&&(bs=-zs,ks=1),zs=Vt*Ti+Tt*Ai+At*Ui,zs<bs&&(bs=zs,ks=2),-zs<bs&&(bs=-zs,ks=3),zs=Ut*Ti+Dt*Ai+Ot*Ui,zs<bs&&(bs=zs,ks=4),-zs<bs&&(bs=-zs,ks=5),0==ks?(rs=X[0],ls=X[1],ms=X[2],cs=X[6],ps=X[7],us=X[8],ys=X[9],xs=X[10],ds=X[11],fs=X[3],Ns=X[4],vs=X[5]):1==ks?(rs=X[15],ls=X[16],ms=X[17],cs=X[21],ps=X[22],us=X[23],ys=X[18],xs=X[19],ds=X[20],fs=X[12],Ns=X[13],vs=X[14]):2==ks?(rs=X[12],ls=X[13],ms=X[14],cs=X[0],ps=X[1],us=X[2],ys=X[3],xs=X[4],ds=X[5],fs=X[15],Ns=X[16],vs=X[17]):3==ks?(rs=X[21],ls=X[22],ms=X[23],cs=X[9],ps=X[10],us=X[11],ys=X[6],xs=X[7],ds=X[8],fs=X[18],Ns=X[19],vs=X[20]):4==ks?(rs=X[12],ls=X[13],ms=X[14],cs=X[18],ps=X[19],us=X[20],ys=X[6],xs=X[7],ds=X[8],fs=X[0],Ns=X[1],vs=X[2]):5==ks&&(rs=X[3],ls=X[4],ms=X[5],cs=X[9],ps=X[10],us=X[11],ys=X[21],xs=X[22],ds=X[23],fs=X[15],Ns=X[16],vs=X[17]));var ws,Ms,Is,gs,Ls,Ss,Ps,Vs,Ts;this.clipVertices1[0]=rs,this.clipVertices1[1]=ls,this.clipVertices1[2]=ms,this.clipVertices1[3]=cs,this.clipVertices1[4]=ps,this.clipVertices1[5]=us,this.clipVertices1[6]=ys,this.clipVertices1[7]=xs,this.clipVertices1[8]=ds,this.clipVertices1[9]=fs,this.clipVertices1[10]=Ns,this.clipVertices1[11]=vs,Ms=0,gs=this.clipVertices1[9],Ls=this.clipVertices1[10],Ss=this.clipVertices1[11],E=(gs-qi-Fi)*Di+(Ls-Yi-Ri)*Oi+(Ss-Xi-Zi)*ji;for(var As=0;As<4;As++)Is=3*As,Ps=this.clipVertices1[Is],Vs=this.clipVertices1[Is+1],Ts=this.clipVertices1[Is+2],B=(Ps-qi-Fi)*Di+(Vs-Yi-Ri)*Oi+(Ts-Xi-Zi)*ji,E>0?B>0?(Is=3*Ms,Ms++,this.clipVertices2[Is]=Ps,this.clipVertices2[Is+1]=Vs,this.clipVertices2[Is+2]=Ts):(Is=3*Ms,Ms++,ns=E/(E-B),this.clipVertices2[Is]=gs+(Ps-gs)*ns,this.clipVertices2[Is+1]=Ls+(Vs-Ls)*ns,this.clipVertices2[Is+2]=Ss+(Ts-Ss)*ns):B>0&&(Is=3*Ms,Ms++,ns=E/(E-B),this.clipVertices2[Is]=gs+(Ps-gs)*ns,this.clipVertices2[Is+1]=Ls+(Vs-Ls)*ns,this.clipVertices2[Is+2]=Ss+(Ts-Ss)*ns,Is=3*Ms,Ms++,this.clipVertices2[Is]=Ps,this.clipVertices2[Is+1]=Vs,this.clipVertices2[Is+2]=Ts),gs=Ps,Ls=Vs,Ss=Ts,E=B;if(ws=Ms,0!=ws){for(Ms=0,Is=3*(ws-1),gs=this.clipVertices2[Is],Ls=this.clipVertices2[Is+1],Ss=this.clipVertices2[Is+2],E=(gs-qi-Ji)*Ci+(Ls-Yi-Wi)*Ei+(Ss-Xi-_i)*Bi,As=0;As<ws;As++)Is=3*As,Ps=this.clipVertices2[Is],Vs=this.clipVertices2[Is+1],Ts=this.clipVertices2[Is+2],B=(Ps-qi-Ji)*Ci+(Vs-Yi-Wi)*Ei+(Ts-Xi-_i)*Bi,E>0?B>0?(Is=3*Ms,Ms++,this.clipVertices1[Is]=Ps,this.clipVertices1[Is+1]=Vs,this.clipVertices1[Is+2]=Ts):(Is=3*Ms,Ms++,ns=E/(E-B),this.clipVertices1[Is]=gs+(Ps-gs)*ns,this.clipVertices1[Is+1]=Ls+(Vs-Ls)*ns,this.clipVertices1[Is+2]=Ss+(Ts-Ss)*ns):B>0&&(Is=3*Ms,Ms++,ns=E/(E-B),this.clipVertices1[Is]=gs+(Ps-gs)*ns,this.clipVertices1[Is+1]=Ls+(Vs-Ls)*ns,this.clipVertices1[Is+2]=Ss+(Ts-Ss)*ns,Is=3*Ms,Ms++,this.clipVertices1[Is]=Ps,this.clipVertices1[Is+1]=Vs,this.clipVertices1[Is+2]=Ts),gs=Ps,Ls=Vs,Ss=Ts,E=B;if(ws=Ms,0!=ws){for(Ms=0,Is=3*(ws-1),gs=this.clipVertices1[Is],Ls=this.clipVertices1[Is+1],Ss=this.clipVertices1[Is+2],E=(gs-qi+Fi)*-Di+(Ls-Yi+Ri)*-Oi+(Ss-Xi+Zi)*-ji,As=0;As<ws;As++)Is=3*As,Ps=this.clipVertices1[Is],Vs=this.clipVertices1[Is+1],Ts=this.clipVertices1[Is+2],B=(Ps-qi+Fi)*-Di+(Vs-Yi+Ri)*-Oi+(Ts-Xi+Zi)*-ji,E>0?B>0?(Is=3*Ms,Ms++,this.clipVertices2[Is]=Ps,this.clipVertices2[Is+1]=Vs,this.clipVertices2[Is+2]=Ts):(Is=3*Ms,Ms++,ns=E/(E-B),this.clipVertices2[Is]=gs+(Ps-gs)*ns,this.clipVertices2[Is+1]=Ls+(Vs-Ls)*ns,this.clipVertices2[Is+2]=Ss+(Ts-Ss)*ns):B>0&&(Is=3*Ms,Ms++,ns=E/(E-B),this.clipVertices2[Is]=gs+(Ps-gs)*ns,this.clipVertices2[Is+1]=Ls+(Vs-Ls)*ns,this.clipVertices2[Is+2]=Ss+(Ts-Ss)*ns,Is=3*Ms,Ms++,this.clipVertices2[Is]=Ps,this.clipVertices2[Is+1]=Vs,this.clipVertices2[Is+2]=Ts),gs=Ps,Ls=Vs,Ss=Ts,E=B;if(ws=Ms,0!=ws){for(Ms=0,Is=3*(ws-1),gs=this.clipVertices2[Is],Ls=this.clipVertices2[Is+1],Ss=this.clipVertices2[Is+2],E=(gs-qi+Ji)*-Ci+(Ls-Yi+Wi)*-Ei+(Ss-Xi+_i)*-Bi,As=0;As<ws;As++)Is=3*As,Ps=this.clipVertices2[Is],Vs=this.clipVertices2[Is+1],Ts=this.clipVertices2[Is+2],B=(Ps-qi+Ji)*-Ci+(Vs-Yi+Wi)*-Ei+(Ts-Xi+_i)*-Bi,E>0?B>0?(Is=3*Ms,Ms++,this.clipVertices1[Is]=Ps,this.clipVertices1[Is+1]=Vs,this.clipVertices1[Is+2]=Ts):(Is=3*Ms,Ms++,ns=E/(E-B),this.clipVertices1[Is]=gs+(Ps-gs)*ns,this.clipVertices1[Is+1]=Ls+(Vs-Ls)*ns,this.clipVertices1[Is+2]=Ss+(Ts-Ss)*ns):B>0&&(Is=3*Ms,Ms++,ns=E/(E-B),this.clipVertices1[Is]=gs+(Ps-gs)*ns,this.clipVertices1[Is+1]=Ls+(Vs-Ls)*ns,this.clipVertices1[Is+2]=Ss+(Ts-Ss)*ns,Is=3*Ms,Ms++,this.clipVertices1[Is]=Ps,this.clipVertices1[Is+1]=Vs,this.clipVertices1[Is+2]=Ts),gs=Ps,Ls=Vs,Ss=Ts,E=B;if(ws=Ms,Hi){var Us=h;h=e,e=Us}if(0!=ws){var Ds=h!=t;if(ws>4){gs=.25*(rs+cs+ys+fs),Ls=.25*(ls+ps+xs+Ns),Ss=.25*(ms+us+ds+vs),Di=rs-gs,Oi=ls-Ls,ji=ms-Ss,Ci=cs-gs,Ei=ps-Ls,Bi=us-Ss;var Os=0,js=0,Cs=0,Es=0,Bs=-this.INF;for(bs=this.INF,As=0;As<ws;As++)this.used[As]=!1,Is=3*As,gs=this.clipVertices1[Is],Ls=this.clipVertices1[Is+1],Ss=this.clipVertices1[Is+2],zs=gs*Di+Ls*Oi+Ss*ji,zs<bs&&(bs=zs,Os=As),zs>Bs&&(Bs=zs,Cs=As);for(this.used[Os]=!0,this.used[Cs]=!0,Bs=-this.INF,bs=this.INF,As=0;As<ws;As++)this.used[As]||(Is=3*As,gs=this.clipVertices1[Is],Ls=this.clipVertices1[Is+1],Ss=this.clipVertices1[Is+2],zs=gs*Ci+Ls*Ei+Ss*Bi,zs<bs&&(bs=zs,js=As),zs>Bs&&(Bs=zs,Es=As));Is=3*Os,gs=this.clipVertices1[Is],Ls=this.clipVertices1[Is+1],Ss=this.clipVertices1[Is+2],zs=(gs-qi)*Ti+(Ls-Yi)*Ai+(Ss-Xi)*Ui,zs<0&&s.addPoint(gs,Ls,Ss,Ti,Ai,Ui,zs,Ds),Is=3*js,gs=this.clipVertices1[Is],Ls=this.clipVertices1[Is+1],Ss=this.clipVertices1[Is+2],zs=(gs-qi)*Ti+(Ls-Yi)*Ai+(Ss-Xi)*Ui,zs<0&&s.addPoint(gs,Ls,Ss,Ti,Ai,Ui,zs,Ds),Is=3*Cs,gs=this.clipVertices1[Is],Ls=this.clipVertices1[Is+1],Ss=this.clipVertices1[Is+2],zs=(gs-qi)*Ti+(Ls-Yi)*Ai+(Ss-Xi)*Ui,zs<0&&s.addPoint(gs,Ls,Ss,Ti,Ai,Ui,zs,Ds),Is=3*Es,gs=this.clipVertices1[Is],Ls=this.clipVertices1[Is+1],Ss=this.clipVertices1[Is+2],zs=(gs-qi)*Ti+(Ls-Yi)*Ai+(Ss-Xi)*Ui,zs<0&&s.addPoint(gs,Ls,Ss,Ti,Ai,Ui,zs,Ds)}else for(As=0;As<ws;As++)Is=3*As,gs=this.clipVertices1[Is],Ls=this.clipVertices1[Is+1],Ss=this.clipVertices1[Is+2],zs=(gs-qi)*Ti+(Ls-Yi)*Ai+(Ss-Xi)*Ui,zs<0&&s.addPoint(gs,Ls,Ss,Ti,Ai,Ui,zs,Ds)}}}}}},tt.prototype=Object.create(K.prototype),tt.prototype.constructor=tt,tt.prototype.getSep=function(t,i,s,e,a){var o,n,r,l,m,c,p,u,y,x,d,f,N,v=new h,b=t.position.x,z=t.position.y,k=t.position.z,w=i.position.x,M=i.position.y,I=i.position.z,g=w-b,L=M-z,S=I-k;g*g+L*L+S*S==0&&(L=.001);var P=-g,V=-L,T=-S;this.supportPointB(t,-P,-V,-T,v);var A=v.x,U=v.y,D=v.z;this.supportPointC(i,P,V,T,v);var O=v.x,j=v.y,C=v.z,E=O-A,B=j-U,q=C-D;if(E*P+B*V+q*T<=0)return!1;if(P=B*S-q*L,V=q*g-E*S,T=E*L-B*g,P*P+V*V+T*T==0)return s.set(E-g,B-L,q-S).normalize(),e.set(.5*(A+O),.5*(U+j),.5*(D+C)),!0;this.supportPointB(t,-P,-V,-T,v);var Y=v.x,X=v.y,F=v.z;this.supportPointC(i,P,V,T,v);var R=v.x,Z=v.y,J=v.z,W=R-Y,_=Z-X,H=J-F;if(W*P+_*V+H*T<=0)return!1;o=E-g,n=B-L,r=q-S,l=W-g,m=_-L,c=H-S,P=n*c-r*m,V=r*l-o*c,T=o*m-n*l,P*g+V*L+T*S>0&&(o=E,n=B,r=q,E=W,B=_,q=H,W=o,_=n,H=r,o=A,n=U,r=D,A=Y,U=X,D=F,Y=o,X=n,F=r,o=O,n=j,r=C,O=R,j=Z,C=J,R=o,Z=n,J=r,P=-P,V=-V,T=-T);for(var Q=0;;){if(++Q>100)return!1;this.supportPointB(t,-P,-V,-T,v);var G=v.x,K=v.y,$=v.z;this.supportPointC(i,P,V,T,v);var tt=v.x,it=v.y,st=v.z,ht=tt-G,et=it-K,at=st-$;if(ht*P+et*V+at*T<=0)return!1;if((B*at-q*et)*g+(q*ht-E*at)*L+(E*et-B*ht)*S<0)W=ht,_=et,H=at,Y=G,X=K,F=$,R=tt,Z=it,J=st,o=E-g,n=B-L,r=q-S,l=ht-g,m=et-L,c=at-S,P=n*c-r*m,V=r*l-o*c,T=o*m-n*l;else if((et*H-at*_)*g+(at*W-ht*H)*L+(ht*_-et*W)*S<0)E=ht,B=et,q=at,A=G,U=K,D=$,O=tt,j=it,C=st,o=ht-g,n=et-L,r=at-S,l=W-g,m=_-L,c=H-S,P=n*c-r*m,V=r*l-o*c,T=o*m-n*l;else for(var ot=!1;;){if(o=W-E,n=_-B,r=H-q,l=ht-E,m=et-B,c=at-q,P=n*c-r*m,V=r*l-o*c,T=o*m-n*l,p=1/Pt.sqrt(P*P+V*V+T*T),P*=p,V*=p,T*=p,P*E+V*B+T*q>=0&&!ot){var nt=(B*H-q*_)*ht+(q*W-E*H)*et+(E*_-B*W)*at,rt=(et*H-at*_)*g+(at*W-ht*H)*L+(ht*_-et*W)*S,lt=(L*q-S*B)*ht+(S*E-g*q)*et+(g*B-L*E)*at,mt=(_*q-H*B)*g+(H*E-W*q)*L+(W*B-_*E)*S,ct=nt+rt+lt+mt;ct<=0&&(nt=0,rt=(_*at-H*et)*P+(H*ht-W*at)*V+(W*et-_*ht)*T,lt=(et*H-at*_)*P+(at*W-ht*H)*V+(ht*_-et*W)*T,mt=(B*H-q*_)*P+(q*W-E*H)*V+(E*_-B*W)*T,ct=rt+lt+mt);var pt=1/ct;u=(b*nt+A*rt+Y*lt+G*mt)*pt,y=(z*nt+U*rt+X*lt+K*mt)*pt,x=(k*nt+D*rt+F*lt+$*mt)*pt,d=(w*nt+O*rt+R*lt+tt*mt)*pt,f=(M*nt+j*rt+Z*lt+it*mt)*pt,N=(I*nt+C*rt+J*lt+st*mt)*pt,ot=!0}this.supportPointB(t,-P,-V,-T,v);var ut=v.x,yt=v.y,xt=v.z;this.supportPointC(i,P,V,T,v);var dt=v.x,ft=v.y,Nt=v.z,vt=dt-ut,bt=ft-yt,zt=Nt-xt,kt=-(vt*P+bt*V+zt*T);if((vt-ht)*P+(bt-et)*V+(zt-at)*T<=.01||kt>=0)return!!ot&&(s.set(-P,-V,-T),e.set(.5*(u+d),.5*(y+f),.5*(x+N)),a.x=kt,!0);(bt*q-zt*B)*g+(zt*E-vt*q)*L+(vt*B-bt*E)*S<0?(bt*H-zt*_)*g+(zt*W-vt*H)*L+(vt*_-bt*W)*S<0?(E=vt,B=bt,q=zt,A=ut,U=yt,D=xt,O=dt,j=ft,C=Nt):(ht=vt,et=bt,at=zt,G=ut,K=yt,$=xt,tt=dt,it=ft,st=Nt):(bt*at-zt*et)*g+(zt*ht-vt*at)*L+(vt*et-bt*ht)*S<0?(W=vt,_=bt,H=zt,Y=ut,X=yt,F=xt,R=dt,Z=ft,J=Nt):(E=vt,B=bt,q=zt,A=ut,U=yt,D=xt,O=dt,j=ft,C=Nt)}}},tt.prototype.supportPointB=function(t,i,s,h,e){var a,o,n,r=t.rotation.elements,l=r[0]*i+r[3]*s+r[6]*h,m=r[1]*i+r[4]*s+r[7]*h,c=r[2]*i+r[5]*s+r[8]*h,p=t.halfWidth,u=t.halfHeight,y=t.halfDepth;a=l<0?-p:p,o=m<0?-u:u,n=c<0?-y:y,l=r[0]*a+r[1]*o+r[2]*n+t.position.x,m=r[3]*a+r[4]*o+r[5]*n+t.position.y,c=r[6]*a+r[7]*o+r[8]*n+t.position.z,e.set(l,m,c)},tt.prototype.supportPointC=function(t,i,s,h,e){var a,o,n,r=t.rotation.elements,l=r[0]*i+r[3]*s+r[6]*h,m=r[1]*i+r[4]*s+r[7]*h,c=r[2]*i+r[5]*s+r[8]*h,p=l,u=c,y=p*p+u*u,x=t.radius,d=t.halfHeight;0==y?m<0?(a=x,o=-d,n=0):(a=x,o=d,n=0):(y=t.radius/Pt.sqrt(y),m<0?(a=p*y,o=-d,n=u*y):(a=p*y,o=d,n=u*y)),l=r[0]*a+r[1]*o+r[2]*n+t.position.x,m=r[3]*a+r[4]*o+r[5]*n+t.position.y,c=r[6]*a+r[7]*o+r[8]*n+t.position.z,e.set(l,m,c)},tt.prototype.detectCollision=function(t,i,s){var e,a;this.flip?(e=i,a=t):(e=t,a=i);var o=new h,n=new h,r=new h;if(this.getSep(e,a,o,n,r)){var l=e.position.x,m=e.position.y,c=e.position.z,p=a.position.x,u=a.position.y,y=a.position.z,x=e.halfWidth,d=e.halfHeight,f=e.halfDepth,N=a.halfHeight,v=a.radius,b=e.dimentions,z=b[0],k=b[1],w=b[2],M=b[3],I=b[4],g=b[5],L=b[6],S=b[7],P=b[8],V=b[9],T=b[10],A=b[11],U=b[12],D=b[13],O=b[14],j=b[15],C=b[16],E=b[17],B=a.normalDirection.x,q=a.normalDirection.y,Y=a.normalDirection.z,X=a.halfDirection.x,F=a.halfDirection.y,R=a.halfDirection.z,Z=o.x,J=o.y,W=o.z,_=Z*z+J*k+W*w,H=Z*M+J*I+W*g,Q=Z*L+J*S+W*P,G=Z*B+J*q+W*Y,K=_>0,$=H>0,tt=Q>0,it=G>0;K||(_=-_),$||(H=-H),tt||(Q=-Q),it||(G=-G);var st=0;G>.999?st=_>.999?_>G?1:4:H>.999?H>G?2:4:Q>.999&&Q>G?3:4:_>.999?st=1:H>.999?st=2:Q>.999&&(st=3);var ht,et,at,ot,nt,rt,lt,mt,ct,pt,ut,yt,xt,dt,ft,Nt,vt,bt,zt,kt,wt,Mt,It,gt,Lt,St,Vt,Tt,At,Ut,Dt,Ot,jt,Ct,Et,Bt,qt,Yt,Xt,Ft,Rt,Zt,Jt,Wt,_t,Ht,Qt,Gt,Kt,$t,ti,ii,si;if(0==st)s.addPoint(n.x,n.y,n.z,Z,J,W,r.x,this.flip);else if(4==st){it?(ot=p-X,nt=u-F,rt=y-R,Z=-B,J=-q,W=-Y):(ot=p+X,nt=u+F,rt=y+R,Z=B,J=q,W=Y);var hi,ei,ai,oi,ni,ri,li,mi,ci,pi,ui,yi;kt=1,st=0,Jt=z*Z+k*J+w*W,Jt<kt&&(kt=Jt,st=0),-Jt<kt&&(kt=-Jt,st=1),Jt=M*Z+I*J+g*W,Jt<kt&&(kt=Jt,st=2),-Jt<kt&&(kt=-Jt,st=3),Jt=L*Z+S*J+P*W,Jt<kt&&(kt=Jt,st=4),-Jt<kt&&(kt=-Jt,st=5);var xi=e.elements;switch(st){case 0:hi=xi[0],ei=xi[1],ai=xi[2],oi=xi[6],ni=xi[7],ri=xi[8],li=xi[9],mi=xi[10],ci=xi[11],pi=xi[3],ui=xi[4],yi=xi[5];break;case 1:hi=xi[15],ei=xi[16],ai=xi[17],oi=xi[21],ni=xi[22],ri=xi[23],li=xi[18],mi=xi[19],ci=xi[20],pi=xi[12],ui=xi[13],yi=xi[14];break;case 2:hi=xi[12],ei=xi[13],ai=xi[14],oi=xi[0],ni=xi[1],ri=xi[2],li=xi[3],mi=xi[4],ci=xi[5],pi=xi[15],ui=xi[16],yi=xi[17];break;case 3:hi=xi[21],ei=xi[22],ai=xi[23],oi=xi[9],ni=xi[10],ri=xi[11],li=xi[6],mi=xi[7],ci=xi[8],pi=xi[18],ui=xi[19],yi=xi[20];break;case 4:hi=xi[12],ei=xi[13],ai=xi[14],oi=xi[18],ni=xi[19],ri=xi[20],li=xi[6],mi=xi[7],ci=xi[8],pi=xi[0],ui=xi[1],yi=xi[2];break;case 5:hi=xi[3],ei=xi[4],ai=xi[5],
oi=xi[9],ni=xi[10],ri=xi[11],li=xi[21],mi=xi[22],ci=xi[23],pi=xi[15],ui=xi[16],yi=xi[17]}zt=Z*(hi-ot)+J*(ei-nt)+W*(ai-rt),zt<=0&&s.addPoint(hi,ei,ai,-Z,-J,-W,zt,this.flip),zt=Z*(oi-ot)+J*(ni-nt)+W*(ri-rt),zt<=0&&s.addPoint(oi,ni,ri,-Z,-J,-W,zt,this.flip),zt=Z*(li-ot)+J*(mi-nt)+W*(ci-rt),zt<=0&&s.addPoint(li,mi,ci,-Z,-J,-W,zt,this.flip),zt=Z*(pi-ot)+J*(ui-nt)+W*(yi-rt),zt<=0&&s.addPoint(pi,ui,yi,-Z,-J,-W,zt,this.flip)}else{switch(st){case 1:K?(ht=l+V,et=m+T,at=c+A,Z=z,J=k,W=w):(ht=l-V,et=m-T,at=c-A,Z=-z,J=-k,W=-w),Ht=M,Qt=I,Gt=g,ii=d,Kt=L,$t=S,ti=P,si=f;break;case 2:$?(ht=l+U,et=m+D,at=c+O,Z=M,J=I,W=g):(ht=l-U,et=m-D,at=c-O,Z=-M,J=-I,W=-g),Ht=z,Qt=k,Gt=w,ii=x,Kt=L,$t=S,ti=P,si=f;break;case 3:tt?(ht=l+j,et=m+C,at=c+E,Z=L,J=S,W=P):(ht=l-j,et=m-C,at=c-E,Z=-L,J=-S,W=-P),Ht=z,Qt=k,Gt=w,ii=x,Kt=M,$t=I,ti=g,si=d}if(kt=Z*B+J*q+W*Y,wt=kt<0?N:-N,ot=p+wt*B,nt=u+wt*q,rt=y+wt*Y,G>=.999999?(Mt=-J,It=W,gt=Z):(Mt=Z,It=J,gt=W),wt=Mt*B+It*q+gt*Y,St=wt*B-Mt,Vt=wt*q-It,Tt=wt*Y-gt,wt=Pt.sqrt(St*St+Vt*Vt+Tt*Tt),0==wt)return;if(wt=v/wt,St*=wt,Vt*=wt,Tt*=wt,Mt=ot+St,It=nt+Vt,gt=rt+Tt,kt<-.96||kt>.96)lt=B*B*1.5-.5,mt=B*q*1.5-.866025403*Y,ct=B*Y*1.5+.866025403*q,pt=q*B*1.5+.866025403*Y,ut=q*q*1.5-.5,yt=q*Y*1.5-.866025403*B,xt=Y*B*1.5-.866025403*q,dt=Y*q*1.5+.866025403*B,ft=Y*Y*1.5-.5,Nt=Mt,vt=It,bt=gt,zt=Z*(Nt-ht)+J*(vt-et)+W*(bt-at),Mt=Nt-zt*Z-ht,It=vt-zt*J-et,gt=bt-zt*W-at,Yt=Ht*Mt+Qt*It+Gt*gt,Zt=Kt*Mt+$t*It+ti*gt,Yt<-ii?Yt=-ii:Yt>ii&&(Yt=ii),Zt<-si?Zt=-si:Zt>si&&(Zt=si),Mt=Yt*Ht+Zt*Kt,It=Yt*Qt+Zt*$t,gt=Yt*Gt+Zt*ti,Nt=ht+Mt,vt=et+It,bt=at+gt,s.addPoint(Nt,vt,bt,Z,J,W,zt,this.flip),Nt=St*lt+Vt*mt+Tt*ct,vt=St*pt+Vt*ut+Tt*yt,bt=St*xt+Vt*dt+Tt*ft,Nt=(St=Nt)+ot,vt=(Vt=vt)+nt,bt=(Tt=bt)+rt,zt=Z*(Nt-ht)+J*(vt-et)+W*(bt-at),zt<=0&&(Mt=Nt-zt*Z-ht,It=vt-zt*J-et,gt=bt-zt*W-at,Yt=Ht*Mt+Qt*It+Gt*gt,Zt=Kt*Mt+$t*It+ti*gt,Yt<-ii?Yt=-ii:Yt>ii&&(Yt=ii),Zt<-si?Zt=-si:Zt>si&&(Zt=si),Mt=Yt*Ht+Zt*Kt,It=Yt*Qt+Zt*$t,gt=Yt*Gt+Zt*ti,Nt=ht+Mt,vt=et+It,bt=at+gt,s.addPoint(Nt,vt,bt,Z,J,W,zt,this.flip)),Nt=St*lt+Vt*mt+Tt*ct,vt=St*pt+Vt*ut+Tt*yt,bt=St*xt+Vt*dt+Tt*ft,Nt=(St=Nt)+ot,vt=(Vt=vt)+nt,bt=(Tt=bt)+rt,zt=Z*(Nt-ht)+J*(vt-et)+W*(bt-at),zt<=0&&(Mt=Nt-zt*Z-ht,It=vt-zt*J-et,gt=bt-zt*W-at,Yt=Ht*Mt+Qt*It+Gt*gt,Zt=Kt*Mt+$t*It+ti*gt,Yt<-ii?Yt=-ii:Yt>ii&&(Yt=ii),Zt<-si?Zt=-si:Zt>si&&(Zt=si),Mt=Yt*Ht+Zt*Kt,It=Yt*Qt+Zt*$t,gt=Yt*Gt+Zt*ti,Nt=ht+Mt,vt=et+It,bt=at+gt,s.addPoint(Nt,vt,bt,Z,J,W,zt,this.flip));else{if(Et=Mt,Bt=It,qt=gt,Yt=Z*(Et-ht)+J*(Bt-et)+W*(qt-at),Et-=Yt*Z,Bt-=Yt*J,qt-=Yt*W,kt>0?(Xt=Mt+2*X,Ft=It+2*F,Rt=gt+2*R):(Xt=Mt-2*X,Ft=It-2*F,Rt=gt-2*R),Zt=Z*(Xt-ht)+J*(Ft-et)+W*(Rt-at),Xt-=Zt*Z,Ft-=Zt*J,Rt-=Zt*W,At=Et-ht,Ut=Bt-et,Dt=qt-at,Ot=Xt-ht,jt=Ft-et,Ct=Rt-at,Mt=Xt-Et,It=Ft-Bt,gt=Rt-qt,Lt=Zt-Yt,_=At*Ht+Ut*Qt+Dt*Gt,H=Ot*Ht+jt*Qt+Ct*Gt,Jt=_-ii,Wt=H-ii,Jt>0){if(Wt>0)return;_t=Jt/(Jt-Wt),Et+=Mt*_t,Bt+=It*_t,qt+=gt*_t,Yt+=Lt*_t,At=Et-ht,Ut=Bt-et,Dt=qt-at,_=At*Ht+Ut*Qt+Dt*Gt,Mt=Xt-Et,It=Ft-Bt,gt=Rt-qt,Lt=Zt-Yt}else Wt>0&&(_t=Jt/(Jt-Wt),Xt=Et+Mt*_t,Ft=Bt+It*_t,Rt=qt+gt*_t,Zt=Yt+Lt*_t,Ot=Xt-ht,jt=Ft-et,Ct=Rt-at,H=Ot*Ht+jt*Qt+Ct*Gt,Mt=Xt-Et,It=Ft-Bt,gt=Rt-qt,Lt=Zt-Yt);if(Jt=_+ii,Wt=H+ii,Jt<0){if(Wt<0)return;_t=Jt/(Jt-Wt),Et+=Mt*_t,Bt+=It*_t,qt+=gt*_t,Yt+=Lt*_t,At=Et-ht,Ut=Bt-et,Dt=qt-at,Mt=Xt-Et,It=Ft-Bt,gt=Rt-qt,Lt=Zt-Yt}else Wt<0&&(_t=Jt/(Jt-Wt),Xt=Et+Mt*_t,Ft=Bt+It*_t,Rt=qt+gt*_t,Zt=Yt+Lt*_t,Ot=Xt-ht,jt=Ft-et,Ct=Rt-at,Mt=Xt-Et,It=Ft-Bt,gt=Rt-qt,Lt=Zt-Yt);if(_=At*Kt+Ut*$t+Dt*ti,H=Ot*Kt+jt*$t+Ct*ti,Jt=_-si,Wt=H-si,Jt>0){if(Wt>0)return;_t=Jt/(Jt-Wt),Et+=Mt*_t,Bt+=It*_t,qt+=gt*_t,Yt+=Lt*_t,At=Et-ht,Ut=Bt-et,Dt=qt-at,_=At*Kt+Ut*$t+Dt*ti,Mt=Xt-Et,It=Ft-Bt,gt=Rt-qt,Lt=Zt-Yt}else Wt>0&&(_t=Jt/(Jt-Wt),Xt=Et+Mt*_t,Ft=Bt+It*_t,Rt=qt+gt*_t,Zt=Yt+Lt*_t,Ot=Xt-ht,jt=Ft-et,Ct=Rt-at,H=Ot*Kt+jt*$t+Ct*ti,Mt=Xt-Et,It=Ft-Bt,gt=Rt-qt,Lt=Zt-Yt);if(Jt=_+si,Wt=H+si,Jt<0){if(Wt<0)return;_t=Jt/(Jt-Wt),Et+=Mt*_t,Bt+=It*_t,qt+=gt*_t,Yt+=Lt*_t}else Wt<0&&(_t=Jt/(Jt-Wt),Xt=Et+Mt*_t,Ft=Bt+It*_t,Rt=qt+gt*_t,Zt=Yt+Lt*_t);Yt<0&&s.addPoint(Et,Bt,qt,Z,J,W,Yt,this.flip),Zt<0&&s.addPoint(Xt,Ft,Rt,Z,J,W,Zt,this.flip)}}}},it.prototype=Object.create(K.prototype),it.prototype.constructor=it,it.prototype.getSep=function(t,i,s,e,a){var o,n,r,l,m,c,p,u,y,x,d,f,N,v=new h,b=t.position.x,z=t.position.y,k=t.position.z,w=i.position.x,M=i.position.y,I=i.position.z,g=w-b,L=M-z,S=I-k;g*g+L*L+S*S==0&&(L=.001);var P=-g,V=-L,T=-S;this.supportPoint(t,-P,-V,-T,v);var A=v.x,U=v.y,D=v.z;this.supportPoint(i,P,V,T,v);var O=v.x,j=v.y,C=v.z,E=O-A,B=j-U,q=C-D;if(E*P+B*V+q*T<=0)return!1;if(P=B*S-q*L,V=q*g-E*S,T=E*L-B*g,P*P+V*V+T*T==0)return s.set(E-g,B-L,q-S).normalize(),e.set(.5*(A+O),.5*(U+j),.5*(D+C)),!0;this.supportPoint(t,-P,-V,-T,v);var Y=v.x,X=v.y,F=v.z;this.supportPoint(i,P,V,T,v);var R=v.x,Z=v.y,J=v.z,W=R-Y,_=Z-X,H=J-F;if(W*P+_*V+H*T<=0)return!1;o=E-g,n=B-L,r=q-S,l=W-g,m=_-L,c=H-S,P=n*c-r*m,V=r*l-o*c,T=o*m-n*l,P*g+V*L+T*S>0&&(o=E,n=B,r=q,E=W,B=_,q=H,W=o,_=n,H=r,o=A,n=U,r=D,A=Y,U=X,D=F,Y=o,X=n,F=r,o=O,n=j,r=C,O=R,j=Z,C=J,R=o,Z=n,J=r,P=-P,V=-V,T=-T);for(var Q=0;;){if(++Q>100)return!1;this.supportPoint(t,-P,-V,-T,v);var G=v.x,K=v.y,$=v.z;this.supportPoint(i,P,V,T,v);var tt=v.x,it=v.y,st=v.z,ht=tt-G,et=it-K,at=st-$;if(ht*P+et*V+at*T<=0)return!1;if((B*at-q*et)*g+(q*ht-E*at)*L+(E*et-B*ht)*S<0)W=ht,_=et,H=at,Y=G,X=K,F=$,R=tt,Z=it,J=st,o=E-g,n=B-L,r=q-S,l=ht-g,m=et-L,c=at-S,P=n*c-r*m,V=r*l-o*c,T=o*m-n*l;else if((et*H-at*_)*g+(at*W-ht*H)*L+(ht*_-et*W)*S<0)E=ht,B=et,q=at,A=G,U=K,D=$,O=tt,j=it,C=st,o=ht-g,n=et-L,r=at-S,l=W-g,m=_-L,c=H-S,P=n*c-r*m,V=r*l-o*c,T=o*m-n*l;else for(var ot=!1;;){if(o=W-E,n=_-B,r=H-q,l=ht-E,m=et-B,c=at-q,P=n*c-r*m,V=r*l-o*c,T=o*m-n*l,p=1/Pt.sqrt(P*P+V*V+T*T),P*=p,V*=p,T*=p,P*E+V*B+T*q>=0&&!ot){var nt=(B*H-q*_)*ht+(q*W-E*H)*et+(E*_-B*W)*at,rt=(et*H-at*_)*g+(at*W-ht*H)*L+(ht*_-et*W)*S,lt=(L*q-S*B)*ht+(S*E-g*q)*et+(g*B-L*E)*at,mt=(_*q-H*B)*g+(H*E-W*q)*L+(W*B-_*E)*S,ct=nt+rt+lt+mt;ct<=0&&(nt=0,rt=(_*at-H*et)*P+(H*ht-W*at)*V+(W*et-_*ht)*T,lt=(et*H-at*_)*P+(at*W-ht*H)*V+(ht*_-et*W)*T,mt=(B*H-q*_)*P+(q*W-E*H)*V+(E*_-B*W)*T,ct=rt+lt+mt);var pt=1/ct;u=(b*nt+A*rt+Y*lt+G*mt)*pt,y=(z*nt+U*rt+X*lt+K*mt)*pt,x=(k*nt+D*rt+F*lt+$*mt)*pt,d=(w*nt+O*rt+R*lt+tt*mt)*pt,f=(M*nt+j*rt+Z*lt+it*mt)*pt,N=(I*nt+C*rt+J*lt+st*mt)*pt,ot=!0}this.supportPoint(t,-P,-V,-T,v);var ut=v.x,yt=v.y,xt=v.z;this.supportPoint(i,P,V,T,v);var dt=v.x,ft=v.y,Nt=v.z,vt=dt-ut,bt=ft-yt,zt=Nt-xt,kt=-(vt*P+bt*V+zt*T);if((vt-ht)*P+(bt-et)*V+(zt-at)*T<=.01||kt>=0)return!!ot&&(s.set(-P,-V,-T),e.set(.5*(u+d),.5*(y+f),.5*(x+N)),a.x=kt,!0);(bt*q-zt*B)*g+(zt*E-vt*q)*L+(vt*B-bt*E)*S<0?(bt*H-zt*_)*g+(zt*W-vt*H)*L+(vt*_-bt*W)*S<0?(E=vt,B=bt,q=zt,A=ut,U=yt,D=xt,O=dt,j=ft,C=Nt):(ht=vt,et=bt,at=zt,G=ut,K=yt,$=xt,tt=dt,it=ft,st=Nt):(bt*at-zt*et)*g+(zt*ht-vt*at)*L+(vt*et-bt*ht)*S<0?(W=vt,_=bt,H=zt,Y=ut,X=yt,F=xt,R=dt,Z=ft,J=Nt):(E=vt,B=bt,q=zt,A=ut,U=yt,D=xt,O=dt,j=ft,C=Nt)}}},it.prototype.supportPoint=function(t,i,s,h,e){var a,o,n,r=t.rotation.elements,l=r[0]*i+r[3]*s+r[6]*h,m=r[1]*i+r[4]*s+r[7]*h,c=r[2]*i+r[5]*s+r[8]*h,p=l,u=c,y=p*p+u*u,x=t.radius,d=t.halfHeight;0==y?m<0?(a=x,o=-d,n=0):(a=x,o=d,n=0):(y=t.radius/Pt.sqrt(y),m<0?(a=p*y,o=-d,n=u*y):(a=p*y,o=d,n=u*y)),l=r[0]*a+r[1]*o+r[2]*n+t.position.x,m=r[3]*a+r[4]*o+r[5]*n+t.position.y,c=r[6]*a+r[7]*o+r[8]*n+t.position.z,e.set(l,m,c)},it.prototype.detectCollision=function(t,i,s){var e,a;t.id<i.id?(e=t,a=i):(e=i,a=t);var o,n,r,l,m,c,p,u,y,x,d,f,N,v,b,z,k,w,M,I,g,L=e.position,S=a.position,P=L.x,V=L.y,T=L.z,A=S.x,U=S.y,D=S.z,O=e.halfHeight,j=a.halfHeight,C=e.normalDirection,E=a.normalDirection,B=e.halfDirection,q=a.halfDirection,Y=e.radius,X=a.radius,F=C.x,R=C.y,Z=C.z,J=E.x,W=E.y,_=E.z,H=B.x,Q=B.y,G=B.z,K=q.x,$=q.y,tt=q.z,it=P-A,st=V-U,ht=T-D,et=new h,at=new h,ot=new h;if(this.getSep(e,a,et,at,ot)){var nt=et.x*F+et.y*R+et.z*Z,rt=et.x*J+et.y*W+et.z*_,lt=nt>0,mt=rt>0;lt||(nt=-nt),mt||(rt=-rt);var ct=0;(nt>.999||rt>.999)&&(ct=nt>rt?1:2);var pt,ut,yt,xt,dt,ft,Nt,vt,bt,zt,kt,wt,Mt,It,gt,Lt,St,Vt,Tt,At,Ut=ot.x;switch(pt=et.x,ut=et.y,yt=et.z,ct){case 0:s.addPoint(at.x,at.y,at.z,pt,ut,yt,Ut,!1);break;case 1:if(lt?(n=P+H,r=V+Q,l=T+G,pt=F,ut=R,yt=Z):(n=P-H,r=V-Q,l=T-G,pt=-F,ut=-R,yt=-Z),M=pt*J+ut*W+yt*_,o=M<0?j:-j,m=A+o*J,c=U+o*W,p=D+o*_,rt>=.999999?(u=-ut,y=yt,x=pt):(u=pt,y=ut,x=yt),o=u*J+y*W+x*_,it=o*J-u,st=o*W-y,ht=o*_-x,o=Pt.sqrt(it*it+st*st+ht*ht),0==o)break;if(o=X/o,it*=o,st*=o,ht*=o,u=m+it,y=c+st,x=p+ht,M<-.96||M>.96)xt=J*J*1.5-.5,dt=J*W*1.5-.866025403*_,ft=J*_*1.5+.866025403*W,Nt=W*J*1.5+.866025403*_,vt=W*W*1.5-.5,bt=W*_*1.5-.866025403*J,zt=_*J*1.5-.866025403*W,kt=_*W*1.5+.866025403*J,wt=_*_*1.5-.5,Mt=u,It=y,gt=x,Lt=pt*(Mt-n)+ut*(It-r)+yt*(gt-l),u=Mt-Lt*pt-n,y=It-Lt*ut-r,x=gt-Lt*yt-l,o=u*u+y*y+x*x,o>Y*Y&&(o=Y/Pt.sqrt(o),u*=o,y*=o,x*=o),Mt=n+u,It=r+y,gt=l+x,s.addPoint(Mt,It,gt,pt,ut,yt,Lt,!1),Mt=it*xt+st*dt+ht*ft,It=it*Nt+st*vt+ht*bt,gt=it*zt+st*kt+ht*wt,Mt=(it=Mt)+m,It=(st=It)+c,gt=(ht=gt)+p,Lt=pt*(Mt-n)+ut*(It-r)+yt*(gt-l),Lt<=0&&(u=Mt-Lt*pt-n,y=It-Lt*ut-r,x=gt-Lt*yt-l,o=u*u+y*y+x*x,o>Y*Y&&(o=Y/Pt.sqrt(o),u*=o,y*=o,x*=o),Mt=n+u,It=r+y,gt=l+x,s.addPoint(Mt,It,gt,pt,ut,yt,Lt,!1)),Mt=it*xt+st*dt+ht*ft,It=it*Nt+st*vt+ht*bt,gt=it*zt+st*kt+ht*wt,Mt=(it=Mt)+m,It=(st=It)+c,gt=(ht=gt)+p,Lt=pt*(Mt-n)+ut*(It-r)+yt*(gt-l),Lt<=0&&(u=Mt-Lt*pt-n,y=It-Lt*ut-r,x=gt-Lt*yt-l,o=u*u+y*y+x*x,o>Y*Y&&(o=Y/Pt.sqrt(o),u*=o,y*=o,x*=o),Mt=n+u,It=r+y,gt=l+x,s.addPoint(Mt,It,gt,pt,ut,yt,Lt,!1));else{if(d=u,f=y,N=x,k=pt*(d-n)+ut*(f-r)+yt*(N-l),d-=k*pt,f-=k*ut,N-=k*yt,M>0?(v=u+J*j*2,b=y+W*j*2,z=x+_*j*2):(v=u-J*j*2,b=y-W*j*2,z=x-_*j*2),w=pt*(v-n)+ut*(b-r)+yt*(z-l),v-=w*pt,b-=w*ut,z-=w*yt,it=n-d,st=r-f,ht=l-N,u=v-d,y=b-f,x=z-N,St=it*it+st*st+ht*ht,Vt=it*u+st*y+ht*x,Tt=u*u+y*y+x*x,At=Vt*Vt-Tt*(St-Y*Y),At<0)break;At=Pt.sqrt(At),I=(Vt+At)/Tt,g=(Vt-At)/Tt,g<I&&(o=I,I=g,g=o),g>1&&(g=1),I<0&&(I=0),u=d+(v-d)*I,y=f+(b-f)*I,x=N+(z-N)*I,v=d+(v-d)*g,b=f+(b-f)*g,z=N+(z-N)*g,d=u,f=y,N=x,o=k+(w-k)*I,w=k+(w-k)*g,k=o,k<0&&s.addPoint(d,f,N,pt,ut,yt,Lt,!1),w<0&&s.addPoint(v,b,z,pt,ut,yt,Lt,!1)}break;case 2:if(mt?(m=A-K,c=U-$,p=D-tt,pt=-J,ut=-W,yt=-_):(m=A+K,c=U+$,p=D+tt,pt=J,ut=W,yt=_),M=pt*F+ut*R+yt*Z,o=M<0?O:-O,n=P+o*F,r=V+o*R,l=T+o*Z,nt>=.999999?(u=-ut,y=yt,x=pt):(u=pt,y=ut,x=yt),o=u*F+y*R+x*Z,it=o*F-u,st=o*R-y,ht=o*Z-x,o=Pt.sqrt(it*it+st*st+ht*ht),0==o)break;if(o=Y/o,it*=o,st*=o,ht*=o,u=n+it,y=r+st,x=l+ht,M<-.96||M>.96)xt=F*F*1.5-.5,dt=F*R*1.5-.866025403*Z,ft=F*Z*1.5+.866025403*R,Nt=R*F*1.5+.866025403*Z,vt=R*R*1.5-.5,bt=R*Z*1.5-.866025403*F,zt=Z*F*1.5-.866025403*R,kt=Z*R*1.5+.866025403*F,wt=Z*Z*1.5-.5,Mt=u,It=y,gt=x,Lt=pt*(Mt-m)+ut*(It-c)+yt*(gt-p),u=Mt-Lt*pt-m,y=It-Lt*ut-c,x=gt-Lt*yt-p,o=u*u+y*y+x*x,o>X*X&&(o=X/Pt.sqrt(o),u*=o,y*=o,x*=o),Mt=m+u,It=c+y,gt=p+x,s.addPoint(Mt,It,gt,-pt,-ut,-yt,Lt,!1),Mt=it*xt+st*dt+ht*ft,It=it*Nt+st*vt+ht*bt,gt=it*zt+st*kt+ht*wt,Mt=(it=Mt)+n,It=(st=It)+r,gt=(ht=gt)+l,Lt=pt*(Mt-m)+ut*(It-c)+yt*(gt-p),Lt<=0&&(u=Mt-Lt*pt-m,y=It-Lt*ut-c,x=gt-Lt*yt-p,o=u*u+y*y+x*x,o>X*X&&(o=X/Pt.sqrt(o),u*=o,y*=o,x*=o),Mt=m+u,It=c+y,gt=p+x,s.addPoint(Mt,It,gt,-pt,-ut,-yt,Lt,!1)),Mt=it*xt+st*dt+ht*ft,It=it*Nt+st*vt+ht*bt,gt=it*zt+st*kt+ht*wt,Mt=(it=Mt)+n,It=(st=It)+r,gt=(ht=gt)+l,Lt=pt*(Mt-m)+ut*(It-c)+yt*(gt-p),Lt<=0&&(u=Mt-Lt*pt-m,y=It-Lt*ut-c,x=gt-Lt*yt-p,o=u*u+y*y+x*x,o>X*X&&(o=X/Pt.sqrt(o),u*=o,y*=o,x*=o),Mt=m+u,It=c+y,gt=p+x,s.addPoint(Mt,It,gt,-pt,-ut,-yt,Lt,!1));else{if(d=u,f=y,N=x,k=pt*(d-m)+ut*(f-c)+yt*(N-p),d-=k*pt,f-=k*ut,N-=k*yt,M>0?(v=u+F*O*2,b=y+R*O*2,z=x+Z*O*2):(v=u-F*O*2,b=y-R*O*2,z=x-Z*O*2),w=pt*(v-m)+ut*(b-c)+yt*(z-p),v-=w*pt,b-=w*ut,z-=w*yt,it=m-d,st=c-f,ht=p-N,u=v-d,y=b-f,x=z-N,St=it*it+st*st+ht*ht,Vt=it*u+st*y+ht*x,Tt=u*u+y*y+x*x,At=Vt*Vt-Tt*(St-X*X),At<0)break;At=Pt.sqrt(At),I=(Vt+At)/Tt,g=(Vt-At)/Tt,g<I&&(o=I,I=g,g=o),g>1&&(g=1),I<0&&(I=0),u=d+(v-d)*I,y=f+(b-f)*I,x=N+(z-N)*I,v=d+(v-d)*g,b=f+(b-f)*g,z=N+(z-N)*g,d=u,f=y,N=x,o=k+(w-k)*I,w=k+(w-k)*g,k=o,k<0&&s.addPoint(d,f,N,-pt,-ut,-yt,k,!1),w<0&&s.addPoint(v,b,z,-pt,-ut,-yt,w,!1)}}}},st.prototype=Object.create(K.prototype),st.prototype.constructor=st,st.prototype.detectCollision=function(t,i,s){var h,e;this.flip?(h=i,e=t):(h=t,e=i);var a,o,n,r,l,m=e.dimentions,c=h.position,p=c.x,u=c.y,y=c.z,x=e.position,d=x.x,f=x.y,N=x.z,v=h.radius,b=e.halfWidth,z=e.halfHeight,k=e.halfDepth,w=p-d,M=u-f,I=y-N,g=m[0]*w+m[1]*M+m[2]*I,L=m[3]*w+m[4]*M+m[5]*I,S=m[6]*w+m[7]*M+m[8]*I,P=0;g>b?g=b:g<-b?g=-b:P=1,L>z?L=z:L<-z?L=-z:P|=2,S>k?S=k:S<-k?S=-k:P|=4,7==P?(w=g<0?b+g:b-g,M=L<0?z+L:z-L,I=S<0?k+S:k-S,w<M?w<I?(r=w-b,g<0?(g=-b,w=m[0],M=m[1],I=m[2]):(g=b,w=-m[0],M=-m[1],I=-m[2])):(r=I-k,S<0?(S=-k,w=m[6],M=m[7],I=m[8]):(S=k,w=-m[6],M=-m[7],I=-m[8])):M<I?(r=M-z,L<0?(L=-z,w=m[3],M=m[4],I=m[5]):(L=z,w=-m[3],M=-m[4],I=-m[5])):(r=I-k,S<0?(S=-k,w=m[6],M=m[7],I=m[8]):(S=k,w=-m[6],M=-m[7],I=-m[8])),a=d+g*m[0]+L*m[3]+S*m[6],o=f+g*m[1]+L*m[4]+S*m[7],n=N+g*m[2]+L*m[5]+S*m[8],s.addPoint(p+v*w,u+v*M,y+v*I,w,M,I,r-v,this.flip)):(a=d+g*m[0]+L*m[3]+S*m[6],o=f+g*m[1]+L*m[4]+S*m[7],n=N+g*m[2]+L*m[5]+S*m[8],w=a-c.x,M=o-c.y,I=n-c.z,r=w*w+M*M+I*I,r>0&&r<v*v&&(r=Pt.sqrt(r),l=1/r,w*=l,M*=l,I*=l,s.addPoint(p+v*w,u+v*M,y+v*I,w,M,I,r-v,this.flip)))},ht.prototype=Object.create(K.prototype),ht.prototype.constructor=ht,ht.prototype.detectCollision=function(t,i,s){var h,e;this.flip?(h=i,e=t):(h=t,e=i);var a=h.position,o=a.x,n=a.y,r=a.z,l=e.position,m=l.x,c=l.y,p=l.z,u=e.normalDirection.x,y=e.normalDirection.y,x=e.normalDirection.z,d=h.radius,f=e.radius,N=d+f,v=e.halfHeight,b=o-m,z=n-c,k=r-p,w=b*u+z*y+k*x;if(!(w<-v-d||w>v+d)){var M=m+w*u,I=c+w*y,g=p+w*x,L=o-M,S=n-I,P=r-g,V=L*L+S*S+P*P;if(!(V>N*N)){V>f*f&&(V=f/Pt.sqrt(V),L*=V,S*=V,P*=V),w<-v?w=-v:w>v&&(w=v),M=m+w*u+L,I=c+w*y+S,g=p+w*x+P,b=M-o,z=I-n,k=g-r,V=b*b+z*z+k*k;var T;V>0&&V<d*d&&(V=Pt.sqrt(V),T=1/V,b*=T,z*=T,k*=T,s.addPoint(o+b*d,n+z*d,r+k*d,b,z,k,V-d,this.flip))}}},et.prototype=Object.create(K.prototype),et.prototype.constructor=et,et.prototype.detectCollision=function(t,i,s){var h=t,e=i,a=h.position,o=e.position,n=o.x-a.x,r=o.y-a.y,l=o.z-a.z,m=n*n+r*r+l*l,c=h.radius,p=e.radius,u=c+p;if(m>0&&m<u*u){m=Pt.sqrt(m);var y=1/m;n*=y,r*=y,l*=y,s.addPoint(a.x+n*c,a.y+r*c,a.z+l*c,n,r,l,m-u,!1)}},Object.assign(at.prototype,{World:!0,getInfo:function(){return this.isStat?this.performance.show():""},clear:function(){for(this.randX=65535;null!==this.joints;)this.removeJoint(this.joints);for(;null!==this.contacts;)this.removeContact(this.contacts);for(;null!==this.rigidBodies;)this.removeRigidBody(this.rigidBodies)},addRigidBody:function(t){t.parent&&i("World","It is not possible to be added to more than one world one of the rigid body"),t.parent=this;for(var s=t.shapes;null!==s;s=s.next)this.addShape(s);null!==this.rigidBodies&&((this.rigidBodies.prev=t).next=this.rigidBodies),this.rigidBodies=t,this.numRigidBodies++},removeRigidBody:function(t){var i=t;if(i.parent===this){i.awake();for(var s=i.jointLink;null!=s;){var h=s.joint;s=s.next,this.removeJoint(h)}for(var e=t.shapes;null!==e;e=e.next)this.removeShape(e);var a=i.prev,o=i.next;null!==a&&(a.next=o),null!==o&&(o.prev=a),this.rigidBodies==i&&(this.rigidBodies=o),i.prev=null,i.next=null,i.parent=null,this.numRigidBodies--}},getByName:function(t){for(var i=this.rigidBodies;null!==i;){if(i.name===t)return i;i=i.next}for(var s=this.joints;null!==s;){if(s.name===t)return s;s=s.next}return null},addShape:function(t){t.parent&&t.parent.parent||i("World","It is not possible to be added alone to shape world"),t.proxy=this.broadPhase.createProxy(t),t.updateProxy(),this.broadPhase.addProxy(t.proxy)},removeShape:function(t){this.broadPhase.removeProxy(t.proxy),t.proxy=null},addJoint:function(t){t.parent&&i("World","It is not possible to be added to more than one world one of the joint"),null!=this.joints&&((this.joints.prev=t).next=this.joints),this.joints=t,t.parent=this,this.numJoints++,t.awake(),t.attach()},removeJoint:function(t){var i=t,s=i.prev,h=i.next;null!==s&&(s.next=h),null!==h&&(h.prev=s),this.joints==i&&(this.joints=h),i.prev=null,i.next=null,this.numJoints--,i.awake(),i.detach(),i.parent=null},addContact:function(t,i){var s;null!==this.unusedContacts?(s=this.unusedContacts,this.unusedContacts=this.unusedContacts.next):s=new j,s.attach(t,i),s.detector=this.detectors[t.type][i.type],this.contacts&&((this.contacts.prev=s).next=this.contacts),this.contacts=s,this.numContacts++},removeContact:function(t){var i=t.prev,s=t.next;s&&(s.prev=i),i&&(i.next=s),this.contacts==t&&(this.contacts=s),t.prev=null,t.next=null,t.detach(),t.next=this.unusedContacts,this.unusedContacts=t,this.numContacts--},checkContact:function(t,i){for(var s,h,e=this.contacts;null!==e;){if(s=e.body1.name||" ",h=e.body2.name||" ",s==t&&h==i||h==t&&s==i)return!!e.touching;e=e.next}return!1},callSleep:function(t){return!!t.allowSleep&&(!(t.linearVelocity.lengthSq()>.04)&&!(t.angularVelocity.lengthSq()>.25))},step:function(){var t=this.isStat;t&&this.performance.setTime(0);for(var i=this.rigidBodies;null!==i;)i.addedToIsland=!1,i.sleeping&&i.testWakeUp(),i=i.next;t&&this.performance.setTime(1),this.broadPhase.detectPairs();for(var s=this.broadPhase.pairs,e=this.broadPhase.numPairs;e--;){var a,o,n=s[e];n.shape1.id<n.shape2.id?(a=n.shape1,o=n.shape2):(a=n.shape2,o=n.shape1);var r;r=a.numContacts<o.numContacts?a.contactLink:o.contactLink;for(var l=!1;r;){var m=r.contact;if(m.shape1==a&&m.shape2==o){m.persisting=!0,l=!0;break}r=r.next}l||this.addContact(a,o)}for(t&&this.performance.calcBroadPhase(),this.numContactPoints=0,m=this.contacts;null!==m;)if(m.persisting||!m.shape1.aabb.intersectTest(m.shape2.aabb)){var c=m.body1,p=m.body2;(c.isDynamic&&!c.sleeping||p.isDynamic&&!p.sleeping)&&m.updateManifold(),this.numContactPoints+=m.manifold.numPoints,m.persisting=!1,m.constraint.addedToIsland=!1,m=m.next}else{var u=m.next;this.removeContact(m),m=u}t&&this.performance.calcNarrowPhase();var y,x,d=1/this.timeStep;for(y=this.joints;null!==y;y=y.next)y.addedToIsland=!1;this.islandRigidBodies=[],this.islandConstraints=[],this.islandStack=[],t&&this.performance.setTime(1),this.numIslands=0;for(var f=this.rigidBodies;null!==f;f=f.next)if(!(f.addedToIsland||f.isStatic||f.sleeping))if(f.isLonely())f.isDynamic&&f.linearVelocity.addTime(this.gravity,this.timeStep),this.callSleep(f)?(f.sleepTime+=this.timeStep,f.sleepTime>.5?f.sleep():f.updatePosition(this.timeStep)):(f.sleepTime=0,f.updatePosition(this.timeStep)),this.numIslands++;else{var N=0,v=0,b=1;this.islandStack[0]=f,f.addedToIsland=!0;do if(i=this.islandStack[--b],this.islandStack[b]=null,i.sleeping=!1,this.islandRigidBodies[N++]=i,!i.isStatic){for(var z=i.contactLink;null!==z;z=z.next){var m=z.contact;if(x=m.constraint,!x.addedToIsland&&m.touching){this.islandConstraints[v++]=x,x.addedToIsland=!0;var u=z.body;u.addedToIsland||(this.islandStack[b++]=u,u.addedToIsland=!0)}}for(var k=i.jointLink;null!==k;k=k.next)x=k.joint,x.addedToIsland||(this.islandConstraints[v++]=x,x.addedToIsland=!0,u=k.body,!u.addedToIsland&&u.isDynamic&&(this.islandStack[b++]=u,u.addedToIsland=!0))}while(0!=b);for(var w=(new h).addTime(this.gravity,this.timeStep),M=N;M--;)i=this.islandRigidBodies[M],i.isDynamic&&i.linearVelocity.addEqual(w);if(this.enableRandomizer)for(M=v;M--;)if(0!==M){var I=(this.randX=this.randX*this.randA+this.randB&2147483647)/2147483648*M|0;x=this.islandConstraints[M],this.islandConstraints[M]=this.islandConstraints[I],this.islandConstraints[I]=x}for(M=v;M--;)this.islandConstraints[M].preSolve(this.timeStep,d);for(var g=this.numIterations;g--;)for(M=v;M--;)this.islandConstraints[M].solve();for(M=v;M--;)this.islandConstraints[M].postSolve(),this.islandConstraints[M]=null;var L=10;for(M=N;M--;)i=this.islandRigidBodies[M],this.callSleep(i)?(i.sleepTime+=this.timeStep,i.sleepTime<L&&(L=i.sleepTime)):(i.sleepTime=0,L=0);if(L>.5)for(M=N;M--;)this.islandRigidBodies[M].sleep(),this.islandRigidBodies[M]=null;else for(M=N;M--;)this.islandRigidBodies[M].updatePosition(this.timeStep),this.islandRigidBodies[M]=null;this.numIslands++}t&&this.performance.calcEnd()},add:function(t){t=t||{};var i=t.type||"box";i.constructor===String&&(i=[i]);var s="joint"===i[0].substring(0,5);return s?this.initJoint(i[0],t):this.initBody(i,t)},initBody:function(t,i){var s=this.invScale,o=i.move||!1,n=i.pos||[0,0,0];n=n.map(function(t){return t*s});var r=void 0===i.size?[1,1,1]:i.size;1===r.length&&(r[1]=r[0]),2===r.length&&(r[2]=r[0]),r=r.map(function(t){return t*s});var u=i.rot||[0,0,0];u=u.map(function(t){return t*Pt.degtorad});var y=new p;if(void 0!==i.density&&(y.density=i.density),void 0!==i.friction&&(y.friction=i.friction),void 0!==i.restitution&&(y.restitution=i.restitution),void 0!==i.belongsTo&&(y.belongsTo=i.belongsTo),void 0!==i.collidesWith&&(y.collidesWith=i.collidesWith),void 0!==i.config&&(void 0!==i.config[0]&&(y.density=i.config[0]),void 0!==i.config[1]&&(y.friction=i.config[1]),void 0!==i.config[2]&&(y.restitution=i.config[2]),void 0!==i.config[3]&&(y.belongsTo=i.config[3]),void 0!==i.config[4]&&(y.collidesWith=i.config[4])),i.massPos&&(i.massPos=i.massPos.map(function(t){return t*s}),y.relativePosition.set(i.massPos[0],i.massPos[1],i.massPos[2])),i.massRot){i.massRot=i.massRot.map(function(t){return t*Pt.degtorad});var x=(new e).setFromEuler(i.massRot[0],i.massRot[1],i.massRot[2]);y.relativeRotation=(new a).setQuat(x)}for(var d,f=new h(n[0],n[1],n[2]),N=(new e).setFromEuler(u[0],u[1],u[2]),v=new C(f,N,this.scale,this.invScale),b=[],z=0;z<t.length;z++){switch(d=3*z,t[z]){case"sphere":b[z]=new m(y,r[d]);break;case"cylinder":b[z]=new c(y,r[d],r[d+1]);break;case"box":b[z]=new l(y,r[d],r[d+1],r[d+2])}if(v.addShape(b[z]),z>0&&(n[d]&&(b[z].relativePosition=new h(n[d],n[d+1],n[d+2])),u[d])){var x=(new e).setFromEuler(u[d],u[d+1],u[d+2]);b[z].relativeRotation=(new a).setQuat(x)}}return o?(i.massPos||i.massRot?v.setupMass(pt,!1):v.setupMass(pt,!0),i.neverSleep?v.allowSleep=!1:v.allowSleep=!0):v.setupMass(ut),void 0!==i.name?v.name=i.name:o&&(v.name=this.numRigidBodies),this.addRigidBody(v),o&&(i.sleep?v.sleep():v.awake()),v},initJoint:function(t,s){var h=this.invScale,e=s.axe1||[1,0,0],a=s.axe2||[1,0,0],o=s.pos1||[0,0,0],n=s.pos2||[0,0,0];o=o.map(function(t){return t*h}),n=n.map(function(t){return t*h});var r,l;"jointDistance"===t?(r=s.min||0,l=s.max||10,r*=h,l*=h):(r=s.min||57.29578,l=s.max||0,r*=Pt.degtorad,l*=Pt.degtorad);var m=s.limit||null,c=s.spring||null,p=s.motor||null,u=new S;u.scale=this.scale,u.invScale=this.invScale,u.allowCollision=s.collision||!1,u.localAxis1.set(e[0],e[1],e[2]),u.localAxis2.set(a[0],a[1],a[2]),u.localAnchorPoint1.set(o[0],o[1],o[2]),u.localAnchorPoint2.set(n[0],n[1],n[2]);var y=null,x=null;if(void 0===s.body1||void 0===s.body2)return i("World","Can't add joint if attach rigidbodys not define !");if(s.body1.constructor===String?y=this.getByName(s.body1):s.body1.constructor===Number?y=this.getByName(s.body1):s.body1.constructor===C&&(y=s.body1),s.body2.constructor===String?x=this.getByName(s.body2):s.body2.constructor===Number?x=this.getByName(s.body2):s.body2.constructor===C&&(x=s.body2),null===y||null===x)return i("World","Can't add joint attach rigidbodys not find !");u.body1=y,u.body2=x;var d;switch(t){case"jointDistance":d=new k(u,r,l),null!==c&&d.limitMotor.setSpring(c[0],c[1]),null!==p&&d.limitMotor.setMotor(p[0],p[1]);break;case"jointHinge":case"joint":d=new v(u,r,l),null!==c&&d.limitMotor.setSpring(c[0],c[1]),null!==p&&d.limitMotor.setMotor(p[0],p[1]);break;case"jointPrisme":d=new I(u,r,l);break;case"jointSlide":d=new g(u,r,l);break;case"jointBall":d=new b(u);break;case"jointWheel":d=new L(u),null!==m&&d.rotationalLimitMotor1.setLimit(m[0],m[1]),null!==c&&d.rotationalLimitMotor1.setSpring(c[0],c[1]),null!==p&&d.rotationalLimitMotor1.setMotor(p[0],p[1])}return d.name=s.name||"",this.addJoint(d),d}}),t.Math=Pt,t.Vec3=h,t.Quat=e,t.Mat33=a,t.Shape=r,t.BoxShape=l,t.SphereShape=m,t.CylinderShape=c,t.ShapeConfig=p,t.LimitMotor=u,t.HingeJoint=v,t.BallAndSocketJoint=b,t.DistanceJoint=k,t.PrismaticJoint=I,t.SliderJoint=g,t.WheelJoint=L,t.JointConfig=S,t.RigidBody=C,t.World=at,t.REVISION=ot,t.BR_NULL=nt,t.BR_BRUTE_FORCE=rt,t.BR_SWEEP_AND_PRUNE=lt,t.BR_BOUNDING_VOLUME_TREE=mt,t.BODY_NULL=ct,t.BODY_DYNAMIC=pt,t.BODY_STATIC=ut,t.BODY_KINEMATIC=yt,t.BODY_GHOST=xt,t.SHAPE_NULL=dt,t.SHAPE_SPHERE=ft,t.SHAPE_BOX=Nt,t.SHAPE_CYLINDER=vt,t.SHAPE_TETRA=bt,t.JOINT_NULL=zt,t.JOINT_DISTANCE=kt,t.JOINT_BALL_AND_SOCKET=wt,t.JOINT_HINGE=Mt,t.JOINT_WHEEL=It,t.JOINT_SLIDER=gt,t.JOINT_PRISMATIC=Lt,t.AABB_PROX=St,t.printError=i,t.InfoDisplay=s,Object.defineProperty(t,"__esModule",{value:!0})});
