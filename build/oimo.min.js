// lo-th.github.io/Oimo.js/license
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i(t.OIMO=t.OIMO||{})}(this,function(t){"use strict";function s(t,i){console.error("[OIMO] "+t+": "+i)}function h(t){this.parent=t,this.infos=new Float32Array(13),this.f=[0,0,0],this.times=[0,0,0,0],this.broadPhase=this.parent.broadPhaseType,this.version=ct,this.fps=0,this.tt=0,this.broadPhaseTime=0,this.narrowPhaseTime=0,this.solvingTime=0,this.totalTime=0,this.updateTime=0,this.MaxBroadPhaseTime=0,this.MaxNarrowPhaseTime=0,this.MaxSolvingTime=0,this.MaxTotalTime=0,this.MaxUpdateTime=0}function e(t,i,s){this.x=t||0,this.y=i||0,this.z=s||0}function a(t,i,s,h){this.x=t||0,this.y=i||0,this.z=s||0,this.w=void 0!==h?h:1}function o(t,i,s,h,e,a,o,n,r){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&console.error("OIMO.Mat33: the constructor no longer reads arguments. use .set() instead.")}function n(t,i,s,h,e,a){this.elements=new Float32Array(6);var o=this.elements;o[0]=t||0,o[1]=s||0,o[2]=e||0,o[3]=i||0,o[4]=h||0,o[5]=a||0}function r(){return Dt++}function l(t){this.type=Nt,this.id=r(),this.prev=null,this.next=null,this.proxy=null,this.parent=null,this.contactLink=null,this.numContacts=0,this.position=new e,this.rotation=new o,this.relativePosition=(new e).copy(t.relativePosition),this.relativeRotation=(new o).copy(t.relativeRotation),this.aabb=new n,this.density=t.density,this.friction=t.friction,this.restitution=t.restitution,this.belongsTo=t.belongsTo,this.collidesWith=t.collidesWith}function m(t,i,s,h){l.call(this,t),this.type=kt,this.width=i,this.height=s,this.depth=h,this.halfWidth=.5*i,this.halfHeight=.5*s,this.halfDepth=.5*h,this.dimentions=new Float32Array(18),this.elements=new Float32Array(24)}function c(t,i){l.call(this,t),this.type=wt,this.radius=i}function p(t,i,s){l.call(this,t),this.type=gt,this.radius=i,this.height=s,this.halfHeight=.5*s,this.normalDirection=new e,this.halfDirection=new e}function y(t,i){l.call(this,t),this.type=Mt,this.normal=new e(0,1,0)}function u(t,i){l.call(this,t),this.type=It}function x(){this.relativePosition=new e,this.relativeRotation=new o,this.friction=.2,this.restitution=.2,this.density=1,this.belongsTo=1,this.collidesWith=4294967295}function d(t,i){i=i||!1,this.axis=t,this.angle=0,this.lowerLimit=i?0:1,this.upperLimit=0,this.motorSpeed=0,this.maxMotorForce=0,this.frequency=0,this.dampingRatio=0}function z(){this.parent=null,this.body1=null,this.body2=null,this.addedToIsland=!1}function f(t){this.prev=null,this.next=null,this.body=null,this.joint=t}function b(t){z.call(this),this.scale=1,this.invScale=1,this.name="",this.id=NaN,this.type=Pt,this.prev=null,this.next=null,this.body1=t.body1,this.body2=t.body2,this.localAnchorPoint1=(new e).copy(t.localAnchorPoint1),this.localAnchorPoint2=(new e).copy(t.localAnchorPoint2),this.relativeAnchorPoint1=new e,this.relativeAnchorPoint2=new e,this.anchorPoint1=new e,this.anchorPoint2=new e,this.allowCollision=t.allowCollision,this.b1Link=new f(this),this.b2Link=new f(this)}function v(t){this.m1=NaN,this.m2=NaN,this.ii1=null,this.ii2=null,this.dd=null,this.r1x=NaN,this.r1y=NaN,this.r1z=NaN,this.r2x=NaN,this.r2y=NaN,this.r2z=NaN,this.ax1x=NaN,this.ax1y=NaN,this.ax1z=NaN,this.ay1x=NaN,this.ay1y=NaN,this.ay1z=NaN,this.az1x=NaN,this.az1y=NaN,this.az1z=NaN,this.ax2x=NaN,this.ax2y=NaN,this.ax2z=NaN,this.ay2x=NaN,this.ay2y=NaN,this.ay2z=NaN,this.az2x=NaN,this.az2y=NaN,this.az2z=NaN,this.vel=NaN,this.velx=NaN,this.vely=NaN,this.velz=NaN,this.joint=t,this.r1=t.relativeAnchorPoint1,this.r2=t.relativeAnchorPoint2,this.p1=t.anchorPoint1,this.p2=t.anchorPoint2,this.b1=t.body1,this.b2=t.body2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.impx=0,this.impy=0,this.impz=0}function N(t,i,s,h){this.cfm1=NaN,this.cfm2=NaN,this.cfm3=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.ax1=NaN,this.ay1=NaN,this.az1=NaN,this.ax2=NaN,this.ay2=NaN,this.az2=NaN,this.ax3=NaN,this.ay3=NaN,this.az3=NaN,this.a1x1=NaN,this.a1y1=NaN,this.a1z1=NaN,this.a2x1=NaN,this.a2y1=NaN,this.a2z1=NaN,this.a1x2=NaN,this.a1y2=NaN,this.a1z2=NaN,this.a2x2=NaN,this.a2y2=NaN,this.a2z2=NaN,this.a1x3=NaN,this.a1y3=NaN,this.a1z3=NaN,this.a2x3=NaN,this.a2y3=NaN,this.a2z3=NaN,this.lowerLimit1=NaN,this.upperLimit1=NaN,this.limitVelocity1=NaN,this.limitState1=0,this.enableMotor1=!1,this.motorSpeed1=NaN,this.maxMotorForce1=NaN,this.maxMotorImpulse1=NaN,this.lowerLimit2=NaN,this.upperLimit2=NaN,this.limitVelocity2=NaN,this.limitState2=0,this.enableMotor2=!1,this.motorSpeed2=NaN,this.maxMotorForce2=NaN,this.maxMotorImpulse2=NaN,this.lowerLimit3=NaN,this.upperLimit3=NaN,this.limitVelocity3=NaN,this.limitState3=0,this.enableMotor3=!1,this.motorSpeed3=NaN,this.maxMotorForce3=NaN,this.maxMotorImpulse3=NaN,this.k00=NaN,this.k01=NaN,this.k02=NaN,this.k10=NaN,this.k11=NaN,this.k12=NaN,this.k20=NaN,this.k21=NaN,this.k22=NaN,this.kv00=NaN,this.kv11=NaN,this.kv22=NaN,this.dv00=NaN,this.dv11=NaN,this.dv22=NaN,this.d00=NaN,this.d01=NaN,this.d02=NaN,this.d10=NaN,this.d11=NaN,this.d12=NaN,this.d20=NaN,this.d21=NaN,this.d22=NaN,this.limitMotor1=i,this.limitMotor2=s,this.limitMotor3=h,this.b1=t.body1,this.b2=t.body2,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse1=0,this.motorImpulse1=0,this.limitImpulse2=0,this.motorImpulse2=0,this.limitImpulse3=0,this.motorImpulse3=0}function w(t,i,s){b.call(this,t),this.type=Tt,this.localAxis1=t.localAxis1.clone().normalize(),this.localAxis2=t.localAxis2.clone().normalize();var h=(new o).setQuat((new a).arc(this.localAxis1,this.localAxis2));this.localAngle1=(new e).tangent(this.localAxis1).normalize(),this.localAngle2=(new e).mulMat(h,this.localAngle1),this.ax1=new e,this.ax2=new e,this.an1=new e,this.an2=new e,this.tmp=new e,this.nor=new e,this.tan=new e,this.bin=new e,this.limitMotor=new d(this.nor,!1),this.limitMotor.lowerLimit=i,this.limitMotor.upperLimit=s,this.lc=new v(this),this.r3=new N(this,this.limitMotor,new d(this.tan,!0),new d(this.bin,!0))}function k(t){b.call(this,t),this.type=Vt,this.lc=new v(this)}function g(t,i){this.cfm=NaN,this.m1=NaN,this.m2=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.motorDenom=NaN,this.invMotorDenom=NaN,this.invDenom=NaN,this.ax=NaN,this.ay=NaN,this.az=NaN,this.r1x=NaN,this.r1y=NaN,this.r1z=NaN,this.r2x=NaN,this.r2y=NaN,this.r2z=NaN,this.t1x=NaN,this.t1y=NaN,this.t1z=NaN,this.t2x=NaN,this.t2y=NaN,this.t2z=NaN,this.l1x=NaN,this.l1y=NaN,this.l1z=NaN,this.l2x=NaN,this.l2y=NaN,this.l2z=NaN,this.a1x=NaN,this.a1y=NaN,this.a1z=NaN,this.a2x=NaN,this.a2y=NaN,this.a2z=NaN,this.lowerLimit=NaN,this.upperLimit=NaN,this.limitVelocity=NaN,this.limitState=0,this.enableMotor=!1,this.motorSpeed=NaN,this.maxMotorForce=NaN,this.maxMotorImpulse=NaN,this.limitMotor=i,this.b1=t.body1,this.b2=t.body2,this.p1=t.anchorPoint1,this.p2=t.anchorPoint2,this.r1=t.relativeAnchorPoint1,this.r2=t.relativeAnchorPoint2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse=0,this.motorImpulse=0}function M(t,i,s){b.call(this,t),this.type=Lt,this.nor=new e,this.limitMotor=new d(this.nor,!0),this.limitMotor.lowerLimit=i,this.limitMotor.upperLimit=s,this.t=new g(this,this.limitMotor)}function I(t,i){this.joint=t,this.targetOrientation=(new a).invert(i),this.relativeOrientation=new a,this.ii1=null,this.ii2=null,this.dd=null,this.vel=new e,this.imp=new e,this.rn0=new e,this.rn1=new e,this.rn2=new e,this.b1=t.body1,this.b2=t.body2,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia}function S(t,i,s,h){this.m1=NaN,this.m2=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.ax1=NaN,this.ay1=NaN,this.az1=NaN,this.ax2=NaN,this.ay2=NaN,this.az2=NaN,this.ax3=NaN,this.ay3=NaN,this.az3=NaN,this.r1x=NaN,this.r1y=NaN,this.r1z=NaN,this.r2x=NaN,this.r2y=NaN,this.r2z=NaN,this.t1x1=NaN,this.t1y1=NaN,this.t1z1=NaN,this.t2x1=NaN,this.t2y1=NaN,this.t2z1=NaN,this.l1x1=NaN,this.l1y1=NaN,this.l1z1=NaN,this.l2x1=NaN,this.l2y1=NaN,this.l2z1=NaN,this.a1x1=NaN,this.a1y1=NaN,this.a1z1=NaN,this.a2x1=NaN,this.a2y1=NaN,this.a2z1=NaN,this.t1x2=NaN,this.t1y2=NaN,this.t1z2=NaN,this.t2x2=NaN,this.t2y2=NaN,this.t2z2=NaN,this.l1x2=NaN,this.l1y2=NaN,this.l1z2=NaN,this.l2x2=NaN,this.l2y2=NaN,this.l2z2=NaN,this.a1x2=NaN,this.a1y2=NaN,this.a1z2=NaN,this.a2x2=NaN,this.a2y2=NaN,this.a2z2=NaN,this.t1x3=NaN,this.t1y3=NaN,this.t1z3=NaN,this.t2x3=NaN,this.t2y3=NaN,this.t2z3=NaN,this.l1x3=NaN,this.l1y3=NaN,this.l1z3=NaN,this.l2x3=NaN,this.l2y3=NaN,this.l2z3=NaN,this.a1x3=NaN,this.a1y3=NaN,this.a1z3=NaN,this.a2x3=NaN,this.a2y3=NaN,this.a2z3=NaN,this.lowerLimit1=NaN,this.upperLimit1=NaN,this.limitVelocity1=NaN,this.limitState1=0,this.enableMotor1=!1,this.motorSpeed1=NaN,this.maxMotorForce1=NaN,this.maxMotorImpulse1=NaN,this.lowerLimit2=NaN,this.upperLimit2=NaN,this.limitVelocity2=NaN,this.limitState2=0,this.enableMotor2=!1,this.motorSpeed2=NaN,this.maxMotorForce2=NaN,this.maxMotorImpulse2=NaN,this.lowerLimit3=NaN,this.upperLimit3=NaN,this.limitVelocity3=NaN,this.limitState3=0,this.enableMotor3=!1,this.motorSpeed3=NaN,this.maxMotorForce3=NaN,this.maxMotorImpulse3=NaN,this.k00=NaN,this.k01=NaN,this.k02=NaN,this.k10=NaN,this.k11=NaN,this.k12=NaN,this.k20=NaN,this.k21=NaN,this.k22=NaN,this.kv00=NaN,this.kv11=NaN,this.kv22=NaN,this.dv00=NaN,this.dv11=NaN,this.dv22=NaN,this.d00=NaN,this.d01=NaN,this.d02=NaN,this.d10=NaN,this.d11=NaN,this.d12=NaN,this.d20=NaN,this.d21=NaN,this.d22=NaN,this.limitMotor1=i,this.limitMotor2=s,this.limitMotor3=h,this.b1=t.body1,this.b2=t.body2,this.p1=t.anchorPoint1,this.p2=t.anchorPoint2,this.r1=t.relativeAnchorPoint1,this.r2=t.relativeAnchorPoint2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse1=0,this.motorImpulse1=0,this.limitImpulse2=0,this.motorImpulse2=0,this.limitImpulse3=0,this.motorImpulse3=0,this.cfm1=0,this.cfm2=0,this.cfm3=0,this.weight=-1}function P(t,i,s){b.call(this,t),this.type=Ot,this.localAxis1=t.localAxis1.clone().normalize(),this.localAxis2=t.localAxis2.clone().normalize(),this.ax1=new e,this.ax2=new e,this.nor=new e,this.tan=new e,this.bin=new e,this.ac=new I(this,(new a).arc(this.localAxis1,this.localAxis2)),this.limitMotor=new d(this.nor,!0),this.limitMotor.lowerLimit=i,this.limitMotor.upperLimit=s,this.t3=new S(this,this.limitMotor,new d(this.tan,!0),new d(this.bin,!0))}function L(t,i,s){b.call(this,t),this.type=At,this.localAxis1=t.localAxis1.clone().normalize(),this.localAxis2=t.localAxis2.clone().normalize();var h=(new o).setQuat((new a).arc(this.localAxis1,this.localAxis2));this.localAngle1=(new e).tangent(this.localAxis1).normalize(),this.localAngle2=(new e).mulMat(h,this.localAngle1),this.ax1=new e,this.ax2=new e,this.an1=new e,this.an2=new e,this.tmp=new e,this.nor=new e,this.tan=new e,this.bin=new e,this.rotationalLimitMotor=new d(this.nor,!1),this.r3=new N(this,this.rotationalLimitMotor,new d(this.tan,!0),new d(this.bin,!0)),this.translationalLimitMotor=new d(this.nor,!0),this.translationalLimitMotor.lowerLimit=i,this.translationalLimitMotor.upperLimit=s,this.t3=new S(this,this.translationalLimitMotor,new d(this.tan,!0),new d(this.bin,!0))}function V(t){b.call(this,t),this.type=qt,this.localAxis1=t.localAxis1.clone().normalize(),this.localAxis2=t.localAxis2.clone().normalize(),this.localAngle1=new e,this.localAngle2=new e;var i=jt.dotVectors(this.localAxis1,this.localAxis2);if(i>-1&&i<1)this.localAngle1.set(this.localAxis2.x-i*this.localAxis1.x,this.localAxis2.y-i*this.localAxis1.y,this.localAxis2.z-i*this.localAxis1.z).normalize(),this.localAngle2.set(this.localAxis1.x-i*this.localAxis2.x,this.localAxis1.y-i*this.localAxis2.y,this.localAxis1.z-i*this.localAxis2.z).normalize();else{var s=(new o).setQuat((new a).arc(this.localAxis1,this.localAxis2));this.localAngle1.tangent(this.localAxis1).normalize(),this.localAngle2.mulMat(s,this.localAngle1)}this.ax1=new e,this.ax2=new e,this.an1=new e,this.an2=new e,this.tmp=new e,this.nor=new e,this.tan=new e,this.bin=new e,this.translationalLimitMotor=new d(this.tan,!0),this.translationalLimitMotor.frequency=8,this.translationalLimitMotor.dampingRatio=1,this.rotationalLimitMotor1=new d(this.tan,!1),this.rotationalLimitMotor2=new d(this.bin,!1),this.t3=new S(this,new d(this.nor,!0),this.translationalLimitMotor,new d(this.bin,!0)),this.t3.weight=1,this.r3=new N(this,new d(this.nor,!0),this.rotationalLimitMotor1,this.rotationalLimitMotor2)}function T(){this.scale=1,this.invScale=1,this.body1=null,this.body2=null,this.localAnchorPoint1=new e,this.localAnchorPoint2=new e,this.localAxis1=new e,this.localAxis2=new e,this.allowCollision=!1}function q(){this.mass=0,this.inertia=new o}function A(t){this.prev=null,this.next=null,this.shape=null,this.body=null,this.contact=t}function O(){this.lp1=new e,this.lp2=new e,this.impulse=NaN}function E(){this.warmStarted=!1,this.position=new e,this.localPoint1=new e,this.localPoint2=new e,this.normal=new e,this.tangent=new e,this.binormal=new e,this.normalImpulse=0,this.tangentImpulse=0,this.binormalImpulse=0,this.normalDenominator=0,this.tangentDenominator=0,this.binormalDenominator=0,this.penetration=0}function j(){this.body1=null,this.body2=null,this.numPoints=0,this.points=[new E,new E,new E,new E]}function D(){this.nor=new e,this.tan=new e,this.bin=new e,this.norU1=new e,this.tanU1=new e,this.binU1=new e,this.norU2=new e,this.tanU2=new e,this.binU2=new e,this.norT1=new e,this.tanT1=new e,this.binT1=new e,this.norT2=new e,this.tanT2=new e,this.binT2=new e,this.norTU1=new e,this.tanTU1=new e,this.binTU1=new e,this.norTU2=new e,this.tanTU2=new e,this.binTU2=new e,this.norImp=0,this.tanImp=0,this.binImp=0,this.norDen=0,this.tanDen=0,this.binDen=0,this.norTar=0,this.next=null,this.last=!1}function C(t){z.call(this),this.manifold=t,this.restitution=0,this.friction=0,this.shape1=null,this.shape2=null,this.body1=null,this.body2=null,this.tmp=new e,this.tmpC1=new e,this.tmpC2=new e,this.tmpP1=new e,this.tmpP2=new e,this.tmplv1=new e,this.tmplv2=new e,this.tmpav1=new e,this.tmpav2=new e,this.lv1=null,this.lv2=null,this.av1=null,this.av2=null,this.m1=0,this.m2=0,this.num=0,this.ps=t.points,this.cs=[new D,new D,new D,new D]}function B(){this.shape1=null,this.shape2=null,this.body1=null,this.body2=null,this.persisting=!1,this.sleeping=!1,this.detector=null,this.constraint=null,this.touching=!1,this.close=!1,this.dist=jt.INF,this.b1Link=new A(this),this.b2Link=new A(this),this.s1Link=new A(this),this.s2Link=new A(this),this.manifold=new j,this.buffer=[new O,new O,new O,new O],this.points=this.manifold.points,this.constraint=new C(this.manifold)}function F(t,i){this.position=t||new e,this.orientation=i||new a,this.scale=1,this.invScale=1,this.mesh=null,this.id=NaN,this.name="",this.type=dt,this.massInfo=new q,this.newPosition=new e,this.newOrientation=new a,this.controlPos=!1,this.controlRot=!1,this.tmpPos=new e,this.tmpQuat=new a,this.quaternion=new a,this.pos=new e,this.linearVelocity=new e,this.angularVelocity=new e,this.parent=null,this.contactLink=[],this.shapes=[],this.jointLink=[],this.sleepPosition=new e,this.sleepOrientation=new a,this.isStatic=!1,this.isDynamic=!1,this.isKinematic=!1,this.rotation=new o,this.mass=0,this.inverseMass=0,this.inverseInertia=new o,this.localInertia=new o,this.inverseLocalInertia=new o,this.tmpInertia=new o,this.addedToIsland=!1,this.allowSleep=!0,this.sleepTime=0,this.sleeping=!1}function U(t,i){this.shape1=t||null,this.shape2=i||null}function R(){this.types=pt,this.numPairChecks=0,this.numPairs=0,this.pairs=[]}function _(){return Ct++}function J(t){this.shape=t,this.aabb=t.aabb}function W(t){J.call(this,t),this.id=_()}function H(){R.call(this),this.types=yt,this.proxies=[]}function X(){this.numElements=0,this.bufferSize=256,this.elements=[],this.elements.length=this.bufferSize,this.stack=new Float32Array(64)}function Q(t,i){this.proxy=t,this.pair=null,this.min1=null,this.max1=null,this.min2=null,this.max2=null,this.max=i,this.value=0}function K(t,i){J.call(this,i),this.belongsTo=0,this.max=[],this.min=[],this.sap=t,this.min[0]=new Q(this,!1),this.max[0]=new Q(this,!0),this.min[1]=new Q(this,!1),this.max[1]=new Q(this,!0),this.min[2]=new Q(this,!1),this.max[2]=new Q(this,!0),this.max[0].pair=this.min[0],this.max[1].pair=this.min[1],this.max[2].pair=this.min[2],this.min[0].min1=this.min[1],this.min[0].max1=this.max[1],this.min[0].min2=this.min[2],this.min[0].max2=this.max[2],this.min[1].min1=this.min[0],this.min[1].max1=this.max[0],this.min[1].min2=this.min[2],this.min[1].max2=this.max[2],this.min[2].min1=this.min[0],this.min[2].max1=this.max[0],this.min[2].min2=this.min[1],this.min[2].max2=this.max[1]}function Y(){R.call(this),this.types=ut,this.numElementsD=0,this.numElementsS=0,this.axesD=[new X,new X,new X],this.axesS=[new X,new X,new X],this.index1=0,this.index2=1}function Z(){this.child1=null,this.child2=null,this.parent=null,this.proxy=null,this.height=0,this.aabb=new n}function G(){this.root=null,this.freeNodes=[],this.freeNodes.length=16384,this.numFreeNodes=0,this.aabb=new n}function $(t){J.call(this,t),this.leaf=new Z,this.leaf.proxy=this}function tt(){R.call(this),this.types=xt,this.tree=new G,this.stack=[],this.leaves=[],this.numLeaves=0}function it(){this.flip=!1}function st(){it.call(this),this.cvs1=new Float32Array(24),this.cvs2=new Float32Array(24),this.qqq=new Float32Array(12),this.used=new Float32Array(8),this.v=[];for(var t=21;t--;)this.v.push(new e);this.INF=jt.INF,this.n=new e,this.n1=new e,this.n2=new e,this.p=new e,this.p1=new e,this.p2=new e,this.d=new e,this.c=new e,this.s1=new e,this.s2=new e,this.d1=new e,this.d2=new e,this.tmp0=new e,this.tmp1=new e,this.tmp2=new e}function ht(t){it.call(this),this.flip=t}function et(){it.call(this),this.n=new e,this.n1=new e,this.n2=new e,this.p=new e,this.d=new e,this.d1=new e,this.d2=new e,this.p1=new e,this.p2=new e,this.cc1=new e,this.cc2=new e,this.tmp0=new e,this.tmp1=new e,this.tmp2=new e,this.tmp3=new e,this.rtt=new o,this.sep=0,this.v=[];for(var t=13;t--;)this.v.push(new e)}function at(t){it.call(this),this.flip=t,this.n=new e,this.p=new e,this.dix=new e,this.diy=new e,this.diz=new e,this.cc=new e,this.cc2=new e}function ot(t){it.call(this),this.flip=t,this.n=new e,this.p=new e,this.n2=new e,this.cc=new e}function nt(){it.call(this),this.n=new e,this.p=new e}function rt(t){it.call(this),this.flip=t,this.n=new e,this.p=new e}function lt(t){it.call(this),this.flip=t,this.n=new e,this.p=new e,this.dix=new e,this.diy=new e,this.diz=new e,this.cc=new e,this.cc2=new e}function mt(t){switch(t instanceof Object||(t={}),this.scale=t.worldscale||1,this.invScale=1/this.scale,this.timeStep=t.timestep||.01666,this.timerate=1e3*this.timeStep,this.timer=null,this.numIterations=t.iterations||8,t.broadphase||2){case 1:this.broadPhase=new H;break;case 2:default:this.broadPhase=new Y;break;case 3:this.broadPhase=new tt}this.Btypes=["None","BruteForce X","Sweep & Prune X","Bounding Volume Tree X"],this.broadPhaseType=this.Btypes[t.broadphase||2],this.performance=null,this.isStat=void 0!==t.info&&t.info,this.isStat&&(this.performance=new h(this)),this.enableRandomizer=void 0===t.random||t.random,this.rigidBodies=[],this.numRigidBodies=0,this.contacts=[],this.numContacts=0,this.joints=[],this.numJoints=0,this.numContactPoints=0,this.numIslands=0,this.gravity=new e(0,-9.81,0),void 0!==t.gravity&&this.gravity.fromArray(t.gravity);var i=6;this.detectors=[];for(var s=i;s--;)this.detectors[s]=[];this.detectors[wt][wt]=new nt,this.detectors[wt][kt]=new at(!1),this.detectors[kt][wt]=new at(!0),this.detectors[kt][kt]=new st,this.detectors[gt][gt]=new et,this.detectors[gt][kt]=new ht(!0),this.detectors[kt][gt]=new ht(!1),this.detectors[gt][wt]=new ot(!0),this.detectors[wt][gt]=new ot(!1),this.detectors[Mt][wt]=new rt(!0),this.detectors[wt][Mt]=new rt(!1),this.detectors[Mt][kt]=new lt(!0),this.detectors[kt][Mt]=new lt(!1),this.randX=65535,this.randA=98765,this.randB=123456789,this.islandRigidBodies=[],this.islandStack=[],this.islandConstraints=[],this.preLoop=null,this.postLoop=null}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&!function(){Object.assign=function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),s=1;s<arguments.length;s++){var h=arguments[s];if(void 0!==h&&null!==h)for(var e in h)Object.prototype.hasOwnProperty.call(h,e)&&(i[e]=h[e])}return i}}();var ct="1.0.7",pt=0,yt=1,ut=2,xt=3,dt=0,zt=1,ft=2,bt=3,vt=4,Nt=0,wt=1,kt=2,gt=3,Mt=4,It=5,St=6,Pt=0,Lt=1,Vt=2,Tt=3,qt=4,At=5,Ot=6,Et=.005,jt={sqrt:Math.sqrt,abs:Math.abs,floor:Math.floor,cos:Math.cos,sin:Math.sin,acos:Math.acos,asin:Math.asin,atan2:Math.atan2,round:Math.round,pow:Math.pow,max:Math.max,min:Math.min,random:Math.random,degtorad:.017453292519943295,radtodeg:57.29577951308232,PI:3.141592653589793,TwoPI:6.283185307179586,PI90:1.570796326794896,PI270:4.712388980384689,INF:1/0,EPZ:1e-5,lerp:function(t,i,s){return(1-s)*t+s*i},randInt:function(t,i){return t+jt.floor(jt.random()*(i-t+1))},rand:function(t,i){return t+jt.random()*(i-t)},generateUUID:function(){var t,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),s=new Array(36),h=0;return function(){for(var e=0;e<36;e++)8===e||13===e||18===e||23===e?s[e]="-":14===e?s[e]="4":(h<=2&&(h=33554432+16777216*Math.random()|0),t=15&h,h>>=4,s[e]=i[19===e?3&t|8:t]);return s.join("")}}(),int:function(t){return jt.floor(t)},fix:function(t,i){return t.toFixed(i||3,10)},clamp:function(t,i,s){return jt.max(i,jt.min(s,t))},distance:function(t,i){var s=i[0]-t[0],h=i[1]-t[1],e=i[2]-t[2];return jt.sqrt(s*s+h*h+e*e)},acosClamp:function(t){return t>1?0:t<-1?jt.PI:jt.acos(t)},distanceVector:function(t,i){var s=t.x-i.x,h=t.y-i.y,e=t.z-i.z;return s*s+h*h+e*e},dotVectors:function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z}};Object.assign(h.prototype,{setTime:function(t){this.times[t||0]=performance.now()},resetMax:function(){this.MaxBroadPhaseTime=0,this.MaxNarrowPhaseTime=0,this.MaxSolvingTime=0,this.MaxTotalTime=0,this.MaxUpdateTime=0},calcBroadPhase:function(){this.setTime(2),this.broadPhaseTime=this.times[2]-this.times[1]},calcNarrowPhase:function(){this.setTime(3),this.narrowPhaseTime=this.times[3]-this.times[2]},calcEnd:function(){this.setTime(2),this.solvingTime=this.times[2]-this.times[1],this.totalTime=this.times[2]-this.times[0],this.updateTime=this.totalTime-(this.broadPhaseTime+this.narrowPhaseTime+this.solvingTime),100===this.tt&&this.resetMax(),this.tt>100&&(this.broadPhaseTime>this.MaxBroadPhaseTime&&(this.MaxBroadPhaseTime=this.broadPhaseTime),this.narrowPhaseTime>this.MaxNarrowPhaseTime&&(this.MaxNarrowPhaseTime=this.narrowPhaseTime),this.solvingTime>this.MaxSolvingTime&&(this.MaxSolvingTime=this.solvingTime),this.totalTime>this.MaxTotalTime&&(this.MaxTotalTime=this.totalTime),this.updateTime>this.MaxUpdateTime&&(this.MaxUpdateTime=this.updateTime)),this.upfps(),this.tt++,this.tt>500&&(this.tt=0)},upfps:function(){this.f[1]=Date.now(),this.f[1]-1e3>this.f[0]&&(this.f[0]=this.f[1],this.fps=this.f[2],this.f[2]=0),this.f[2]++},show:function(){var t=["Oimo.js "+this.version+"<br>",this.broadPhase+"<br><br>","FPS: "+this.fps+" fps<br><br>","rigidbody "+this.parent.numRigidBodies+"<br>","contact &nbsp;&nbsp;"+this.parent.numContacts+"<br>","ct-point &nbsp;"+this.parent.numContactPoints+"<br>","paircheck "+this.parent.broadPhase.numPairChecks+"<br>","island &nbsp;&nbsp;&nbsp;"+this.parent.numIslands+"<br><br>","Time in milliseconds<br><br>","broadphase &nbsp;"+jt.fix(this.broadPhaseTime)+" | "+jt.fix(this.MaxBroadPhaseTime)+"<br>","narrowphase "+jt.fix(this.narrowPhaseTime)+" | "+jt.fix(this.MaxNarrowPhaseTime)+"<br>","solving &nbsp;&nbsp;&nbsp;&nbsp;"+jt.fix(this.solvingTime)+" | "+jt.fix(this.MaxSolvingTime)+"<br>","total &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+jt.fix(this.totalTime)+" | "+jt.fix(this.MaxTotalTime)+"<br>","updating &nbsp;&nbsp;&nbsp;"+jt.fix(this.updateTime)+" | "+jt.fix(this.MaxUpdateTime)+"<br>"].join("\n");return t},toArray:function(){return this.infos[0]=this.parent.broadPhase.types,this.infos[1]=this.parent.numRigidBodies,this.infos[2]=this.parent.numContacts,this.infos[3]=this.parent.broadPhase.numPairChecks,this.infos[4]=this.parent.numContactPoints,this.infos[5]=this.parent.numIslands,this.infos[6]=this.broadPhaseTime,this.infos[7]=this.narrowPhaseTime,this.infos[8]=this.solvingTime,this.infos[9]=this.updateTime,this.infos[10]=this.totalTime,this.infos[11]=this.fps,this.infos}}),Object.assign(e.prototype,{Vec3:!0,set:function(t,i,s){return this.x=t,this.y=i,this.z=s,this},add:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},addEqual:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},addTime:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this},sub:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},subEqual:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},addScale:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this},subScale:function(t,i){return this.x-=t.x*i,this.y-=t.y*i,this.z-=t.z*i,this},scale:function(t,i){return this.x=t.x*i,this.y=t.y*i,this.z=t.z*i,this},scaleEqual:function(t){return this.x*=t,this.y*=t,this.z*=t,this},scaleV:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},scaleVectorEqual:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},cross:function(t,i){var s=t.x,h=t.y,e=t.z,a=i.x,o=i.y,n=i.z;return this.x=h*n-e*o,this.y=e*a-s*n,this.z=s*o-h*a,this},crossVectors:function(t,i){var s=t.x,h=t.y,e=t.z,a=i.x,o=i.y,n=i.z;return this.x=h*n-e*o,this.y=e*a-s*n,this.z=s*o-h*a,this},tangent:function(t){var i=t.x,s=t.y,h=t.z;return this.x=s*i-h*h,this.y=-h*s-i*i,this.z=i*h+s*s,this},mul:function(t,i,s){var h=s.elements;return this.x=t.x+i.x*h[0]+i.y*h[1]+i.z*h[2],this.y=t.y+i.x*h[3]+i.y*h[4]+i.z*h[5],this.z=t.z+i.x*h[6]+i.y*h[7]+i.z*h[8],this},mulMat:function(t,i){var s=t.elements;return this.x=s[0]*i.x+s[1]*i.y+s[2]*i.z,this.y=s[3]*i.x+s[4]*i.y+s[5]*i.z,this.z=s[6]*i.x+s[7]*i.y+s[8]*i.z,this},mulManifold:function(t,i){var s=t.elements;return this.x=s[0]*i.x+s[3]*i.y+s[6]*i.z,this.y=s[1]*i.x+s[4]*i.y+s[7]*i.z,this.z=s[2]*i.x+s[5]*i.y+s[8]*i.z,this},invert:function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},addition:function(){return this.x+this.y+this.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return jt.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},subQuatTime:function(t,i){return this.applyQuaternion(t.scaleEqual(i).normalize()),this},applyMatrix3:function(t){var i=this.x,s=this.y,h=this.z,e=t.elements;return this.x=e[0]*i+e[3]*s+e[6]*h,this.y=e[1]*i+e[4]*s+e[7]*h,this.z=e[2]*i+e[5]*s+e[8]*h,this},applyQuaternion:function(t){var i=this.x,s=this.y,h=this.z,e=t.x,a=t.y,o=t.z,n=t.w,r=n*i+a*h-o*s,l=n*s+o*i-e*h,m=n*h+e*s-a*i,c=-e*i-a*s-o*h;return this.x=r*n+c*-e+l*-o-m*-a,this.y=l*n+c*-a+m*-e-r*-o,this.z=m*n+c*-o+r*-a-l*-e,this},testZero:function(){return 0!==this.x||0!==this.y||0!==this.z},testDiff:function(t){return t.x!==this.x||t.y!==this.y||t.z!==this.z},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},clone:function(){return new this.constructor(this.x,this.y,this.z)},toString:function(){return"Vec3["+this.x.toFixed(4)+", "+this.y.toFixed(4)+", "+this.z.toFixed(4)+"]"},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),this},divideScalar:function(t){return this.multiplyScalar(1/t)},normalize:function(){return this.divideScalar(this.length())},toArray:function(t,i){void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z},fromArray:function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}}),Object.assign(a.prototype,{Quat:!0,set:function(t,i,s,h){return this.x=t,this.y=i,this.z=s,this.w=h,this},add:function(t,i){return this.w=t.w+i.w,this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},addTime:function(t,i){var s=t.x,h=t.y,e=t.z,a=this.w,o=this.x,n=this.y,r=this.z;return i*=.5,this.x+=i*(s*a+h*r-e*n),this.y+=i*(h*a+e*o-s*r),this.z+=i*(e*a+s*n-h*o),this.w+=i*(-s*o-h*n-e*r),this.normalize(),this},sub:function(t,i){return this.w=t.w-i.w,this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},scale:function(t,i){return this.w=t.w*i,this.x=t.x*i,this.y=t.y*i,this.z=t.z*i,this},scaleEqual:function(t){return this.w*=t,this.x*=t,this.y*=t,this.z*=t,this},mul:function(t,i){var s=t.x,h=t.y,e=t.z,a=t.w,o=i.x,n=i.y,r=i.z,l=i.w;return this.x=s*l+a*o+h*r-e*n,this.y=h*l+a*n+e*o-s*r,this.z=e*l+a*r+s*n-h*o,this.w=a*l-s*o-h*n-e*r,this},arc:function(t,i){var s=t.x,h=t.y,e=t.z,a=i.x,o=i.y,n=i.z,r=s*a+h*o+e*n;if(r==-1)return a=h*s-e*e,o=-e*h-s*s,n=s*e+h*h,r=1/jt.sqrt(a*a+o*o+n*n),this.w=0,this.x=a*r,this.y=o*r,this.z=n*r,this;var l=h*n-e*o,m=e*a-s*n,c=s*o-h*a;return this.w=jt.sqrt(.5*(1+r)),r=.5/this.w,this.x=l*r,this.y=m*r,this.z=c*r,this},normalize:function(){var t=jt.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),this.w=this.w*t,this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this},invert:function(t){return this.w=t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,this},length:function(){return jt.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z)},copy:function(t){return this.w=t.w,this.x=t.x,this.y=t.y,this.z=t.z,this},testDiff:function(t){return this.w!==t.w||this.x!==t.x||this.y!==t.y||this.z!==t.z},clone:function(t){return new a(this.x,this.y,this.z,this.w)},toString:function(){return"Quat["+this.x.toFixed(4)+", ("+this.y.toFixed(4)+", "+this.z.toFixed(4)+", "+this.w.toFixed(4)+")]"},setFromEuler:function(t,i,s){var h=Math.cos(.5*t),e=Math.cos(.5*i),a=Math.cos(.5*s),o=Math.sin(.5*t),n=Math.sin(.5*i),r=Math.sin(.5*s);return this.x=o*e*a+h*n*r,this.y=h*n*a-o*e*r,this.z=h*e*r+o*n*a,this.w=h*e*a-o*n*r,this},setFromAxis:function(t,i,s,h){var e=i*i+s*s+h*h;e>0&&(e=1/jt.sqrt(e),i*=e,s*=e,h*=e);var a=jt.sin(.5*t);return this.x=a*i,this.y=a*s,this.z=a*h,this.w=jt.cos(.5*t),this},setFromRotationMatrix:function(t){var i,s=t.elements,h=s[0],e=s[1],a=s[2],o=s[3],n=s[4],r=s[5],l=s[6],m=s[7],c=s[8],p=h+n+c;return p>0?(i=.5/jt.sqrt(p+1),this.w=.25/i,this.x=(m-r)*i,this.y=(a-l)*i,this.z=(o-e)*i):h>n&&h>c?(i=2*jt.sqrt(1+h-n-c),this.w=(m-r)/i,this.x=.25*i,this.y=(e+o)/i,this.z=(a+l)/i):n>c?(i=2*jt.sqrt(1+n-h-c),this.w=(a-l)/i,this.x=(e+o)/i,this.y=.25*i,this.z=(r+m)/i):(i=2*jt.sqrt(1+c-h-n),this.w=(o-e)/i,this.x=(a+l)/i,this.y=(r+m)/i,this.z=.25*i),this},toArray:function(t,i){i=i||0,t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,
t[i+3]=this.w},fromArray:function(t,i){return i=i||0,this.set(t[i],t[i+1],t[i+2],t[i+3]),this}}),Object.assign(o.prototype,{Mat33:!0,set:function(t,i,s,h,e,a,o,n,r){var l=this.elements;return l[0]=t,l[1]=i,l[2]=s,l[3]=h,l[4]=e,l[5]=a,l[6]=o,l[7]=n,l[8]=r,this},multiply:function(t){var i=this.elements;return i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=t,i[4]*=t,i[5]*=t,i[6]*=t,i[7]*=t,i[8]*=t,this},add:function(t,i){var s=this.elements,h=t.elements,e=i.elements;return s[0]=h[0]+e[0],s[1]=h[1]+e[1],s[2]=h[2]+e[2],s[3]=h[3]+e[3],s[4]=h[4]+e[4],s[5]=h[5]+e[5],s[6]=h[6]+e[6],s[7]=h[7]+e[7],s[8]=h[8]+e[8],this},addEqual:function(t){var i=this.elements,s=t.elements;return i[0]+=s[0],i[1]+=s[1],i[2]+=s[2],i[3]+=s[3],i[4]+=s[4],i[5]+=s[5],i[6]+=s[6],i[7]+=s[7],i[8]+=s[8],this},sub:function(t,i){var s=this.elements,h=t.elements,e=i.elements;return s[0]=h[0]-e[0],s[1]=h[1]-e[1],s[2]=h[2]-e[2],s[3]=h[3]-e[3],s[4]=h[4]-e[4],s[5]=h[5]-e[5],s[6]=h[6]-e[6],s[7]=h[7]-e[7],s[8]=h[8]-e[8],this},subEqual:function(t){var i=this.elements,s=t.elements;return i[0]-=s[0],i[1]-=s[1],i[2]-=s[2],i[3]-=s[3],i[4]-=s[4],i[5]-=s[5],i[6]-=s[6],i[7]-=s[7],i[8]-=s[8],this},scale:function(t,i){var s=this.elements,h=t.elements;return s[0]=h[0]*i,s[1]=h[1]*i,s[2]=h[2]*i,s[3]=h[3]*i,s[4]=h[4]*i,s[5]=h[5]*i,s[6]=h[6]*i,s[7]=h[7]*i,s[8]=h[8]*i,this},scaleEqual:function(t){var i=this.elements;return i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=t,i[4]*=t,i[5]*=t,i[6]*=t,i[7]*=t,i[8]*=t,this},mul:function(t,i,s){var h,e=this.elements,a=t.elements,o=i.elements,n=a[0],r=a[3],l=a[6],m=a[1],c=a[4],p=a[7],y=a[2],u=a[5],x=a[8],d=o[0],z=o[3],f=o[6],b=o[1],v=o[4],N=o[7],w=o[2],k=o[5],g=o[8];return s&&(h=b,b=z,z=h,h=w,w=f,f=h,h=k,k=N,N=h),e[0]=n*d+m*z+y*f,e[1]=n*b+m*v+y*N,e[2]=n*w+m*k+y*g,e[3]=r*d+c*z+u*f,e[4]=r*b+c*v+u*N,e[5]=r*w+c*k+u*g,e[6]=l*d+p*z+x*f,e[7]=l*b+p*v+x*N,e[8]=l*w+p*k+x*g,this},setQuat:function(t){var i=this.elements,s=t.x,h=t.y,e=t.z,a=t.w,o=s+s,n=h+h,r=e+e,l=s*o,m=s*n,c=s*r,p=h*n,y=h*r,u=e*r,x=a*o,d=a*n,z=a*r;return i[0]=1-(p+u),i[1]=m-z,i[2]=c+d,i[3]=m+z,i[4]=1-(l+u),i[5]=y-x,i[6]=c-d,i[7]=y+x,i[8]=1-(l+p),this},invert:function(t){var i=this.elements,s=t.elements,h=s[0],e=s[3],a=s[6],o=s[1],n=s[4],r=s[7],l=s[2],m=s[5],c=s[8],p=n*c-r*m,y=r*l-o*c,u=o*m-n*l,x=h*p+e*y+a*u;return 0!=x&&(x=1/x),i[0]=x*p,i[1]=x*y,i[2]=x*u,i[3]=x*(m*a-e*c),i[4]=x*(h*c-l*a),i[5]=x*(l*e-h*m),i[6]=x*(e*r-n*a),i[7]=x*(o*a-h*r),i[8]=x*(h*n-o*e),this},addOffset:function(t,i){var s=i.x,h=i.y,e=i.z,a=this.elements;a[0]+=t*(h*h+e*e),a[4]+=t*(s*s+e*e),a[8]+=t*(s*s+h*h);var o=t*s*h,n=t*h*e,r=t*e*s;return a[1]-=o,a[3]-=o,a[2]-=n,a[6]-=n,a[5]-=r,a[7]-=r,this},subOffset:function(t,i){var s=i.x,h=i.y,e=i.z,a=this.elements;a[0]-=t*(h*h+e*e),a[4]-=t*(s*s+e*e),a[8]-=t*(s*s+h*h);var o=t*s*h,n=t*h*e,r=t*e*s;return a[1]+=o,a[3]+=o,a[2]+=n,a[6]+=n,a[5]+=r,a[7]+=r,this},multiplyScalar:function(t){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new o).fromArray(this.elements)},copy:function(t){return this.elements.set(t.elements),this},fromArray:function(t,i){void 0===i&&(i=0);for(var s=0;s<9;s++)this.elements[s]=t[s+i];return this},toArray:function(t,i){void 0===t&&(t=[]),void 0===i&&(i=0);var s=this.elements;return t[i]=s[0],t[i+1]=s[1],t[i+2]=s[2],t[i+3]=s[3],t[i+4]=s[4],t[i+5]=s[5],t[i+6]=s[6],t[i+7]=s[7],t[i+8]=s[8],t}}),Object.assign(n.prototype,{AABB:!0,set:function(t,i,s,h,e,a){var o=this.elements;return o[0]=t,o[3]=i,o[1]=s,o[4]=h,o[2]=e,o[5]=a,this},intersectTest:function(t){var i=this.elements,s=t.elements;return i[0]>s[3]||i[1]>s[4]||i[2]>s[5]||i[3]<s[0]||i[4]<s[1]||i[5]<s[2]},intersectTestTwo:function(t){var i=this.elements,s=t.elements;return i[0]<s[0]||i[1]<s[1]||i[2]<s[2]||i[3]>s[3]||i[4]>s[4]||i[5]>s[5]},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t,i){var s=i||0,h=t.elements;return this.set(h[0]-s,h[3]+s,h[1]-s,h[4]+s,h[2]-s,h[5]+s),this},fromArray:function(t){return this.elements.set(t),this},combine:function(t,i){var s=t.elements,h=i.elements,e=this.elements;return e[0]=s[0]<h[0]?s[0]:h[0],e[1]=s[1]<h[1]?s[1]:h[1],e[2]=s[2]<h[2]?s[2]:h[2],e[3]=s[3]>h[3]?s[3]:h[3],e[4]=s[4]>h[4]?s[4]:h[4],e[5]=s[5]>h[5]?s[5]:h[5],this},surfaceArea:function(){var t=this.elements,i=t[3]-t[0],s=t[4]-t[1],h=t[5]-t[2];return 2*(i*(s+h)+s*h)},intersectsWithPoint:function(t,i,s){var h=this.elements;return t>=h[0]&&t<=h[3]&&i>=h[1]&&i<=h[4]&&s>=h[2]&&s<=h[5]},setFromPoints:function(t){this.makeEmpty();for(var i=0;i<t.length;i++)this.expandByPoint(t[i])},makeEmpty:function(){this.set(-(1/0),-(1/0),-(1/0),1/0,1/0,1/0)},expandByPoint:function(t){var i=this.elements;this.set(jt.min(i[0],t.x),jt.min(i[1],t.y),jt.min(i[2],t.z),jt.max(i[3],t.x),jt.max(i[4],t.y),jt.max(i[5],t.z))},expandByScalar:function(t){var i=this.elements;i[0]+=-t,i[1]+=-t,i[2]+=-t,i[3]+=t,i[4]+=t,i[5]+=t}});var Dt=0;Object.assign(l.prototype,{Shape:!0,calculateMassInfo:function(t){s("Shape","Inheritance error.")},updateProxy:function(){s("Shape","Inheritance error.")}}),m.prototype=Object.assign(Object.create(l.prototype),{constructor:m,calculateMassInfo:function(t){var i=this.width*this.height*this.depth*this.density,s=1/12;t.mass=i,t.inertia.set(i*(this.height*this.height+this.depth*this.depth)*s,0,0,0,i*(this.width*this.width+this.depth*this.depth)*s,0,0,0,i*(this.width*this.width+this.height*this.height)*s)},updateProxy:function(){var t=this.rotation.elements,i=this.dimentions;i[0]=t[0],i[1]=t[3],i[2]=t[6],i[3]=t[1],i[4]=t[4],i[5]=t[7],i[6]=t[2],i[7]=t[5],i[8]=t[8],i[9]=t[0]*this.halfWidth,i[10]=t[3]*this.halfWidth,i[11]=t[6]*this.halfWidth,i[12]=t[1]*this.halfHeight,i[13]=t[4]*this.halfHeight,i[14]=t[7]*this.halfHeight,i[15]=t[2]*this.halfDepth,i[16]=t[5]*this.halfDepth,i[17]=t[8]*this.halfDepth;var s=i[9],h=i[10],e=i[11],a=i[12],o=i[13],n=i[14],r=i[15],l=i[16],m=i[17],c=this.position.x,p=this.position.y,y=this.position.z,u=this.elements;u[0]=c+s+a+r,u[1]=p+h+o+l,u[2]=y+e+n+m,u[3]=c+s+a-r,u[4]=p+h+o-l,u[5]=y+e+n-m,u[6]=c+s-a+r,u[7]=p+h-o+l,u[8]=y+e-n+m,u[9]=c+s-a-r,u[10]=p+h-o-l,u[11]=y+e-n-m,u[12]=c-s+a+r,u[13]=p-h+o+l,u[14]=y-e+n+m,u[15]=c-s+a-r,u[16]=p-h+o-l,u[17]=y-e+n-m,u[18]=c-s-a+r,u[19]=p-h-o+l,u[20]=y-e-n+m,u[21]=c-s-a-r,u[22]=p-h-o-l,u[23]=y-e-n-m;var x=i[9]<0?-i[9]:i[9],d=i[10]<0?-i[10]:i[10],z=i[11]<0?-i[11]:i[11];x=i[12]<0?x-i[12]:x+i[12],d=i[13]<0?d-i[13]:d+i[13],z=i[14]<0?z-i[14]:z+i[14],x=i[15]<0?x-i[15]:x+i[15],d=i[16]<0?d-i[16]:d+i[16],z=i[17]<0?z-i[17]:z+i[17];var f=Et;this.aabb.set(this.position.x-x-f,this.position.x+x+f,this.position.y-d-f,this.position.y+d+f,this.position.z-z-f,this.position.z+z+f),null!=this.proxy&&this.proxy.update()}}),c.prototype=Object.assign(Object.create(l.prototype),{constructor:c,volume:function(){return jt.PI*this.radius*1.333333},calculateMassInfo:function(t){var i=this.volume()*this.radius*this.radius*this.density;t.mass=i;var s=i*this.radius*this.radius*.4;t.inertia.set(s,0,0,0,s,0,0,0,s)},updateProxy:function(){var t=Et;this.aabb.set(this.position.x-this.radius-t,this.position.x+this.radius+t,this.position.y-this.radius-t,this.position.y+this.radius+t,this.position.z-this.radius-t,this.position.z+this.radius+t),null!=this.proxy&&this.proxy.update()}}),p.prototype=Object.assign(Object.create(l.prototype),{constructor:p,calculateMassInfo:function(t){var i=this.radius*this.radius,s=jt.PI*i*this.height*this.density,h=(.25*i+.0833*this.height*this.height)*s,e=.5*i;t.mass=s,t.inertia.set(h,0,0,0,e,0,0,0,h)},updateProxy:function(){var t,i,s,h,e,a,o,n,r,l,m,c=this.rotation.elements;e=c[1]*c[1],a=c[4]*c[4],o=c[7]*c[7],this.normalDirection.set(c[1],c[4],c[7]),this.halfDirection.scale(this.normalDirection,this.halfHeight),i=1-e,t=jt.sqrt(i*i+e*a+e*o),t>0&&(t=this.radius/t),i*=t,s=1-a,t=jt.sqrt(a*e+s*s+a*o),t>0&&(t=this.radius/t),s*=t,h=1-o,t=jt.sqrt(o*e+o*a+h*h),t>0&&(t=this.radius/t),h*=t,n=this.halfDirection.x<0?-this.halfDirection.x:this.halfDirection.x,r=this.halfDirection.y<0?-this.halfDirection.y:this.halfDirection.y,l=this.halfDirection.z<0?-this.halfDirection.z:this.halfDirection.z,n=i<0?n-i:n+i,r=s<0?r-s:r+s,l=h<0?l-h:l+h,m=Et,this.aabb.set(this.position.x-n-m,this.position.x+n+m,this.position.y-r-m,this.position.y+r+m,this.position.z-l-m,this.position.z+l+m),null!=this.proxy&&this.proxy.update()}}),y.prototype=Object.assign(Object.create(l.prototype),{constructor:y,volume:function(){return Number.MAX_VALUE},calculateMassInfo:function(t){t.mass=this.density;var i=1;t.inertia.set(i,0,0,0,i,0,0,0,i)},updateProxy:function(){var t=Et,i=-jt.INF,s=jt.INF,h=this.normal;this.aabb.set(h.x===-1?this.position.x-t:i,1===h.x?this.position.x+t:s,h.y===-1?this.position.y-t:i,1===h.y?this.position.y+t:s,h.z===-1?this.position.z-t:i,1===h.z?this.position.z+t:s),null!=this.proxy&&this.proxy.update()}}),u.prototype=Object.assign(Object.create(l.prototype),{constructor:u,volume:function(){return Number.MAX_VALUE},calculateMassInfo:function(t){var i=0;t.inertia.set(i,0,0,0,i,0,0,0,i)},updateProxy:function(){var t=0;this.aabb.set(this.position.x-t,this.position.x+t,this.position.y-t,this.position.y+t,this.position.z-t,this.position.z+t),null!=this.proxy&&this.proxy.update()}}),Object.assign(d.prototype,{LimitMotor:!0,setLimit:function(t,i){this.lowerLimit=t,this.upperLimit=i},setMotor:function(t,i){this.motorSpeed=t,this.maxMotorForce=i},setSpring:function(t,i){this.frequency=t,this.dampingRatio=i}}),Object.assign(z.prototype,{Constraint:!0,preSolve:function(t,i){s("Constraint","Inheritance error.")},solve:function(){s("Constraint","Inheritance error.")},postSolve:function(){s("Constraint","Inheritance error.")}}),b.prototype=Object.assign(Object.create(z.prototype),{constructor:b,setId:function(t){this.id=i},setParent:function(t){this.parent=t,this.scale=this.parent.scale,this.invScale=this.parent.invScale,this.id=this.parent.numJoints,this.name||(this.name="J"+this.id)},updateAnchorPoints:function(){this.relativeAnchorPoint1.mulMat(this.body1.rotation,this.localAnchorPoint1),this.relativeAnchorPoint2.mulMat(this.body2.rotation,this.localAnchorPoint2),this.anchorPoint1.add(this.relativeAnchorPoint1,this.body1.position),this.anchorPoint2.add(this.relativeAnchorPoint2,this.body2.position)},attach:function(t){this.b1Link.body=this.body2,this.b2Link.body=this.body1,t?(this.body1.jointLink.push(this.b1Link),this.body2.jointLink.push(this.b2Link)):(null!=this.body1.jointLink?(this.b1Link.next=this.body1.jointLink).prev=this.b1Link:this.b1Link.next=null,this.body1.jointLink=this.b1Link,this.body1.numJoints++,null!=this.body2.jointLink?(this.b2Link.next=this.body2.jointLink).prev=this.b2Link:this.b2Link.next=null,this.body2.jointLink=this.b2Link,this.body2.numJoints++)},detach:function(t){if(t)this.body1.jointLink.splice(this.body1.jointLink.indexOf(this.b1Link),1),this.body2.jointLink.splice(this.body2.jointLink.indexOf(this.b2Link),1);else{var i=this.b1Link.prev,s=this.b1Link.next;null!=i&&(i.next=s),null!=s&&(s.prev=i),this.body1.jointLink==this.b1Link&&(this.body1.jointLink=s),this.b1Link.prev=null,this.b1Link.next=null,this.b1Link.body=null,this.body1.numJoints--,i=this.b2Link.prev,s=this.b2Link.next,null!=i&&(i.next=s),null!=s&&(s.prev=i),this.body2.jointLink==this.b2Link&&(this.body2.jointLink=s),this.b2Link.prev=null,this.b2Link.next=null,this.b2Link.body=null,this.body2.numJoints--}this.b1Link.body=null,this.b2Link.body=null},awake:function(){this.body1.awake(),this.body2.awake()},preSolve:function(t,i){},solve:function(){},postSolve:function(){},remove:function(){this.dispose()},dispose:function(){this.parent.removeJoint(this)},getPosition:function(){var t=(new e).scale(this.anchorPoint1,this.scale),i=(new e).scale(this.anchorPoint2,this.scale);return[t,i]}}),Object.assign(v.prototype,{LinearConstraint:!0,preSolve:function(t,i){this.r1x=this.r1.x,this.r1y=this.r1.y,this.r1z=this.r1.z,this.r2x=this.r2.x,this.r2y=this.r2.y,this.r2z=this.r2.z,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass,this.ii1=this.i1.clone(),this.ii2=this.i2.clone();var s=this.ii1.elements,h=this.ii2.elements;this.ax1x=this.r1z*s[1]+-this.r1y*s[2],this.ax1y=this.r1z*s[4]+-this.r1y*s[5],this.ax1z=this.r1z*s[7]+-this.r1y*s[8],this.ay1x=-this.r1z*s[0]+this.r1x*s[2],this.ay1y=-this.r1z*s[3]+this.r1x*s[5],this.ay1z=-this.r1z*s[6]+this.r1x*s[8],this.az1x=this.r1y*s[0]+-this.r1x*s[1],this.az1y=this.r1y*s[3]+-this.r1x*s[4],this.az1z=this.r1y*s[6]+-this.r1x*s[7],this.ax2x=this.r2z*h[1]+-this.r2y*h[2],this.ax2y=this.r2z*h[4]+-this.r2y*h[5],this.ax2z=this.r2z*h[7]+-this.r2y*h[8],this.ay2x=-this.r2z*h[0]+this.r2x*h[2],this.ay2y=-this.r2z*h[3]+this.r2x*h[5],this.ay2z=-this.r2z*h[6]+this.r2x*h[8],this.az2x=this.r2y*h[0]+-this.r2x*h[1],this.az2y=this.r2y*h[3]+-this.r2x*h[4],this.az2z=this.r2y*h[6]+-this.r2x*h[7];var e=this.m1+this.m2,a=(new o).set(e,0,0,0,e,0,0,0,e),n=a.elements;n[0]+=s[4]*this.r1z*this.r1z-(s[7]+s[5])*this.r1y*this.r1z+s[8]*this.r1y*this.r1y,n[1]+=(s[6]*this.r1y+s[5]*this.r1x)*this.r1z-s[3]*this.r1z*this.r1z-s[8]*this.r1x*this.r1y,n[2]+=(s[3]*this.r1y-s[4]*this.r1x)*this.r1z-s[6]*this.r1y*this.r1y+s[7]*this.r1x*this.r1y,n[3]+=(s[2]*this.r1y+s[7]*this.r1x)*this.r1z-s[1]*this.r1z*this.r1z-s[8]*this.r1x*this.r1y,n[4]+=s[0]*this.r1z*this.r1z-(s[6]+s[2])*this.r1x*this.r1z+s[8]*this.r1x*this.r1x,n[5]+=(s[1]*this.r1x-s[0]*this.r1y)*this.r1z-s[7]*this.r1x*this.r1x+s[6]*this.r1x*this.r1y,n[6]+=(s[1]*this.r1y-s[4]*this.r1x)*this.r1z-s[2]*this.r1y*this.r1y+s[5]*this.r1x*this.r1y,n[7]+=(s[3]*this.r1x-s[0]*this.r1y)*this.r1z-s[5]*this.r1x*this.r1x+s[2]*this.r1x*this.r1y,n[8]+=s[0]*this.r1y*this.r1y-(s[3]+s[1])*this.r1x*this.r1y+s[4]*this.r1x*this.r1x,n[0]+=h[4]*this.r2z*this.r2z-(h[7]+h[5])*this.r2y*this.r2z+h[8]*this.r2y*this.r2y,n[1]+=(h[6]*this.r2y+h[5]*this.r2x)*this.r2z-h[3]*this.r2z*this.r2z-h[8]*this.r2x*this.r2y,n[2]+=(h[3]*this.r2y-h[4]*this.r2x)*this.r2z-h[6]*this.r2y*this.r2y+h[7]*this.r2x*this.r2y,n[3]+=(h[2]*this.r2y+h[7]*this.r2x)*this.r2z-h[1]*this.r2z*this.r2z-h[8]*this.r2x*this.r2y,n[4]+=h[0]*this.r2z*this.r2z-(h[6]+h[2])*this.r2x*this.r2z+h[8]*this.r2x*this.r2x,n[5]+=(h[1]*this.r2x-h[0]*this.r2y)*this.r2z-h[7]*this.r2x*this.r2x+h[6]*this.r2x*this.r2y,n[6]+=(h[1]*this.r2y-h[4]*this.r2x)*this.r2z-h[2]*this.r2y*this.r2y+h[5]*this.r2x*this.r2y,n[7]+=(h[3]*this.r2x-h[0]*this.r2y)*this.r2z-h[5]*this.r2x*this.r2x+h[2]*this.r2x*this.r2y,n[8]+=h[0]*this.r2y*this.r2y-(h[3]+h[1])*this.r2x*this.r2y+h[4]*this.r2x*this.r2x;var r=1/(n[0]*(n[4]*n[8]-n[7]*n[5])+n[3]*(n[7]*n[2]-n[1]*n[8])+n[6]*(n[1]*n[5]-n[4]*n[2]));this.dd=(new o).set(n[4]*n[8]-n[5]*n[7],n[2]*n[7]-n[1]*n[8],n[1]*n[5]-n[2]*n[4],n[5]*n[6]-n[3]*n[8],n[0]*n[8]-n[2]*n[6],n[2]*n[3]-n[0]*n[5],n[3]*n[7]-n[4]*n[6],n[1]*n[6]-n[0]*n[7],n[0]*n[4]-n[1]*n[3]).multiply(r),this.velx=this.p2.x-this.p1.x,this.vely=this.p2.y-this.p1.y,this.velz=this.p2.z-this.p1.z;var l=jt.sqrt(this.velx*this.velx+this.vely*this.vely+this.velz*this.velz);l>.005?(l=(.005-l)/l*i*.05,this.velx*=l,this.vely*=l,this.velz*=l):(this.velx=0,this.vely=0,this.velz=0),this.impx*=.95,this.impy*=.95,this.impz*=.95,this.l1.x+=this.impx*this.m1,this.l1.y+=this.impy*this.m1,this.l1.z+=this.impz*this.m1,this.a1.x+=this.impx*this.ax1x+this.impy*this.ay1x+this.impz*this.az1x,this.a1.y+=this.impx*this.ax1y+this.impy*this.ay1y+this.impz*this.az1y,this.a1.z+=this.impx*this.ax1z+this.impy*this.ay1z+this.impz*this.az1z,this.l2.x-=this.impx*this.m2,this.l2.y-=this.impy*this.m2,this.l2.z-=this.impz*this.m2,this.a2.x-=this.impx*this.ax2x+this.impy*this.ay2x+this.impz*this.az2x,this.a2.y-=this.impx*this.ax2y+this.impy*this.ay2y+this.impz*this.az2y,this.a2.z-=this.impx*this.ax2z+this.impy*this.ay2z+this.impz*this.az2z},solve:function(){var t=this.dd.elements,i=this.l2.x-this.l1.x+this.a2.y*this.r2z-this.a2.z*this.r2y-this.a1.y*this.r1z+this.a1.z*this.r1y-this.velx,s=this.l2.y-this.l1.y+this.a2.z*this.r2x-this.a2.x*this.r2z-this.a1.z*this.r1x+this.a1.x*this.r1z-this.vely,h=this.l2.z-this.l1.z+this.a2.x*this.r2y-this.a2.y*this.r2x-this.a1.x*this.r1y+this.a1.y*this.r1x-this.velz,e=i*t[0]+s*t[1]+h*t[2],a=i*t[3]+s*t[4]+h*t[5],o=i*t[6]+s*t[7]+h*t[8];this.impx+=e,this.impy+=a,this.impz+=o,this.l1.x+=e*this.m1,this.l1.y+=a*this.m1,this.l1.z+=o*this.m1,this.a1.x+=e*this.ax1x+a*this.ay1x+o*this.az1x,this.a1.y+=e*this.ax1y+a*this.ay1y+o*this.az1y,this.a1.z+=e*this.ax1z+a*this.ay1z+o*this.az1z,this.l2.x-=e*this.m2,this.l2.y-=a*this.m2,this.l2.z-=o*this.m2,this.a2.x-=e*this.ax2x+a*this.ay2x+o*this.az2x,this.a2.y-=e*this.ax2y+a*this.ay2y+o*this.az2y,this.a2.z-=e*this.ax2z+a*this.ay2z+o*this.az2z}}),Object.assign(N.prototype,{Rotational3Constraint:!0,preSolve:function(t,i){this.ax1=this.limitMotor1.axis.x,this.ay1=this.limitMotor1.axis.y,this.az1=this.limitMotor1.axis.z,this.ax2=this.limitMotor2.axis.x,this.ay2=this.limitMotor2.axis.y,this.az2=this.limitMotor2.axis.z,this.ax3=this.limitMotor3.axis.x,this.ay3=this.limitMotor3.axis.y,this.az3=this.limitMotor3.axis.z,this.lowerLimit1=this.limitMotor1.lowerLimit,this.upperLimit1=this.limitMotor1.upperLimit,this.motorSpeed1=this.limitMotor1.motorSpeed,this.maxMotorForce1=this.limitMotor1.maxMotorForce,this.enableMotor1=this.maxMotorForce1>0,this.lowerLimit2=this.limitMotor2.lowerLimit,this.upperLimit2=this.limitMotor2.upperLimit,this.motorSpeed2=this.limitMotor2.motorSpeed,this.maxMotorForce2=this.limitMotor2.maxMotorForce,this.enableMotor2=this.maxMotorForce2>0,this.lowerLimit3=this.limitMotor3.lowerLimit,this.upperLimit3=this.limitMotor3.upperLimit,this.motorSpeed3=this.limitMotor3.motorSpeed,this.maxMotorForce3=this.limitMotor3.maxMotorForce,this.enableMotor3=this.maxMotorForce3>0;var s=this.i1.elements,h=this.i2.elements;this.i1e00=s[0],this.i1e01=s[1],this.i1e02=s[2],this.i1e10=s[3],this.i1e11=s[4],this.i1e12=s[5],this.i1e20=s[6],this.i1e21=s[7],this.i1e22=s[8],this.i2e00=h[0],this.i2e01=h[1],this.i2e02=h[2],this.i2e10=h[3],this.i2e11=h[4],this.i2e12=h[5],this.i2e20=h[6],this.i2e21=h[7],this.i2e22=h[8];var e=this.limitMotor1.frequency,a=this.limitMotor2.frequency,o=this.limitMotor3.frequency,n=e>0,r=a>0,l=o>0,m=this.lowerLimit1<=this.upperLimit1,c=this.lowerLimit2<=this.upperLimit2,p=this.lowerLimit3<=this.upperLimit3,y=this.limitMotor1.angle;m?(this.lowerLimit1==this.upperLimit1?(0!=this.limitState1&&(this.limitState1=0,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-y):y<this.lowerLimit1?(this.limitState1!=-1&&(this.limitState1=-1,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-y):y>this.upperLimit1?(1!=this.limitState1&&(this.limitState1=1,this.limitImpulse1=0),this.limitVelocity1=this.upperLimit1-y):(this.limitState1=2,this.limitImpulse1=0,this.limitVelocity1=0),n||(this.limitVelocity1>.02?this.limitVelocity1-=.02:this.limitVelocity1<-.02?this.limitVelocity1+=.02:this.limitVelocity1=0)):(this.limitState1=2,this.limitImpulse1=0);var u=this.limitMotor2.angle;c?(this.lowerLimit2==this.upperLimit2?(0!=this.limitState2&&(this.limitState2=0,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-u):u<this.lowerLimit2?(this.limitState2!=-1&&(this.limitState2=-1,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-u):u>this.upperLimit2?(1!=this.limitState2&&(this.limitState2=1,this.limitImpulse2=0),this.limitVelocity2=this.upperLimit2-u):(this.limitState2=2,this.limitImpulse2=0,this.limitVelocity2=0),r||(this.limitVelocity2>.02?this.limitVelocity2-=.02:this.limitVelocity2<-.02?this.limitVelocity2+=.02:this.limitVelocity2=0)):(this.limitState2=2,this.limitImpulse2=0);var x=this.limitMotor3.angle;if(p?(this.lowerLimit3==this.upperLimit3?(0!=this.limitState3&&(this.limitState3=0,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-x):x<this.lowerLimit3?(this.limitState3!=-1&&(this.limitState3=-1,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-x):x>this.upperLimit3?(1!=this.limitState3&&(this.limitState3=1,this.limitImpulse3=0),this.limitVelocity3=this.upperLimit3-x):(this.limitState3=2,this.limitImpulse3=0,this.limitVelocity3=0),l||(this.limitVelocity3>.02?this.limitVelocity3-=.02:this.limitVelocity3<-.02?this.limitVelocity3+=.02:this.limitVelocity3=0)):(this.limitState3=2,this.limitImpulse3=0),this.enableMotor1&&(0!=this.limitState1||n)?this.maxMotorImpulse1=this.maxMotorForce1*t:(this.motorImpulse1=0,this.maxMotorImpulse1=0),this.enableMotor2&&(0!=this.limitState2||r)?this.maxMotorImpulse2=this.maxMotorForce2*t:(this.motorImpulse2=0,this.maxMotorImpulse2=0),this.enableMotor3&&(0!=this.limitState3||l)?this.maxMotorImpulse3=this.maxMotorForce3*t:(this.motorImpulse3=0,this.maxMotorImpulse3=0),this.a1x1=this.ax1*this.i1e00+this.ay1*this.i1e01+this.az1*this.i1e02,this.a1y1=this.ax1*this.i1e10+this.ay1*this.i1e11+this.az1*this.i1e12,this.a1z1=this.ax1*this.i1e20+this.ay1*this.i1e21+this.az1*this.i1e22,this.a2x1=this.ax1*this.i2e00+this.ay1*this.i2e01+this.az1*this.i2e02,this.a2y1=this.ax1*this.i2e10+this.ay1*this.i2e11+this.az1*this.i2e12,this.a2z1=this.ax1*this.i2e20+this.ay1*this.i2e21+this.az1*this.i2e22,this.a1x2=this.ax2*this.i1e00+this.ay2*this.i1e01+this.az2*this.i1e02,this.a1y2=this.ax2*this.i1e10+this.ay2*this.i1e11+this.az2*this.i1e12,this.a1z2=this.ax2*this.i1e20+this.ay2*this.i1e21+this.az2*this.i1e22,this.a2x2=this.ax2*this.i2e00+this.ay2*this.i2e01+this.az2*this.i2e02,this.a2y2=this.ax2*this.i2e10+this.ay2*this.i2e11+this.az2*this.i2e12,this.a2z2=this.ax2*this.i2e20+this.ay2*this.i2e21+this.az2*this.i2e22,this.a1x3=this.ax3*this.i1e00+this.ay3*this.i1e01+this.az3*this.i1e02,this.a1y3=this.ax3*this.i1e10+this.ay3*this.i1e11+this.az3*this.i1e12,this.a1z3=this.ax3*this.i1e20+this.ay3*this.i1e21+this.az3*this.i1e22,this.a2x3=this.ax3*this.i2e00+this.ay3*this.i2e01+this.az3*this.i2e02,this.a2y3=this.ax3*this.i2e10+this.ay3*this.i2e11+this.az3*this.i2e12,this.a2z3=this.ax3*this.i2e20+this.ay3*this.i2e21+this.az3*this.i2e22,this.k00=this.ax1*(this.a1x1+this.a2x1)+this.ay1*(this.a1y1+this.a2y1)+this.az1*(this.a1z1+this.a2z1),this.k01=this.ax1*(this.a1x2+this.a2x2)+this.ay1*(this.a1y2+this.a2y2)+this.az1*(this.a1z2+this.a2z2),this.k02=this.ax1*(this.a1x3+this.a2x3)+this.ay1*(this.a1y3+this.a2y3)+this.az1*(this.a1z3+this.a2z3),this.k10=this.ax2*(this.a1x1+this.a2x1)+this.ay2*(this.a1y1+this.a2y1)+this.az2*(this.a1z1+this.a2z1),this.k11=this.ax2*(this.a1x2+this.a2x2)+this.ay2*(this.a1y2+this.a2y2)+this.az2*(this.a1z2+this.a2z2),this.k12=this.ax2*(this.a1x3+this.a2x3)+this.ay2*(this.a1y3+this.a2y3)+this.az2*(this.a1z3+this.a2z3),this.k20=this.ax3*(this.a1x1+this.a2x1)+this.ay3*(this.a1y1+this.a2y1)+this.az3*(this.a1z1+this.a2z1),this.k21=this.ax3*(this.a1x2+this.a2x2)+this.ay3*(this.a1y2+this.a2y2)+this.az3*(this.a1z2+this.a2z2),this.k22=this.ax3*(this.a1x3+this.a2x3)+this.ay3*(this.a1y3+this.a2y3)+this.az3*(this.a1z3+this.a2z3),this.kv00=this.k00,this.kv11=this.k11,this.kv22=this.k22,this.dv00=1/this.kv00,this.dv11=1/this.kv11,this.dv22=1/this.kv22,n&&2!=this.limitState1){var d=6.2831853*e,z=d*d*t,f=i/(z+2*this.limitMotor1.dampingRatio*d);this.cfm1=this.kv00*f,this.limitVelocity1*=z*f}else this.cfm1=0,this.limitVelocity1*=.05*i;r&&2!=this.limitState2?(d=6.2831853*a,z=d*d*t,f=i/(z+2*this.limitMotor2.dampingRatio*d),this.cfm2=this.kv11*f,this.limitVelocity2*=z*f):(this.cfm2=0,this.limitVelocity2*=.05*i),l&&2!=this.limitState3?(d=6.2831853*o,z=d*d*t,f=i/(z+2*this.limitMotor3.dampingRatio*d),this.cfm3=this.kv22*f,this.limitVelocity3*=z*f):(this.cfm3=0,this.limitVelocity3*=.05*i),this.k00+=this.cfm1,this.k11+=this.cfm2,this.k22+=this.cfm3;var b=1/(this.k00*(this.k11*this.k22-this.k21*this.k12)+this.k10*(this.k21*this.k02-this.k01*this.k22)+this.k20*(this.k01*this.k12-this.k11*this.k02));this.d00=(this.k11*this.k22-this.k12*this.k21)*b,this.d01=(this.k02*this.k21-this.k01*this.k22)*b,this.d02=(this.k01*this.k12-this.k02*this.k11)*b,this.d10=(this.k12*this.k20-this.k10*this.k22)*b,this.d11=(this.k00*this.k22-this.k02*this.k20)*b,this.d12=(this.k02*this.k10-this.k00*this.k12)*b,this.d20=(this.k10*this.k21-this.k11*this.k20)*b,this.d21=(this.k01*this.k20-this.k00*this.k21)*b,this.d22=(this.k00*this.k11-this.k01*this.k10)*b,this.limitImpulse1*=.95,this.motorImpulse1*=.95,this.limitImpulse2*=.95,this.motorImpulse2*=.95,this.limitImpulse3*=.95,this.motorImpulse3*=.95;var v=this.limitImpulse1+this.motorImpulse1,N=this.limitImpulse2+this.motorImpulse2,w=this.limitImpulse3+this.motorImpulse3;this.a1.x+=v*this.a1x1+N*this.a1x2+w*this.a1x3,this.a1.y+=v*this.a1y1+N*this.a1y2+w*this.a1y3,this.a1.z+=v*this.a1z1+N*this.a1z2+w*this.a1z3,this.a2.x-=v*this.a2x1+N*this.a2x2+w*this.a2x3,this.a2.y-=v*this.a2y1+N*this.a2y2+w*this.a2y3,this.a2.z-=v*this.a2z1+N*this.a2z2+w*this.a2z3},solve_:function(){var t=this.a2.x-this.a1.x,i=this.a2.y-this.a1.y,s=this.a2.z-this.a1.z;this.limitVelocity3=30;var h=t*this.ax1+i*this.ay1+s*this.az1-this.limitVelocity1,e=t*this.ax2+i*this.ay2+s*this.az2-this.limitVelocity2,a=t*this.ax3+i*this.ay3+s*this.az3-this.limitVelocity3,o=h*this.d00+e*this.d01+a*this.d02,n=h*this.d10+e*this.d11+a*this.d12,r=h*this.d20+e*this.d21+a*this.d22;this.limitImpulse1+=o,this.limitImpulse2+=n,this.limitImpulse3+=r,this.a1.x+=o*this.a1x1+n*this.a1x2+r*this.a1x3,this.a1.y+=o*this.a1y1+n*this.a1y2+r*this.a1y3,this.a1.z+=o*this.a1z1+n*this.a1z2+r*this.a1z3,this.a2.x-=o*this.a2x1+n*this.a2x2+r*this.a2x3,this.a2.y-=o*this.a2y1+n*this.a2y2+r*this.a2y3,this.a2.z-=o*this.a2z1+n*this.a2z2+r*this.a2z3},solve:function(){var t=this.a2.x-this.a1.x,i=this.a2.y-this.a1.y,s=this.a2.z-this.a1.z,h=t*this.ax1+i*this.ay1+s*this.az1,e=t*this.ax2+i*this.ay2+s*this.az2,a=t*this.ax3+i*this.ay3+s*this.az3,o=this.motorImpulse1,n=this.motorImpulse2,r=this.motorImpulse3,l=0,m=0,c=0;this.enableMotor1&&(l=(h-this.motorSpeed1)*this.dv00,this.motorImpulse1+=l,this.motorImpulse1>this.maxMotorImpulse1?this.motorImpulse1=this.maxMotorImpulse1:this.motorImpulse1<-this.maxMotorImpulse1&&(this.motorImpulse1=-this.maxMotorImpulse1),l=this.motorImpulse1-o),this.enableMotor2&&(m=(e-this.motorSpeed2)*this.dv11,this.motorImpulse2+=m,this.motorImpulse2>this.maxMotorImpulse2?this.motorImpulse2=this.maxMotorImpulse2:this.motorImpulse2<-this.maxMotorImpulse2&&(this.motorImpulse2=-this.maxMotorImpulse2),m=this.motorImpulse2-n),this.enableMotor3&&(c=(a-this.motorSpeed3)*this.dv22,this.motorImpulse3+=c,this.motorImpulse3>this.maxMotorImpulse3?this.motorImpulse3=this.maxMotorImpulse3:this.motorImpulse3<-this.maxMotorImpulse3&&(this.motorImpulse3=-this.maxMotorImpulse3),c=this.motorImpulse3-r),h+=l*this.kv00+m*this.k01+c*this.k02,e+=l*this.k10+m*this.kv11+c*this.k12,a+=l*this.k20+m*this.k21+c*this.kv22,h-=this.limitVelocity1+this.limitImpulse1*this.cfm1,e-=this.limitVelocity2+this.limitImpulse2*this.cfm2,a-=this.limitVelocity3+this.limitImpulse3*this.cfm3;var p=this.limitImpulse1,y=this.limitImpulse2,u=this.limitImpulse3,x=h*this.d00+e*this.d01+a*this.d02,d=h*this.d10+e*this.d11+a*this.d12,z=h*this.d20+e*this.d21+a*this.d22;this.limitImpulse1+=x,this.limitImpulse2+=d,this.limitImpulse3+=z;var f=0;(2==this.limitState1||this.limitImpulse1*this.limitState1<0)&&(x=-p,e+=x*this.k10,a+=x*this.k20,f|=1),(2==this.limitState2||this.limitImpulse2*this.limitState2<0)&&(d=-y,h+=d*this.k01,a+=d*this.k21,f|=2),(2==this.limitState3||this.limitImpulse3*this.limitState3<0)&&(z=-u,h+=z*this.k02,e+=z*this.k12,f|=4);var b;switch(f){case 1:b=1/(this.k11*this.k22-this.k12*this.k21),d=(this.k22*e+-this.k12*a)*b,z=(-this.k21*e+this.k11*a)*b;break;case 2:b=1/(this.k00*this.k22-this.k02*this.k20),x=(this.k22*h+-this.k02*a)*b,z=(-this.k20*h+this.k00*a)*b;break;case 3:z=a/this.k22;break;case 4:b=1/(this.k00*this.k11-this.k01*this.k10),x=(this.k11*h+-this.k01*e)*b,d=(-this.k10*h+this.k00*e)*b;break;case 5:d=e/this.k11;break;case 6:x=h/this.k00}this.limitImpulse1=x+p,this.limitImpulse2=d+y,this.limitImpulse3=z+u;var v=l+x,N=m+d,w=c+z;this.a1.x+=v*this.a1x1+N*this.a1x2+w*this.a1x3,this.a1.y+=v*this.a1y1+N*this.a1y2+w*this.a1y3,this.a1.z+=v*this.a1z1+N*this.a1z2+w*this.a1z3,this.a2.x-=v*this.a2x1+N*this.a2x2+w*this.a2x3,this.a2.y-=v*this.a2y1+N*this.a2y2+w*this.a2y3,this.a2.z-=v*this.a2z1+N*this.a2z2+w*this.a2z3,t=this.a2.x-this.a1.x,i=this.a2.y-this.a1.y,s=this.a2.z-this.a1.z,e=t*this.ax2+i*this.ay2+s*this.az2}}),w.prototype=Object.assign(Object.create(b.prototype),{constructor:w,preSolve:function(t,i){this.updateAnchorPoints(),this.ax1.mulMat(this.body1.rotation,this.localAxis1),this.ax2.mulMat(this.body2.rotation,this.localAxis2),this.an1.mulMat(this.body1.rotation,this.localAngle1),this.an2.mulMat(this.body2.rotation,this.localAngle2),this.nor.set(this.ax1.x*this.body2.inverseMass+this.ax2.x*this.body1.inverseMass,this.ax1.y*this.body2.inverseMass+this.ax2.y*this.body1.inverseMass,this.ax1.z*this.body2.inverseMass+this.ax2.z*this.body1.inverseMass).normalize(),this.tan.tangent(this.nor).normalize(),this.bin.crossVectors(this.nor,this.tan);var s=jt.acosClamp(jt.dotVectors(this.an1,this.an2));this.tmp.crossVectors(this.an1,this.an2),jt.dotVectors(this.nor,this.tmp)<0?this.limitMotor.angle=-s:this.limitMotor.angle=s,this.tmp.crossVectors(this.ax1,this.ax2),this.r3.limitMotor2.angle=jt.dotVectors(this.tan,this.tmp),this.r3.limitMotor3.angle=jt.dotVectors(this.bin,this.tmp),this.r3.preSolve(t,i),this.lc.preSolve(t,i)},solve:function(){this.r3.solve(),this.lc.solve()},postSolve:function(){}}),k.prototype=Object.assign(Object.create(b.prototype),{constructor:k,preSolve:function(t,i){this.updateAnchorPoints(),this.lc.preSolve(t,i)},solve:function(){this.lc.solve()},postSolve:function(){}}),Object.assign(g.prototype,{TranslationalConstraint:!0,preSolve:function(t,i){this.ax=this.limitMotor.axis.x,this.ay=this.limitMotor.axis.y,this.az=this.limitMotor.axis.z,this.lowerLimit=this.limitMotor.lowerLimit,this.upperLimit=this.limitMotor.upperLimit,this.motorSpeed=this.limitMotor.motorSpeed,this.maxMotorForce=this.limitMotor.maxMotorForce,this.enableMotor=this.maxMotorForce>0,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass;var s=this.i1.elements,h=this.i2.elements;this.i1e00=s[0],this.i1e01=s[1],this.i1e02=s[2],this.i1e10=s[3],this.i1e11=s[4],this.i1e12=s[5],this.i1e20=s[6],this.i1e21=s[7],this.i1e22=s[8],this.i2e00=h[0],this.i2e01=h[1],this.i2e02=h[2],this.i2e10=h[3],this.i2e11=h[4],this.i2e12=h[5],this.i2e20=h[6],this.i2e21=h[7],this.i2e22=h[8];var e=this.p2.x-this.p1.x,a=this.p2.y-this.p1.y,o=this.p2.z-this.p1.z,n=e*this.ax+a*this.ay+o*this.az,r=this.limitMotor.frequency,l=r>0,m=this.lowerLimit<=this.upperLimit;(l&&n>20||n<-20)&&(l=!1),m?(this.lowerLimit==this.upperLimit?(0!=this.limitState&&(this.limitState=0,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-n,l||(n=this.lowerLimit)):n<this.lowerLimit?(this.limitState!=-1&&(this.limitState=-1,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-n,l||(n=this.lowerLimit)):n>this.upperLimit?(1!=this.limitState&&(this.limitState=1,this.limitImpulse=0),this.limitVelocity=this.upperLimit-n,l||(n=this.upperLimit)):(this.limitState=2,this.limitImpulse=0,this.limitVelocity=0),l||(this.limitVelocity>.005?this.limitVelocity-=.005:this.limitVelocity<-.005?this.limitVelocity+=.005:this.limitVelocity=0)):(this.limitState=2,this.limitImpulse=0),this.enableMotor&&(0!=this.limitState||l)?this.maxMotorImpulse=this.maxMotorForce*t:(this.motorImpulse=0,this.maxMotorImpulse=0);var c=n*this.ax,p=n*this.ay,y=n*this.az,u=this.m1/(this.m1+this.m2),x=1-u;if(this.r1x=this.r1.x+c*u,this.r1y=this.r1.y+p*u,this.r1z=this.r1.z+y*u,this.r2x=this.r2.x-c*x,this.r2y=this.r2.y-p*x,this.r2z=this.r2.z-y*x,this.t1x=this.r1y*this.az-this.r1z*this.ay,this.t1y=this.r1z*this.ax-this.r1x*this.az,this.t1z=this.r1x*this.ay-this.r1y*this.ax,this.t2x=this.r2y*this.az-this.r2z*this.ay,this.t2y=this.r2z*this.ax-this.r2x*this.az,this.t2z=this.r2x*this.ay-this.r2y*this.ax,this.l1x=this.ax*this.m1,this.l1y=this.ay*this.m1,this.l1z=this.az*this.m1,this.l2x=this.ax*this.m2,this.l2y=this.ay*this.m2,this.l2z=this.az*this.m2,this.a1x=this.t1x*this.i1e00+this.t1y*this.i1e01+this.t1z*this.i1e02,this.a1y=this.t1x*this.i1e10+this.t1y*this.i1e11+this.t1z*this.i1e12,this.a1z=this.t1x*this.i1e20+this.t1y*this.i1e21+this.t1z*this.i1e22,this.a2x=this.t2x*this.i2e00+this.t2y*this.i2e01+this.t2z*this.i2e02,
this.a2y=this.t2x*this.i2e10+this.t2y*this.i2e11+this.t2z*this.i2e12,this.a2z=this.t2x*this.i2e20+this.t2y*this.i2e21+this.t2z*this.i2e22,this.motorDenom=this.m1+this.m2+this.ax*(this.a1y*this.r1z-this.a1z*this.r1y+this.a2y*this.r2z-this.a2z*this.r2y)+this.ay*(this.a1z*this.r1x-this.a1x*this.r1z+this.a2z*this.r2x-this.a2x*this.r2z)+this.az*(this.a1x*this.r1y-this.a1y*this.r1x+this.a2x*this.r2y-this.a2y*this.r2x),this.invMotorDenom=1/this.motorDenom,l&&2!=this.limitState){var d=6.2831853*r,z=d*d*t,f=i/(z+2*this.limitMotor.dampingRatio*d);this.cfm=this.motorDenom*f,this.limitVelocity*=z*f}else this.cfm=0,this.limitVelocity*=.05*i;this.invDenom=1/(this.motorDenom+this.cfm);var b=this.limitImpulse+this.motorImpulse;this.l1.x+=b*this.l1x,this.l1.y+=b*this.l1y,this.l1.z+=b*this.l1z,this.a1.x+=b*this.a1x,this.a1.y+=b*this.a1y,this.a1.z+=b*this.a1z,this.l2.x-=b*this.l2x,this.l2.y-=b*this.l2y,this.l2.z-=b*this.l2z,this.a2.x-=b*this.a2x,this.a2.y-=b*this.a2y,this.a2.z-=b*this.a2z},solve:function(){var t,i=this.ax*(this.l2.x-this.l1.x)+this.ay*(this.l2.y-this.l1.y)+this.az*(this.l2.z-this.l1.z)+this.t2x*this.a2.x-this.t1x*this.a1.x+this.t2y*this.a2.y-this.t1y*this.a1.y+this.t2z*this.a2.z-this.t1z*this.a1.z;if(this.enableMotor){t=(i-this.motorSpeed)*this.invMotorDenom;var s=this.motorImpulse;this.motorImpulse+=t,this.motorImpulse>this.maxMotorImpulse?this.motorImpulse=this.maxMotorImpulse:this.motorImpulse<-this.maxMotorImpulse&&(this.motorImpulse=-this.maxMotorImpulse),t=this.motorImpulse-s,i-=t*this.motorDenom}else t=0;var h;if(2!=this.limitState){h=(i-this.limitVelocity-this.limitImpulse*this.cfm)*this.invDenom;var e=this.limitImpulse;this.limitImpulse+=h,this.limitImpulse*this.limitState<0&&(this.limitImpulse=0),h=this.limitImpulse-e}else h=0;var a=h+t;this.l1.x+=a*this.l1x,this.l1.y+=a*this.l1y,this.l1.z+=a*this.l1z,this.a1.x+=a*this.a1x,this.a1.y+=a*this.a1y,this.a1.z+=a*this.a1z,this.l2.x-=a*this.l2x,this.l2.y-=a*this.l2y,this.l2.z-=a*this.l2z,this.a2.x-=a*this.a2x,this.a2.y-=a*this.a2y,this.a2.z-=a*this.a2z}}),M.prototype=Object.assign(Object.create(b.prototype),{constructor:M,preSolve:function(t,i){this.updateAnchorPoints(),this.nor.sub(this.anchorPoint2,this.anchorPoint1).normalize(),this.t.preSolve(t,i)},solve:function(){this.t.solve()},postSolve:function(){}}),Object.assign(I.prototype,{AngularConstraint:!0,preSolve:function(t,i){var s,h,e;this.ii1=this.i1.clone(),this.ii2=this.i2.clone(),e=(new o).add(this.ii1,this.ii2).elements,s=1/(e[0]*(e[4]*e[8]-e[7]*e[5])+e[3]*(e[7]*e[2]-e[1]*e[8])+e[6]*(e[1]*e[5]-e[4]*e[2])),this.dd=(new o).set(e[4]*e[8]-e[5]*e[7],e[2]*e[7]-e[1]*e[8],e[1]*e[5]-e[2]*e[4],e[5]*e[6]-e[3]*e[8],e[0]*e[8]-e[2]*e[6],e[2]*e[3]-e[0]*e[5],e[3]*e[7]-e[4]*e[6],e[1]*e[6]-e[0]*e[7],e[0]*e[4]-e[1]*e[3]).multiply(s),this.relativeOrientation.invert(this.b1.orientation),this.relativeOrientation.mul(this.targetOrientation,this.relativeOrientation),this.relativeOrientation.mul(this.b2.orientation,this.relativeOrientation),s=2*this.relativeOrientation.w,this.vel.scale(this.relativeOrientation,s),h=this.vel.length(),h>.02?(h=(.02-h)/h*i*.05,this.vel.scaleEqual(h)):this.vel.set(0,0,0),this.rn1.mulMat(this.ii1,this.imp),this.rn2.mulMat(this.ii2,this.imp),this.a1.addEqual(this.rn1),this.a2.subEqual(this.rn2)},solve:function(){var t=this.a2.clone().subEqual(this.a1).subEqual(this.vel);this.rn0.mulMat(this.dd,t),this.rn1.mulMat(this.ii1,this.rn0),this.rn2.mulMat(this.ii2,this.rn0),this.imp.addEqual(this.rn0),this.a1.addEqual(this.rn1),this.a2.subEqual(this.rn2)}}),Object.assign(S.prototype,{Translational3Constraint:!0,preSolve:function(t,i){this.ax1=this.limitMotor1.axis.x,this.ay1=this.limitMotor1.axis.y,this.az1=this.limitMotor1.axis.z,this.ax2=this.limitMotor2.axis.x,this.ay2=this.limitMotor2.axis.y,this.az2=this.limitMotor2.axis.z,this.ax3=this.limitMotor3.axis.x,this.ay3=this.limitMotor3.axis.y,this.az3=this.limitMotor3.axis.z,this.lowerLimit1=this.limitMotor1.lowerLimit,this.upperLimit1=this.limitMotor1.upperLimit,this.motorSpeed1=this.limitMotor1.motorSpeed,this.maxMotorForce1=this.limitMotor1.maxMotorForce,this.enableMotor1=this.maxMotorForce1>0,this.lowerLimit2=this.limitMotor2.lowerLimit,this.upperLimit2=this.limitMotor2.upperLimit,this.motorSpeed2=this.limitMotor2.motorSpeed,this.maxMotorForce2=this.limitMotor2.maxMotorForce,this.enableMotor2=this.maxMotorForce2>0,this.lowerLimit3=this.limitMotor3.lowerLimit,this.upperLimit3=this.limitMotor3.upperLimit,this.motorSpeed3=this.limitMotor3.motorSpeed,this.maxMotorForce3=this.limitMotor3.maxMotorForce,this.enableMotor3=this.maxMotorForce3>0,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass;var s=this.i1.elements,h=this.i2.elements;this.i1e00=s[0],this.i1e01=s[1],this.i1e02=s[2],this.i1e10=s[3],this.i1e11=s[4],this.i1e12=s[5],this.i1e20=s[6],this.i1e21=s[7],this.i1e22=s[8],this.i2e00=h[0],this.i2e01=h[1],this.i2e02=h[2],this.i2e10=h[3],this.i2e11=h[4],this.i2e12=h[5],this.i2e20=h[6],this.i2e21=h[7],this.i2e22=h[8];var e=this.p2.x-this.p1.x,a=this.p2.y-this.p1.y,o=this.p2.z-this.p1.z,n=e*this.ax1+a*this.ay1+o*this.az1,r=e*this.ax2+a*this.ay2+o*this.az2,l=e*this.ax3+a*this.ay3+o*this.az3,m=this.limitMotor1.frequency,c=this.limitMotor2.frequency,p=this.limitMotor3.frequency,y=m>0,u=c>0,x=p>0,d=this.lowerLimit1<=this.upperLimit1,z=this.lowerLimit2<=this.upperLimit2,f=this.lowerLimit3<=this.upperLimit3;(y&&n>20||n<-20)&&(y=!1),(u&&r>20||r<-20)&&(u=!1),(x&&l>20||l<-20)&&(x=!1),d?(this.lowerLimit1==this.upperLimit1?(0!=this.limitState1&&(this.limitState1=0,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-n,y||(n=this.lowerLimit1)):n<this.lowerLimit1?(this.limitState1!=-1&&(this.limitState1=-1,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-n,y||(n=this.lowerLimit1)):n>this.upperLimit1?(1!=this.limitState1&&(this.limitState1=1,this.limitImpulse1=0),this.limitVelocity1=this.upperLimit1-n,y||(n=this.upperLimit1)):(this.limitState1=2,this.limitImpulse1=0,this.limitVelocity1=0),y||(this.limitVelocity1>.005?this.limitVelocity1-=.005:this.limitVelocity1<-.005?this.limitVelocity1+=.005:this.limitVelocity1=0)):(this.limitState1=2,this.limitImpulse1=0),z?(this.lowerLimit2==this.upperLimit2?(0!=this.limitState2&&(this.limitState2=0,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-r,u||(r=this.lowerLimit2)):r<this.lowerLimit2?(this.limitState2!=-1&&(this.limitState2=-1,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-r,u||(r=this.lowerLimit2)):r>this.upperLimit2?(1!=this.limitState2&&(this.limitState2=1,this.limitImpulse2=0),this.limitVelocity2=this.upperLimit2-r,u||(r=this.upperLimit2)):(this.limitState2=2,this.limitImpulse2=0,this.limitVelocity2=0),u||(this.limitVelocity2>.005?this.limitVelocity2-=.005:this.limitVelocity2<-.005?this.limitVelocity2+=.005:this.limitVelocity2=0)):(this.limitState2=2,this.limitImpulse2=0),f?(this.lowerLimit3==this.upperLimit3?(0!=this.limitState3&&(this.limitState3=0,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-l,x||(l=this.lowerLimit3)):l<this.lowerLimit3?(this.limitState3!=-1&&(this.limitState3=-1,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-l,x||(l=this.lowerLimit3)):l>this.upperLimit3?(1!=this.limitState3&&(this.limitState3=1,this.limitImpulse3=0),this.limitVelocity3=this.upperLimit3-l,x||(l=this.upperLimit3)):(this.limitState3=2,this.limitImpulse3=0,this.limitVelocity3=0),x||(this.limitVelocity3>.005?this.limitVelocity3-=.005:this.limitVelocity3<-.005?this.limitVelocity3+=.005:this.limitVelocity3=0)):(this.limitState3=2,this.limitImpulse3=0),this.enableMotor1&&(0!=this.limitState1||y)?this.maxMotorImpulse1=this.maxMotorForce1*t:(this.motorImpulse1=0,this.maxMotorImpulse1=0),this.enableMotor2&&(0!=this.limitState2||u)?this.maxMotorImpulse2=this.maxMotorForce2*t:(this.motorImpulse2=0,this.maxMotorImpulse2=0),this.enableMotor3&&(0!=this.limitState3||x)?this.maxMotorImpulse3=this.maxMotorForce3*t:(this.motorImpulse3=0,this.maxMotorImpulse3=0);var b=n*this.ax1+r*this.ax2+l*this.ax2,v=n*this.ay1+r*this.ay2+l*this.ay2,N=n*this.az1+r*this.az2+l*this.az2,w=this.m2/(this.m1+this.m2);this.weight>=0&&(w=this.weight);var k=1-w;this.r1x=this.r1.x+b*w,this.r1y=this.r1.y+v*w,this.r1z=this.r1.z+N*w,this.r2x=this.r2.x-b*k,this.r2y=this.r2.y-v*k,this.r2z=this.r2.z-N*k,this.t1x1=this.r1y*this.az1-this.r1z*this.ay1,this.t1y1=this.r1z*this.ax1-this.r1x*this.az1,this.t1z1=this.r1x*this.ay1-this.r1y*this.ax1,this.t2x1=this.r2y*this.az1-this.r2z*this.ay1,this.t2y1=this.r2z*this.ax1-this.r2x*this.az1,this.t2z1=this.r2x*this.ay1-this.r2y*this.ax1,this.l1x1=this.ax1*this.m1,this.l1y1=this.ay1*this.m1,this.l1z1=this.az1*this.m1,this.l2x1=this.ax1*this.m2,this.l2y1=this.ay1*this.m2,this.l2z1=this.az1*this.m2,this.a1x1=this.t1x1*this.i1e00+this.t1y1*this.i1e01+this.t1z1*this.i1e02,this.a1y1=this.t1x1*this.i1e10+this.t1y1*this.i1e11+this.t1z1*this.i1e12,this.a1z1=this.t1x1*this.i1e20+this.t1y1*this.i1e21+this.t1z1*this.i1e22,this.a2x1=this.t2x1*this.i2e00+this.t2y1*this.i2e01+this.t2z1*this.i2e02,this.a2y1=this.t2x1*this.i2e10+this.t2y1*this.i2e11+this.t2z1*this.i2e12,this.a2z1=this.t2x1*this.i2e20+this.t2y1*this.i2e21+this.t2z1*this.i2e22,this.t1x2=this.r1y*this.az2-this.r1z*this.ay2,this.t1y2=this.r1z*this.ax2-this.r1x*this.az2,this.t1z2=this.r1x*this.ay2-this.r1y*this.ax2,this.t2x2=this.r2y*this.az2-this.r2z*this.ay2,this.t2y2=this.r2z*this.ax2-this.r2x*this.az2,this.t2z2=this.r2x*this.ay2-this.r2y*this.ax2,this.l1x2=this.ax2*this.m1,this.l1y2=this.ay2*this.m1,this.l1z2=this.az2*this.m1,this.l2x2=this.ax2*this.m2,this.l2y2=this.ay2*this.m2,this.l2z2=this.az2*this.m2,this.a1x2=this.t1x2*this.i1e00+this.t1y2*this.i1e01+this.t1z2*this.i1e02,this.a1y2=this.t1x2*this.i1e10+this.t1y2*this.i1e11+this.t1z2*this.i1e12,this.a1z2=this.t1x2*this.i1e20+this.t1y2*this.i1e21+this.t1z2*this.i1e22,this.a2x2=this.t2x2*this.i2e00+this.t2y2*this.i2e01+this.t2z2*this.i2e02,this.a2y2=this.t2x2*this.i2e10+this.t2y2*this.i2e11+this.t2z2*this.i2e12,this.a2z2=this.t2x2*this.i2e20+this.t2y2*this.i2e21+this.t2z2*this.i2e22,this.t1x3=this.r1y*this.az3-this.r1z*this.ay3,this.t1y3=this.r1z*this.ax3-this.r1x*this.az3,this.t1z3=this.r1x*this.ay3-this.r1y*this.ax3,this.t2x3=this.r2y*this.az3-this.r2z*this.ay3,this.t2y3=this.r2z*this.ax3-this.r2x*this.az3,this.t2z3=this.r2x*this.ay3-this.r2y*this.ax3,this.l1x3=this.ax3*this.m1,this.l1y3=this.ay3*this.m1,this.l1z3=this.az3*this.m1,this.l2x3=this.ax3*this.m2,this.l2y3=this.ay3*this.m2,this.l2z3=this.az3*this.m2,this.a1x3=this.t1x3*this.i1e00+this.t1y3*this.i1e01+this.t1z3*this.i1e02,this.a1y3=this.t1x3*this.i1e10+this.t1y3*this.i1e11+this.t1z3*this.i1e12,this.a1z3=this.t1x3*this.i1e20+this.t1y3*this.i1e21+this.t1z3*this.i1e22,this.a2x3=this.t2x3*this.i2e00+this.t2y3*this.i2e01+this.t2z3*this.i2e02,this.a2y3=this.t2x3*this.i2e10+this.t2y3*this.i2e11+this.t2z3*this.i2e12,this.a2z3=this.t2x3*this.i2e20+this.t2y3*this.i2e21+this.t2z3*this.i2e22;var g=this.m1+this.m2;if(this.k00=(this.ax1*this.ax1+this.ay1*this.ay1+this.az1*this.az1)*g,this.k01=(this.ax1*this.ax2+this.ay1*this.ay2+this.az1*this.az2)*g,this.k02=(this.ax1*this.ax3+this.ay1*this.ay3+this.az1*this.az3)*g,this.k10=(this.ax2*this.ax1+this.ay2*this.ay1+this.az2*this.az1)*g,this.k11=(this.ax2*this.ax2+this.ay2*this.ay2+this.az2*this.az2)*g,this.k12=(this.ax2*this.ax3+this.ay2*this.ay3+this.az2*this.az3)*g,this.k20=(this.ax3*this.ax1+this.ay3*this.ay1+this.az3*this.az1)*g,this.k21=(this.ax3*this.ax2+this.ay3*this.ay2+this.az3*this.az2)*g,this.k22=(this.ax3*this.ax3+this.ay3*this.ay3+this.az3*this.az3)*g,this.k00+=this.t1x1*this.a1x1+this.t1y1*this.a1y1+this.t1z1*this.a1z1,this.k01+=this.t1x1*this.a1x2+this.t1y1*this.a1y2+this.t1z1*this.a1z2,this.k02+=this.t1x1*this.a1x3+this.t1y1*this.a1y3+this.t1z1*this.a1z3,this.k10+=this.t1x2*this.a1x1+this.t1y2*this.a1y1+this.t1z2*this.a1z1,this.k11+=this.t1x2*this.a1x2+this.t1y2*this.a1y2+this.t1z2*this.a1z2,this.k12+=this.t1x2*this.a1x3+this.t1y2*this.a1y3+this.t1z2*this.a1z3,this.k20+=this.t1x3*this.a1x1+this.t1y3*this.a1y1+this.t1z3*this.a1z1,this.k21+=this.t1x3*this.a1x2+this.t1y3*this.a1y2+this.t1z3*this.a1z2,this.k22+=this.t1x3*this.a1x3+this.t1y3*this.a1y3+this.t1z3*this.a1z3,this.k00+=this.t2x1*this.a2x1+this.t2y1*this.a2y1+this.t2z1*this.a2z1,this.k01+=this.t2x1*this.a2x2+this.t2y1*this.a2y2+this.t2z1*this.a2z2,this.k02+=this.t2x1*this.a2x3+this.t2y1*this.a2y3+this.t2z1*this.a2z3,this.k10+=this.t2x2*this.a2x1+this.t2y2*this.a2y1+this.t2z2*this.a2z1,this.k11+=this.t2x2*this.a2x2+this.t2y2*this.a2y2+this.t2z2*this.a2z2,this.k12+=this.t2x2*this.a2x3+this.t2y2*this.a2y3+this.t2z2*this.a2z3,this.k20+=this.t2x3*this.a2x1+this.t2y3*this.a2y1+this.t2z3*this.a2z1,this.k21+=this.t2x3*this.a2x2+this.t2y3*this.a2y2+this.t2z3*this.a2z2,this.k22+=this.t2x3*this.a2x3+this.t2y3*this.a2y3+this.t2z3*this.a2z3,this.kv00=this.k00,this.kv11=this.k11,this.kv22=this.k22,this.dv00=1/this.kv00,this.dv11=1/this.kv11,this.dv22=1/this.kv22,y&&2!=this.limitState1){var M=6.2831853*m,I=M*M*t,S=i/(I+2*this.limitMotor1.dampingRatio*M);this.cfm1=this.kv00*S,this.limitVelocity1*=I*S}else this.cfm1=0,this.limitVelocity1*=.05*i;u&&2!=this.limitState2?(M=6.2831853*c,I=M*M*t,S=i/(I+2*this.limitMotor2.dampingRatio*M),this.cfm2=this.kv11*S,this.limitVelocity2*=I*S):(this.cfm2=0,this.limitVelocity2*=.05*i),x&&2!=this.limitState3?(M=6.2831853*p,I=M*M*t,S=i/(I+2*this.limitMotor3.dampingRatio*M),this.cfm3=this.kv22*S,this.limitVelocity3*=I*S):(this.cfm3=0,this.limitVelocity3*=.05*i),this.k00+=this.cfm1,this.k11+=this.cfm2,this.k22+=this.cfm3;var P=1/(this.k00*(this.k11*this.k22-this.k21*this.k12)+this.k10*(this.k21*this.k02-this.k01*this.k22)+this.k20*(this.k01*this.k12-this.k11*this.k02));this.d00=(this.k11*this.k22-this.k12*this.k21)*P,this.d01=(this.k02*this.k21-this.k01*this.k22)*P,this.d02=(this.k01*this.k12-this.k02*this.k11)*P,this.d10=(this.k12*this.k20-this.k10*this.k22)*P,this.d11=(this.k00*this.k22-this.k02*this.k20)*P,this.d12=(this.k02*this.k10-this.k00*this.k12)*P,this.d20=(this.k10*this.k21-this.k11*this.k20)*P,this.d21=(this.k01*this.k20-this.k00*this.k21)*P,this.d22=(this.k00*this.k11-this.k01*this.k10)*P;var L=this.limitImpulse1+this.motorImpulse1,V=this.limitImpulse2+this.motorImpulse2,T=this.limitImpulse3+this.motorImpulse3;this.l1.x+=L*this.l1x1+V*this.l1x2+T*this.l1x3,this.l1.y+=L*this.l1y1+V*this.l1y2+T*this.l1y3,this.l1.z+=L*this.l1z1+V*this.l1z2+T*this.l1z3,this.a1.x+=L*this.a1x1+V*this.a1x2+T*this.a1x3,this.a1.y+=L*this.a1y1+V*this.a1y2+T*this.a1y3,this.a1.z+=L*this.a1z1+V*this.a1z2+T*this.a1z3,this.l2.x-=L*this.l2x1+V*this.l2x2+T*this.l2x3,this.l2.y-=L*this.l2y1+V*this.l2y2+T*this.l2y3,this.l2.z-=L*this.l2z1+V*this.l2z2+T*this.l2z3,this.a2.x-=L*this.a2x1+V*this.a2x2+T*this.a2x3,this.a2.y-=L*this.a2y1+V*this.a2y2+T*this.a2y3,this.a2.z-=L*this.a2z1+V*this.a2z2+T*this.a2z3},solve:function(){var t=this.l2.x-this.l1.x+this.a2.y*this.r2z-this.a2.z*this.r2y-this.a1.y*this.r1z+this.a1.z*this.r1y,i=this.l2.y-this.l1.y+this.a2.z*this.r2x-this.a2.x*this.r2z-this.a1.z*this.r1x+this.a1.x*this.r1z,s=this.l2.z-this.l1.z+this.a2.x*this.r2y-this.a2.y*this.r2x-this.a1.x*this.r1y+this.a1.y*this.r1x,h=t*this.ax1+i*this.ay1+s*this.az1,e=t*this.ax2+i*this.ay2+s*this.az2,a=t*this.ax3+i*this.ay3+s*this.az3,o=this.motorImpulse1,n=this.motorImpulse2,r=this.motorImpulse3,l=0,m=0,c=0;this.enableMotor1&&(l=(h-this.motorSpeed1)*this.dv00,this.motorImpulse1+=l,this.motorImpulse1>this.maxMotorImpulse1?this.motorImpulse1=this.maxMotorImpulse1:this.motorImpulse1<-this.maxMotorImpulse1&&(this.motorImpulse1=-this.maxMotorImpulse1),l=this.motorImpulse1-o),this.enableMotor2&&(m=(e-this.motorSpeed2)*this.dv11,this.motorImpulse2+=m,this.motorImpulse2>this.maxMotorImpulse2?this.motorImpulse2=this.maxMotorImpulse2:this.motorImpulse2<-this.maxMotorImpulse2&&(this.motorImpulse2=-this.maxMotorImpulse2),m=this.motorImpulse2-n),this.enableMotor3&&(c=(a-this.motorSpeed3)*this.dv22,this.motorImpulse3+=c,this.motorImpulse3>this.maxMotorImpulse3?this.motorImpulse3=this.maxMotorImpulse3:this.motorImpulse3<-this.maxMotorImpulse3&&(this.motorImpulse3=-this.maxMotorImpulse3),c=this.motorImpulse3-r),h+=l*this.kv00+m*this.k01+c*this.k02,e+=l*this.k10+m*this.kv11+c*this.k12,a+=l*this.k20+m*this.k21+c*this.kv22,h-=this.limitVelocity1+this.limitImpulse1*this.cfm1,e-=this.limitVelocity2+this.limitImpulse2*this.cfm2,a-=this.limitVelocity3+this.limitImpulse3*this.cfm3;var p=this.limitImpulse1,y=this.limitImpulse2,u=this.limitImpulse3,x=h*this.d00+e*this.d01+a*this.d02,d=h*this.d10+e*this.d11+a*this.d12,z=h*this.d20+e*this.d21+a*this.d22;this.limitImpulse1+=x,this.limitImpulse2+=d,this.limitImpulse3+=z;var f=0;(2==this.limitState1||this.limitImpulse1*this.limitState1<0)&&(x=-p,e+=x*this.k10,a+=x*this.k20,f|=1),(2==this.limitState2||this.limitImpulse2*this.limitState2<0)&&(d=-y,h+=d*this.k01,a+=d*this.k21,f|=2),(2==this.limitState3||this.limitImpulse3*this.limitState3<0)&&(z=-u,h+=z*this.k02,e+=z*this.k12,f|=4);var b;switch(f){case 1:b=1/(this.k11*this.k22-this.k12*this.k21),d=(this.k22*e+-this.k12*a)*b,z=(-this.k21*e+this.k11*a)*b;break;case 2:b=1/(this.k00*this.k22-this.k02*this.k20),x=(this.k22*h+-this.k02*a)*b,z=(-this.k20*h+this.k00*a)*b;break;case 3:z=a/this.k22;break;case 4:b=1/(this.k00*this.k11-this.k01*this.k10),x=(this.k11*h+-this.k01*e)*b,d=(-this.k10*h+this.k00*e)*b;break;case 5:d=e/this.k11;break;case 6:x=h/this.k00}this.limitImpulse1=p+x,this.limitImpulse2=y+d,this.limitImpulse3=u+z;var v=l+x,N=m+d,w=c+z;this.l1.x+=v*this.l1x1+N*this.l1x2+w*this.l1x3,this.l1.y+=v*this.l1y1+N*this.l1y2+w*this.l1y3,this.l1.z+=v*this.l1z1+N*this.l1z2+w*this.l1z3,this.a1.x+=v*this.a1x1+N*this.a1x2+w*this.a1x3,this.a1.y+=v*this.a1y1+N*this.a1y2+w*this.a1y3,this.a1.z+=v*this.a1z1+N*this.a1z2+w*this.a1z3,this.l2.x-=v*this.l2x1+N*this.l2x2+w*this.l2x3,this.l2.y-=v*this.l2y1+N*this.l2y2+w*this.l2y3,this.l2.z-=v*this.l2z1+N*this.l2z2+w*this.l2z3,this.a2.x-=v*this.a2x1+N*this.a2x2+w*this.a2x3,this.a2.y-=v*this.a2y1+N*this.a2y2+w*this.a2y3,this.a2.z-=v*this.a2z1+N*this.a2z2+w*this.a2z3}}),P.prototype=Object.assign(Object.create(b.prototype),{constructor:P,preSolve:function(t,i){this.updateAnchorPoints(),this.ax1.mulMat(this.body1.rotation,this.localAxis1),this.ax2.mulMat(this.body2.rotation,this.localAxis2),this.nor.set(this.ax1.x*this.body2.inverseMass+this.ax2.x*this.body1.inverseMass,this.ax1.y*this.body2.inverseMass+this.ax2.y*this.body1.inverseMass,this.ax1.z*this.body2.inverseMass+this.ax2.z*this.body1.inverseMass).normalize(),this.tan.tangent(this.nor).normalize(),this.bin.crossVectors(this.nor,this.tan),this.ac.preSolve(t,i),this.t3.preSolve(t,i)},solve:function(){this.ac.solve(),this.t3.solve()},postSolve:function(){}}),L.prototype=Object.assign(Object.create(b.prototype),{constructor:L,preSolve:function(t,i){this.updateAnchorPoints(),this.ax1.mulMat(this.body1.rotation,this.localAxis1),this.an1.mulMat(this.body1.rotation,this.localAngle1),this.ax2.mulMat(this.body2.rotation,this.localAxis2),this.an2.mulMat(this.body2.rotation,this.localAngle2),this.nor.set(this.ax1.x*this.body2.inverseMass+this.ax2.x*this.body1.inverseMass,this.ax1.y*this.body2.inverseMass+this.ax2.y*this.body1.inverseMass,this.ax1.z*this.body2.inverseMass+this.ax2.z*this.body1.inverseMass).normalize(),this.tan.tangent(this.nor).normalize(),this.bin.crossVectors(this.nor,this.tan),this.tmp.crossVectors(this.an1,this.an2);var s=jt.acosClamp(jt.dotVectors(this.an1,this.an2));jt.dotVectors(this.nor,this.tmp)<0?this.rotationalLimitMotor.angle=-s:this.rotationalLimitMotor.angle=s,this.tmp.crossVectors(this.ax1,this.ax2),this.r3.limitMotor2.angle=jt.dotVectors(this.tan,this.tmp),this.r3.limitMotor3.angle=jt.dotVectors(this.bin,this.tmp),this.r3.preSolve(t,i),this.t3.preSolve(t,i)},solve:function(){this.r3.solve(),this.t3.solve()},postSolve:function(){}}),V.prototype=Object.assign(Object.create(b.prototype),{constructor:V,preSolve:function(t,i){this.updateAnchorPoints(),this.ax1.mulMat(this.body1.rotation,this.localAxis1),this.ax2.mulMat(this.body2.rotation,this.localAxis2),this.an1.mulMat(this.body1.rotation,this.localAngle1),this.an2.mulMat(this.body2.rotation,this.localAngle2),this.r3.limitMotor1.angle=jt.dotVectors(this.ax1,this.ax2);var s=jt.dotVectors(this.an1,this.ax2);jt.dotVectors(this.ax1,this.tmp.crossVectors(this.an1,this.ax2))<0?this.rotationalLimitMotor1.angle=-s:this.rotationalLimitMotor1.angle=s,s=jt.dotVectors(this.an2,this.ax1),jt.dotVectors(this.ax2,this.tmp.crossVectors(this.an2,this.ax1))<0?this.rotationalLimitMotor2.angle=-s:this.rotationalLimitMotor2.angle=s,this.nor.crossVectors(this.ax1,this.ax2).normalize(),this.tan.crossVectors(this.nor,this.ax2).normalize(),this.bin.crossVectors(this.nor,this.ax1).normalize(),this.r3.preSolve(t,i),this.t3.preSolve(t,i)},solve:function(){this.r3.solve(),this.t3.solve()},postSolve:function(){}}),j.prototype={constructor:j,reset:function(t,i){this.body1=t.parent,this.body2=i.parent,this.numPoints=0},addPointVec:function(t,i,s,h){var e=this.points[this.numPoints++];e.position.copy(t),e.localPoint1.mulManifold(this.body1.rotation,t.clone().subEqual(this.body1.position)),e.localPoint2.mulManifold(this.body2.rotation,t.clone().subEqual(this.body2.position)),e.normal.copy(i),h&&e.normal.negate(),e.normalImpulse=0,e.penetration=s,e.warmStarted=!1},addPoint:function(t,i,s,h,a,o,n,r){var l=this.points[this.numPoints++];l.position.set(t,i,s),l.localPoint1.mulManifold(this.body1.rotation,(new e).sub(l.position,this.body1.position)),l.localPoint2.mulManifold(this.body2.rotation,(new e).sub(l.position,this.body2.position)),l.normalImpulse=0,l.normal.set(h,a,o),r&&l.normal.negate(),l.penetration=n,l.warmStarted=!1}},C.prototype=Object.assign(Object.create(z.prototype),{constructor:C,attach:function(t,i){this.shape1=t,this.shape2=i,this.body1=t.parent,this.body2=i.parent},detach:function(){this.shape1=null,this.shape2=null,this.body1=null,this.body2=null},preSolve:function(t,i){this.restitution=jt.sqrt(this.shape1.restitution,this.shape2.restitution),this.friction=jt.sqrt(this.shape1.friction,this.shape2.friction),this.lv1=this.body1.linearVelocity,this.av1=this.body1.angularVelocity,this.lv2=this.body2.linearVelocity,this.av2=this.body2.angularVelocity,this.m1=this.body1.inverseMass,this.m2=this.body2.inverseMass;var s=this.m1+this.m2;this.num=this.manifold.numPoints;for(var h,e,a,o,n,r,l,m,c=this.num,p=this.cs;c--;)p=this.cs[c],h=this.ps[c],this.i1=this.body1.inverseInertia,this.i2=this.body2.inverseInertia,this.tmpP1.sub(h.position,this.body1.position),this.tmpP2.sub(h.position,this.body2.position),this.tmpC1.crossVectors(this.av1,this.tmpP1),this.tmpC2.crossVectors(this.av2,this.tmpP2),p.norImp=h.normalImpulse,p.tanImp=h.tangentImpulse,p.binImp=h.binormalImpulse,p.nor.copy(h.normal),this.tmp.set(this.lv2.x+this.tmpC2.x-(this.lv1.x+this.tmpC1.x),this.lv2.y+this.tmpC2.y-(this.lv1.y+this.tmpC1.y),this.lv2.z+this.tmpC2.z-(this.lv1.z+this.tmpC1.z)),e=jt.dotVectors(p.nor,this.tmp),p.tan.set(this.tmp.x-e*p.nor.x,this.tmp.y-e*p.nor.y,this.tmp.z-e*p.nor.z),a=jt.dotVectors(p.tan,p.tan),a<=.04&&p.tan.tangent(p.nor),p.tan.normalize(),p.bin.crossVectors(p.nor,p.tan),p.norU1.scale(p.nor,this.m1),p.norU2.scale(p.nor,this.m2),p.tanU1.scale(p.tan,this.m1),p.tanU2.scale(p.tan,this.m2),p.binU1.scale(p.bin,this.m1),p.binU2.scale(p.bin,this.m2),p.norT1.crossVectors(this.tmpP1,p.nor),p.tanT1.crossVectors(this.tmpP1,p.tan),p.binT1.crossVectors(this.tmpP1,p.bin),p.norT2.crossVectors(this.tmpP2,p.nor),p.tanT2.crossVectors(this.tmpP2,p.tan),p.binT2.crossVectors(this.tmpP2,p.bin),l=this.body1.inverseInertia,m=this.body2.inverseInertia,p.norTU1.mulMat(l,p.norT1),p.tanTU1.mulMat(l,p.tanT1),p.binTU1.mulMat(l,p.binT1),p.norTU2.mulMat(m,p.norT2),p.tanTU2.mulMat(m,p.tanT2),p.binTU2.mulMat(m,p.binT2),this.tmpC1.crossVectors(p.norTU1,this.tmpP1),this.tmpC2.crossVectors(p.norTU2,this.tmpP2),this.tmp.add(this.tmpC1,this.tmpC2),p.norDen=1/(s+jt.dotVectors(p.nor,this.tmp)),this.tmpC1.crossVectors(p.tanTU1,this.tmpP1),this.tmpC2.crossVectors(p.tanTU2,this.tmpP2),this.tmp.add(this.tmpC1,this.tmpC2),p.tanDen=1/(s+jt.dotVectors(p.tan,this.tmp)),this.tmpC1.crossVectors(p.binTU1,this.tmpP1),this.tmpC2.crossVectors(p.binTU2,this.tmpP2),this.tmp.add(this.tmpC1,this.tmpC2),p.binDen=1/(s+jt.dotVectors(p.bin,this.tmp)),h.warmStarted?(o=h.normalImpulse,this.lv1.addScale(p.norU1,o),this.av1.addScale(p.norTU1,o),this.lv2.subScale(p.norU2,o),this.av2.subScale(p.norTU2,o),p.norImp=o,p.tanImp=0,p.binImp=0,e=0):(p.norImp=0,p.tanImp=0,p.binImp=0),e>-1&&(e=0),n=this.restitution*-e,r=-(h.penetration+.005)*i*.05,n<r&&(n=r),p.norTar=n},solve:function(){this.tmplv1.copy(this.lv1),this.tmplv2.copy(this.lv2),this.tmpav1.copy(this.av1),this.tmpav2.copy(this.av2);for(var t,i,s,h,e,a,o,n,r,l,m,c=this.num;c--;)m=this.cs[c],a=m.norImp,o=m.tanImp,n=m.binImp,r=-a*this.friction,this.tmp.sub(this.tmplv2,this.tmplv1),e=jt.dotVectors(this.tmp,m.tan)+jt.dotVectors(this.tmpav2,m.tanT2)-jt.dotVectors(this.tmpav1,m.tanT1),t=o,i=e*m.tanDen,o+=i,e=jt.dotVectors(this.tmp,m.bin)+jt.dotVectors(this.tmpav2,m.binT2)-jt.dotVectors(this.tmpav1,m.binT1),s=n,h=e*m.binDen,n+=h,l=o*o+n*n,l>r*r&&(l=r/jt.sqrt(l),o*=l,n*=l),i=o-t,h=n-s,this.tmp.set(m.tanU1.x*i+m.binU1.x*h,m.tanU1.y*i+m.binU1.y*h,m.tanU1.z*i+m.binU1.z*h),this.tmplv1.addEqual(this.tmp),this.tmp.set(m.tanTU1.x*i+m.binTU1.x*h,m.tanTU1.y*i+m.binTU1.y*h,m.tanTU1.z*i+m.binTU1.z*h),this.tmpav1.addEqual(this.tmp),this.tmp.set(m.tanU2.x*i+m.binU2.x*h,m.tanU2.y*i+m.binU2.y*h,m.tanU2.z*i+m.binU2.z*h),this.tmplv2.subEqual(this.tmp),this.tmp.set(m.tanTU2.x*i+m.binTU2.x*h,m.tanTU2.y*i+m.binTU2.y*h,m.tanTU2.z*i+m.binTU2.z*h),this.tmpav2.subEqual(this.tmp),this.tmp.sub(this.tmplv2,this.tmplv1),e=jt.dotVectors(this.tmp,m.nor)+jt.dotVectors(this.tmpav2,m.norT2)-jt.dotVectors(this.tmpav1,m.norT1),t=a,i=(e-m.norTar)*m.norDen,a+=i,a>0&&(a=0),i=a-t,this.tmplv1.addScale(m.norU1,i),this.tmpav1.addScale(m.norTU1,i),this.tmplv2.subScale(m.norU2,i),this.tmpav2.subScale(m.norTU2,i),m.norImp=a,m.tanImp=o,m.binImp=n;this.lv1.copy(this.tmplv1),this.lv2.copy(this.tmplv2),this.av1.copy(this.tmpav1),this.av2.copy(this.tmpav2)},postSolve:function(){for(var t,i,s=this.num;s--;)i=this.ps[s],t=this.cs[s],i.normal.copy(t.nor),i.tangent.copy(t.tan),i.binormal.copy(t.bin),i.normalImpulse=t.norImp,i.tangentImpulse=t.tanImp,i.binormalImpulse=t.binImp,i.normalDenominator=t.norDen,i.tangentDenominator=t.tanDen,i.binormalDenominator=t.binDen}}),Object.assign(B.prototype,{Contact:!0,mixRestitution:function(t,i){return jt.sqrt(t*i)},mixFriction:function(t,i){return jt.sqrt(t*i)},updateManifold:function(){var t,i,s,h,e,a,o,n,r,l,m;for(this.constraint.restitution=this.mixRestitution(this.shape1.restitution,this.shape2.restitution),this.constraint.friction=this.mixFriction(this.shape1.friction,this.shape2.friction),a=this.manifold.numPoints,t=a;t--;)s=this.buffer[t],h=this.points[t],s.lp1.copy(h.localPoint1),s.lp2.copy(h.localPoint2),s.impulse=h.normalImpulse;if(this.manifold.numPoints=0,this.detector.detectCollision(this.shape1,this.shape2,this.manifold),e=this.manifold.numPoints,0===e)return this.touching=!1,void(this.close=!1);for((this.touching||this.dist<.001)&&(this.close=!0),this.touching=!0,t=e;t--;){for(h=this.points[t],r=-1,l=4e-4,i=a;i--;)s=this.buffer[i],o=jt.distanceVector(s.lp1,h.localPoint1),n=jt.distanceVector(s.lp2,h.localPoint2),o<n?o<l&&(l=o,r=i):n<l&&(l=n,r=i),l<this.dist&&(this.dist=l);r!==-1?(m=this.buffer[r],this.buffer[r]=this.buffer[--a],this.buffer[a]=m,h.normalImpulse=m.impulse,h.warmStarted=!0):(h.normalImpulse=0,h.warmStarted=!1)}},attach:function(t,i){this.shape1=t,this.shape2=i,this.body1=t.parent,this.body2=i.parent,this.manifold.body1=this.body1,this.manifold.body2=this.body2,this.constraint.attach(t,i),this.s1Link.shape=i,this.s1Link.body=this.body2,this.s2Link.shape=t,this.s2Link.body=this.body1,this.shape1.contactLink.push(this.s1Link),this.shape2.contactLink.push(this.s2Link),this.b1Link.shape=i,this.b1Link.body=this.body2,this.b2Link.shape=t,this.b2Link.body=this.body1,this.body1.contactLink.push(this.b1Link),this.body2.contactLink.push(this.b2Link),this.persisting=!0,this.sleeping=this.body1.sleeping&&this.body2.sleeping,this.manifold.numPoints=0},detach:function(){this.shape1.contactLink.splice(this.shape1.contactLink.indexOf(this.s1Link),1),this.shape2.contactLink.splice(this.shape2.contactLink.indexOf(this.s2Link),1),this.body1.contactLink.splice(this.body1.contactLink.indexOf(this.b1Link),1),this.body2.contactLink.splice(this.body2.contactLink.indexOf(this.b2Link),1),this.s1Link.shape=null,this.s1Link.body=null,this.s2Link.shape=null,this.s2Link.body=null,this.b1Link.shape=null,this.b1Link.body=null,this.b2Link.shape=null,this.b2Link.body=null,this.manifold.body1=null,this.manifold.body2=null,this.constraint.detach(),this.shape1=null,this.shape2=null,this.body1=null,this.body2=null,this.detector=null,this.constraint=null,this.persisting=!1,this.sleeping=!1,this.touching=!1,this.close=!1}}),Object.assign(F.prototype,{RigidBody:!0,setId:function(t){this.id=i},setParent:function(t){this.parent=t,this.scale=this.parent.scale,this.invScale=this.parent.invScale,this.id=this.parent.numRigidBodies,this.name||(this.name=this.id),this.updateMesh()},addShape:function(t){t.parent&&s("RigidBody","It is not possible that you add to the multi-rigid body the shape of one"),t.parent=this,t.contactLink=[],this.parent&&this.parent.addShape(t),this.shapes.push(t)},removeShape:function(t){this.shapes.splice(this.shapes.indexOf(t),1),t.parent===this&&(t.parent=null,this.parent&&this.parent.removeShape(t))},remove:function(){this.dispose()},dispose:function(){this.mesh&&(this.mesh=null),this.parent.removeRigidBody(this)},checkContact:function(t){this.parent.checkContact(this.name,t)},setupMass:function(t,i){var s=void 0===i||i;this.type=t||zt,this.isDynamic=this.type===zt,this.isStatic=this.type===ft,this.mass=0,this.localInertia.set(0,0,0,0,0,0,0,0,0);for(var h,a=new o,n=new e,r=this.shapes.length;r--;){h=this.shapes[r],h.calculateMassInfo(this.massInfo);var l=this.massInfo.mass;n.addScale(h.relativePosition,l),this.mass+=l,this.rotateInertia(h.relativeRotation,this.massInfo.inertia,a),this.localInertia.addEqual(a),this.localInertia.addOffset(l,h.relativePosition)}if(this.inverseMass=1/this.mass,n.scaleEqual(this.inverseMass),s){for(this.position.addEqual(n),r=this.shapes.length;r--;)this.shapes[r].relativePosition.subEqual(n);this.localInertia.subOffset(this.mass,n)}this.inverseLocalInertia.invert(this.localInertia),this.type===ft&&(this.inverseMass=0,this.inverseLocalInertia.set(0,0,0,0,0,0,0,0,0)),this.syncShapes(),this.awake()},awake:function(){if(this.allowSleep&&this.sleeping){this.sleeping=!1,this.sleepTime=0;var t,i,s;for(t=this.contactLink.length;t--;)s=this.contactLink[t],s.body.sleepTime=0,s.body.sleeping=!1;for(t=this.jointLink.length;t--;)i=this.jointLink[t],i.body.sleepTime=0,i.body.sleeping=!1;for(t=this.shapes.length;t--;)this.shapes[t].updateProxy()}},sleep:function(){if(this.allowSleep&&!this.sleeping){this.linearVelocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.sleepPosition.copy(this.position),this.sleepOrientation.copy(this.orientation),this.sleepTime=0,this.sleeping=!0;for(var t=this.shapes.length;t--;)this.shapes[t].updateProxy()}},testWakeUp:function(){(this.linearVelocity.testZero()||this.angularVelocity.testZero()||this.position.testDiff(this.sleepPosition)||this.orientation.testDiff(this.sleepOrientation))&&this.awake()},isLonely:function(){return 0===this.jointLink.length&&0===this.contactLink.length},updatePosition:function(t){switch(this.type){case ft:this.linearVelocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.controlPos&&(this.tmpPos.sub(this.newPosition,this.position),this.linearVelocity.scale(this.tmpPos,1/t),this.controlPos=!1,this.position.addTime(this.linearVelocity,t)),this.controlRot&&(this.angularVelocity.copy(this.getAxis()),this.orientation.copy(this.newOrientation),this.controlRot=!1,this.orientation.addTime(this.angularVelocity,t));break;case zt:this.isKinematic&&(this.linearVelocity.set(0,0,0),this.angularVelocity.set(0,0,0)),this.controlPos&&(this.tmpPos.sub(this.newPosition,this.position),
this.linearVelocity.scale(this.tmpPos,1/t),this.controlPos=!1),this.controlRot&&(this.angularVelocity.copy(this.getAxis()),this.orientation.copy(this.newOrientation),this.controlRot=!1),this.position.addTime(this.linearVelocity,t),this.orientation.addTime(this.angularVelocity,t),this.updateMesh();break;default:s("RigidBody","Invalid type.")}this.syncShapes()},getAxis:function(){return(new e).mulMat(this.inverseLocalInertia,new e(0,1,0)).normalize()},rotateInertia:function(t,i,s){this.tmpInertia.mul(t,i),s.mul(this.tmpInertia,t,!0)},syncShapes:function(){this.rotation.setQuat(this.orientation),this.rotateInertia(this.rotation,this.inverseLocalInertia,this.inverseInertia);for(var t,i=this.shapes.length;i--;)t=this.shapes[i],t.position.mulMat(this.rotation,t.relativePosition).addEqual(this.position),t.rotation.mul(this.rotation,t.relativeRotation),t.updateProxy()},applyImpulse:function(t,i){this.linearVelocity.addScale(i,this.inverseMass);var s=new e;s.sub(t,this.position).cross(s,i).mulMat(this.inverseInertia,s),this.angularVelocity.addEqual(s)},setPosition:function(t){this.newPosition.copy(t).multiplyScalar(this.invScale),this.controlPos=!0,this.isKinematic||(this.isKinematic=!0)},setQuaternion:function(t){this.newOrientation.copy(t),this.controlRot=!0,this.isKinematic||(this.isKinematic=!0)},setRotation:function(t){this.newOrientation=(new a).setFromEuler(t.x*jt.degtorad,t.y*jt.degtorad,t.y*jt.degtorad),this.controlRot=!0},resetPosition:function(t,i,s){this.linearVelocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.position.set(t,i,s).multiplyScalar(this.invScale),this.awake()},resetQuaternion:function(t){this.angularVelocity.set(0,0,0),this.orientation=new a(t.x,t.y,t.z,t.w),this.awake()},resetRotation:function(t,i,s){this.angularVelocity.set(0,0,0),this.orientation=(new a).setFromEuler(t*jt.degtorad,i*jt.degtorad,s*jt.degtorad),this.awake()},getPosition:function(){return this.pos},getQuaternion:function(){return this.quaternion},connectMesh:function(t){this.mesh=t,this.updateMesh()},updateMesh:function(){this.pos.scale(this.position,this.scale),this.quaternion.copy(this.orientation),null!==this.mesh&&(this.mesh.position.copy(this.pos),this.mesh.quaternion.copy(this.quaternion))}}),Object.assign(R.prototype,{BroadPhase:!0,createProxy:function(t){s("BroadPhase","Inheritance error.")},addProxy:function(t){s("BroadPhase","Inheritance error.")},removeProxy:function(t){s("BroadPhase","Inheritance error.")},isAvailablePair:function(t,i){var s=t.parent,h=i.parent;if(s==h||!s.isDynamic&&!h.isDynamic||0==(t.belongsTo&i.collidesWith)||0==(i.belongsTo&t.collidesWith))return!1;var e;e=s.numJoints<h.numJoints?s.jointLink:h.jointLink;for(var a=e.length;a--;){var o=e[a].joint;if(!o.allowCollision&&(o.body1==s&&o.body2==h||o.body1==h&&o.body2==s))return!1}return!0},detectPairs:function(){this.pairs=[],this.numPairs=0,this.numPairChecks=0,this.collectPairs()},collectPairs:function(){s("BroadPhase","Inheritance error.")},addPair:function(t,i){var s=new U(t,i);this.pairs.push(s),this.numPairs++}});var Ct=0;Object.assign(J.prototype,{Proxy:!0,update:function(){s("Proxy","Inheritance error.")}}),W.prototype=Object.assign(Object.create(J.prototype),{constructor:W,update:function(){}}),H.prototype=Object.assign(Object.create(R.prototype),{constructor:H,createProxy:function(t){return new W(t)},addProxy:function(t){this.proxies.push(t)},removeProxy:function(t){var i=this.proxies.indexOf(t);i>-1&&this.proxies.splice(i,1)},collectPairs:function(){var t,i,s,h=0,e=this.proxies,a=e.length;for(this.numPairChecks=a*(a-1)>>1;h<a;)for(i=e[h++],t=h+1;t<a;)s=e[t++],!i.aabb.intersectTest(s.aabb)&&this.isAvailablePair(i.shape,s.shape)&&this.addPair(i.shape,s.shape)}}),Object.assign(X.prototype,{SAPAxis:!0,addElements:function(t,i){if(this.numElements+2>=this.bufferSize){this.bufferSize*=2;for(var s=[],h=this.numElements;h--;)s[h]=this.elements[h]}this.elements[this.numElements++]=t,this.elements[this.numElements++]=i},removeElements:function(t,i){for(var s=-1,h=-1,e=0,a=this.numElements;e<a;e++){var o=this.elements[e];if(o==t||o==i){if(s!=-1){h=e;break}s=e}}for(e=s+1,a=h;e<a;e++)this.elements[e-1]=this.elements[e];for(e=h+1,a=this.numElements;e<a;e++)this.elements[e-2]=this.elements[e];this.elements[--this.numElements]=null,this.elements[--this.numElements]=null},sort:function(){for(var t=0,i=1;this.numElements>>i!=0;)i++;i=i*this.numElements>>2,t=0;for(var s=!1,h=this.elements,e=1,a=this.numElements;e<a;e++){var o=h[e],n=o.value,r=h[e-1];if(r.value>n){var l=e;do{if(h[l]=r,0==--l)break;r=h[l-1]}while(r.value>n);if(h[l]=o,t+=e-l,t>i){s=!0;break}}}if(s){t=2;var m=this.stack;for(m[0]=0,m[1]=this.numElements-1;t>0;){var c=m[--t],p=m[--t],y=c-p;if(y>16){var u=p+jt.floor(.5*y);for(o=h[u],h[u]=h[c],h[c]=o,n=o.value,e=p-1,l=c;;){var x,d;do x=h[++e];while(x.value<n);do d=h[--l];while(n<d.value&&l!=p);if(e>=l)break;h[e]=d,h[l]=x}h[c]=h[e],h[e]=o,e-p>c-e?(m[t++]=p,m[t++]=e-1,m[t++]=e+1,m[t++]=c):(m[t++]=e+1,m[t++]=c,m[t++]=p,m[t++]=e-1)}else for(e=p+1;e<=c;e++)if(o=h[e],n=o.value,r=h[e-1],r.value>n){l=e;do{if(h[l]=r,0==--l)break;r=h[l-1]}while(r.value>n);h[l]=o}}}},calculateTestCount:function(){for(var t=1,i=0,s=1,h=this.numElements;s<h;s++)this.elements[s].max?t--:(i+=t,t++);return i}}),K.prototype=Object.assign(Object.create(J.prototype),{constructor:K,isDynamic:function(){var t=this.shape.parent;return t.isDynamic&&!t.sleeping},update:function(){var t=this.aabb.elements;this.min[0].value=t[0],this.min[1].value=t[1],this.min[2].value=t[2],this.max[0].value=t[3],this.max[1].value=t[4],this.max[2].value=t[5],(1==this.belongsTo&&!this.isDynamic()||2==this.belongsTo&&this.isDynamic())&&(this.sap.removeProxy(this),this.sap.addProxy(this))}}),Y.prototype=Object.assign(Object.create(R.prototype),{constructor:Y,createProxy:function(t){return new K(this,t)},addProxy:function(t){var i=t;i.isDynamic()?(this.axesD[0].addElements(i.min[0],i.max[0]),this.axesD[1].addElements(i.min[1],i.max[1]),this.axesD[2].addElements(i.min[2],i.max[2]),i.belongsTo=1,this.numElementsD+=2):(this.axesS[0].addElements(i.min[0],i.max[0]),this.axesS[1].addElements(i.min[1],i.max[1]),this.axesS[2].addElements(i.min[2],i.max[2]),i.belongsTo=2,this.numElementsS+=2)},removeProxy:function(t){var i=t;if(0!=i.belongsTo){switch(i.belongsTo){case 1:this.axesD[0].removeElements(i.min[0],i.max[0]),this.axesD[1].removeElements(i.min[1],i.max[1]),this.axesD[2].removeElements(i.min[2],i.max[2]),this.numElementsD-=2;break;case 2:this.axesS[0].removeElements(i.min[0],i.max[0]),this.axesS[1].removeElements(i.min[1],i.max[1]),this.axesS[2].removeElements(i.min[2],i.max[2]),this.numElementsS-=2}i.belongsTo=0}},collectPairs:function(){if(0!=this.numElementsD){var t=this.axesD[this.index1],i=this.axesD[this.index2];t.sort(),i.sort();var s,h,e=t.calculateTestCount(),a=i.calculateTestCount();e<=a?(i=this.axesS[this.index1],i.sort(),s=t.elements,h=i.elements):(t=this.axesS[this.index2],t.sort(),s=i.elements,h=t.elements,this.index1^=this.index2,this.index2^=this.index1,this.index1^=this.index2);for(var o,n,r=0,l=0;r<this.numElementsD;){var m,c;if(l==this.numElementsS)m=s[r],c=!0,r++;else{var p=s[r],y=h[l];p.value<y.value?(m=p,c=!0,r++):(m=y,c=!1,l++)}if(m.max){var u=m.pair;if(c){if(u==o){o=o.pair;continue}m=o}else{if(u==n){n=n.pair;continue}m=n}do{if(v=m.pair,v==u){m.pair=v.pair;break}m=v}while(null!=m)}else{for(var x=m.proxy.shape,d=m.min1.value,z=m.max1.value,f=m.min2.value,b=m.max2.value,v=o;null!=v;v=v.pair){var N=v.proxy.shape;this.numPairChecks++,d>v.max1.value||z<v.min1.value||f>v.max2.value||b<v.min2.value||!this.isAvailablePair(x,N)||this.addPair(x,N)}if(c){for(v=n;null!=v;v=v.pair)N=v.proxy.shape,this.numPairChecks++,d>v.max1.value||z<v.min1.value||f>v.max2.value||b<v.min2.value||!this.isAvailablePair(x,N)||this.addPair(x,N);m.pair=o,o=m}else m.pair=n,n=m}}this.index2=3^(this.index1|this.index2)}}}),Object.assign(G.prototype,{DBVT:!0,moveLeaf:function(t){this.deleteLeaf(t),this.insertLeaf(t)},insertLeaf:function(t){if(null==this.root)return void(this.root=t);for(var i,s,h=t.aabb,e=this.root;null==e.proxy;){var a=e.child1,o=e.child2,n=e.aabb,r=a.aabb,l=o.aabb;i=n.surfaceArea(),this.aabb.combine(h,n),s=this.aabb.surfaceArea();var m=2*s,c=2*(s-i),p=c;this.aabb.combine(h,r),p+=null!=a.proxy?this.aabb.surfaceArea():this.aabb.surfaceArea()-r.surfaceArea();var y=c;if(this.aabb.combine(h,l),y+=null!=o.proxy?this.aabb.surfaceArea():this.aabb.surfaceArea()-l.surfaceArea(),p<y){if(m<p)break;e=a}else{if(m<y)break;e=o}}var u,x=e.parent;u=this.numFreeNodes>0?this.freeNodes[--this.numFreeNodes]:new Z,u.parent=x,u.child1=t,u.child2=e,u.aabb.combine(t.aabb,e.aabb),u.height=e.height+1,e.parent=u,t.parent=u,e==this.root?this.root=u:x.child1==e?x.child1=u:x.child2=u;do u=this.balance(u),this.fix(u),u=u.parent;while(null!=u)},getBalance:function(t){return null!=t.proxy?0:t.child1.height-t.child2.height},deleteLeaf:function(t){if(t==this.root)return void(this.root=null);var i,s=t.parent;if(i=s.child1==t?s.child2:s.child1,s==this.root)return this.root=i,void(i.parent=null);var h=s.parent;i.parent=h,h.child1==s?h.child1=i:h.child2=i,this.numFreeNodes<16384&&(this.freeNodes[this.numFreeNodes++]=s);do h=this.balance(h),this.fix(h),h=h.parent;while(null!=h)},balance:function(t){var i=t.height;if(i<2)return t;var s,h=t.parent,e=t.child1,a=t.child2,o=e.height,n=a.height,r=o-n;if(r>1){var l=e.child1,m=e.child2,c=l.height,p=m.height;return c>p?(e.child2=t,t.parent=e,t.child1=m,m.parent=t,t.aabb.combine(m.aabb,a.aabb),s=p-n,t.height=p-(s&s>>31)+1,e.aabb.combine(l.aabb,t.aabb),s=c-i,e.height=c-(s&s>>31)+1):(e.child1=t,t.parent=e,t.child1=l,l.parent=t,t.aabb.combine(l.aabb,a.aabb),s=c-n,t.height=c-(s&s>>31)+1,e.aabb.combine(t.aabb,m.aabb),s=i-p,e.height=i-(s&s>>31)+1),null!=h?h.child1==t?h.child1=e:h.child2=e:this.root=e,e.parent=h,e}if(r<-1){var y=a.child1,u=a.child2,x=y.height,d=u.height;return x>d?(a.child2=t,t.parent=a,t.child2=u,u.parent=t,t.aabb.combine(e.aabb,u.aabb),s=o-d,t.height=o-(s&s>>31)+1,a.aabb.combine(y.aabb,t.aabb),s=x-i,a.height=x-(s&s>>31)+1):(a.child1=t,t.parent=a,t.child2=y,y.parent=t,t.aabb.combine(e.aabb,y.aabb),s=o-x,t.height=o-(s&s>>31)+1,a.aabb.combine(t.aabb,u.aabb),s=i-d,a.height=i-(s&s>>31)+1),null!=h?h.child1==t?h.child1=a:h.child2=a:this.root=a,a.parent=h,a}return t},fix:function(t){var i=t.child1,s=t.child2;t.aabb.combine(i.aabb,s.aabb),t.height=i.height<s.height?s.height+1:i.height+1}}),$.prototype=Object.assign(Object.create(J.prototype),{constructor:$,update:function(){}}),tt.prototype=Object.assign(Object.create(R.prototype),{constructor:tt,createProxy:function(t){return new $(t)},addProxy:function(t){this.tree.insertLeaf(t.leaf),this.leaves.push(t.leaf),this.numLeaves++},removeProxy:function(t){this.tree.deleteLeaf(t.leaf);var i=this.leaves.indexOf(t.leaf);i>-1&&(this.leaves.splice(i,1),this.numLeaves--)},collectPairs:function(){if(!(this.numLeaves<2))for(var t,i=.1,s=this.numLeaves;s--;)t=this.leaves[s],t.proxy.aabb.intersectTestTwo(t.aabb)&&(t.aabb.copy(t.proxy.aabb,i),this.tree.deleteLeaf(t),this.tree.insertLeaf(t),this.collide(t,this.tree.root))},collide:function(t,i){var s,h,e,a,o,n,r=2;for(this.stack[0]=t,this.stack[1]=i;r>0;)if(e=this.stack[--r],a=this.stack[--r],o=null!=e.proxy,n=null!=a.proxy,this.numPairChecks++,o&&n){if(s=e.proxy.shape,h=a.proxy.shape,s==h||s.aabb.intersectTest(h.aabb)||!this.isAvailablePair(s,h))continue;this.addPair(s,h)}else{if(e.aabb.intersectTest(a.aabb))continue;n||!o&&e.aabb.surfaceArea()>a.aabb.surfaceArea()?(this.stack[r++]=e.child1,this.stack[r++]=a,this.stack[r++]=e.child2,this.stack[r++]=a):(this.stack[r++]=e,this.stack[r++]=a.child1,this.stack[r++]=e,this.stack[r++]=a.child2)}}}),Object.assign(it.prototype,{CollisionDetector:!0,detectCollision:function(t,i,h){s("CollisionDetector","Inheritance error.")}}),st.prototype=Object.assign(Object.create(it.prototype),{constructor:st,tryAxisOO:function(t){var i,s,h,e,a,o,n,r=this.v,l=jt.dotVectors;return i=l(r[t[0]],this.d),n=i>0,i=n?i:-i,e=l(r[t[0]],r[t[1]]),a=l(r[t[0]],r[t[2]]),o=l(r[t[0]],r[t[3]]),e=e<0?-e:e,a=a<0?-a:a,o=o<0?-o:o,s=t[4],h=e*t[5]+a*t[6]+o*t[7],{o:i-s-h,r:n}},tryAxisCompOO:function(t){var i,s,h,e,a,o,n=this.v,r=jt.dotVectors,l=jt.EPZ;return i=n[t[0]].lengthSq(),i>l?(n[t[0]].multiplyScalar(1/jt.sqrt(i)),i=r(n[t[0]],this.d),o=i>0,i=o?i:-i,e=r(n[t[0]],n[t[1]]),a=r(n[t[0]],n[t[2]]),e=e<0?-e:e,a=a<0?-a:a,s=e*t[5]+a*t[6],e=r(n[t[0]],n[t[3]]),a=r(n[t[0]],n[t[4]]),e=e<0?-e:e,a=a<0?-a:a,h=e*t[7]+a*t[8],{o:i-s-h,r:o,inv:!1}):{o:0,r:!1,inv:!0}},detectCollision:function(t,i,s){var h,e,a,o,n=this.n,r=this.p,l=this.v,m=this.d,c=this.n1,p=this.n2,y=this.p1,u=this.p2,x=this.d1,d=this.d2,z=this.tmp0,f=this.tmp1,b=this.tmp2,v=this.c,N=this.s1,w=this.s2;t.id<i.id?(a=t,o=i):(a=i,o=t);var k,g,M=a.elements,I=o.elements,S=a.dimentions,P=o.dimentions;y.copy(a.position),u.copy(o.position),m.sub(u,y),x.set(a.halfWidth,a.halfHeight,a.halfDepth),d.set(o.halfWidth,o.halfHeight,o.halfDepth),l[0].set(S[0],S[1],S[2]),l[1].set(S[3],S[4],S[5]),l[2].set(S[6],S[7],S[8]),l[3].set(S[9],S[10],S[11]),l[4].set(S[12],S[13],S[14]),l[5].set(S[15],S[16],S[17]),l[6].set(P[0],P[1],P[2]),l[7].set(P[3],P[4],P[5]),l[8].set(P[6],P[7],P[8]),l[9].set(P[9],P[10],P[11]),l[10].set(P[12],P[13],P[14]),l[11].set(P[15],P[16],P[17]),l[12].crossVectors(l[0],l[6]),l[13].crossVectors(l[0],l[7]),l[14].crossVectors(l[0],l[8]),l[15].crossVectors(l[1],l[6]),l[16].crossVectors(l[1],l[7]),l[17].crossVectors(l[1],l[8]),l[18].crossVectors(l[2],l[6]),l[19].crossVectors(l[2],l[7]),l[20].crossVectors(l[2],l[8]);var L,V=[],T=[],q=[],A=[[0,6,7,8,x.x,d.x,d.y,d.z],[1,6,7,8,x.y,d.x,d.y,d.z],[2,6,7,8,x.z,d.x,d.y,d.z],[6,0,1,2,d.x,x.x,x.y,x.z],[7,0,1,2,d.y,x.x,x.y,x.z],[8,0,1,2,d.z,x.x,x.y,x.z],[12,1,2,7,8,x.y,x.z,d.y,d.z],[13,1,2,6,8,x.y,x.z,d.x,d.z],[14,1,2,6,7,x.y,x.z,d.x,d.y],[15,0,2,7,8,x.x,x.z,d.y,d.z],[16,0,2,6,8,x.x,x.z,d.x,d.z],[17,0,2,6,7,x.x,x.z,d.x,d.y],[18,0,1,7,8,x.x,x.y,d.y,d.z],[19,0,1,6,8,x.x,x.y,d.x,d.z],[20,0,1,6,7,x.x,x.y,d.x,d.y]],O=jt.dotVectors,E=!1;for(h=0;h<15;h++)if(h<6){if(L=this.tryAxisOO(A[h]),L.o>0){E=!0;break}T[h]=L.o,V[h]=L.r}else{if(L=this.tryAxisCompOO(A[h]),!L.inv&&L.o>0){E=!0;break}T[h]=L.o,V[h]=L.r,q[h]=L.inv}if(!E){var j=T[0],D=T[0],C=0,B=V[0];T[1]>D&&(j=T[1],D=T[1],C=1,B=V[1]),T[2]>D&&(j=T[2],D=T[2],C=2,B=V[2]),T[3]>D&&(j=T[3],D=T[3],C=3,B=V[3]),T[4]>D&&(j=T[4],D=T[4],C=4,B=V[4]),T[5]>D&&(j=T[5],D=T[5],C=5,B=V[5]),T[6]-.01>D&&!q[6]&&(j=T[6],D=T[6]-.01,C=6,B=V[6]),T[7]-.01>D&&!q[7]&&(j=T[7],D=T[7]-.01,C=7,B=V[7]),T[8]-.01>D&&!q[8]&&(j=T[8],D=T[8]-.01,C=8,B=V[8]),T[9]-.01>D&&!q[9]&&(j=T[9],D=T[9]-.01,C=9,B=V[9]),T[10]-.01>D&&!q[10]&&(j=T[10],D=T[10]-.01,C=10,B=V[10]),T[11]-.01>D&&!q[11]&&(j=T[11],D=T[11]-.01,C=11,B=V[11]),T[12]-.01>D&&!q[12]&&(j=T[12],D=T[12]-.01,C=12,B=V[12]),T[13]-.01>D&&!q[13]&&(j=T[13],D=T[13]-.01,C=13,B=V[13]),T[14]-.01>D&&!q[14]&&(j=T[14],C=14,B=V[14]);var F=!1;switch(C){case 0:n.copy(l[0]),B?v.add(y,l[3]):(v.sub(y,l[3]),n.negate()),N.copy(l[4]),w.copy(l[5]),c.copy(l[1]).negate(),p.copy(l[2]).negate();break;case 1:n.copy(l[1]),B?v.add(y,l[4]):(v.sub(y,l[4]),n.negate()),N.copy(l[3]),w.copy(l[5]),c.copy(l[0]).negate(),p.copy(l[2]).negate();break;case 2:n.copy(l[2]),B?v.add(y,l[5]):(v.sub(y,l[5]),n.negate()),N.copy(l[3]),w.copy(l[4]),c.copy(l[0]).negate(),p.copy(l[1]).negate();break;case 3:n.copy(l[6]),B?(v.sub(u,l[9]),n.negate()):v.add(u,l[9]),N.copy(l[10]),w.copy(l[11]),c.copy(l[7]).negate(),p.copy(l[8]).negate(),F=!0;break;case 4:n.copy(l[7]),B?(v.sub(u,l[10]),n.negate()):v.add(u,l[10]),N.copy(l[9]),w.copy(l[11]),c.copy(l[6]).negate(),p.copy(l[8]).negate(),F=!0;break;case 5:n.copy(l[8]),B?(v.sub(u,l[11]),n.negate()):v.add(u,l[11]),N.copy(l[9]),w.copy(l[10]),c.copy(l[6]).negate(),p.copy(l[7]).negate(),F=!0;break;case 6:n.copy(l[12]),c.copy(l[0]),p.copy(l[6]);break;case 7:n.copy(l[13]),c.copy(l[0]),p.copy(l[7]);break;case 8:n.copy(l[14]),c.copy(l[0]),p.copy(l[8]);break;case 9:n.copy(l[15]),c.copy(l[1]),p.copy(l[6]);break;case 10:n.copy(l[16]),c.copy(l[1]),p.copy(l[7]);break;case 11:n.copy(l[17]),c.copy(l[1]),p.copy(l[8]);break;case 12:n.copy(l[18]),c.copy(l[2]),p.copy(l[6]);break;case 13:n.copy(l[19]),c.copy(l[2]),p.copy(l[7]);break;case 14:n.copy(l[20]),c.copy(l[2]),p.copy(l[8])}var U,R,_,J;if(C>5){for(B||n.negate(),f.set(M[0],M[1],M[2]),R=O(n,f),b.set(I[0],I[1],I[2]),_=O(n,b),h=1;h<8;h++)e=3*h,z.set(M[e],M[e+1],M[e+2]),U=O(n,z),U>R&&(R=U,f.copy(z)),z.set(I[e],I[e+1],I[e+2]),U=O(n,z),U>_&&(_=U,b.copy(z));return z.sub(b,f),k=O(c,p),J=(z.x*(c.x-p.x*k)+z.y*(c.y-p.y*k)+z.z*(c.z-p.z*k))/(1-k*k),r.set(f.x+c.x*J+n.x*j*.5,f.y+c.y*J+n.y*j*.5,f.z+c.z*J+n.z*j*.5),void s.addPointVec(r,n,j,!1)}var W,H=1,X=0,Q=0;switch(F?(X=O(l[0],n),X<H&&(H=X,Q=0),-X<H&&(H=-X,Q=1),X=O(l[1],n),X<H&&(H=X,Q=2),-X<H&&(H=-X,Q=3),X=O(l[2],n),X<H&&(H=X,Q=4),-X<H&&(H=-X,Q=5),W=M):(X=O(l[6],n),X<H&&(H=X,Q=0),-X<H&&(H=-X,Q=1),X=O(l[7],n),X<H&&(H=X,Q=2),-X<H&&(H=-X,Q=3),X=O(l[8],n),X<H&&(H=X,Q=4),-X<H&&(H=-X,Q=5),W=I),Q){case 0:this.qqq.set([W[0],W[1],W[2],W[6],W[7],W[8],W[9],W[10],W[11],W[3],W[4],W[5]]);break;case 1:this.qqq.set([W[15],W[16],W[17],W[21],W[22],W[23],W[18],W[19],W[20],W[12],W[13],W[14]]);break;case 2:this.qqq.set([W[12],W[13],W[14],W[0],W[1],W[2],W[3],W[4],W[5],W[15],W[16],W[17]]);break;case 3:this.qqq.set([W[21],W[22],W[23],W[9],W[10],W[11],W[6],W[7],W[8],W[18],W[19],W[20]]);break;case 4:this.qqq.set([W[12],W[13],W[14],W[18],W[19],W[20],W[6],W[7],W[8],W[0],W[1],W[2]]);break;case 5:this.qqq.set([W[3],W[4],W[5],W[9],W[10],W[11],W[21],W[22],W[23],W[15],W[16],W[17]])}var K,Y,Z=this.cvs1,G=this.cvs2;Z.set(this.qqq),Y=0,f.set(Z[9],Z[10],Z[11]),k=(f.x-v.x-N.x)*c.x+(f.y-v.y-N.y)*c.y+(f.z-v.z-N.z)*c.z;for(var h=0;h<4;h++)e=3*h,b.set(Z[e],Z[e+1],Z[e+2]),g=(b.x-v.x-N.x)*c.x+(b.y-v.y-N.y)*c.y+(b.z-v.z-N.z)*c.z,k>0?g>0?(e=3*Y,Y++,G[e]=b.x,G[e+1]=b.y,G[e+2]=b.z):(e=3*Y,Y++,J=k/(k-g),G[e]=f.x+(b.x-f.x)*J,G[e+1]=f.y+(b.y-f.y)*J,G[e+2]=f.z+(b.z-f.z)*J):g>0&&(e=3*Y,Y++,J=k/(k-g),G[e]=f.x+(b.x-f.x)*J,G[e+1]=f.y+(b.y-f.y)*J,G[e+2]=f.z+(b.z-f.z)*J,e=3*Y,Y++,G[e]=b.x,G[e+1]=b.y,G[e+2]=b.z),f.copy(b),k=g;if(K=Y,0!==K){for(Y=0,e=3*(K-1),f.set(G[e],G[e+1],G[e+2]),k=(f.x-v.x-w.x)*p.x+(f.y-v.y-w.y)*p.y+(f.z-v.z-w.z)*p.z,h=0;h<K;h++)e=3*h,b.set(G[e],G[e+1],G[e+2]),g=(b.x-v.x-w.x)*p.x+(b.y-v.y-w.y)*p.y+(b.z-v.z-w.z)*p.z,k>0?g>0?(e=3*Y,Y++,Z[e]=b.x,Z[e+1]=b.y,Z[e+2]=b.z):(e=3*Y,Y++,J=k/(k-g),Z[e]=f.x+(b.x-f.x)*J,Z[e+1]=f.y+(b.y-f.y)*J,Z[e+2]=f.z+(b.z-f.z)*J):g>0&&(e=3*Y,Y++,J=k/(k-g),Z[e]=f.x+(b.x-f.x)*J,Z[e+1]=f.y+(b.y-f.y)*J,Z[e+2]=f.z+(b.z-f.z)*J,e=3*Y,Y++,Z[e]=b.x,Z[e+1]=b.y,Z[e+2]=b.z),f.copy(b),k=g;if(K=Y,0!=K){for(Y=0,e=3*(K-1),f.set(Z[e],Z[e+1],Z[e+2]),k=(f.x-v.x+N.x)*-c.x+(f.y-v.y+N.y)*-c.y+(f.z-v.z+N.z)*-c.z,h=0;h<K;h++)e=3*h,b.set(Z[e],Z[e+1],Z[e+2]),g=(b.x-v.x+N.x)*-c.x+(b.y-v.y+N.y)*-c.y+(b.z-v.z+N.z)*-c.z,k>0?g>0?(e=3*Y,Y++,G[e]=b.x,G[e+1]=b.y,G[e+2]=b.z):(e=3*Y,Y++,J=k/(k-g),G[e]=f.x+(b.x-f.x)*J,G[e+1]=f.y+(b.y-f.y)*J,G[e+2]=f.z+(b.z-f.z)*J):g>0&&(e=3*Y,Y++,J=k/(k-g),G[e]=f.x+(b.x-f.x)*J,G[e+1]=f.y+(b.y-f.y)*J,G[e+2]=f.z+(b.z-f.z)*J,e=3*Y,Y++,G[e]=b.x,G[e+1]=b.y,G[e+2]=b.z),f.copy(b),k=g;if(K=Y,0!=K){for(Y=0,e=3*(K-1),f.set(G[e],G[e+1],G[e+2]),k=(f.x-v.x+w.x)*-p.x+(f.y-v.y+w.y)*-p.y+(f.z-v.z+w.z)*-p.z,h=0;h<K;h++)e=3*h,b.set(G[e],G[e+1],G[e+2]),g=(b.x-v.x+w.x)*-p.x+(b.y-v.y+w.y)*-p.y+(b.z-v.z+w.z)*-p.z,k>0?g>0?(e=3*Y,Y++,Z[e]=b.x,Z[e+1]=b.y,Z[e+2]=b.z):(e=3*Y,Y++,J=k/(k-g),Z[e]=f.x+(b.x-f.x)*J,Z[e+1]=f.y+(b.y-f.y)*J,Z[e+2]=f.z+(b.z-f.z)*J):g>0&&(e=3*Y,Y++,J=k/(k-g),Z[e]=f.x+(b.x-f.x)*J,Z[e+1]=f.y+(b.y-f.y)*J,Z[e+2]=f.z+(b.z-f.z)*J,e=3*Y,Y++,Z[e]=b.x,Z[e+1]=b.y,Z[e+2]=b.z),f.copy(b),k=g;if(K=Y,F){var $=a;a=o,o=$}if(0!=K){var tt=a!=t;if(K>4){f.x=.25*(this.qqq[0]+this.qqq[3]+this.qqq[6]+this.qqq[9]),f.y=.25*(this.qqq[1]+this.qqq[4]+this.qqq[7]+this.qqq[10]),f.z=.25*(this.qqq[2]+this.qqq[5]+this.qqq[8]+this.qqq[11]),c.x=this.qqq[0]-f.x,c.y=this.qqq[1]-f.y,c.z=this.qqq[2]-f.z,p.x=this.qqq[3]-f.x,p.y=this.qqq[4]-f.y,p.z=this.qqq[5]-f.z;var it=0,st=0,ht=0,et=0,at=-this.INF;for(H=this.INF,h=0;h<K;h++)this.used[h]=!1,e=3*h,f.x=Z[e],f.y=Z[e+1],f.z=Z[e+2],X=f.x*c.x+f.y*c.y+f.z*c.z,X<H&&(H=X,it=h),X>at&&(at=X,ht=h);for(this.used[it]=!0,this.used[ht]=!0,at=-this.INF,H=this.INF,h=0;h<K;h++)this.used[h]||(e=3*h,f.x=Z[e],f.y=Z[e+1],f.z=Z[e+2],X=f.x*p.x+f.y*p.y+f.z*p.z,X<H&&(H=X,st=h),X>at&&(at=X,et=h));e=3*it,f.set(Z[e],Z[e+1],Z[e+2]),r.copy(f),X=(f.x-v.x)*n.x+(f.y-v.y)*n.y+(f.z-v.z)*n.z,X<0&&s.addPointVec(r,n,X,tt),e=3*st,f.set(Z[e],Z[e+1],Z[e+2]),r.copy(f),X=(f.x-v.x)*n.x+(f.y-v.y)*n.y+(f.z-v.z)*n.z,X<0&&s.addPointVec(r,n,X,tt),e=3*ht,f.set(Z[e],Z[e+1],Z[e+2]),r.copy(f),X=(f.x-v.x)*n.x+(f.y-v.y)*n.y+(f.z-v.z)*n.z,X<0&&s.addPointVec(r,n,X,tt),e=3*et,f.set(Z[e],Z[e+1],Z[e+2]),r.copy(f),X=(f.x-v.x)*n.x+(f.y-v.y)*n.y+(f.z-v.z)*n.z,X<0&&s.addPointVec(r,n,X,tt)}else for(h=0;h<K;h++)e=3*h,f.set(Z[e],Z[e+1],Z[e+2]),r.copy(f),X=(f.x-v.x)*n.x+(f.y-v.y)*n.y+(f.z-v.z)*n.z,X<0&&s.addPointVec(r,n,X,tt)}}}}}}}),ht.prototype=Object.assign(Object.create(it.prototype),{constructor:ht,getSep:function(t,i,s,h,a){var o,n,r,l,m,c,p,y,u,x,d,z,f,b=new e,v=t.position.x,N=t.position.y,w=t.position.z,k=i.position.x,g=i.position.y,M=i.position.z,I=k-v,S=g-N,P=M-w;I*I+S*S+P*P==0&&(S=.001);var L=-I,V=-S,T=-P;this.supportPointB(t,-L,-V,-T,b);var q=b.x,A=b.y,O=b.z;this.supportPointC(i,L,V,T,b);var E=b.x,j=b.y,D=b.z,C=E-q,B=j-A,F=D-O;if(C*L+B*V+F*T<=0)return!1;if(L=B*P-F*S,V=F*I-C*P,T=C*S-B*I,L*L+V*V+T*T==0)return s.set(C-I,B-S,F-P).normalize(),h.set(.5*(q+E),.5*(A+j),.5*(O+D)),!0;this.supportPointB(t,-L,-V,-T,b);var U=b.x,R=b.y,_=b.z;this.supportPointC(i,L,V,T,b);var J=b.x,W=b.y,H=b.z,X=J-U,Q=W-R,K=H-_;if(X*L+Q*V+K*T<=0)return!1;o=C-I,n=B-S,r=F-P,l=X-I,m=Q-S,c=K-P,L=n*c-r*m,V=r*l-o*c,T=o*m-n*l,L*I+V*S+T*P>0&&(o=C,n=B,r=F,C=X,B=Q,F=K,X=o,Q=n,K=r,o=q,n=A,r=O,q=U,A=R,O=_,U=o,R=n,_=r,o=E,n=j,r=D,E=J,j=W,D=H,J=o,W=n,H=r,L=-L,V=-V,T=-T);for(var Y=0;;){if(++Y>100)return!1;this.supportPointB(t,-L,-V,-T,b);var Z=b.x,G=b.y,$=b.z;this.supportPointC(i,L,V,T,b);var tt=b.x,it=b.y,st=b.z,ht=tt-Z,et=it-G,at=st-$;if(ht*L+et*V+at*T<=0)return!1;if((B*at-F*et)*I+(F*ht-C*at)*S+(C*et-B*ht)*P<0)X=ht,Q=et,K=at,U=Z,R=G,_=$,J=tt,W=it,H=st,o=C-I,n=B-S,r=F-P,l=ht-I,m=et-S,c=at-P,L=n*c-r*m,V=r*l-o*c,T=o*m-n*l;else if((et*K-at*Q)*I+(at*X-ht*K)*S+(ht*Q-et*X)*P<0)C=ht,B=et,F=at,q=Z,A=G,O=$,E=tt,j=it,D=st,o=ht-I,n=et-S,r=at-P,l=X-I,m=Q-S,c=K-P,L=n*c-r*m,V=r*l-o*c,T=o*m-n*l;else for(var ot=!1;;){if(o=X-C,n=Q-B,r=K-F,l=ht-C,m=et-B,c=at-F,L=n*c-r*m,V=r*l-o*c,T=o*m-n*l,p=1/jt.sqrt(L*L+V*V+T*T),L*=p,V*=p,T*=p,L*C+V*B+T*F>=0&&!ot){var nt=(B*K-F*Q)*ht+(F*X-C*K)*et+(C*Q-B*X)*at,rt=(et*K-at*Q)*I+(at*X-ht*K)*S+(ht*Q-et*X)*P,lt=(S*F-P*B)*ht+(P*C-I*F)*et+(I*B-S*C)*at,mt=(Q*F-K*B)*I+(K*C-X*F)*S+(X*B-Q*C)*P,ct=nt+rt+lt+mt;ct<=0&&(nt=0,rt=(Q*at-K*et)*L+(K*ht-X*at)*V+(X*et-Q*ht)*T,lt=(et*K-at*Q)*L+(at*X-ht*K)*V+(ht*Q-et*X)*T,mt=(B*K-F*Q)*L+(F*X-C*K)*V+(C*Q-B*X)*T,ct=rt+lt+mt);var pt=1/ct;y=(v*nt+q*rt+U*lt+Z*mt)*pt,u=(N*nt+A*rt+R*lt+G*mt)*pt,x=(w*nt+O*rt+_*lt+$*mt)*pt,d=(k*nt+E*rt+J*lt+tt*mt)*pt,z=(g*nt+j*rt+W*lt+it*mt)*pt,f=(M*nt+D*rt+H*lt+st*mt)*pt,ot=!0}this.supportPointB(t,-L,-V,-T,b);var yt=b.x,ut=b.y,xt=b.z;this.supportPointC(i,L,V,T,b);var dt=b.x,zt=b.y,ft=b.z,bt=dt-yt,vt=zt-ut,Nt=ft-xt,wt=-(bt*L+vt*V+Nt*T);if((bt-ht)*L+(vt-et)*V+(Nt-at)*T<=.01||wt>=0)return!!ot&&(s.set(-L,-V,-T),h.set(.5*(y+d),.5*(u+z),.5*(x+f)),a.x=wt,!0);(vt*F-Nt*B)*I+(Nt*C-bt*F)*S+(bt*B-vt*C)*P<0?(vt*K-Nt*Q)*I+(Nt*X-bt*K)*S+(bt*Q-vt*X)*P<0?(C=bt,B=vt,F=Nt,q=yt,A=ut,O=xt,E=dt,j=zt,D=ft):(ht=bt,et=vt,at=Nt,Z=yt,G=ut,$=xt,tt=dt,it=zt,st=ft):(vt*at-Nt*et)*I+(Nt*ht-bt*at)*S+(bt*et-vt*ht)*P<0?(X=bt,Q=vt,K=Nt,U=yt,R=ut,_=xt,J=dt,W=zt,H=ft):(C=bt,B=vt,F=Nt,q=yt,A=ut,O=xt,E=dt,j=zt,D=ft)}}},supportPointB:function(t,i,s,h,e){var a,o,n,r=t.rotation.elements,l=r[0]*i+r[3]*s+r[6]*h,m=r[1]*i+r[4]*s+r[7]*h,c=r[2]*i+r[5]*s+r[8]*h,p=t.halfWidth,y=t.halfHeight,u=t.halfDepth;a=l<0?-p:p,o=m<0?-y:y,n=c<0?-u:u,l=r[0]*a+r[1]*o+r[2]*n+t.position.x,m=r[3]*a+r[4]*o+r[5]*n+t.position.y,c=r[6]*a+r[7]*o+r[8]*n+t.position.z,e.set(l,m,c)},supportPointC:function(t,i,s,h,e){var a,o,n,r=t.rotation.elements,l=r[0]*i+r[3]*s+r[6]*h,m=r[1]*i+r[4]*s+r[7]*h,c=r[2]*i+r[5]*s+r[8]*h,p=l,y=c,u=p*p+y*y,x=t.radius,d=t.halfHeight;0==u?m<0?(a=x,o=-d,n=0):(a=x,o=d,n=0):(u=t.radius/jt.sqrt(u),m<0?(a=p*u,o=-d,n=y*u):(a=p*u,o=d,n=y*u)),l=r[0]*a+r[1]*o+r[2]*n+t.position.x,m=r[3]*a+r[4]*o+r[5]*n+t.position.y,c=r[6]*a+r[7]*o+r[8]*n+t.position.z,e.set(l,m,c)},detectCollision:function(t,i,s){var h,a;this.flip?(h=i,a=t):(h=t,a=i);var o=new e,n=new e,r=new e;if(this.getSep(h,a,o,n,r)){var l=h.position.x,m=h.position.y,c=h.position.z,p=a.position.x,y=a.position.y,u=a.position.z,x=h.halfWidth,d=h.halfHeight,z=h.halfDepth,f=a.halfHeight,b=a.radius,v=h.dimentions,N=v[0],w=v[1],k=v[2],g=v[3],M=v[4],I=v[5],S=v[6],P=v[7],L=v[8],V=v[9],T=v[10],q=v[11],A=v[12],O=v[13],E=v[14],j=v[15],D=v[16],C=v[17],B=a.normalDirection.x,F=a.normalDirection.y,U=a.normalDirection.z,R=a.halfDirection.x,_=a.halfDirection.y,J=a.halfDirection.z,W=o.x,H=o.y,X=o.z,Q=W*N+H*w+X*k,K=W*g+H*M+X*I,Y=W*S+H*P+X*L,Z=W*B+H*F+X*U,G=Q>0,$=K>0,tt=Y>0,it=Z>0;G||(Q=-Q),$||(K=-K),tt||(Y=-Y),it||(Z=-Z);var st=0;Z>.999?st=Q>.999?Q>Z?1:4:K>.999?K>Z?2:4:Y>.999&&Y>Z?3:4:Q>.999?st=1:K>.999?st=2:Y>.999&&(st=3);var ht,et,at,ot,nt,rt,lt,mt,ct,pt,yt,ut,xt,dt,zt,ft,bt,vt,Nt,wt,kt,gt,Mt,It,St,Pt,Lt,Vt,Tt,qt,At,Ot,Et,Dt,Ct,Bt,Ft,Ut,Rt,_t,Jt,Wt,Ht,Xt,Qt,Kt,Yt,Zt,Gt,$t,ti,ii,si;if(0==st)s.addPoint(n.x,n.y,n.z,W,H,X,r.x,this.flip);else if(4==st){it?(ot=p-R,nt=y-_,rt=u-J,W=-B,H=-F,X=-U):(ot=p+R,nt=y+_,rt=u+J,W=B,H=F,X=U);var hi,ei,ai,oi,ni,ri,li,mi,ci,pi,yi,ui;wt=1,st=0,Ht=N*W+w*H+k*X,Ht<wt&&(wt=Ht,st=0),-Ht<wt&&(wt=-Ht,st=1),Ht=g*W+M*H+I*X,Ht<wt&&(wt=Ht,st=2),-Ht<wt&&(wt=-Ht,st=3),Ht=S*W+P*H+L*X,Ht<wt&&(wt=Ht,st=4),-Ht<wt&&(wt=-Ht,st=5);var xi=h.elements;switch(st){case 0:hi=xi[0],ei=xi[1],ai=xi[2],oi=xi[6],ni=xi[7],ri=xi[8],li=xi[9],mi=xi[10],ci=xi[11],pi=xi[3],yi=xi[4],ui=xi[5];break;case 1:hi=xi[15],ei=xi[16],ai=xi[17],oi=xi[21],ni=xi[22],ri=xi[23],li=xi[18],mi=xi[19],ci=xi[20],pi=xi[12],yi=xi[13],ui=xi[14];break;case 2:hi=xi[12],ei=xi[13],ai=xi[14],oi=xi[0],ni=xi[1],ri=xi[2],li=xi[3],mi=xi[4],ci=xi[5],pi=xi[15],yi=xi[16],ui=xi[17];break;case 3:hi=xi[21],ei=xi[22],ai=xi[23],oi=xi[9],ni=xi[10],ri=xi[11],li=xi[6],mi=xi[7],ci=xi[8],pi=xi[18],yi=xi[19],ui=xi[20];break;case 4:hi=xi[12],ei=xi[13],ai=xi[14],oi=xi[18],ni=xi[19],ri=xi[20],li=xi[6],mi=xi[7],ci=xi[8],pi=xi[0],yi=xi[1],ui=xi[2];break;case 5:hi=xi[3],ei=xi[4],ai=xi[5],oi=xi[9],ni=xi[10],ri=xi[11],li=xi[21],mi=xi[22],ci=xi[23],pi=xi[15],yi=xi[16],ui=xi[17]}Nt=W*(hi-ot)+H*(ei-nt)+X*(ai-rt),Nt<=0&&s.addPoint(hi,ei,ai,-W,-H,-X,Nt,this.flip),Nt=W*(oi-ot)+H*(ni-nt)+X*(ri-rt),Nt<=0&&s.addPoint(oi,ni,ri,-W,-H,-X,Nt,this.flip),Nt=W*(li-ot)+H*(mi-nt)+X*(ci-rt),Nt<=0&&s.addPoint(li,mi,ci,-W,-H,-X,Nt,this.flip),Nt=W*(pi-ot)+H*(yi-nt)+X*(ui-rt),Nt<=0&&s.addPoint(pi,yi,ui,-W,-H,-X,Nt,this.flip)}else{switch(st){case 1:G?(ht=l+V,et=m+T,at=c+q,W=N,H=w,X=k):(ht=l-V,et=m-T,at=c-q,W=-N,H=-w,X=-k),Kt=g,Yt=M,Zt=I,ii=d,Gt=S,$t=P,ti=L,si=z;break;case 2:$?(ht=l+A,et=m+O,at=c+E,W=g,H=M,X=I):(ht=l-A,et=m-O,at=c-E,W=-g,H=-M,X=-I),Kt=N,Yt=w,Zt=k,ii=x,Gt=S,$t=P,ti=L,si=z;break;case 3:tt?(ht=l+j,et=m+D,at=c+C,W=S,H=P,X=L):(ht=l-j,et=m-D,at=c-C,W=-S,H=-P,X=-L),Kt=N,Yt=w,Zt=k,ii=x,Gt=g,$t=M,ti=I,si=d}if(wt=W*B+H*F+X*U,kt=wt<0?f:-f,ot=p+kt*B,nt=y+kt*F,rt=u+kt*U,Z>=.999999?(gt=-H,Mt=X,It=W):(gt=W,Mt=H,It=X),kt=gt*B+Mt*F+It*U,Pt=kt*B-gt,Lt=kt*F-Mt,Vt=kt*U-It,kt=jt.sqrt(Pt*Pt+Lt*Lt+Vt*Vt),0==kt)return;if(kt=b/kt,Pt*=kt,Lt*=kt,Vt*=kt,gt=ot+Pt,Mt=nt+Lt,It=rt+Vt,wt<-.96||wt>.96)lt=B*B*1.5-.5,mt=B*F*1.5-.866025403*U,ct=B*U*1.5+.866025403*F,pt=F*B*1.5+.866025403*U,yt=F*F*1.5-.5,ut=F*U*1.5-.866025403*B,xt=U*B*1.5-.866025403*F,dt=U*F*1.5+.866025403*B,zt=U*U*1.5-.5,ft=gt,bt=Mt,vt=It,Nt=W*(ft-ht)+H*(bt-et)+X*(vt-at),gt=ft-Nt*W-ht,Mt=bt-Nt*H-et,It=vt-Nt*X-at,Ut=Kt*gt+Yt*Mt+Zt*It,Wt=Gt*gt+$t*Mt+ti*It,Ut<-ii?Ut=-ii:Ut>ii&&(Ut=ii),Wt<-si?Wt=-si:Wt>si&&(Wt=si),gt=Ut*Kt+Wt*Gt,Mt=Ut*Yt+Wt*$t,It=Ut*Zt+Wt*ti,ft=ht+gt,bt=et+Mt,vt=at+It,s.addPoint(ft,bt,vt,W,H,X,Nt,this.flip),ft=Pt*lt+Lt*mt+Vt*ct,bt=Pt*pt+Lt*yt+Vt*ut,vt=Pt*xt+Lt*dt+Vt*zt,ft=(Pt=ft)+ot,bt=(Lt=bt)+nt,vt=(Vt=vt)+rt,Nt=W*(ft-ht)+H*(bt-et)+X*(vt-at),Nt<=0&&(gt=ft-Nt*W-ht,Mt=bt-Nt*H-et,It=vt-Nt*X-at,Ut=Kt*gt+Yt*Mt+Zt*It,Wt=Gt*gt+$t*Mt+ti*It,Ut<-ii?Ut=-ii:Ut>ii&&(Ut=ii),Wt<-si?Wt=-si:Wt>si&&(Wt=si),gt=Ut*Kt+Wt*Gt,Mt=Ut*Yt+Wt*$t,It=Ut*Zt+Wt*ti,ft=ht+gt,bt=et+Mt,vt=at+It,s.addPoint(ft,bt,vt,W,H,X,Nt,this.flip)),ft=Pt*lt+Lt*mt+Vt*ct,bt=Pt*pt+Lt*yt+Vt*ut,vt=Pt*xt+Lt*dt+Vt*zt,ft=(Pt=ft)+ot,bt=(Lt=bt)+nt,vt=(Vt=vt)+rt,Nt=W*(ft-ht)+H*(bt-et)+X*(vt-at),Nt<=0&&(gt=ft-Nt*W-ht,Mt=bt-Nt*H-et,It=vt-Nt*X-at,Ut=Kt*gt+Yt*Mt+Zt*It,Wt=Gt*gt+$t*Mt+ti*It,Ut<-ii?Ut=-ii:Ut>ii&&(Ut=ii),Wt<-si?Wt=-si:Wt>si&&(Wt=si),gt=Ut*Kt+Wt*Gt,Mt=Ut*Yt+Wt*$t,It=Ut*Zt+Wt*ti,ft=ht+gt,bt=et+Mt,vt=at+It,s.addPoint(ft,bt,vt,W,H,X,Nt,this.flip));else{if(Ct=gt,Bt=Mt,Ft=It,Ut=W*(Ct-ht)+H*(Bt-et)+X*(Ft-at),Ct-=Ut*W,Bt-=Ut*H,Ft-=Ut*X,wt>0?(Rt=gt+2*R,_t=Mt+2*_,Jt=It+2*J):(Rt=gt-2*R,_t=Mt-2*_,Jt=It-2*J),Wt=W*(Rt-ht)+H*(_t-et)+X*(Jt-at),Rt-=Wt*W,_t-=Wt*H,Jt-=Wt*X,Tt=Ct-ht,qt=Bt-et,At=Ft-at,Ot=Rt-ht,Et=_t-et,Dt=Jt-at,gt=Rt-Ct,Mt=_t-Bt,It=Jt-Ft,St=Wt-Ut,Q=Tt*Kt+qt*Yt+At*Zt,K=Ot*Kt+Et*Yt+Dt*Zt,Ht=Q-ii,Xt=K-ii,Ht>0){if(Xt>0)return;Qt=Ht/(Ht-Xt),Ct+=gt*Qt,Bt+=Mt*Qt,Ft+=It*Qt,Ut+=St*Qt,Tt=Ct-ht,qt=Bt-et,At=Ft-at,Q=Tt*Kt+qt*Yt+At*Zt,gt=Rt-Ct,Mt=_t-Bt,It=Jt-Ft,St=Wt-Ut}else Xt>0&&(Qt=Ht/(Ht-Xt),Rt=Ct+gt*Qt,_t=Bt+Mt*Qt,Jt=Ft+It*Qt,Wt=Ut+St*Qt,Ot=Rt-ht,Et=_t-et,Dt=Jt-at,K=Ot*Kt+Et*Yt+Dt*Zt,gt=Rt-Ct,Mt=_t-Bt,It=Jt-Ft,St=Wt-Ut);if(Ht=Q+ii,Xt=K+ii,Ht<0){if(Xt<0)return;Qt=Ht/(Ht-Xt),Ct+=gt*Qt,Bt+=Mt*Qt,Ft+=It*Qt,Ut+=St*Qt,Tt=Ct-ht,qt=Bt-et,At=Ft-at,gt=Rt-Ct,Mt=_t-Bt,It=Jt-Ft,St=Wt-Ut}else Xt<0&&(Qt=Ht/(Ht-Xt),Rt=Ct+gt*Qt,_t=Bt+Mt*Qt,Jt=Ft+It*Qt,Wt=Ut+St*Qt,Ot=Rt-ht,Et=_t-et,Dt=Jt-at,gt=Rt-Ct,Mt=_t-Bt,It=Jt-Ft,St=Wt-Ut);if(Q=Tt*Gt+qt*$t+At*ti,K=Ot*Gt+Et*$t+Dt*ti,Ht=Q-si,Xt=K-si,Ht>0){if(Xt>0)return;Qt=Ht/(Ht-Xt),Ct+=gt*Qt,Bt+=Mt*Qt,Ft+=It*Qt,Ut+=St*Qt,Tt=Ct-ht,qt=Bt-et,At=Ft-at,Q=Tt*Gt+qt*$t+At*ti,gt=Rt-Ct,Mt=_t-Bt,It=Jt-Ft,St=Wt-Ut}else Xt>0&&(Qt=Ht/(Ht-Xt),Rt=Ct+gt*Qt,_t=Bt+Mt*Qt,Jt=Ft+It*Qt,Wt=Ut+St*Qt,Ot=Rt-ht,Et=_t-et,Dt=Jt-at,K=Ot*Gt+Et*$t+Dt*ti,gt=Rt-Ct,Mt=_t-Bt,It=Jt-Ft,St=Wt-Ut);if(Ht=Q+si,Xt=K+si,Ht<0){if(Xt<0)return;Qt=Ht/(Ht-Xt),Ct+=gt*Qt,Bt+=Mt*Qt,Ft+=It*Qt,Ut+=St*Qt}else Xt<0&&(Qt=Ht/(Ht-Xt),Rt=Ct+gt*Qt,_t=Bt+Mt*Qt,Jt=Ft+It*Qt,Wt=Ut+St*Qt);Ut<0&&s.addPoint(Ct,Bt,Ft,W,H,X,Ut,this.flip),Wt<0&&s.addPoint(Rt,_t,Jt,W,H,X,Wt,this.flip)}}}}}),et.prototype=Object.assign(Object.create(it.prototype),{constructor:et,crossX:function(t,i,s){return this.tmp3.crossVectors(t,i).scaleVectorEqual(s).addition()},getSep:function(t,i){var s,h,e,a,o,n,r,l,m=this.n,c=this.p,p=this.d,y=this.p1,u=this.p2,x=this.tmp0,d=this.tmp1,z=this.tmp2,f=this.v;if(0===p.lengthSq()&&(p.y=.001),m.copy(p).negate(),this.supportPoint(t,m,d,!0),this.supportPoint(i,m,z),x.sub(z,d),jt.dotVectors(x,m)<=0)return!1;if(m.cross(x,p),0==m.lengthSq())return m.sub(x,p).normalize(),c.add(d,z).scaleEqual(.5),!0;if(this.supportPoint(t,m,f[4],!0),this.supportPoint(i,m,f[5]),f[6].sub(f[5],f[4]),jt.dotVectors(f[6],m)<=0)return!1;f[0].sub(x,p.x),f[1].sub(f[6],p.x),m.crossVectors(f[0],f[1]),m.lengthSq()>0&&(f[0].copy(x),x.copy(f[6]),f[6].copy(f[0]),f[0].copy(d),d.copy(f[4]),f[4].copy(f[0]),f[0].copy(z),z.copy(f[5]),f[5].copy(f[0]),m.negate());for(var b=0;;){if(++b>8)return!1;if(this.supportPoint(t,m,f[7],!0),this.supportPoint(i,m,f[8]),f[9].sub(f[8],f[7]),jt.dotVectors(f[9],m)<=0)return!1;if(this.crossX(x,f[9],p)<0)f[6].copy(f[9]),f[4].copy(f[7]),f[5].copy(f[8]),f[0].sub(x,p),f[1].sub(f[9],p),m.crossVectors(f[0],f[1]);else if(this.crossX(f[9],f[6],p)<0)x.copy(f[9]),d.copy(f[7]),d.copy(f[8]),f[0].sub(f[9],p),f[1].sub(f[6],p),m.crossVectors(f[0],f[1]);else for(var v=!1;;){if(f[0].sub(f[6],x),f[1].sub(f[9],x),m.crossVectors(f[0],f[1]),l=1/m.length(),m.x*=l,m.y*=l,m.z*=l,jt.dotVectors(m,x)>=0&&!v&&(s=this.crossX(x,f[6],f[9]),h=this.crossX(f[9],f[6],p),e=this.crossX(p,x,f[9]),a=this.crossX(f[6],x,p),o=s+h+e+a,o<=0&&(s=0,h=this.crossX(f[6],f[9],m),e=this.crossX(f[9],f[6],m),a=this.crossX(x,f[6],m),o=h+e+a),n=1/o,f[2].set((y.x*s+d.x*h+f[4].x*e+f[7].x*a)*n,(y.y*s+d.y*h+f[4].y*e+f[7].y*a)*n,(y.z*s+d.z*h+f[4].z*e+f[7].z*a)*n),
f[3].set((u.x*s+z.x*h+f[5].x*e+f[8].x*a)*n,(u.y*s+z.y*h+f[5].y*e+f[8].y*a)*n,(u.z*s+z.z*h+f[5].z*e+f[8].z*a)*n),v=!0),this.supportPoint(t,m,f[10],!0),this.supportPoint(i,m,f[11]),f[12].sub(f[11],f[10]),r=-jt.dotVectors(f[12],m),(f[12].x-f[9].x)*m.x+(f[12].y-f[9].y)*m.y+(f[12].z-f[9].z)*m.z<=.01||r>=0)return!!v&&(m.negate(),c.add(f[2],f[3]).scaleEqual(.5),this.sep=r,!0);this.crossX(f[12],x,p)<0?this.crossX(f[12],f[6],p)<0?(x.copy(f[12]),d.copy(f[10]),z.copy(f[11])):(f[9].copy(f[12]),f[7].copy(f[10]),f[8].copy(f[11])):this.crossX(f[12],f[9],p)<0?(f[6].copy(f[12]),f[4].copy(f[10]),f[5].copy(f[11])):(x.copy(f[12]),d.copy(f[10]),z.copy(f[11]))}}return!1},supportPoint:function(t,i,s,h){var a=i.clone(),o=new e;h&&a.negate(),a.applyMatrix3(t.rotation);var n=a.x*a.x+a.z*a.z;0===n?o.set(t.radius,0,0):(n=t.radius/jt.sqrt(n),o.set(a.x*n,0,a.z*n)),o.y=a.y<0?-t.halfHeight:t.halfHeight,a.mulMat(t.rotation,o).addEqual(t.position),s.set(a.x,a.y,a.z)},detectCollision:function(t,i,s){var h,e;t.id<i.id?(h=t,e=i):(h=i,e=t);var a=this.p,o=this.p1,n=this.p2,r=this.n,l=this.n1,m=this.n2,c=this.d1,p=this.d2,y=this.cc1,u=this.cc2,x=this.d,d=this.v,z=this.rtt;o.copy(h.position),n.copy(e.position),l.copy(h.normalDirection),m.copy(e.normalDirection),c.copy(h.halfDirection),p.copy(e.halfDirection),x.sub(n,o);var f,b,v,N,w,k,g=h.halfHeight,M=e.halfHeight,I=h.radius,S=e.radius;if(this.getSep(h,e)){var P=jt.dotVectors(r,l),L=jt.dotVectors(r,m),V=P>0,T=L>0;V||(P=-P),T||(L=-L);var q=0;(P>.999||L>.999)&&(q=P>L?1:2);var A,O,E,j,D,C=this.sep,B=.96,F=1.5,U=.5,R=.866025403;switch(q){case 0:s.addPointVec(a,r,C,!1);break;case 1:if(r.copy(l),V?y.add(o,c):(y.sub(o,c),r.negate()),N=jt.dotVectors(r,m),f=N<0?M:-M,u.x=n.x+f*m.x,u.y=n.y+f*m.y,u.z=n.z+f*m.z,d[0].copy(r),L>=.999999&&(d[0].x=-r.y),f=jt.dotVectors(d[0],m),x.copy(m).scaleEqual(f).subEqual(d[0]),f=x.length(),0===f)break;if(f=S/f,x.scaleEqual(f),d[0].add(u,x),N<-B||N>B)z.set(m.x*m.x*F-U,m.x*m.y*F-m.z*R,m.x*m.z*F+m.y*R,m.y*m.x*F+m.z*R,m.y*m.y*F-U,m.y*m.z*F-m.x*R,m.z*m.x*F-m.y*R,m.z*m.y*F+m.x*R,m.z*m.z*F-U),d[3].copy(d[0]),A=d[5].sub(d[3],y).scaleV(r).addition(),d[0].set(d[3].x-A*r.x-y.x,d[3].y-A*r.y-y.y,d[3].z-A*r.z-y.z),f=d[0].lengthSq(),f>I*I&&(f=I/jt.sqrt(f),d[0].scaleEqual(f)),d[3].add(y,d[0]),s.addPointVec(d[3],r,A,!1),x.applyMatrix3(z),d[3].add(x,u),A=d[5].sub(d[3],y).scaleV(r).addition(),A<=0&&(d[0].set(d[3].x-A*r.x-y.x,d[3].y-A*r.y-y.y,d[3].z-A*r.z-y.z),f=d[0].lengthSq(),f>I*I&&(f=I/jt.sqrt(f),d[0].scaleEqual(f)),d[3].add(y,d[0]),s.addPointVec(d[3],r,A,!1)),x.applyMatrix3(z),d[3].add(x,u),A=d[5].sub(d[3],y).scaleV(r).addition(),A<=0&&(d[0].set(d[3].x-A*r.x-y.x,d[3].y-A*r.y-y.y,d[3].z-A*r.z-y.z),f=d[0].lengthSq(),f>I*I&&(f=I/jt.sqrt(f),d[0].scaleEqual(f)),d[3].add(y,d[0]),s.addPointVec(d[3],r,A,!1));else{if(d[1].copy(d[0]),b=d[5].sub(d[1],y).scaleV(r).addition(),d[1].x-=b*r.x,d[1].y-=b*r.y,d[1].z-=b*r.z,N>0?d[2].add(d[0],m).scaleEqual(2*M):d[2].sub(d[0],m).scaleEqual(2*M),v=d[5].sub(d[2],y).scaleV(r).addition(),d[2].x-=v*r.x,d[2].y-=v*r.y,d[2].z-=v*r.z,x.sub(y,d[1]),d[0].sub(d[2],d[1]),O=x.lengthSq(),E=jt.dotVectors(x,d[0]),j=d[0].lengthSq(),D=E*E-j*(O-I*I),D<0)break;D=jt.sqrt(D),w=(E+D)/j,k=(E-D)/j,k<w&&(f=w,w=k,k=f),k>1&&(k=1),w<0&&(w=0),d[0].x=d[1].x+(d[2].x-d[1].x)*w,d[0].y=d[1].y+(d[2].y-d[1].y)*w,d[0].z=d[1].z+(d[2].z-d[1].z)*w,d[2].x=d[1].x+(d[2].x-d[1].x)*k,d[2].y=d[1].y+(d[2].y-d[1].y)*k,d[2].z=d[1].z+(d[2].z-d[1].z)*k,d[1].x=d[0].x,d[1].y=d[0].y,d[1].z=d[0].z,f=b+(v-b)*w,v=b+(v-b)*k,b=f,b<0&&s.addPointVec(d[1],r,A,!1),v<0&&s.addPointVec(d[2],r,A,!1)}break;case 2:if(r.copy(m),T?(u.sub(n,p),r.negate()):u.add(n,p),N=jt.dotVectors(r,l),f=N<0?g:-g,y.x=o.x+f*l.x,y.y=o.y+f*l.y,y.z=o.z+f*l.z,d[0].copy(r),P>=.999999&&(d[0].x=-r.y),f=jt.dotVectors(d[0],l),x.copy(l).scaleEqual(f).subEqual(d[0]),f=x.length(),0===f)break;if(f=I/f,x.scaleEqual(f),d[0].add(y,x),N<-B||N>B)z.set(l.x*l.x*F-U,l.x*l.y*F-l.z*R,l.x*l.z*F+l.y*R,l.y*l.x*F+l.z*R,l.y*l.y*F-U,l.y*l.z*F-l.x*R,l.z*l.x*F-l.y*R,l.z*l.y*F+l.x*R,l.z*l.z*F-U),d[3].copy(d[0]),A=d[5].sub(d[3],u).scaleV(r).addition(),d[0].set(d[3].x-A*r.x-u.x,d[3].y-A*r.y-u.y,d[3].z-A*r.z-u.z),f=d[0].lengthSq(),f>S*S&&(f=S/jt.sqrt(f),d[0].scaleEqual(f)),d[3].add(u,d[0]),s.addPointVec(d[3],r.negate(),A,!1),x.applyMatrix3(z),d[3].add(x,y),A=d[5].sub(d[3],u).scaleV(r).addition(),A<=0&&(d[0].set(d[3].x-A*r.x-u.x,d[3].y-A*r.y-u.y,d[3].z-A*r.z-u.z),f=d[0].lengthSq(),f>S*S&&(f=S/jt.sqrt(f),d[0].scaleEqual(f)),d[3].add(u,d[0]),s.addPointVec(d[3],r.negate(),A,!1)),x.applyMatrix3(z),d[3].add(x,y),A=d[5].sub(d[3],u).scaleV(r).addition(),A<=0&&(d[0].x=d[3].x-A*r.x-u.x,d[0].y=d[3].y-A*r.y-u.y,d[0].z=d[3].z-A*r.z-u.z,f=d[0].lengthSq(),f>S*S&&(f=S/jt.sqrt(f),d[0].x*=f,d[0].y*=f,d[0].z*=f),d[3].add(u,d[0]),s.addPointVec(d[3],r.negate(),A,!1));else{if(d[1].copy(d[0]),b=d[5].sub(d[1],u).scaleV(r).addition(),d[1].x-=b*r.x,d[1].y-=b*r.y,d[1].z-=b*r.z,N>0?d[2].add(d[0],l).scaleEqual(2*g):d[2].sub(d[0],l).scaleEqual(2*g),v=d[5].sub(d[2],u).scaleV(r).addition(),d[2].x-=v*r.x,d[2].y-=v*r.y,d[2].z-=v*r.z,x.sub(u,d[1]),d[0].sub(d[2],d[1]),O=x.lengthSq(),E=jt.dotVectors(x,d[0]),j=d[0].lengthSq(),D=E*E-j*(O-S*S),D<0)break;D=jt.sqrt(D),w=(E+D)/j,k=(E-D)/j,k<w&&(f=w,w=k,k=f),k>1&&(k=1),w<0&&(w=0),d[4].sub(d[2],d[1]),d[0].copy(d[4]).scaleEqual(w).addEqual(d[1]),d[2].copy(d[4]).scaleEqual(k).addEqual(d[1]),d[1].copy(d[0]),f=b+(v-b)*w,v=b+(v-b)*k,b=f,b<0&&s.addPointVec(d[1],r.negate(),b,!1),v<0&&s.addPointVec(d[2],r.negate(),v,!1)}}}}}),at.prototype=Object.assign(Object.create(it.prototype),{constructor:at,detectCollision:function(t,i,s){var h,e=this.flip?i:t,a=this.flip?t:i,o=this.n,n=this.p,r=this.cc,l=this.cc2,m=a.dimentions,c=a.halfWidth,p=a.halfHeight,y=a.halfDepth,u=e.radius,x=0;this.dix.set(m[0],m[1],m[2]),this.diy.set(m[3],m[4],m[5]),this.diz.set(m[6],m[7],m[8]),o.sub(e.position,a.position),r.set(jt.dotVectors(this.dix,o),jt.dotVectors(this.diy,o),jt.dotVectors(this.diz,o)),r.x>c?r.x=c:r.x<-c?r.x=-c:x=1,r.y>p?r.y=p:r.y<-p?r.y=-p:x|=2,r.z>y?r.z=y:r.z<-y?r.z=-y:x|=4,7===x?(o.set(r.x<0?c+r.x:c-r.x,r.y<0?p+r.y:p-r.y,r.z<0?y+r.z:y-r.z),o.x<o.y?o.x<o.z?(h=o.x-c,r.x<0?(r.x=-c,o.copy(this.dix)):(r.x=c,o.subEqual(this.dix))):(h=o.z-y,r.z<0?(r.z=-y,o.copy(this.diz)):(r.z=y,o.subEqual(this.diz))):o.y<o.z?(h=o.y-p,r.y<0?(r.y=-p,o.copy(this.diy)):(r.y=p,o.subEqual(this.diy))):(h=o.z-y,r.z<0?(r.z=-y,o.copy(this.diz)):(r.z=y,o.subEqual(this.diz))),n.copy(e.position).addScale(o,u),s.addPointVec(n,o,h-u,this.flip)):(l.set(r.x*m[0]+r.y*m[3]+r.z*m[6],r.x*m[1]+r.y*m[4]+r.z*m[7],r.x*m[2]+r.y*m[5]+r.z*m[8]).addEqual(a.position),o.sub(l,e.position),h=o.lengthSq(),h>0&&h<u*u&&(h=jt.sqrt(h),o.scaleEqual(1/h),n.copy(e.position).addScale(o,u),s.addPointVec(n,o,h-u,this.flip)))}}),ot.prototype=Object.assign(Object.create(it.prototype),{constructor:ot,detectCollision:function(t,i,s){var h,e=this.flip?i:t,a=this.flip?t:i,o=this.n,n=this.p,r=this.n2,l=this.cc,m=e.radius,c=a.radius,p=m+c,y=a.halfHeight;o.sub(e.position,a.position);var u=jt.dotVectors(o,a.normalDirection);u<-y-m||u>y+m||(l.copy(a.position).addScale(a.normalDirection,u),r.sub(e.position,l),h=r.lengthSq(),h>p*p||(h>c*c&&(h=c/jt.sqrt(h),r.scaleEqual(h)),u<-y?u=-y:u>y&&(u=y),l.copy(a.position).addScale(a.normalDirection,u).addEqual(r),o.sub(l,e.position),h=o.lengthSq(),h>0&&h<m*m&&(h=jt.sqrt(h),o.scaleEqual(1/h),n.copy(e.position).addScale(o,m),s.addPointVec(n,o,h-m,this.flip))))}}),nt.prototype=Object.assign(Object.create(it.prototype),{constructor:nt,detectCollision:function(t,i,s){var h=this.n,e=this.p,a=t,o=i;h.sub(o.position,a.position);var n=a.radius+o.radius,r=h.lengthSq();r>0&&r<n*n&&(r=jt.sqrt(r),h.scaleEqual(1/r),e.copy(a.position).addScale(h,a.radius),s.addPointVec(e,h,r-n,!1))}}),rt.prototype=Object.assign(Object.create(it.prototype),{constructor:rt,detectCollision:function(t,i,s){var h,e=this.n,a=this.p,o=this.flip?i:t,n=this.flip?t:i,r=o.radius;e.sub(o.position,n.position),e.x*=n.normal.x,e.y*=n.normal.y,e.z*=n.normal.z;var h=e.lengthSq();h>0&&h<r*r&&(h=jt.sqrt(h),e.copy(n.normal).negate(),a.copy(o.position).addScale(e,r),s.addPointVec(a,e,h-r,this.flip))}}),lt.prototype=Object.assign(Object.create(it.prototype),{constructor:lt,detectCollision:function(t,i,s){var h,e=this.n,a=this.p,o=this.cc,n=this.flip?i:t,r=this.flip?t:i,l=n.dimentions,m=n.halfWidth,c=n.halfHeight,p=n.halfDepth,y=0;this.dix.set(l[0],l[1],l[2]),this.diy.set(l[3],l[4],l[5]),this.diz.set(l[6],l[7],l[8]),e.sub(n.position,r.position),e.x*=r.normal.x,e.y*=r.normal.y,e.z*=r.normal.z,o.set(jt.dotVectors(this.dix,e),jt.dotVectors(this.diy,e),jt.dotVectors(this.diz,e)),o.x>m?o.x=m:o.x<-m?o.x=-m:y=1,o.y>c?o.y=c:o.y<-c?o.y=-c:y|=2,o.z>p?o.z=p:o.z<-p?o.z=-p:y|=4,7===y&&(e.set(o.x<0?m+o.x:m-o.x,o.y<0?c+o.y:c-o.y,o.z<0?p+o.z:p-o.z),e.x<e.y?e.x<e.z?(h=e.x-m,o.x<0?(o.x=-m,e.copy(this.dix)):(o.x=m,e.subEqual(this.dix))):(h=e.z-p,o.z<0?(o.z=-p,e.copy(this.diz)):(o.z=p,e.subEqual(this.diz))):e.y<e.z?(h=e.y-c,o.y<0?(o.y=-c,e.copy(this.diy)):(o.y=c,e.subEqual(this.diy))):(h=e.z-p,o.z<0?(o.z=-p,e.copy(this.diz)):(o.z=p,e.subEqual(this.diz))),a.copy(r.position).addScale(e,1),s.addPointVec(a,e,h,this.flip))}}),Object.assign(mt.prototype,{World:!0,play:function(){if(null===this.timer){var t=this;this.timer=setInterval(function(){t.step()},this.timerate)}},stop:function(){null!==this.timer&&(clearInterval(this.timer),this.timer=null)},getInfo:function(){return this.isStat?this.performance.show():""},clear:function(){for(this.stop(),this.preLoop=null,this.postLoop=null,this.randX=65535;this.joints.length>0;)this.removeJoint(this.joints.pop(),!0);for(;this.contacts.length>0;)this.removeContact(this.contacts.pop(),!0);for(;this.rigidBodies.length>0;)this.removeRigidBody(this.rigidBodies.pop(),!0);this.numRigidBodies=0,this.numContacts=0,this.numJoints=0},patchId:function(t){for(var i=t.length;i--;)t[i].setId(i)},addRigidBody:function(t){t.parent&&s("World","It is not possible to be added to more than one world one of the rigid body"),t.setParent(this);for(var i=t.shapes.length;i--;)this.addShape(t.shapes[i]);this.rigidBodies.push(t),this.numRigidBodies++},removeRigidBody:function(t,i){if(t.parent===this){var s;for(t.awake(),s=t.jointLink.length;s--;)this.removeJoint(t.jointLink[s]);for(s=t.shapes.length;s--;)this.removeShape(t.shapes[s]);t.parent=null,i||(this.rigidBodies.splice(t.id,1),this.patchId(this.rigidBodies),this.numRigidBodies--)}},getByName:function(t){var i,s,h;for(i=this.rigidBodies.length;i--;)if(s=this.rigidBodies[i],s.name===t)return s;for(i=this.joints.length;i--;)if(h=this.joints[i],h.name===t)return h;return null},addShape:function(t){t.parent&&t.parent.parent||s("World","It is not possible to be added alone to shape world"),t.proxy=this.broadPhase.createProxy(t),t.updateProxy(),this.broadPhase.addProxy(t.proxy)},removeShape:function(t){this.broadPhase.removeProxy(t.proxy),t.proxy=null},addJoint:function(t){t.parent&&s("World","It is not possible to be added to more than one world one of the joint"),t.setParent(this),t.awake(),t.attach(!0),this.joints.push(t),this.numJoints++},removeJoint:function(t,i){t.parent===this&&(t.awake(),t.detach(!0),t.parent=null,i||(this.joints.splice(t.id,1),this.patchId(this.joints),this.numJoints--))},addContact:function(t,i){var s=new B;s.attach(t,i),s.detector=this.detectors[t.type][i.type],this.contacts.push(s),this.numContacts++},removeContact:function(t,i){void 0===i&&this.contacts.splice(this.contacts.indexOf(t),1),t.detach(),this.numContacts--},getContact:function(t,i){var s,h,e,a,o=null;for(t=t.constructor===F?t.name:t,i=i.constructor===F?i.name:i,e=this.contacts.length;e--;)if(a=this.contacts[e],s=a.body1.name,h=a.body2.name,(s===t&&h===i||h===t&&s===i)&&a.touching){o=a;break}return o},checkContact:function(t,i){for(var s,h,e,a=!1,o=this.contacts.length;o--;)if(e=this.contacts[o],s=e.body1.name,h=e.body2.name,s===t&&h===i||h===t&&s===i){a=e.touching;break}return a},callSleep:function(t){return!!t.allowSleep&&(!(t.linearVelocity.lengthSq()>.04)&&!(t.angularVelocity.lengthSq()>.25))},step:function(){null!==this.preLoop&&this.preLoop();var t=this.isStat;t&&this.performance.setTime(0);var i,s,h,a,o,n,r,l,m;for(a=this.rigidBodies.length;a--;)i=this.rigidBodies[a],i.addedToIsland=!1,i.sleeping&&i.testWakeUp();t&&this.performance.setTime(1),this.broadPhase.detectPairs();var c,p,y,u,x,d,z,f,h,b,v,N=this.broadPhase.pairs;for(a=N.length;a--;){for(p=N[a],c=p.shape1.id<p.shape2.id,y=c?p.shape1:p.shape2,u=c?p.shape2:p.shape1,d=y.contactLink.length,z=u.contactLink.length,x=d<z?y.contactLink:u.contactLink,f=!1,o=x.length;o--;)if(h=x[o].contact,h.shape1===y&&h.shape2===u){h.persisting=!0,f=!0;break}f||this.addContact(y,u)}for(t&&this.performance.calcBroadPhase(),this.numContactPoints=0,a=this.contacts.length;a--;)h=this.contacts[a],h.persisting||!h.shape1.aabb.intersectTest(h.shape2.aabb)?(b=h.body1,v=h.body2,(b.isDynamic&&!b.sleeping||v.isDynamic&&!v.sleeping)&&h.updateManifold(),this.numContactPoints+=h.manifold.numPoints,h.persisting=!1,h.constraint.addedToIsland=!1):this.removeContact(h);t&&this.performance.calcNarrowPhase();var w,k,g,M,I,S,P,L=1/this.timeStep;for(a=this.joints.length;a--;)this.joints[a].addedToIsland=!1;for(this.islandRigidBodies=[],this.islandConstraints=[],this.islandStack=[],t&&this.performance.setTime(1),this.numIslands=0,a=this.rigidBodies.length;a--;)if(s=this.rigidBodies[a],!(s.addedToIsland||s.isStatic||s.sleeping))if(s.isLonely())s.isDynamic&&!s.isKinematic&&s.linearVelocity.addScale(this.gravity,this.timeStep),this.callSleep(s)?(s.sleepTime+=this.timeStep,s.sleepTime>.5?s.sleep():s.updatePosition(this.timeStep)):(s.sleepTime=0,s.updatePosition(this.timeStep)),this.numIslands++;else{k=0,g=0,M=1,this.islandStack[0]=s,s.addedToIsland=!0;do if(i=this.islandStack[--M],this.islandStack[M]=null,i.sleeping=!1,this.islandRigidBodies[k++]=i,!i.isStatic){for(o=i.contactLink.length;o--;)r=i.contactLink[o],h=r.contact,w=h.constraint,!w.addedToIsland&&h.touching&&(this.islandConstraints[g++]=w,w.addedToIsland=!0,m=r.body,m.addedToIsland||(this.islandStack[M++]=m,m.addedToIsland=!0));for(n=i.jointLink.length;n--;)l=i.jointLink[n],w=l.joint,w.addedToIsland||(this.islandConstraints[g++]=w,w.addedToIsland=!0,m=l.body,!m.addedToIsland&&m.isDynamic&&(this.islandStack[M++]=m,m.addedToIsland=!0))}while(0!=M);for(I=(new e).addScale(this.gravity,this.timeStep),o=k;o--;)i=this.islandRigidBodies[o],i.isDynamic&&!i.isKinematic&&i.linearVelocity.addEqual(I);if(this.enableRandomizer)for(o=g;o--;)o>0&&(S=(this.randX=this.randX*this.randA+this.randB&2147483647)/2147483648*o|0,w=this.islandConstraints[o],this.islandConstraints[o]=this.islandConstraints[S],this.islandConstraints[S]=w);for(o=g;o--;)this.islandConstraints[o].preSolve(this.timeStep,L);for(n=this.numIterations;n--;)for(o=g;o--;)this.islandConstraints[o].solve();for(o=g;o--;)this.islandConstraints[o].postSolve(),this.islandConstraints[o]=null;for(P=10,o=k;o--;)i=this.islandRigidBodies[o],this.callSleep(i)?(i.sleepTime+=this.timeStep,i.sleepTime<P&&(P=i.sleepTime)):(i.sleepTime=0,P=0);if(P>.5)for(o=k;o--;)this.islandRigidBodies[o].sleep(),this.islandRigidBodies[o]=null;else for(o=k;o--;)this.islandRigidBodies[o].updatePosition(this.timeStep),this.islandRigidBodies[o]=null;this.numIslands++}t&&this.performance.calcEnd(),null!==this.postLoop&&this.postLoop()},add:function(t){t=t||{};var i=t.type||"box";i.constructor===String&&(i=[i]);var s="joint"===i[0].substring(0,5);return s?this.initJoint(i[0],t):this.initBody(i,t)},initBody:function(t,i){var s=this.invScale,h=i.move||!1,n=i.kinematic||!1,r=i.pos||[0,0,0];r=r.map(function(t){return t*s});var l=void 0===i.size?[1,1,1]:i.size;1==l.length&&(l[1]=l[0]),2==l.length&&(l[2]=l[0]),l=l.map(function(t){return t*s});var u=i.rot||[0,0,0];u=u.map(function(t){return t*jt.degtorad});var d=new x;void 0!==i.density&&(d.density=i.density),void 0!==i.friction&&(d.friction=i.friction),void 0!==i.restitution&&(d.restitution=i.restitution),void 0!==i.belongsTo&&(d.belongsTo=i.belongsTo),void 0!==i.collidesWith&&(d.collidesWith=i.collidesWith),void 0!==i.config&&(void 0!==i.config[0]&&(d.density=i.config[0]),void 0!==i.config[1]&&(d.friction=i.config[1]),void 0!==i.config[2]&&(d.restitution=i.config[2]),void 0!==i.config[3]&&(d.belongsTo=i.config[3]),void 0!==i.config[4]&&(d.collidesWith=i.config[4])),i.massPos&&(i.massPos=i.massPos.map(function(t){return t*s}),d.relativePosition.set(i.massPos[0],i.massPos[1],i.massPos[2])),i.massRot&&(i.massRot=i.massRot.map(function(t){return t*degtorad}),d.relativeRotation=jt.EulerToMatrix(i.massRot[0],i.massRot[1],i.massRot[2]));for(var z,f=new e(r[0],r[1],r[2]),b=(new a).setFromEuler(u[0],u[1],u[2]),v=new F(f,b,this.scale,this.invScale),N=[],w=0;w<t.length;w++){switch(z=3*w,t[w]){case"sphere":N[w]=new c(d,l[z]);break;case"cylinder":N[w]=new p(d,l[z],l[z+1]);break;case"box":N[w]=new m(d,l[z],l[z+1],l[z+2]);break;case"plane":N[w]=new y(d)}if(v.addShape(N[w]),w>0&&(r[z]&&(N[w].relativePosition=new e(r[z],r[z+1],r[z+2])),u[z])){var k=(new a).setFromEuler(u[z],u[z+1],u[z+2]);N[w].relativeRotation=(new o).setQuat(k)}}return i.neverSleep||n?v.allowSleep=!1:v.allowSleep=!0,v.isKinematic=n,h?i.massPos||i.massRot?v.setupMass(zt,!1):v.setupMass(zt,!0):v.setupMass(ft),void 0!==i.name&&(v.name=i.name),this.addRigidBody(v),h&&(i.sleep?v.sleep():v.awake()),v},initJoint:function(t,i){var h=this.invScale,e=i.axe1||[1,0,0],a=i.axe2||[1,0,0],o=i.pos1||[0,0,0],n=i.pos2||[0,0,0];o=o.map(function(t){return t*h}),n=n.map(function(t){return t*h});var r,l;"jointDistance"===t?(r=i.min||0,l=i.max||10,r*=h,l*=h):(r=i.min||57.29578,l=i.max||0,r*=jt.degtorad,l*=jt.degtorad);var m=i.limit||null,c=i.spring||null,p=i.motor||null,y=new T;y.scale=this.scale,y.invScale=this.invScale,y.allowCollision=i.collision||!1,y.localAxis1.set(e[0],e[1],e[2]),y.localAxis2.set(a[0],a[1],a[2]),y.localAnchorPoint1.set(o[0],o[1],o[2]),y.localAnchorPoint2.set(n[0],n[1],n[2]);var u=null,x=null;if(void 0===i.body1||void 0===i.body2)return s("World","Can't add joint if attach rigidbodys not define !");if(i.body1.constructor===String?u=this.getByName(i.body1):i.body1.constructor===Number?u=this.getByName(i.body1):i.body1.constructor===F&&(u=i.body1),i.body2.constructor===String?x=this.getByName(i.body2):i.body2.constructor===Number?x=this.getByName(i.body2):i.body2.constructor===F&&(x=i.body2),null===u||null===x)return s("World","Can't add joint attach rigidbodys not find !");y.body1=u,y.body2=x;var d;switch(t){case"jointDistance":d=new M(y,r,l),null!==c&&d.limitMotor.setSpring(c[0],c[1]),null!==p&&d.limitMotor.setMotor(p[0],p[1]);break;case"jointHinge":case"joint":d=new w(y,r,l),null!==c&&d.limitMotor.setSpring(c[0],c[1]),null!==p&&d.limitMotor.setMotor(p[0],p[1]);break;case"jointPrisme":d=new P(y,r,l);break;case"jointSlide":d=new L(y,r,l);break;case"jointBall":d=new k(y);break;case"jointWheel":d=new V(y),null!==m&&d.rotationalLimitMotor1.setLimit(m[0],m[1]),null!==c&&d.rotationalLimitMotor1.setSpring(c[0],c[1]),null!==p&&d.rotationalLimitMotor1.setMotor(p[0],p[1])}return d.name=i.name||"",this.addJoint(d),d}}),t.Math=jt,t.Vec3=e,t.Quat=a,t.Mat33=o,t.Shape=l,t.Box=m,t.Sphere=c,t.Cylinder=p,t.Plane=y,t.Particle=u,t.ShapeConfig=x,t.LimitMotor=d,t.HingeJoint=w,t.BallAndSocketJoint=k,t.DistanceJoint=M,t.PrismaticJoint=P,t.SliderJoint=L,t.WheelJoint=V,t.JointConfig=T,t.RigidBody=F,t.World=mt,t.REVISION=ct,t.BR_NULL=pt,t.BR_BRUTE_FORCE=yt,t.BR_SWEEP_AND_PRUNE=ut,t.BR_BOUNDING_VOLUME_TREE=xt,t.BODY_NULL=dt,t.BODY_DYNAMIC=zt,t.BODY_STATIC=ft,t.BODY_KINEMATIC=bt,t.BODY_GHOST=vt,t.SHAPE_NULL=Nt,t.SHAPE_SPHERE=wt,t.SHAPE_BOX=kt,t.SHAPE_CYLINDER=gt,t.SHAPE_PLANE=Mt,t.SHAPE_PARTICLE=It,t.SHAPE_TETRA=St,t.JOINT_NULL=Pt,t.JOINT_DISTANCE=Lt,t.JOINT_BALL_AND_SOCKET=Vt,t.JOINT_HINGE=Tt,t.JOINT_WHEEL=qt,t.JOINT_SLIDER=At,t.JOINT_PRISMATIC=Ot,t.AABB_PROX=Et,t.printError=s,t.InfoDisplay=h,Object.defineProperty(t,"__esModule",{value:!0})});
