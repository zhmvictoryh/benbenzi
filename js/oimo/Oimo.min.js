"use strict";var OIMO={REVISION:"DEV.1.1.0a",COPY:"Copyright (c) 2012-2013 EL-EMENT saharan"};OIMO.BROAD_PHASE_BRUTE_FORCE=1,OIMO.BROAD_PHASE_SWEEP_AND_PRUNE=2,OIMO.BROAD_PHASE_DYNAMIC_BOUNDING_VOLUME_TREE=3,OIMO.SHAPE_SPHERE=1,OIMO.SHAPE_BOX=2,OIMO.World=function(n,t){var u=n||60,f=t||OIMO.BROAD_PHASE_SWEEP_AND_PRUNE,r,i;this.rigidBodies=null,this.numRigidBodies=0,this.contacts=null,this.unusedContacts=null,this.numContacts=0,this.numContactPoints=0,this.joints=null,this.numJoints=0,this.numIslands=0,this.timeStep=1/u;switch(f){case OIMO.BROAD_PHASE_BRUTE_FORCE:this.broadPhase=new OIMO.BruteForceBroadPhase;break;case OIMO.BROAD_PHASE_SWEEP_AND_PRUNE:this.broadPhase=new OIMO.SAPBroadPhase;break;case OIMO.BROAD_PHASE_DYNAMIC_BOUNDING_VOLUME_TREE:this.broadPhase=new OIMO.DBVTBroadPhase}for(this.numIterations=8,this.gravity=new OIMO.Vec3(0,-9.80665,0),this.performance=new OIMO.Performance,r=3,this.detectors=[],this.detectors.length=3,i=0;i<r;i++)this.detectors[i]=[];this.detectors[OIMO.SHAPE_SPHERE][OIMO.SHAPE_SPHERE]=new OIMO.SphereSphereCollisionDetector,this.detectors[OIMO.SHAPE_SPHERE][OIMO.SHAPE_BOX]=new OIMO.SphereBoxCollisionDetector(!1),this.detectors[OIMO.SHAPE_BOX][OIMO.SHAPE_SPHERE]=new OIMO.SphereBoxCollisionDetector(!0),this.detectors[OIMO.SHAPE_BOX][OIMO.SHAPE_BOX]=new OIMO.BoxBoxCollisionDetector,this.randX=65535,this.randA=98765,this.randB=123456789,this.maxIslandRigidBodies=64,this.islandRigidBodies=[],this.islandStack=[],this.maxIslandConstraints=128,this.islandConstraints=[],this.enableRandomizer=!0},OIMO.World.prototype={constructor:OIMO.World,clear:function(){for(this.randX=65535;this.joints!==null;)this.removeJoint(this.joints);while(this.contacts!==null)this.removeContact(this.contacts);while(this.rigidBodies!==null)this.removeRigidBody(this.rigidBodies);OIMO.nextID=0},addRigidBody:function(n){if(n.parent)throw new Error("It is not possible to be added to more than one world one of the rigid body");n.parent=this,n.awake();for(var t=n.shapes;t!=null;t=t.next)this.addShape(t);this.rigidBodies!=null&&((this.rigidBodies.prev=n).next=this.rigidBodies),this.rigidBodies=n,this.numRigidBodies++},removeRigidBody:function(n){var t=n,i,e,r,f,u;if(t.parent==this){for(t.awake(),i=t.jointLink;i!=null;)e=i.joint,i=i.next,this.removeJoint(e);for(r=n.shapes;r!=null;r=r.next)this.removeShape(r);f=t.prev,u=t.next,f!=null&&(f.next=u),u!=null&&(u.prev=f),this.rigidBodies==t&&(this.rigidBodies=u),t.prev=null,t.next=null,t.parent=null,this.numRigidBodies--}},addShape:function(n){if(!n.parent||!n.parent.parent)throw new Error("It is not possible to be added alone to shape world");n.proxy=this.broadPhase.createProxy(n),n.updateProxy(),this.broadPhase.addProxy(n.proxy)},removeShape:function(n){this.broadPhase.removeProxy(n.proxy),n.proxy=null},addJoint:function(n){if(n.parent)throw new Error("It is not possible to be added to more than one world one of the joint");this.joints!=null&&((this.joints.prev=n).next=this.joints),this.joints=n,n.parent=this,this.numJoints++,n.awake(),n.attach()},removeJoint:function(n){var t=n,r=t.prev,i=t.next;r!=null&&(r.next=i),i!=null&&(i.prev=r),this.joints==t&&(this.joints=i),t.prev=null,t.next=null,this.numJoints--,t.awake(),t.detach(),t.parent=null},step:function(){for(var s=Date.now(),n=this.rigidBodies,o;n!=null;){if(n.addedToIsland=!1,n.sleeping){var r=n.linearVelocity,u=n.linearVelocity,f=n.position,e=n.sleepPosition,t=n.orientation,i=n.sleepOrientation;(r.x!=0||r.y!=0||r.z!=0||u.x!=0||u.y!=0||u.z!=0||f.x!=e.x||f.y!=e.y||f.z!=e.z||t.s!=i.s||t.x!=i.x||t.y!=i.y||t.z!=i.z)&&n.awake()}n=n.next}this.updateContacts(),this.solveIslands(),o=Date.now(),this.performance.totalTime=o-s,this.performance.updatingTime=this.performance.totalTime-(this.performance.broadPhaseTime+this.performance.narrowPhaseTime+this.performance.solvingTime)},updateContacts:function(){var w=Date.now(),a,v,o,t,u,f,e,s,n,h,i,r,y,c,l,p;for(this.broadPhase.detectPairs(),a=this.broadPhase.pairs,v=this.broadPhase.numPairs,o=0;o<v;o++){for(t=a[o],t.shape1.id<t.shape2.id?(u=t.shape1,f=t.shape2):(u=t.shape2,f=t.shape1),e=u.numContacts<f.numContacts?u.contactLink:f.contactLink,s=!1;e;){if(n=e.contact,n.shape1==u&&n.shape2==f){n.persisting=!0,s=!0;break}e=e.next}s||this.addContact(u,f)}for(h=Date.now(),this.performance.broadPhaseTime=h-w,this.numContactPoints=0,n=this.contacts;n!=null;){if(!n.persisting&&(i=n.shape1.aabb,r=n.shape2.aabb,i.minX>r.maxX||i.maxX<r.minX||i.minY>r.maxY||i.maxY<r.minY||i.minZ>r.maxZ||i.maxZ<r.minZ)){y=n.next,this.removeContact(n),n=y;continue}c=n.body1,l=n.body2,(c.isDynamic&&!c.sleeping||l.isDynamic&&!l.sleeping)&&n.updateManifold(),this.numContactPoints+=n.manifold.numPoints,n.persisting=!1,n.constraint.addedToIsland=!1,n=n.next}p=Date.now(),this.performance.narrowPhaseTime=p-h},addContact:function(n,t){var i;this.unusedContacts!=null?(i=this.unusedContacts,this.unusedContacts=this.unusedContacts.next):i=new OIMO.Contact,i.attach(n,t),i.detector=this.detectors[n.type][t.type],this.contacts&&((this.contacts.prev=i).next=this.contacts),this.contacts=i,this.numContacts++},removeContact:function(n){var i=n.prev,t=n.next;t&&(t.prev=i),i&&(i.next=t),this.contacts==n&&(this.contacts=t),n.prev=null,n.next=null,n.detach(),n.next=this.unusedContacts,this.unusedContacts=n,this.numContacts--},calSleep:function(n){if(!n.allowSleep)return!1;var t=n.linearVelocity;return t.x*t.x+t.y*t.y+t.z*t.z>.04?!1:(t=n.angularVelocity,t.x*t.x+t.y*t.y+t.z*t.z>.25)?!1:!0},solveIslands:function(){for(var k=1/this.timeStep,i,r,tt,a,w,t,e,v,u,o,n,y,p,l,b,s=this.joints;s!=null;s=s.next)s.addedToIsland=!1;for(this.maxIslandRigidBodies<this.numRigidBodies&&(this.maxIslandRigidBodies=this.numRigidBodies<<1,this.islandRigidBodies=[],this.islandStack=[]),a=this.numJoints+this.numContacts,this.maxIslandConstraints<a&&(this.maxIslandConstraints=a<<1,this.islandConstraints=[]),w=Date.now(),this.numIslands=0,t=this.rigidBodies;t!=null;t=t.next)if(!t.addedToIsland&&!t.isStatic&&!t.sleeping){if(t.isLonely()){t.isDynamic&&(t.linearVelocity.x+=this.gravity.x*this.timeStep,t.linearVelocity.y+=this.gravity.y*this.timeStep,t.linearVelocity.z+=this.gravity.z*this.timeStep),this.calSleep(t)?(t.sleepTime+=this.timeStep,t.sleepTime>.5?t.sleep():t.updatePosition(this.timeStep)):(t.sleepTime=0,t.updatePosition(this.timeStep)),this.numIslands++;continue}var h=0,f=0,c=1;this.islandStack[0]=t,t.addedToIsland=!0;do if(i=this.islandStack[--c],this.islandStack[c]=null,i.sleeping=!1,this.islandRigidBodies[h++]=i,!i.isStatic){for(e=i.contactLink;e!=null;e=e.next)(v=e.contact,r=v.constraint,!r.addedToIsland&&v.touching)&&((this.islandConstraints[f++]=r,r.addedToIsland=!0,u=e.body,u.addedToIsland)||(this.islandStack[c++]=u,u.addedToIsland=!0));for(o=i.jointLink;o!=null;o=o.next)(r=o.joint,r.addedToIsland)||(this.islandConstraints[f++]=r,r.addedToIsland=!0,u=o.body,!u.addedToIsland&&u.isDynamic)&&(this.islandStack[c++]=u,u.addedToIsland=!0)}while(c!=0);var d=this.gravity.x*this.timeStep,g=this.gravity.y*this.timeStep,nt=this.gravity.z*this.timeStep;for(n=0;n<h;n++)i=this.islandRigidBodies[n],i.isDynamic&&(i.linearVelocity.x+=d,i.linearVelocity.y+=g,i.linearVelocity.z+=nt);if(this.enableRandomizer)for(n=1;n<f;n++)y=(this.randX=this.randX*this.randA+this.randB&2147483647)/2147483648*n|0,r=this.islandConstraints[n],this.islandConstraints[n]=this.islandConstraints[y],this.islandConstraints[y]=r;for(n=0;n<f;n++)this.islandConstraints[n].preSolve(this.timeStep,k);for(p=0;p<this.numIterations;p++)for(n=0;n<f;n++)this.islandConstraints[n].solve();for(n=0;n<f;n++)this.islandConstraints[n].postSolve(),this.islandConstraints[n]=null;for(l=10,n=0;n<h;n++)if(i=this.islandRigidBodies[n],this.calSleep(i))i.sleepTime+=this.timeStep,i.sleepTime<l&&(l=i.sleepTime);else{i.sleepTime=0,l=0;continue}if(l>.5)for(n=0;n<h;n++)this.islandRigidBodies[n].sleep(),this.islandRigidBodies[n]=null;else for(n=0;n<h;n++)this.islandRigidBodies[n].updatePosition(this.timeStep),this.islandRigidBodies[n]=null;this.numIslands++}b=Date.now(),this.performance.solvingTime=b-w}},OIMO.Performance=function(){this.broadPhaseTime=0,this.narrowPhaseTime=0,this.solvingTime=0,this.updatingTime=0,this.totalTime=0},OIMO.RigidBody=function(n,t,i,r,u,f,e){var a=r||0,s=u||0,h=f||0,c=e||0,y=n||0,p=t||0,w=i||0,o,l,v;this.BODY_DYNAMIC=1,this.BODY_STATIC=2,this.MAX_SHAPES=64,this.prev=null,this.next=null,this.type=0,this.isDynamic=!1,this.isStatic=!1,this.position=null,this.mass=NaN,this.inverseMass=NaN,this.shapes=null,this.numShapes=0,this.parent=null,this.contactLink=null,this.numContacts=0,this.jointLink=null,this.numJoints=0,this.addedToIsland=!1,this.sleeping=!1,this.massInfo=new OIMO.MassInfo,o=s*s+h*h+c*c,this.position=new OIMO.Vec3(y,p,w),o>0&&(o=1/Math.sqrt(o),s*=o,h*=o,c*=o),l=Math.sin(a*.5),v=Math.cos(a*.5),this.orientation=new OIMO.Quat(v,l*s,l*h,l*c),this.linearVelocity=new OIMO.Vec3,this.angularVelocity=new OIMO.Vec3,this.sleepPosition=new OIMO.Vec3,this.sleepOrientation=new OIMO.Quat,this.rotation=new OIMO.Mat33,this.inverseInertia=new OIMO.Mat33,this.localInertia=new OIMO.Mat33,this.inverseLocalInertia=new OIMO.Mat33,this.allowSleep=!0,this.sleepTime=0},OIMO.RigidBody.prototype={constructor:OIMO.RigidBody,addShape:function(n){if(n.parent)throw new Error("It is not possible that you add to the multi-rigid body the shape of one");this.shapes!=null&&((this.shapes.prev=n).next=this.shapes),this.shapes=n,n.parent=this,this.parent&&this.parent.addShape(n),this.numShapes++},removeShape:function(n){var t=n,r,i;t.parent==this&&(r=t.prev,i=t.next,r!=null&&(r.next=i),i!=null&&(i.prev=r),this.shapes==t&&(this.shapes=i),t.prev=null,t.next=null,t.parent=null,this.parent&&this.parent.removeShape(t),this.numShapes--)},setupMass:function(n,t){var v=t||!0,l=n||this.BODY_DYNAMIC,a,e,i;for(this.type=l,this.isDynamic=l==this.BODY_DYNAMIC,this.isStatic=l==this.BODY_STATIC,this.mass=0,this.localInertia.init(0,0,0,0,0,0,0,0,0),a=new OIMO.Mat33,e=new OIMO.Vec3,i=this.shapes;i!=null;i=i.next){i.calculateMassInfo(this.massInfo);var o=this.massInfo.mass,r=i.relativePosition.x,u=i.relativePosition.y,f=i.relativePosition.z;e.x+=r*o,e.y+=u*o,e.z+=f*o,this.mass+=o,this.rotateInertia(i.relativeRotation,this.massInfo.inertia,a),this.localInertia.addEqual(a),this.localInertia.e00+=o*(u*u+f*f),this.localInertia.e11+=o*(r*r+f*f),this.localInertia.e22+=o*(r*r+u*u);var s=o*r*u,h=o*u*f,c=o*f*r;this.localInertia.e01-=s,this.localInertia.e10-=s,this.localInertia.e02-=h,this.localInertia.e20-=h,this.localInertia.e12-=c,this.localInertia.e21-=c}if(this.inverseMass=1/this.mass,e.scaleEqual(this.inverseMass),v){for(this.position.addEqual(e),i=this.shapes;i!=null;i=i.next)i.relativePosition.subEqual(e);r=e.x,u=e.y,f=e.z,this.localInertia.e00-=this.mass*(u*u+f*f),this.localInertia.e11-=this.mass*(r*r+f*f),this.localInertia.e22-=this.mass*(r*r+u*u),s=this.mass*r*u,h=this.mass*u*f,c=this.mass*f*r,this.localInertia.e01+=s,this.localInertia.e10+=s,this.localInertia.e02+=h,this.localInertia.e20+=h,this.localInertia.e12+=c,this.localInertia.e21+=c}this.inverseLocalInertia.invert(this.localInertia),l===this.BODY_STATIC&&(this.inverseMass=0,this.inverseLocalInertia.init(0,0,0,0,0,0,0,0,0)),this.syncShapes(),this.awake()},awake:function(){var n,t,i;if(this.allowSleep&&this.sleeping){for(this.sleeping=!1,this.sleepTime=0,n=this.contactLink;n!=null;)n.body.sleepTime=0,n.body.sleeping=!1,n=n.next;for(t=this.jointLink;t!=null;)t.body.sleepTime=0,t.body.sleeping=!1,t=t.next;for(i=this.shapes;i!=null;i=i.next)i.updateProxy()}},sleep:function(){if(this.allowSleep&&!this.sleeping){this.linearVelocity.x=0,this.linearVelocity.y=0,this.linearVelocity.z=0,this.angularVelocity.x=0,this.angularVelocity.y=0,this.angularVelocity.z=0,this.sleepPosition.x=this.position.x,this.sleepPosition.y=this.position.y,this.sleepPosition.z=this.position.z,this.sleepOrientation.s=this.orientation.s,this.sleepOrientation.x=this.orientation.x,this.sleepOrientation.y=this.orientation.y,this.sleepOrientation.z=this.orientation.z,this.sleepTime=0,this.sleeping=!0;for(var n=this.shapes;n!=null;n=n.next)n.updateProxy()}},isLonely:function(){return this.numJoints==0&&this.numContacts==0},updatePosition:function(n){switch(this.type){case this.BODY_STATIC:this.linearVelocity.x=0,this.linearVelocity.y=0,this.linearVelocity.z=0,this.angularVelocity.x=0,this.angularVelocity.y=0,this.angularVelocity.z=0;break;case this.BODY_DYNAMIC:var f=this.linearVelocity.x,e=this.linearVelocity.y,o=this.linearVelocity.z;this.position.x+=f*n,this.position.y+=e*n,this.position.z+=o*n,f=this.angularVelocity.x,e=this.angularVelocity.y,o=this.angularVelocity.z;var t=this.orientation.s,i=this.orientation.x,r=this.orientation.y,u=this.orientation.z;n*=.5;var s=(-f*i-e*r-o*u)*n,h=(f*t+e*u-o*r)*n,c=(-f*u+e*t+o*i)*n,l=(f*r-e*i+o*t)*n;t+=s,i+=h,r+=c,u+=l,s=1/Math.sqrt(t*t+i*i+r*r+u*u),this.orientation.s=t*s,this.orientation.x=i*s,this.orientation.y=r*s,this.orientation.z=u*s;break;default:throw new Error("Invalid type.");}this.syncShapes()},rotateInertia:function(n,t,i){var r=n.e00,u=n.e01,f=n.e02,e=n.e10,o=n.e11,s=n.e12,h=n.e20,c=n.e21,l=n.e22,a=t.e00,v=t.e01,y=t.e02,p=t.e10,w=t.e11,b=t.e12,k=t.e20,d=t.e21,g=t.e22,nt=r*a+u*p+f*k,tt=r*v+u*w+f*d,it=r*y+u*b+f*g,rt=e*a+o*p+s*k,ut=e*v+o*w+s*d,ft=e*y+o*b+s*g,et=h*a+c*p+l*k,ot=h*v+c*w+l*d,st=h*y+c*b+l*g;i.e00=nt*r+tt*u+it*f,i.e01=nt*e+tt*o+it*s,i.e02=nt*h+tt*c+it*l,i.e10=rt*r+ut*u+ft*f,i.e11=rt*e+ut*o+ft*s,i.e12=rt*h+ut*c+ft*l,i.e20=et*r+ot*u+st*f,i.e21=et*e+ot*o+st*s,i.e22=et*h+ot*c+st*l},syncShapes:function(){var r=this.orientation.s,t=this.orientation.x,u=this.orientation.y,c=this.orientation.z,l=2*t,f=2*u,i=2*c,a=t*l,v=u*f,y=c*i,p=t*f,w=u*i,b=t*i,k=r*l,d=r*f,g=r*i,n;this.rotation.e00=1-v-y,this.rotation.e01=p-g,this.rotation.e02=b+d,this.rotation.e10=p+g,this.rotation.e11=1-a-y,this.rotation.e12=w-k,this.rotation.e20=b-d,this.rotation.e21=w+k,this.rotation.e22=1-a-v;var nt=this.rotation.e00,tt=this.rotation.e01,it=this.rotation.e02,rt=this.rotation.e10,ut=this.rotation.e11,ft=this.rotation.e12,et=this.rotation.e20,ot=this.rotation.e21,st=this.rotation.e22;for(this.rotateInertia(this.rotation,this.inverseLocalInertia,this.inverseInertia),n=this.shapes;n!=null;n=n.next){var e=n.relativePosition,ht=n.relativeRotation,ct=n.rotation,o=e.x,s=e.y,h=e.z;n.position.x=this.position.x+o*nt+s*tt+h*it,n.position.y=this.position.y+o*rt+s*ut+h*ft,n.position.z=this.position.z+o*et+s*ot+h*st,ct.mul(ht,this.rotation),n.updateProxy()}},applyImpulse:function(n,t){this.linearVelocity.x+=t.x*this.inverseMass,this.linearVelocity.y+=t.y*this.inverseMass,this.linearVelocity.z+=t.z*this.inverseMass;var i=new OIMO.Vec3;i.sub(n,this.position).cross(i,t).mulMat(this.inverseInertia,i),this.angularVelocity.x+=i.x,this.angularVelocity.y+=i.y,this.angularVelocity.z+=i.z}},OIMO.AABB=function(n,t,i,r,u,f){this.minX=n||0,this.maxX=t||0,this.minY=i||0,this.maxY=r||0,this.minZ=u||0,this.maxZ=f||0},OIMO.AABB.prototype={constructor:OIMO.AABB,init:function(n,t,i,r,u,f){this.minX=n,this.maxX=t,this.minY=i,this.maxY=r,this.minZ=u,this.maxZ=f},combine:function(n,t){this.minX=n.minX<t.minX?n.minX:t.minX,this.maxX=n.maxX>t.maxX?n.maxX:t.maxX,this.minY=n.minY<t.minY?n.minY:t.minY,this.maxY=n.maxY>t.maxY?n.maxY:t.maxY,this.minZ=n.minZ<t.minZ?n.minZ:t.minZ,this.maxZ=n.maxZ>t.maxZ?n.maxZ:t.maxZ;var i=0;this.minX-=i,this.minY-=i,this.minZ-=i,this.maxX+=i,this.maxY+=i,this.maxZ+=i},surfaceArea:function(){var n=this.maxY-this.minY,t=this.maxZ-this.minZ;return 2*((this.maxX-this.minX)*(n+t)+n*t)},intersectsWithPoint:function(n,t,i){return n>=this.minX&&n<=this.maxX&&t>=this.minY&&t<=this.maxY&&i>=this.minZ&&i<=this.maxZ}},OIMO.Pair=function(){this.shape1=null,this.shape2=null},OIMO.Proxy=function(n){this.shape=n,this.aabb=n.aabb},OIMO.Proxy.prototype={constructor:OIMO.Proxy,update:function(){throw new Error("Inheritance error.");}},OIMO.BasicProxy=function(n){OIMO.Proxy.call(this,n)},OIMO.BasicProxy.prototype=Object.create(OIMO.Proxy.prototype),OIMO.BasicProxy.prototype.update=function(){},OIMO.BroadPhase=function(){this.numPairChecks=0,this.numPairs=0,this.bufferSize=256,this.pairs=[],this.pairs.length=this.bufferSize;for(var n=0;n<this.bufferSize;n++)this.pairs[n]=new OIMO.Pair},OIMO.BroadPhase.prototype={constructor:OIMO.BroadPhase,createProxy:function(){throw new Error("Inheritance error.");},addProxy:function(){throw new Error("Inheritance error.");},removeProxy:function(){throw new Error("Inheritance error.");},isAvailablePair:function(n,t){var i=n.parent,r=t.parent,u,f;if(i==r||!i.isDynamic&&!r.isDynamic||(n.belongsTo&t.collidesWith)==0||(t.belongsTo&n.collidesWith)==0)return!1;for(u=i.numJoints<r.numJoints?i.jointLink:r.jointLink;u!=null;){if(f=u.joint,!f.allowCollision&&(f.body1==i&&f.body2==r||f.body1==r&&f.body2==i))return!1;u=u.next}return!0},detectPairs:function(){while(this.numPairs>0){var n=this.pairs[--this.numPairs];n.shape1=null,n.shape2=null}this.numPairChecks=0,this.collectPairs()},collectPairs:function(){throw new Error("Inheritance error.");},addPair:function(n,t){var u,r,i,f;if(this.numPairs==this.bufferSize){for(u=this.bufferSize<<1,r=[],r.length=this.bufferSize,i=0;i<this.bufferSize;i++)r[i]=this.pairs[i];for(i=this.bufferSize;i<u;i++)r[i]=new OIMO.Pair;this.pairs=r,this.bufferSize=u}f=this.pairs[this.numPairs++],f.shape1=n,f.shape2=t}},OIMO.BruteForceBroadPhase=function(){OIMO.BroadPhase.call(this),this.numProxies=0,this.maxProxies=256,this.proxies=[],this.proxies.length=256},OIMO.BruteForceBroadPhase.prototype=Object.create(OIMO.BroadPhase.prototype),OIMO.BruteForceBroadPhase.prototype.createProxy=function(n){return new OIMO.BasicProxy(n)},OIMO.BruteForceBroadPhase.prototype.addProxy=function(n){var i,t;if(this.numProxies==this.maxProxies){for(this.maxProxies<<=1,i=[],t=0;t<this.numProxies;t++)i[t]=this.proxies[t];this.proxies=i}this.proxies[this.numProxies++]=n},OIMO.BruteForceBroadPhase.prototype.removeProxy=function(n){for(var t=0;t<this.numProxies;t++)if(this.proxies[t]==n){this.proxies[t]=this.proxies[--this.numProxies],this.proxies[this.numProxies]=null;return}},OIMO.BruteForceBroadPhase.prototype.collectPairs=function(){var i,r;for(this.numPairChecks=this.numProxies*(this.numProxies-1)>>1,i=0;i<this.numProxies;i++){var u=this.proxies[i],n=u.aabb,f=u.shape;for(r=i+1;r<this.numProxies;r++){var e=this.proxies[r],t=e.aabb,o=e.shape;n.maxX<t.minX||n.minX>t.maxX||n.maxY<t.minY||n.minY>t.maxY||n.maxZ<t.minZ||n.minZ>t.maxZ||!this.isAvailablePair(f,o)||this.addPair(f,o)}}},OIMO.SAPBroadPhase=function(){OIMO.BroadPhase.call(this),this.numElementsD=0,this.numElementsS=0,this.axesD=[],this.axesS=[],this.axesD.length=3,this.axesS.length=3,this.axesD[0]=new OIMO.SAPAxis,this.axesD[1]=new OIMO.SAPAxis,this.axesD[2]=new OIMO.SAPAxis,this.axesS[0]=new OIMO.SAPAxis,this.axesS[1]=new OIMO.SAPAxis,this.axesS[2]=new OIMO.SAPAxis,this.index1=0,this.index2=1},OIMO.SAPBroadPhase.prototype=Object.create(OIMO.BroadPhase.prototype),OIMO.SAPBroadPhase.prototype.createProxy=function(n){return new OIMO.SAPProxy(this,n)},OIMO.SAPBroadPhase.prototype.addProxy=function(n){var t=n;t.isDynamic()?(this.axesD[0].addElements(t.min[0],t.max[0]),this.axesD[1].addElements(t.min[1],t.max[1]),this.axesD[2].addElements(t.min[2],t.max[2]),t.belongsTo=1,this.numElementsD+=2):(this.axesS[0].addElements(t.min[0],t.max[0]),this.axesS[1].addElements(t.min[1],t.max[1]),this.axesS[2].addElements(t.min[2],t.max[2]),t.belongsTo=2,this.numElementsS+=2)},OIMO.SAPBroadPhase.prototype.removeProxy=function(n){var t=n;if(t.belongsTo!=0){switch(t.belongsTo){case 1:this.axesD[0].removeElements(t.min[0],t.max[0]),this.axesD[1].removeElements(t.min[1],t.max[1]),this.axesD[2].removeElements(t.min[2],t.max[2]),this.numElementsD-=2;break;case 2:this.axesS[0].removeElements(t.min[0],t.max[0]),this.axesS[1].removeElements(t.min[1],t.max[1]),this.axesS[2].removeElements(t.min[2],t.max[2]),this.numElementsS-=2}t.belongsTo=0}},OIMO.SAPBroadPhase.prototype.collectPairs=function(){var i,r,w,b,h,v,u,f,e,c,t,s,y,p,n,o,a;if(this.numElementsD!=0){for(i=this.axesD[this.index1],r=this.axesD[this.index2],i.sort(),r.sort(),w=i.calculateTestCount(),b=r.calculateTestCount(),w<=b?(r=this.axesS[this.index1],r.sort(),h=i.elements,v=r.elements):(i=this.axesS[this.index2],i.sort(),h=r.elements,v=i.elements,this.index1^=this.index2,this.index2^=this.index1,this.index1^=this.index2),e=0,c=0;e<this.numElementsD;)if(c==this.numElementsS?(t=h[e],s=!0,e++):(y=h[e],p=v[c],y.value<p.value?(t=y,s=!0,e++):(t=p,s=!1,c++)),t.max){if(a=t.pair,s)if(a==u){u=u.pair;continue}else t=u;else if(a==f){f=f.pair;continue}else t=f;do{if(n=t.pair,n==a){t.pair=n.pair;break}t=n}while(t!=null)}else{var l=t.proxy.shape,k=t.min1.value,d=t.max1.value,g=t.min2.value,nt=t.max2.value;for(n=u;n!=null;n=n.pair)(o=n.proxy.shape,this.numPairChecks++,k>n.max1.value||d<n.min1.value||g>n.max2.value||nt<n.min2.value||!this.isAvailablePair(l,o))||this.addPair(l,o);if(s){for(n=f;n!=null;n=n.pair)(o=n.proxy.shape,this.numPairChecks++,k>n.max1.value||d<n.min1.value||g>n.max2.value||nt<n.min2.value||!this.isAvailablePair(l,o))||this.addPair(l,o);t.pair=u,u=t}else t.pair=f,f=t}this.index2=(this.index1|this.index2)^3}},OIMO.SAPAxis=function(){this.numElements=0,this.stack=[],this.stack.length=64,this.bufferSize=256,this.elements=[],this.elements.length=this.bufferSize},OIMO.SAPAxis.prototype={constructor:OIMO.SAPAxis,addElements:function(n,t){var r,i;if(this.numElements+2>=this.bufferSize)for(this.bufferSize<<=1,r=[],i=0;i<this.numElements;i++)r[i]=this.elements[i];this.elements[this.numElements++]=n,this.elements[this.numElements++]=t},removeElements:function(n,t){for(var r=-1,u=-1,f,i=0;i<this.numElements;i++)if(f=this.elements[i],f==n||f==t)if(r==-1)r=i;else{u=i;break}for(i=r+1;i<u;i++)this.elements[i-1]=this.elements[i];for(i=u+1;i<this.numElements;i++)this.elements[i-2]=this.elements[i];this.elements[--this.numElements]=null,this.elements[--this.numElements]=null},sort:function(){for(var r=0,c=1,l,t,n,i,u,a,v,y;this.numElements>>c!=0;)c++;for(c=c*this.numElements>>2,r=0,l=!1,t=this.elements,n=1;n<this.numElements;n++){var f=t[n],s=f.value,e=t[n-1];if(e.value>s){i=n;do{if(t[i]=e,--i==0)break;e=t[i-1]}while(e.value>s);if(t[i]=f,r+=n-i,r>c){l=!0;break}}}if(l)for(r=2,u=this.stack,u[0]=0,u[1]=this.numElements-1;r>0;){var o=u[--r],h=u[--r],p=o-h;if(p>16){for(a=h+(p>>1),f=t[a],t[a]=t[o],t[o]=f,s=f.value,n=h-1,i=o;;){do v=t[++n];while(v.value<s);do y=t[--i];while(s<y.value&&i!=h);if(n>=i)break;t[n]=y,t[i]=v}t[o]=t[n],t[n]=f,n-h>o-n?(u[r++]=h,u[r++]=n-1,u[r++]=n+1,u[r++]=o):(u[r++]=n+1,u[r++]=o,u[r++]=h,u[r++]=n-1)}else for(n=h+1;n<=o;n++)if(f=t[n],s=f.value,e=t[n-1],e.value>s){i=n;do{if(t[i]=e,--i==0)break;e=t[i-1]}while(e.value>s);t[i]=f}}},calculateTestCount:function(){for(var t=1,i=0,n=1;n<this.numElements;n++)this.elements[n].max?t--:(i+=t,t++);return i}},OIMO.SAPElement=function(n,t){this.pair=null,this.min1=null,this.max1=null,this.min2=null,this.max2=null,this.proxy=n,this.max=t,this.value=0},OIMO.SAPProxy=function(n,t){OIMO.Proxy.call(this,t),this.belongsTo=0,this.max=[],this.min=[],this.sap=n,this.min[0]=new OIMO.SAPElement(this,!1),this.max[0]=new OIMO.SAPElement(this,!0),this.min[1]=new OIMO.SAPElement(this,!1),this.max[1]=new OIMO.SAPElement(this,!0),this.min[2]=new OIMO.SAPElement(this,!1),this.max[2]=new OIMO.SAPElement(this,!0),this.max[0].pair=this.min[0],this.max[1].pair=this.min[1],this.max[2].pair=this.min[2],this.min[0].min1=this.min[1],this.min[0].max1=this.max[1],this.min[0].min2=this.min[2],this.min[0].max2=this.max[2],this.min[1].min1=this.min[0],this.min[1].max1=this.max[0],this.min[1].min2=this.min[2],this.min[1].max2=this.max[2],this.min[2].min1=this.min[0],this.min[2].max1=this.max[0],this.min[2].min2=this.min[1],this.min[2].max2=this.max[1]},OIMO.SAPProxy.prototype=Object.create(OIMO.Proxy.prototype),OIMO.SAPProxy.prototype.isDynamic=function(){var n=this.shape.parent;return n.isDynamic&&!n.sleeping},OIMO.SAPProxy.prototype.update=function(){this.min[0].value=this.aabb.minX,this.max[0].value=this.aabb.maxX,this.min[1].value=this.aabb.minY,this.max[1].value=this.aabb.maxY,this.min[2].value=this.aabb.minZ,this.max[2].value=this.aabb.maxZ,(this.belongsTo==1&&!this.isDynamic()||this.belongsTo==2&&this.isDynamic())&&(this.sap.removeProxy(this),this.sap.addProxy(this))},OIMO.DBVTProxy=function(n){OIMO.Proxy.call(this,n),this.leaf=new OIMO.DBVTNode,this.leaf.proxy=this},OIMO.DBVTProxy.prototype=Object.create(OIMO.Proxy.prototype),OIMO.DBVTProxy.prototype.update=function(){},OIMO.DBVTNode=function(){this.child1=null,this.child2=null,this.parent=null,this.proxy=null,this.height=0,this.aabb=new OIMO.AABB},OIMO.DBVTBroadPhase=function(){OIMO.BroadPhase.call(this),this.numLeaves=0,this.maxLeaves=0,this.tree=new OIMO.DBVT,this.maxStack=256,this.stack=[],this.maxLeaves=256,this.leaves=[]},OIMO.DBVTBroadPhase.prototype=Object.create(OIMO.BroadPhase.prototype),OIMO.DBVTBroadPhase.prototype.createProxy=function(n){return new OIMO.DBVTProxy(n)},OIMO.DBVTBroadPhase.prototype.addProxy=function(n){var r=n,i,t;if(this.tree.insertLeaf(r.leaf),this.numLeaves==this.maxLeaves){for(this.maxLeaves<<=1,i=[],t=0;t<this.numLeaves;t++)i[t]=this.leaves[t];this.leaves=i}this.leaves[this.numLeaves++]=r.leaf},OIMO.DBVTBroadPhase.prototype.removeProxy=function(n){var i=n,t;for(this.tree.deleteLeaf(i.leaf),t=0;t<this.numLeaves;t++)if(this.leaves[t]==i.leaf){this.leaves[t]=this.leaves[--this.numLeaves],this.leaves[this.numLeaves]=null;return}},OIMO.DBVTBroadPhase.prototype.collectPairs=function(){var u,i;if(!(this.numLeaves<2))for(u=0;u<this.numLeaves;u++){var r=this.leaves[u],n=r.proxy.aabb,t=r.aabb;(n.minX<t.minX||n.maxX>t.maxX||n.minY<t.minY||n.maxY>t.maxY||n.minZ<t.minZ||n.maxZ>t.maxZ)&&(i=.1,this.tree.deleteLeaf(r),t.minX=n.minX-i,t.maxX=n.maxX+i,t.minY=n.minY-i,t.maxY=n.maxY+i,t.minZ=n.minZ-i,t.maxZ=n.maxZ+i,this.tree.insertLeaf(r),this.collide(r,this.tree.root))}},OIMO.DBVTBroadPhase.prototype.collide=function(n,t){var i=2,c,o;for(this.stack[0]=n,this.stack[1]=t;i>0;){var f=this.stack[--i],e=this.stack[--i],l=f.proxy!=null,a=e.proxy!=null;if(this.numPairChecks++,l&&a){var s=f.proxy.shape,h=e.proxy.shape,r=s.aabb,u=h.aabb;if(s==h||r.maxX<u.minX||r.minX>u.maxX||r.maxY<u.minY||r.minY>u.maxY||r.maxZ<u.minZ||r.minZ>u.maxZ||!this.isAvailablePair(s,h))continue;this.addPair(s,h)}else{if(r=f.aabb,u=e.aabb,r.maxX<u.minX||r.minX>u.maxX||r.maxY<u.minY||r.minY>u.maxY||r.maxZ<u.minZ||r.minZ>u.maxZ)continue;if(i+4>=this.maxStack){for(this.maxStack<<=1,c=[],o=0;o<i;o++)c[o]=this.stack[o];this.stack=c}a||!l&&f.aabb.surfaceArea()>e.aabb.surfaceArea()?(this.stack[i++]=f.child1,this.stack[i++]=e,this.stack[i++]=f.child2,this.stack[i++]=e):(this.stack[i++]=f,this.stack[i++]=e.child1,this.stack[i++]=f,this.stack[i++]=e.child2)}}},OIMO.DBVT=function(){this.root=null,this.freeNodes=[],this.numFreeNodes=0,this.aabb=new OIMO.AABB},OIMO.DBVT.prototype={constructor:OIMO.DBVT,moveLeaf:function(n){this.deleteLeaf(n),this.insertLeaf(n)},insertLeaf:function(n){var f,i,c,o,r,u,t;if(this.root==null){this.root=n;return}for(f=n.aabb,i=this.root;i.proxy==null;){var s=i.child1,h=i.child2,l=i.aabb,a=s.aabb,v=h.aabb;c=l.surfaceArea(),this.aabb.combine(f,l),o=this.aabb.surfaceArea();var y=o*2,p=(o-c)*2,e=p;if(this.aabb.combine(f,a),e+=s.proxy!=null?this.aabb.surfaceArea():this.aabb.surfaceArea()-a.surfaceArea(),r=p,this.aabb.combine(f,v),r+=h.proxy!=null?this.aabb.surfaceArea():this.aabb.surfaceArea()-v.surfaceArea(),e<r)if(y<e)break;else i=s;else if(y<r)break;else i=h}u=i.parent,t=this.numFreeNodes>0?this.freeNodes[--this.numFreeNodes]:new OIMO.DBVTNode,t.parent=u,t.child1=n,t.child2=i,t.aabb.combine(n.aabb,i.aabb),t.height=i.height+1,i.parent=t,n.parent=t,i==this.root?this.root=t:u.child1==i?u.child1=t:u.child2=t;do t=this.balance(t),this.fix(t),t=t.parent;while(t!=null)},getBalance:function(n){return n.proxy!=null?0:n.child1.height-n.child2.height},print:function(n,t,i){var r=n.proxy==null,u;for(r&&(i=this.print(n.child1,t+1,i)),u=t*2;u>=0;u--)i+=" ";return i+=(r?this.getBalance(n):"["+n.proxy.aabb.minX+"]")+"\n",r&&(i=this.print(n.child2,t+1,i)),i},deleteLeaf:function(n){var i,r,t;if(n==this.root){this.root=null;return}if(i=n.parent,r=i.child1==n?i.child2:i.child1,i==this.root){this.root=r,r.parent=null;return}t=i.parent,r.parent=t,t.child1==i?t.child1=r:t.child2=r,this.numFreeNodes<16384&&(this.freeNodes[this.numFreeNodes++]=i);do t=this.balance(t),this.fix(t),t=t.parent;while(t!=null)},balance:function(n){var f=n.height;if(f<2)return n;var u=n.parent,i=n.child1,r=n.child2,e=i.height,y=r.height,w=e-y,t;if(w>1){var o=i.child1,s=i.child2,h=o.height,a=s.height;return h>a?(i.child2=n,n.parent=i,n.child1=s,s.parent=n,n.aabb.combine(s.aabb,r.aabb),t=a-y,n.height=a-(t&t>>31)+1,i.aabb.combine(o.aabb,n.aabb),t=h-f,i.height=h-(t&t>>31)+1):(i.child1=n,n.parent=i,n.child1=o,o.parent=n,n.aabb.combine(o.aabb,r.aabb),t=h-y,n.height=h-(t&t>>31)+1,i.aabb.combine(n.aabb,s.aabb),t=f-a,i.height=f-(t&t>>31)+1),u!=null?u.child1==n?u.child1=i:u.child2=i:this.root=i,i.parent=u,i}if(w<-1){var c=r.child1,l=r.child2,v=c.height,p=l.height;return v>p?(r.child2=n,n.parent=r,n.child2=l,l.parent=n,n.aabb.combine(i.aabb,l.aabb),t=e-p,n.height=e-(t&t>>31)+1,r.aabb.combine(c.aabb,n.aabb),t=v-f,r.height=v-(t&t>>31)+1):(r.child1=n,n.parent=r,n.child2=c,c.parent=n,n.aabb.combine(i.aabb,c.aabb),t=e-v,n.height=e-(t&t>>31)+1,r.aabb.combine(n.aabb,l.aabb),t=f-p,r.height=f-(t&t>>31)+1),u!=null?u.child1==n?u.child1=r:u.child2=r:this.root=r,r.parent=u,r}return n},fix:function(n){var r=n.child1,u=n.child2,t,i;n.aabb.combine(r.aabb,u.aabb),t=r.height,i=u.height,n.height=t<i?i+1:t+1}},OIMO.CollisionDetector=function(){this.flip=!1},OIMO.CollisionDetector.prototype={constructor:OIMO.CollisionDetector,detectCollision:function(){throw new Error("Inheritance error.");}},OIMO.BoxBoxCollisionDetector=function(){OIMO.CollisionDetector.call(this),this.clipVertices1=[],this.clipVertices2=[],this.clipVertices1.length=24,this.clipVertices2.length=24,this.used=[],this.INF=1/0},OIMO.BoxBoxCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype),OIMO.BoxBoxCollisionDetector.prototype.detectCollision=function(n,t,i){var s,h,r,g,et,b,k,d,br,kr,dr,lu,au,vu,tt,gi,nt,o,y,p,w,st,ht,ct,it,sh,ye;n.id<t.id?(s=n,h=t):(s=t,h=n);var cs=s.position,ls=h.position,ne=cs.x,te=cs.y,ie=cs.z,re=ls.x,ue=ls.y,fe=ls.z,tr=re-ne,ir=ue-te,rr=fe-ie,gr=s.halfWidth,nu=s.halfHeight,tu=s.halfDepth,iu=h.halfWidth,ru=h.halfHeight,uu=h.halfDepth,io=s.halfDirectionWidth.x,ro=s.halfDirectionWidth.y,uo=s.halfDirectionWidth.z,fo=s.halfDirectionHeight.x,eo=s.halfDirectionHeight.y,oo=s.halfDirectionHeight.z,so=s.halfDirectionDepth.x,ho=s.halfDirectionDepth.y,co=s.halfDirectionDepth.z,lo=h.halfDirectionWidth.x,ao=h.halfDirectionWidth.y,vo=h.halfDirectionWidth.z,yo=h.halfDirectionHeight.x,po=h.halfDirectionHeight.y,wo=h.halfDirectionHeight.z,bo=h.halfDirectionDepth.x,ko=h.halfDirectionDepth.y,go=h.halfDirectionDepth.z,lt=s.normalDirectionWidth.x,at=s.normalDirectionWidth.y,vt=s.normalDirectionWidth.z,yt=s.normalDirectionHeight.x,pt=s.normalDirectionHeight.y,wt=s.normalDirectionHeight.z,bt=s.normalDirectionDepth.x,kt=s.normalDirectionDepth.y,dt=s.normalDirectionDepth.z,gt=h.normalDirectionWidth.x,ni=h.normalDirectionWidth.y,ti=h.normalDirectionWidth.z,ii=h.normalDirectionHeight.x,ri=h.normalDirectionHeight.y,ui=h.normalDirectionHeight.z,fi=h.normalDirectionDepth.x,ei=h.normalDirectionDepth.y,oi=h.normalDirectionDepth.z,yu=at*ti-vt*ni,pu=vt*gt-lt*ti,wu=lt*ni-at*gt,bu=at*ui-vt*ri,ku=vt*ii-lt*ui,du=lt*ri-at*ii,gu=at*oi-vt*ei,nf=vt*fi-lt*oi,tf=lt*ei-at*fi,rf=pt*ti-wt*ni,uf=wt*gt-yt*ti,ff=yt*ni-pt*gt,ef=pt*ui-wt*ri,of=wt*ii-yt*ui,sf=yt*ri-pt*ii,hf=pt*oi-wt*ei,cf=wt*fi-yt*oi,lf=yt*ei-pt*fi,af=kt*ti-dt*ni,vf=dt*gt-bt*ti,yf=bt*ni-kt*gt,pf=kt*ui-dt*ri,wf=dt*ii-bt*ui,bf=bt*ri-kt*ii,kf=kt*oi-dt*ei,df=dt*fi-bt*oi,gf=bt*ei-kt*fi,as,vs,ys,ps,ws,bs,ns,ts,is,rs,us,fs,es,os,ss,hs,pe,we,be,ke,de,ee,oe,se,he,ce,le,ae,ve,ge,gs=!1,nh=!1,th=!1,ih=!1,rh=!1,uh=!1,fh=!1,eh=!1,oh=!1,e,rt,ut,u,f,ft;if((e=lt*tr+at*ir+vt*rr,as=e>0,as||(e=-e),rt=gr,u=lt*gt+at*ni+vt*ti,f=lt*ii+at*ri+vt*ui,ft=lt*fi+at*ei+vt*oi,u<0&&(u=-u),f<0&&(f=-f),ft<0&&(ft=-ft),ut=u*iu+f*ru+ft*uu,hs=e-rt-ut,!(hs>0))&&(e=yt*tr+pt*ir+wt*rr,vs=e>0,vs||(e=-e),rt=nu,u=yt*gt+pt*ni+wt*ti,f=yt*ii+pt*ri+wt*ui,ft=yt*fi+pt*ei+wt*oi,u<0&&(u=-u),f<0&&(f=-f),ft<0&&(ft=-ft),ut=u*iu+f*ru+ft*uu,pe=e-rt-ut,!(pe>0))&&(e=bt*tr+kt*ir+dt*rr,ys=e>0,ys||(e=-e),rt=tu,u=bt*gt+kt*ni+dt*ti,f=bt*ii+kt*ri+dt*ui,ft=bt*fi+kt*ei+dt*oi,u<0&&(u=-u),f<0&&(f=-f),ft<0&&(ft=-ft),ut=u*iu+f*ru+ft*uu,we=e-rt-ut,!(we>0))&&(e=gt*tr+ni*ir+ti*rr,ps=e>0,ps||(e=-e),u=gt*lt+ni*at+ti*vt,f=gt*yt+ni*pt+ti*wt,ft=gt*bt+ni*kt+ti*dt,u<0&&(u=-u),f<0&&(f=-f),ft<0&&(ft=-ft),rt=u*gr+f*nu+ft*tu,ut=iu,be=(e-rt-ut)*1,!(be>0))&&(e=ii*tr+ri*ir+ui*rr,ws=e>0,ws||(e=-e),u=ii*lt+ri*at+ui*vt,f=ii*yt+ri*pt+ui*wt,ft=ii*bt+ri*kt+ui*dt,u<0&&(u=-u),f<0&&(f=-f),ft<0&&(ft=-ft),rt=u*gr+f*nu+ft*tu,ut=ru,ke=(e-rt-ut)*1,!(ke>0))&&(e=fi*tr+ei*ir+oi*rr,bs=e>0,bs||(e=-e),u=fi*lt+ei*at+oi*vt,f=fi*yt+ei*pt+oi*wt,ft=fi*bt+ei*kt+oi*dt,u<0&&(u=-u),f<0&&(f=-f),ft<0&&(ft=-ft),rt=u*gr+f*nu+ft*tu,ut=uu,de=(e-rt-ut)*1,!(de>0))){if(e=yu*yu+pu*pu+wu*wu,e>1e-5){if(e=1/Math.sqrt(e),yu*=e,pu*=e,wu*=e,e=yu*tr+pu*ir+wu*rr,ns=e>0,ns||(e=-e),u=yu*yt+pu*pt+wu*wt,f=yu*bt+pu*kt+wu*dt,u<0&&(u=-u),f<0&&(f=-f),rt=u*nu+f*tu,u=yu*ii+pu*ri+wu*ui,f=yu*fi+pu*ei+wu*oi,u<0&&(u=-u),f<0&&(f=-f),ut=u*ru+f*uu,ee=e-rt-ut,ee>0)return}else ns=!1,ee=0,gs=!0;if(e=bu*bu+ku*ku+du*du,e>1e-5){if(e=1/Math.sqrt(e),bu*=e,ku*=e,du*=e,e=bu*tr+ku*ir+du*rr,ts=e>0,ts||(e=-e),u=bu*yt+ku*pt+du*wt,f=bu*bt+ku*kt+du*dt,u<0&&(u=-u),f<0&&(f=-f),rt=u*nu+f*tu,u=bu*gt+ku*ni+du*ti,f=bu*fi+ku*ei+du*oi,u<0&&(u=-u),f<0&&(f=-f),ut=u*iu+f*uu,oe=e-rt-ut,oe>0)return}else ts=!1,oe=0,nh=!0;if(e=gu*gu+nf*nf+tf*tf,e>1e-5){if(e=1/Math.sqrt(e),gu*=e,nf*=e,tf*=e,e=gu*tr+nf*ir+tf*rr,is=e>0,is||(e=-e),u=gu*yt+nf*pt+tf*wt,f=gu*bt+nf*kt+tf*dt,u<0&&(u=-u),f<0&&(f=-f),rt=u*nu+f*tu,u=gu*gt+nf*ni+tf*ti,f=gu*ii+nf*ri+tf*ui,u<0&&(u=-u),f<0&&(f=-f),ut=u*iu+f*ru,se=e-rt-ut,se>0)return}else is=!1,se=0,th=!0;if(e=rf*rf+uf*uf+ff*ff,e>1e-5){if(e=1/Math.sqrt(e),rf*=e,uf*=e,ff*=e,e=rf*tr+uf*ir+ff*rr,rs=e>0,rs||(e=-e),u=rf*lt+uf*at+ff*vt,f=rf*bt+uf*kt+ff*dt,u<0&&(u=-u),f<0&&(f=-f),rt=u*gr+f*tu,u=rf*ii+uf*ri+ff*ui,f=rf*fi+uf*ei+ff*oi,u<0&&(u=-u),f<0&&(f=-f),ut=u*ru+f*uu,he=e-rt-ut,he>0)return}else rs=!1,he=0,ih=!0;if(e=ef*ef+of*of+sf*sf,e>1e-5){if(e=1/Math.sqrt(e),ef*=e,of*=e,sf*=e,e=ef*tr+of*ir+sf*rr,us=e>0,us||(e=-e),u=ef*lt+of*at+sf*vt,f=ef*bt+of*kt+sf*dt,u<0&&(u=-u),f<0&&(f=-f),rt=u*gr+f*tu,u=ef*gt+of*ni+sf*ti,f=ef*fi+of*ei+sf*oi,u<0&&(u=-u),f<0&&(f=-f),ut=u*iu+f*uu,ce=e-rt-ut,ce>0)return}else us=!1,ce=0,rh=!0;if(e=hf*hf+cf*cf+lf*lf,e>1e-5){if(e=1/Math.sqrt(e),hf*=e,cf*=e,lf*=e,e=hf*tr+cf*ir+lf*rr,fs=e>0,fs||(e=-e),u=hf*lt+cf*at+lf*vt,f=hf*bt+cf*kt+lf*dt,u<0&&(u=-u),f<0&&(f=-f),rt=u*gr+f*tu,u=hf*gt+cf*ni+lf*ti,f=hf*ii+cf*ri+lf*ui,u<0&&(u=-u),f<0&&(f=-f),ut=u*iu+f*ru,le=e-rt-ut,le>0)return}else fs=!1,le=0,uh=!0;if(e=af*af+vf*vf+yf*yf,e>1e-5){if(e=1/Math.sqrt(e),af*=e,vf*=e,yf*=e,e=af*tr+vf*ir+yf*rr,es=e>0,es||(e=-e),u=af*lt+vf*at+yf*vt,f=af*yt+vf*pt+yf*wt,u<0&&(u=-u),f<0&&(f=-f),rt=u*gr+f*nu,u=af*ii+vf*ri+yf*ui,f=af*fi+vf*ei+yf*oi,u<0&&(u=-u),f<0&&(f=-f),ut=u*ru+f*uu,ae=e-rt-ut,ae>0)return}else es=!1,ae=0,fh=!0;if(e=pf*pf+wf*wf+bf*bf,e>1e-5){if(e=1/Math.sqrt(e),pf*=e,wf*=e,bf*=e,e=pf*tr+wf*ir+bf*rr,os=e>0,os||(e=-e),u=pf*lt+wf*at+bf*vt,f=pf*yt+wf*pt+bf*wt,u<0&&(u=-u),f<0&&(f=-f),rt=u*gr+f*nu,u=pf*gt+wf*ni+bf*ti,f=pf*fi+wf*ei+bf*oi,u<0&&(u=-u),f<0&&(f=-f),ut=u*iu+f*uu,ve=e-rt-ut,ve>0)return}else os=!1,ve=0,eh=!0;if(e=kf*kf+df*df+gf*gf,e>1e-5){if(e=1/Math.sqrt(e),kf*=e,df*=e,gf*=e,e=kf*tr+df*ir+gf*rr,ss=e>0,ss||(e=-e),u=kf*lt+df*at+gf*vt,f=kf*yt+df*pt+gf*wt,u<0&&(u=-u),f<0&&(f=-f),rt=u*gr+f*nu,u=kf*gt+df*ni+gf*ti,f=kf*ii+df*ri+gf*ui,u<0&&(u=-u),f<0&&(f=-f),ut=u*iu+f*ru,ge=e-rt-ut,ge>0)return}else ss=!1,ge=0,oh=!0;var di=hs,si=hs,nr=0,ki=as;pe>si&&(di=pe,si=pe,nr=1,ki=vs),we>si&&(di=we,si=we,nr=2,ki=ys),be>si&&(di=be,si=be,nr=3,ki=ps),ke>si&&(di=ke,si=ke,nr=4,ki=ws),de>si&&(di=de,si=de,nr=5,ki=bs),ee-.01>si&&!gs&&(di=ee,si=ee-.01,nr=6,ki=ns),oe-.01>si&&!nh&&(di=oe,si=oe-.01,nr=7,ki=ts),se-.01>si&&!th&&(di=se,si=se-.01,nr=8,ki=is),he-.01>si&&!ih&&(di=he,si=he-.01,nr=9,ki=rs),ce-.01>si&&!rh&&(di=ce,si=ce-.01,nr=10,ki=us),le-.01>si&&!uh&&(di=le,si=le-.01,nr=11,ki=fs),ae-.01>si&&!fh&&(di=ae,si=ae-.01,nr=12,ki=es),ve-.01>si&&!eh&&(di=ve,si=ve-.01,nr=13,ki=os),ge-.01>si&&!oh&&(di=ge,nr=14,ki=ss);var c=0,l=0,a=0,ai=0,vi=0,yi=0,pi=0,wi=0,bi=0,hi=0,ci=0,li=0,fu=0,eu=0,ou=0,su=0,hu=0,cu=0,no=!1;switch(nr){case 0:ki?(hi=ne+io,ci=te+ro,li=ie+uo,c=lt,l=at,a=vt):(hi=ne-io,ci=te-ro,li=ie-uo,c=-lt,l=-at,a=-vt),fu=fo,eu=eo,ou=oo,ai=-yt,vi=-pt,yi=-wt,su=so,hu=ho,cu=co,pi=-bt,wi=-kt,bi=-dt;break;case 1:ki?(hi=ne+fo,ci=te+eo,li=ie+oo,c=yt,l=pt,a=wt):(hi=ne-fo,ci=te-eo,li=ie-oo,c=-yt,l=-pt,a=-wt),fu=io,eu=ro,ou=uo,ai=-lt,vi=-at,yi=-vt,su=so,hu=ho,cu=co,pi=-bt,wi=-kt,bi=-dt;break;case 2:ki?(hi=ne+so,ci=te+ho,li=ie+co,c=bt,l=kt,a=dt):(hi=ne-so,ci=te-ho,li=ie-co,c=-bt,l=-kt,a=-dt),fu=io,eu=ro,ou=uo,ai=-lt,vi=-at,yi=-vt,su=fo,hu=eo,cu=oo,pi=-yt,wi=-pt,bi=-wt;break;case 3:no=!0,ki?(hi=re-lo,ci=ue-ao,li=fe-vo,c=-gt,l=-ni,a=-ti):(hi=re+lo,ci=ue+ao,li=fe+vo,c=gt,l=ni,a=ti),fu=yo,eu=po,ou=wo,ai=-ii,vi=-ri,yi=-ui,su=bo,hu=ko,cu=go,pi=-fi,wi=-ei,bi=-oi;break;case 4:no=!0,ki?(hi=re-yo,ci=ue-po,li=fe-wo,c=-ii,l=-ri,a=-ui):(hi=re+yo,ci=ue+po,li=fe+wo,c=ii,l=ri,a=ui),fu=lo,eu=ao,ou=vo,ai=-gt,vi=-ni,yi=-ti,su=bo,hu=ko,cu=go,pi=-fi,wi=-ei,bi=-oi;break;case 5:no=!0,ki?(hi=re-bo,ci=ue-ko,li=fe-go,c=-fi,l=-ei,a=-oi):(hi=re+bo,ci=ue+ko,li=fe+go,c=fi,l=ei,a=oi),fu=lo,eu=ao,ou=vo,ai=-gt,vi=-ni,yi=-ti,su=yo,hu=po,cu=wo,pi=-ii,wi=-ri,bi=-ui;break;case 6:c=yu,l=pu,a=wu,ai=lt,vi=at,yi=vt,pi=gt,wi=ni,bi=ti;break;case 7:c=bu,l=ku,a=du,ai=lt,vi=at,yi=vt,pi=ii,wi=ri,bi=ui;break;case 8:c=gu,l=nf,a=tf,ai=lt,vi=at,yi=vt,pi=fi,wi=ei,bi=oi;break;case 9:c=rf,l=uf,a=ff,ai=yt,vi=pt,yi=wt,pi=gt,wi=ni,bi=ti;break;case 10:c=ef,l=of,a=sf,ai=yt,vi=pt,yi=wt,pi=ii,wi=ri,bi=ui;break;case 11:c=hf,l=cf,a=lf,ai=yt,vi=pt,yi=wt,pi=fi,wi=ei,bi=oi;break;case 12:c=af,l=vf,a=yf,ai=bt,vi=kt,yi=dt,pi=gt,wi=ni,bi=ti;break;case 13:c=pf,l=wf,a=bf,ai=bt,vi=kt,yi=dt,pi=ii,wi=ri,bi=ui;break;case 14:c=kf,l=df,a=gf,ai=bt,vi=kt,yi=dt,pi=fi,wi=ei,bi=oi}if(nr>5){ki||(c=-c,l=-l,a=-a),r=s.vertex1,br=r.x,kr=r.y,dr=r.z,et=c*br+l*kr+a*dr,r=s.vertex2,b=r.x,k=r.y,d=r.z,g=c*b+l*k+a*d,g>et&&(et=g,br=b,kr=k,dr=d),r=s.vertex3,b=r.x,k=r.y,d=r.z,g=c*b+l*k+a*d,g>et&&(et=g,br=b,kr=k,dr=d),r=s.vertex4,b=r.x,k=r.y,d=r.z,g=c*b+l*k+a*d,g>et&&(et=g,br=b,kr=k,dr=d),r=s.vertex5,b=r.x,k=r.y,d=r.z,g=c*b+l*k+a*d,g>et&&(et=g,br=b,kr=k,dr=d),r=s.vertex6,b=r.x,k=r.y,d=r.z,g=c*b+l*k+a*d,g>et&&(et=g,br=b,kr=k,dr=d),r=s.vertex7,b=r.x,k=r.y,d=r.z,g=c*b+l*k+a*d,g>et&&(et=g,br=b,kr=k,dr=d),r=s.vertex8,b=r.x,k=r.y,d=r.z,g=c*b+l*k+a*d,g>et&&(et=g,br=b,kr=k,dr=d),r=h.vertex1,lu=r.x,au=r.y,vu=r.z,et=c*lu+l*au+a*vu,r=h.vertex2,b=r.x,k=r.y,d=r.z,g=c*b+l*k+a*d,g<et&&(et=g,lu=b,au=k,vu=d),r=h.vertex3,b=r.x,k=r.y,d=r.z,g=c*b+l*k+a*d,g<et&&(et=g,lu=b,au=k,vu=d),r=h.vertex4,b=r.x,k=r.y,d=r.z,g=c*b+l*k+a*d,g<et&&(et=g,lu=b,au=k,vu=d),r=h.vertex5,b=r.x,k=r.y,d=r.z,g=c*b+l*k+a*d,g<et&&(et=g,lu=b,au=k,vu=d),r=h.vertex6,b=r.x,k=r.y,d=r.z,g=c*b+l*k+a*d,g<et&&(et=g,lu=b,au=k,vu=d),r=h.vertex7,b=r.x,k=r.y,d=r.z,g=c*b+l*k+a*d,g<et&&(et=g,lu=b,au=k,vu=d),r=h.vertex8,b=r.x,k=r.y,d=r.z,g=c*b+l*k+a*d,g<et&&(et=g,lu=b,au=k,vu=d),b=lu-br,k=au-kr,d=vu-dr,u=ai*pi+vi*wi+yi*bi,tt=(b*(ai-pi*u)+k*(vi-wi*u)+d*(yi-bi*u))/(1-u*u),i.addPoint(br+ai*tt+c*di*.5,kr+vi*tt+l*di*.5,dr+yi*tt+a*di*.5,c,l,a,di,!1);return}var ur,fr,er,or,sr,hr,cr,lr,ar,vr,yr,pr,ot=1,v=0,wr=0;if(no){v=lt*c+at*l+vt*a,v<ot&&(ot=v,wr=0),-v<ot&&(ot=-v,wr=1),v=yt*c+pt*l+wt*a,v<ot&&(ot=v,wr=2),-v<ot&&(ot=-v,wr=3),v=bt*c+kt*l+dt*a,v<ot&&(ot=v,wr=4),-v<ot&&(ot=-v,wr=5);switch(wr){case 0:r=s.vertex1,ur=r.x,fr=r.y,er=r.z,r=s.vertex3,or=r.x,sr=r.y,hr=r.z,r=s.vertex4,cr=r.x,lr=r.y,ar=r.z,r=s.vertex2,vr=r.x,yr=r.y,pr=r.z;break;case 1:r=s.vertex6,ur=r.x,fr=r.y,er=r.z,r=s.vertex8,or=r.x,sr=r.y,hr=r.z,r=s.vertex7,cr=r.x,lr=r.y,ar=r.z,r=s.vertex5,vr=r.x,yr=r.y,pr=r.z;break;case 2:r=s.vertex5,ur=r.x,fr=r.y,er=r.z,r=s.vertex1,or=r.x,sr=r.y,hr=r.z,r=s.vertex2,cr=r.x,lr=r.y,ar=r.z,r=s.vertex6,vr=r.x,yr=r.y,pr=r.z;break;case 3:r=s.vertex8,ur=r.x,fr=r.y,er=r.z,r=s.vertex4,or=r.x,sr=r.y,hr=r.z,r=s.vertex3,cr=r.x,lr=r.y,ar=r.z,r=s.vertex7,vr=r.x,yr=r.y,pr=r.z;break;case 4:r=s.vertex5,ur=r.x,fr=r.y,er=r.z,r=s.vertex7,or=r.x,sr=r.y,hr=r.z,r=s.vertex3,cr=r.x,lr=r.y,ar=r.z,r=s.vertex1,vr=r.x,yr=r.y,pr=r.z;break;case 5:r=s.vertex2,ur=r.x,fr=r.y,er=r.z,r=s.vertex4,or=r.x,sr=r.y,hr=r.z,r=s.vertex8,cr=r.x,lr=r.y,ar=r.z,r=s.vertex6,vr=r.x,yr=r.y,pr=r.z}}else{v=gt*c+ni*l+ti*a,v<ot&&(ot=v,wr=0),-v<ot&&(ot=-v,wr=1),v=ii*c+ri*l+ui*a,v<ot&&(ot=v,wr=2),-v<ot&&(ot=-v,wr=3),v=fi*c+ei*l+oi*a,v<ot&&(ot=v,wr=4),-v<ot&&(ot=-v,wr=5);switch(wr){case 0:r=h.vertex1,ur=r.x,fr=r.y,er=r.z,r=h.vertex3,or=r.x,sr=r.y,hr=r.z,r=h.vertex4,cr=r.x,lr=r.y,ar=r.z,r=h.vertex2,vr=r.x,yr=r.y,pr=r.z;break;case 1:r=h.vertex6,ur=r.x,fr=r.y,er=r.z,r=h.vertex8,or=r.x,sr=r.y,hr=r.z,r=h.vertex7,cr=r.x,lr=r.y,ar=r.z,r=h.vertex5,vr=r.x,yr=r.y,pr=r.z;break;case 2:r=h.vertex5,ur=r.x,fr=r.y,er=r.z,r=h.vertex1,or=r.x,sr=r.y,hr=r.z,r=h.vertex2,cr=r.x,lr=r.y,ar=r.z,r=h.vertex6,vr=r.x,yr=r.y,pr=r.z;break;case 3:r=h.vertex8,ur=r.x,fr=r.y,er=r.z,r=h.vertex4,or=r.x,sr=r.y,hr=r.z,r=h.vertex3,cr=r.x,lr=r.y,ar=r.z,r=h.vertex7,vr=r.x,yr=r.y,pr=r.z;break;case 4:r=h.vertex5,ur=r.x,fr=r.y,er=r.z,r=h.vertex7,or=r.x,sr=r.y,hr=r.z,r=h.vertex3,cr=r.x,lr=r.y,ar=r.z,r=h.vertex1,vr=r.x,yr=r.y,pr=r.z;break;case 5:r=h.vertex2,ur=r.x,fr=r.y,er=r.z,r=h.vertex4,or=r.x,sr=r.y,hr=r.z,r=h.vertex8,cr=r.x,lr=r.y,ar=r.z,r=h.vertex6,vr=r.x,yr=r.y,pr=r.z}}for(this.clipVertices1[0]=ur,this.clipVertices1[1]=fr,this.clipVertices1[2]=er,this.clipVertices1[3]=or,this.clipVertices1[4]=sr,this.clipVertices1[5]=hr,this.clipVertices1[6]=cr,this.clipVertices1[7]=lr,this.clipVertices1[8]=ar,this.clipVertices1[9]=vr,this.clipVertices1[10]=yr,this.clipVertices1[11]=pr,nt=0,y=this.clipVertices1[9],p=this.clipVertices1[10],w=this.clipVertices1[11],u=(y-hi-fu)*ai+(p-ci-eu)*vi+(w-li-ou)*yi,it=0;it<4;it++)o=it*3,st=this.clipVertices1[o],ht=this.clipVertices1[o+1],ct=this.clipVertices1[o+2],f=(st-hi-fu)*ai+(ht-ci-eu)*vi+(ct-li-ou)*yi,u>0?f>0?(o=nt*3,nt++,this.clipVertices2[o]=st,this.clipVertices2[o+1]=ht,this.clipVertices2[o+2]=ct):(o=nt*3,nt++,tt=u/(u-f),this.clipVertices2[o]=y+(st-y)*tt,this.clipVertices2[o+1]=p+(ht-p)*tt,this.clipVertices2[o+2]=w+(ct-w)*tt):f>0&&(o=nt*3,nt++,tt=u/(u-f),this.clipVertices2[o]=y+(st-y)*tt,this.clipVertices2[o+1]=p+(ht-p)*tt,this.clipVertices2[o+2]=w+(ct-w)*tt,o=nt*3,nt++,this.clipVertices2[o]=st,this.clipVertices2[o+1]=ht,this.clipVertices2[o+2]=ct),y=st,p=ht,w=ct,u=f;if(gi=nt,gi!=0){for(nt=0,o=(gi-1)*3,y=this.clipVertices2[o],p=this.clipVertices2[o+1],w=this.clipVertices2[o+2],u=(y-hi-su)*pi+(p-ci-hu)*wi+(w-li-cu)*bi,it=0;it<gi;it++)o=it*3,st=this.clipVertices2[o],ht=this.clipVertices2[o+1],ct=this.clipVertices2[o+2],f=(st-hi-su)*pi+(ht-ci-hu)*wi+(ct-li-cu)*bi,u>0?f>0?(o=nt*3,nt++,this.clipVertices1[o]=st,this.clipVertices1[o+1]=ht,this.clipVertices1[o+2]=ct):(o=nt*3,nt++,tt=u/(u-f),this.clipVertices1[o]=y+(st-y)*tt,this.clipVertices1[o+1]=p+(ht-p)*tt,this.clipVertices1[o+2]=w+(ct-w)*tt):f>0&&(o=nt*3,nt++,tt=u/(u-f),this.clipVertices1[o]=y+(st-y)*tt,this.clipVertices1[o+1]=p+(ht-p)*tt,this.clipVertices1[o+2]=w+(ct-w)*tt,o=nt*3,nt++,this.clipVertices1[o]=st,this.clipVertices1[o+1]=ht,this.clipVertices1[o+2]=ct),y=st,p=ht,w=ct,u=f;if(gi=nt,gi!=0){for(nt=0,o=(gi-1)*3,y=this.clipVertices1[o],p=this.clipVertices1[o+1],w=this.clipVertices1[o+2],u=(y-hi+fu)*-ai+(p-ci+eu)*-vi+(w-li+ou)*-yi,it=0;it<gi;it++)o=it*3,st=this.clipVertices1[o],ht=this.clipVertices1[o+1],ct=this.clipVertices1[o+2],f=(st-hi+fu)*-ai+(ht-ci+eu)*-vi+(ct-li+ou)*-yi,u>0?f>0?(o=nt*3,nt++,this.clipVertices2[o]=st,this.clipVertices2[o+1]=ht,this.clipVertices2[o+2]=ct):(o=nt*3,nt++,tt=u/(u-f),this.clipVertices2[o]=y+(st-y)*tt,this.clipVertices2[o+1]=p+(ht-p)*tt,this.clipVertices2[o+2]=w+(ct-w)*tt):f>0&&(o=nt*3,nt++,tt=u/(u-f),this.clipVertices2[o]=y+(st-y)*tt,this.clipVertices2[o+1]=p+(ht-p)*tt,this.clipVertices2[o+2]=w+(ct-w)*tt,o=nt*3,nt++,this.clipVertices2[o]=st,this.clipVertices2[o+1]=ht,this.clipVertices2[o+2]=ct),y=st,p=ht,w=ct,u=f;if(gi=nt,gi!=0){for(nt=0,o=(gi-1)*3,y=this.clipVertices2[o],p=this.clipVertices2[o+1],w=this.clipVertices2[o+2],u=(y-hi+su)*-pi+(p-ci+hu)*-wi+(w-li+cu)*-bi,it=0;it<gi;it++)o=it*3,st=this.clipVertices2[o],ht=this.clipVertices2[o+1],ct=this.clipVertices2[o+2],f=(st-hi+su)*-pi+(ht-ci+hu)*-wi+(ct-li+cu)*-bi,u>0?f>0?(o=nt*3,nt++,this.clipVertices1[o]=st,this.clipVertices1[o+1]=ht,this.clipVertices1[o+2]=ct):(o=nt*3,nt++,tt=u/(u-f),this.clipVertices1[o]=y+(st-y)*tt,this.clipVertices1[o+1]=p+(ht-p)*tt,this.clipVertices1[o+2]=w+(ct-w)*tt):f>0&&(o=nt*3,nt++,tt=u/(u-f),this.clipVertices1[o]=y+(st-y)*tt,this.clipVertices1[o+1]=p+(ht-p)*tt,this.clipVertices1[o+2]=w+(ct-w)*tt,o=nt*3,nt++,this.clipVertices1[o]=st,this.clipVertices1[o+1]=ht,this.clipVertices1[o+2]=ct),y=st,p=ht,w=ct,u=f;if(gi=nt,no&&(sh=s,s=h,h=sh),gi!=0)if(ye=s!=n,gi>4){y=(ur+or+cr+vr)*.25,p=(fr+sr+lr+yr)*.25,w=(er+hr+ar+pr)*.25,ai=ur-y,vi=fr-p,yi=er-w,pi=or-y,wi=sr-p,bi=hr-w;var ks=0,hh=0,ds=0,ch=0,to=-this.INF;for(ot=this.INF,it=0;it<gi;it++)this.used[it]=!1,o=it*3,y=this.clipVertices1[o],p=this.clipVertices1[o+1],w=this.clipVertices1[o+2],v=y*ai+p*vi+w*yi,v<ot&&(ot=v,ks=it),v>to&&(to=v,ds=it);for(this.used[ks]=!0,this.used[ds]=!0,to=-this.INF,ot=this.INF,it=0;it<gi;it++)this.used[it]||(o=it*3,y=this.clipVertices1[o],p=this.clipVertices1[o+1],w=this.clipVertices1[o+2],v=y*pi+p*wi+w*bi,v<ot&&(ot=v,hh=it),v>to&&(to=v,ch=it));o=ks*3,y=this.clipVertices1[o],p=this.clipVertices1[o+1],w=this.clipVertices1[o+2],v=(y-hi)*c+(p-ci)*l+(w-li)*a,v<0&&i.addPoint(y,p,w,c,l,a,v,ye),o=hh*3,y=this.clipVertices1[o],p=this.clipVertices1[o+1],w=this.clipVertices1[o+2],v=(y-hi)*c+(p-ci)*l+(w-li)*a,v<0&&i.addPoint(y,p,w,c,l,a,v,ye),o=ds*3,y=this.clipVertices1[o],p=this.clipVertices1[o+1],w=this.clipVertices1[o+2],v=(y-hi)*c+(p-ci)*l+(w-li)*a,v<0&&i.addPoint(y,p,w,c,l,a,v,ye),o=ch*3,y=this.clipVertices1[o],p=this.clipVertices1[o+1],w=this.clipVertices1[o+2],v=(y-hi)*c+(p-ci)*l+(w-li)*a,v<0&&i.addPoint(y,p,w,c,l,a,v,ye)}else for(it=0;it<gi;it++)o=it*3,y=this.clipVertices1[o],p=this.clipVertices1[o+1],w=this.clipVertices1[o+2],v=(y-hi)*c+(p-ci)*l+(w-li)*a,v<0&&i.addPoint(y,p,w,c,l,a,v,ye)}}}}},OIMO.SphereBoxCollisionDetector=function(n){OIMO.CollisionDetector.call(this),this.flip=n},OIMO.SphereBoxCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype),OIMO.SphereBoxCollisionDetector.prototype.detectCollision=function(n,t,i){var d,p;this.flip?(d=t,p=n):(d=n,p=t);var k=d.position,tt=k.x,it=k.y,rt=k.z,ut=p.position,ft=ut.x,et=ut.y,ot=ut.z,y=d.radius,c=p.normalDirectionWidth,l=p.normalDirectionHeight,e=p.normalDirectionDepth,w=p.halfWidth,b=p.halfHeight,a=p.halfDepth,u=tt-ft,f=it-et,r=rt-ot,s=c.x*u+c.y*f+c.z*r,h=l.x*u+l.y*f+l.z*r,o=e.x*u+e.y*f+e.z*r,st,ht,ct,v,g,nt=0;s>w?s=w:s<-w?s=-w:nt=1,h>b?h=b:h<-b?h=-b:nt|=2,o>a?o=a:o<-a?o=-a:nt|=4,nt==7?(u=s<0?w+s:w-s,f=h<0?b+h:b-h,r=o<0?a+o:a-o,u<f?u<r?(v=u-w,s<0?(s=-w,u=c.x,f=c.y,r=c.z):(s=w,u=-c.x,f=-c.y,r=-c.z)):(v=r-a,o<0?(o=-a,u=e.x,f=e.y,r=e.z):(o=a,u=-e.x,f=-e.y,r=-e.z)):f<r?(v=f-b,h<0?(h=-b,u=l.x,f=l.y,r=l.z):(h=b,u=-l.x,f=-l.y,r=-l.z)):(v=r-a,o<0?(o=-a,u=e.x,f=e.y,r=e.z):(o=a,u=-e.x,f=-e.y,r=-e.z)),st=ft+s*c.x+h*l.x+o*e.x,ht=et+s*c.y+h*l.y+o*e.y,ct=ot+s*c.z+h*l.z+o*e.z,i.addPoint(tt+y*u,it+y*f,rt+y*r,u,f,r,v-y,this.flip)):(st=ft+s*c.x+h*l.x+o*e.x,ht=et+s*c.y+h*l.y+o*e.y,ct=ot+s*c.z+h*l.z+o*e.z,u=st-k.x,f=ht-k.y,r=ct-k.z,v=u*u+f*f+r*r,v>0&&v<y*y&&(v=Math.sqrt(v),g=1/v,u*=g,f*=g,r*=g,i.addPoint(tt+y*u,it+y*f,rt+y*r,u,f,r,v-y,this.flip)))},OIMO.SphereSphereCollisionDetector=function(){OIMO.CollisionDetector.call(this)},OIMO.SphereSphereCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype),OIMO.SphereSphereCollisionDetector.prototype.detectCollision=function(n,t,i){var a=n,v=t,r=a.position,c=v.position,f=c.x-r.x,e=c.y-r.y,o=c.z-r.z,u=f*f+e*e+o*o,s=a.radius,y=v.radius,l=s+y,h;u>0&&u<l*l&&(u=Math.sqrt(u),h=1/u,f*=h,e*=h,o*=h,i.addPoint(r.x+f*s,r.y+e*s,r.z+o*s,f,e,o,u-l,!1))},OIMO.nextID=0,OIMO.Shape=function(n){this.prev=null,this.next=null,this.type=0,this.proxy=null,this.parent=null,this.contactLink=null,this.numContacts=0,this.id=OIMO.nextID++,this.position=new OIMO.Vec3,this.relativePosition=(new OIMO.Vec3).copy(n.relativePosition),this.rotation=new OIMO.Mat33,this.relativeRotation=(new OIMO.Mat33).copy(n.relativeRotation),this.aabb=new OIMO.AABB,this.density=n.density,this.friction=n.friction,this.restitution=n.restitution,this.belongsTo=n.belongsTo,this.collidesWith=n.collidesWith},OIMO.Shape.prototype={constructor:OIMO.Shape,calculateMassInfo:function(){throw new Error("Inheritance error.");},updateProxy:function(){throw new Error("Inheritance error.");}},OIMO.ShapeConfig=function(){this.relativePosition=new OIMO.Vec3,this.relativeRotation=new OIMO.Mat33,this.friction=.4,this.restitution=.2,this.density=1,this.belongsTo=1,this.collidesWith=4294967295},OIMO.MassInfo=function(){this.mass=0,this.inertia=new OIMO.Mat33},OIMO.BoxShape=function(n,t,i,r){OIMO.Shape.call(this,n),this.width=t,this.halfWidth=t*.5,this.height=i,this.halfHeight=i*.5,this.depth=r,this.halfDepth=r*.5,this.normalDirectionWidth=new OIMO.Vec3,this.normalDirectionHeight=new OIMO.Vec3,this.normalDirectionDepth=new OIMO.Vec3,this.halfDirectionWidth=new OIMO.Vec3,this.halfDirectionHeight=new OIMO.Vec3,this.halfDirectionDepth=new OIMO.Vec3,this.vertex1=new OIMO.Vec3,this.vertex2=new OIMO.Vec3,this.vertex3=new OIMO.Vec3,this.vertex4=new OIMO.Vec3,this.vertex5=new OIMO.Vec3,this.vertex6=new OIMO.Vec3,this.vertex7=new OIMO.Vec3,this.vertex8=new OIMO.Vec3,this.type=OIMO.SHAPE_BOX},OIMO.BoxShape.prototype=Object.create(OIMO.Shape.prototype),OIMO.BoxShape.prototype.calculateMassInfo=function(n){var t=this.width*this.height*this.depth*this.density;n.mass=t,n.inertia.init(t*(this.height*this.height+this.depth*this.depth)/12,0,0,0,t*(this.width*this.width+this.depth*this.depth)/12,0,0,0,t*(this.width*this.width+this.height*this.height)/12)},OIMO.BoxShape.prototype.updateProxy=function(){var a,v,y;this.normalDirectionWidth.x=this.rotation.e00,this.normalDirectionWidth.y=this.rotation.e10,this.normalDirectionWidth.z=this.rotation.e20,this.normalDirectionHeight.x=this.rotation.e01,this.normalDirectionHeight.y=this.rotation.e11,this.normalDirectionHeight.z=this.rotation.e21,this.normalDirectionDepth.x=this.rotation.e02,this.normalDirectionDepth.y=this.rotation.e12,this.normalDirectionDepth.z=this.rotation.e22,this.halfDirectionWidth.x=this.rotation.e00*this.halfWidth,this.halfDirectionWidth.y=this.rotation.e10*this.halfWidth,this.halfDirectionWidth.z=this.rotation.e20*this.halfWidth,this.halfDirectionHeight.x=this.rotation.e01*this.halfHeight,this.halfDirectionHeight.y=this.rotation.e11*this.halfHeight,this.halfDirectionHeight.z=this.rotation.e21*this.halfHeight,this.halfDirectionDepth.x=this.rotation.e02*this.halfDepth,this.halfDirectionDepth.y=this.rotation.e12*this.halfDepth,this.halfDirectionDepth.z=this.rotation.e22*this.halfDepth;var n=this.halfDirectionWidth.x,t=this.halfDirectionWidth.y,i=this.halfDirectionWidth.z,r=this.halfDirectionHeight.x,u=this.halfDirectionHeight.y,f=this.halfDirectionHeight.z,e=this.halfDirectionDepth.x,o=this.halfDirectionDepth.y,s=this.halfDirectionDepth.z,h=this.position.x,c=this.position.y,l=this.position.z;this.vertex1.x=h+n+r+e,this.vertex1.y=c+t+u+o,this.vertex1.z=l+i+f+s,this.vertex2.x=h+n+r-e,this.vertex2.y=c+t+u-o,this.vertex2.z=l+i+f-s,this.vertex3.x=h+n-r+e,this.vertex3.y=c+t-u+o,this.vertex3.z=l+i-f+s,this.vertex4.x=h+n-r-e,this.vertex4.y=c+t-u-o,this.vertex4.z=l+i-f-s,this.vertex5.x=h-n+r+e,this.vertex5.y=c-t+u+o,this.vertex5.z=l-i+f+s,this.vertex6.x=h-n+r-e,this.vertex6.y=c-t+u-o,this.vertex6.z=l-i+f-s,this.vertex7.x=h-n-r+e,this.vertex7.y=c-t-u+o,this.vertex7.z=l-i-f+s,this.vertex8.x=h-n-r-e,this.vertex8.y=c-t-u-o,this.vertex8.z=l-i-f-s,a=this.halfDirectionWidth.x<0?-this.halfDirectionWidth.x:this.halfDirectionWidth.x,v=this.halfDirectionWidth.y<0?-this.halfDirectionWidth.y:this.halfDirectionWidth.y,y=this.halfDirectionWidth.z<0?-this.halfDirectionWidth.z:this.halfDirectionWidth.z,this.halfDirectionHeight.x<0?a-=this.halfDirectionHeight.x:a+=this.halfDirectionHeight.x,this.halfDirectionHeight.y<0?v-=this.halfDirectionHeight.y:v+=this.halfDirectionHeight.y,this.halfDirectionHeight.z<0?y-=this.halfDirectionHeight.z:y+=this.halfDirectionHeight.z,this.halfDirectionDepth.x<0?a-=this.halfDirectionDepth.x:a+=this.halfDirectionDepth.x,this.halfDirectionDepth.y<0?v-=this.halfDirectionDepth.y:v+=this.halfDirectionDepth.y,this.halfDirectionDepth.z<0?y-=this.halfDirectionDepth.z:y+=this.halfDirectionDepth.z,this.aabb.init(this.position.x-a-.005,this.position.x+a+.005,this.position.y-v-.005,this.position.y+v+.005,this.position.z-y-.005,this.position.z+y+.005),this.proxy!==null&&this.proxy.update()},OIMO.SphereShape=function(n,t){OIMO.Shape.call(this,n),this.radius=t,this.type=OIMO.SHAPE_SPHERE},OIMO.SphereShape.prototype=Object.create(OIMO.Shape.prototype),OIMO.SphereShape.prototype.calculateMassInfo=function(n){var i=4/3*Math.PI*this.radius*this.radius*this.radius*this.density,t;n.mass=i,t=i*this.radius*this.radius*2/5,n.inertia.init(t,0,0,0,t,0,0,0,t)},OIMO.SphereShape.prototype.updateProxy=function(){this.aabb.init(this.position.x-this.radius-.005,this.position.x+this.radius+.005,this.position.y-this.radius-.005,this.position.y+this.radius+.005,this.position.z-this.radius-.005,this.position.z+this.radius+.005),this.proxy!=null&&this.proxy.update()},OIMO.Constraint=function(){this.parent=null,this.body1=null,this.body2=null,this.addedToIsland=!1},OIMO.Constraint.prototype={constructor:OIMO.Constraint,preSolve:function(){throw new Error("Inheritance error.");},solve:function(){throw new Error("Inheritance error.");},postSolve:function(){throw new Error("Inheritance error.");}},OIMO.ContactPointDataBuffer=function(){this.norX=NaN,this.norY=NaN,this.norZ=NaN,this.tanX=NaN,this.tanY=NaN,this.tanZ=NaN,this.binX=NaN,this.binY=NaN,this.binZ=NaN,this.rp1X=NaN,this.rp1Y=NaN,this.rp1Z=NaN,this.rp2X=NaN,this.rp2Y=NaN,this.rp2Z=NaN,this.norU1X=NaN,this.norU1Y=NaN,this.norU1Z=NaN,this.norU2X=NaN,this.norU2Y=NaN,this.norU2Z=NaN,this.tanU1X=NaN,this.tanU1Y=NaN,this.tanU1Z=NaN,this.tanU2X=NaN,this.tanU2Y=NaN,this.tanU2Z=NaN,this.binU1X=NaN,this.binU1Y=NaN,this.binU1Z=NaN,this.binU2X=NaN,this.binU2Y=NaN,this.binU2Z=NaN,this.norT1X=NaN,this.norT1Y=NaN,this.norT1Z=NaN,this.norT2X=NaN,this.norT2Y=NaN,this.norT2Z=NaN,this.tanT1X=NaN,this.tanT1Y=NaN,this.tanT1Z=NaN,this.tanT2X=NaN,this.tanT2Y=NaN,this.tanT2Z=NaN,this.binT1X=NaN,this.binT1Y=NaN,this.binT1Z=NaN,this.binT2X=NaN,this.binT2Y=NaN,this.binT2Z=NaN,this.norTU1X=NaN,this.norTU1Y=NaN,this.norTU1Z=NaN,this.norTU2X=NaN,this.norTU2Y=NaN,this.norTU2Z=NaN,this.tanTU1X=NaN,this.tanTU1Y=NaN,this.tanTU1Z=NaN,this.tanTU2X=NaN,this.tanTU2Y=NaN,this.tanTU2Z=NaN,this.binTU1X=NaN,this.binTU1Y=NaN,this.binTU1Z=NaN,this.binTU2X=NaN,this.binTU2Y=NaN,this.binTU2Z=NaN,this.norImp=NaN,this.tanImp=NaN,this.binImp=NaN,this.norDen=NaN,this.tanDen=NaN,this.binDen=NaN,this.norTar=NaN,this.next=null,this.last=!1},OIMO.ImpulseDataBuffer=function(){this.lp1X=NaN,this.lp1Y=NaN,this.lp1Z=NaN,this.lp2X=NaN,this.lp2Y=NaN,this.lp2Z=NaN,this.impulse=NaN},OIMO.ManifoldPoint=function(){this.warmStarted=!1,this.position=new OIMO.Vec3,this.localPoint1=new OIMO.Vec3,this.localPoint2=new OIMO.Vec3,this.normal=new OIMO.Vec3,this.tangent=new OIMO.Vec3,this.binormal=new OIMO.Vec3,this.normalImpulse=0,this.tangentImpulse=0,this.binormalImpulse=0,this.normalDenominator=0,this.tangentDenominator=0,this.binormalDenominator=0,this.penetration=0},OIMO.ContactLink=function(n){this.prev=null,this.next=null,this.shape=null,this.body=null,this.contact=n},OIMO.ContactManifold=function(){this.body1=null,this.body2=null,this.numPoints=0,this.points=[],this.points.length=4,this.points[0]=new OIMO.ManifoldPoint,this.points[1]=new OIMO.ManifoldPoint,this.points[2]=new OIMO.ManifoldPoint,this.points[3]=new OIMO.ManifoldPoint},OIMO.ContactManifold.prototype={constructor:OIMO.ContactManifold,reset:function(n,t){this.body1=n.parent,this.body2=t.parent,this.numPoints=0},addPoint:function(n,t,i,r,u,f,e,o){var h=this.points[this.numPoints++];h.position.x=n,h.position.y=t,h.position.z=i;var s=this.body1.rotation,c=n-this.body1.position.x,l=t-this.body1.position.y,a=i-this.body1.position.z;h.localPoint1.x=c*s.e00+l*s.e10+a*s.e20,h.localPoint1.y=c*s.e01+l*s.e11+a*s.e21,h.localPoint1.z=c*s.e02+l*s.e12+a*s.e22,s=this.body2.rotation,c=n-this.body2.position.x,l=t-this.body2.position.y,a=i-this.body2.position.z,h.localPoint2.x=c*s.e00+l*s.e10+a*s.e20,h.localPoint2.y=c*s.e01+l*s.e11+a*s.e21,h.localPoint2.z=c*s.e02+l*s.e12+a*s.e22,h.normalImpulse=0,o?(h.normal.x=-r,h.normal.y=-u,h.normal.z=-f):(h.normal.x=r,h.normal.y=u,h.normal.z=f),h.penetration=e,h.warmStarted=!1}},OIMO.Contact=function(){this.shape1=null,this.shape2=null,this.body1=null,this.body2=null,this.prev=null,this.next=null,this.persisting=!1,this.sleeping=!1,this.detector=null,this.constraint=null,this.touching=!1,this.b1Link=new OIMO.ContactLink(this),this.b2Link=new OIMO.ContactLink(this),this.s1Link=new OIMO.ContactLink(this),this.s2Link=new OIMO.ContactLink(this),this.manifold=new OIMO.ContactManifold,this.buffer=[],this.buffer[0]=new OIMO.ImpulseDataBuffer,this.buffer[1]=new OIMO.ImpulseDataBuffer,this.buffer[2]=new OIMO.ImpulseDataBuffer,this.buffer[3]=new OIMO.ImpulseDataBuffer,this.points=this.manifold.points,this.constraint=new OIMO.ContactConstraint(this.manifold)},OIMO.Contact.prototype={constructor:OIMO.Contact,mixRestitution:function(n,t){return Math.sqrt(n*t)},mixFriction:function(n,t){return Math.sqrt(n*t)},updateManifold:function(){var u,i,t,n,l,r,c,v;for(this.constraint.restitution=this.mixRestitution(this.shape1.restitution,this.shape2.restitution),this.constraint.friction=this.mixFriction(this.shape1.friction,this.shape2.friction),u=this.manifold.numPoints,i=0;i<u;i++)t=this.buffer[i],n=this.points[i],t.lp1X=n.localPoint1.x,t.lp1Y=n.localPoint1.y,t.lp1Z=n.localPoint1.z,t.lp2X=n.localPoint2.x,t.lp2Y=n.localPoint2.y,t.lp2Z=n.localPoint2.z,t.impulse=n.normalImpulse;if(this.manifold.numPoints=0,this.detector.detectCollision(this.shape1,this.shape2,this.manifold),l=this.manifold.numPoints,l==0){this.touching=!1;return}for(this.touching=!0,i=0;i<l;i++){n=this.points[i];var y=n.localPoint1.x,p=n.localPoint1.y,w=n.localPoint1.z,b=n.localPoint2.x,k=n.localPoint2.y,d=n.localPoint2.z,f=-1,h=.0004;for(r=0;r<u;r++){t=this.buffer[r];var e=t.lp1X-y,o=t.lp1Y-p,s=t.lp1Z-w,a=e*e+o*o+s*s;e=t.lp2X-b,o=t.lp2Y-k,s=t.lp2Z-d,c=e*e+o*o+s*s,a<c?a<h&&(h=a,f=r):c<h&&(h=c,f=r)}f!=-1?(v=this.buffer[f],this.buffer[f]=this.buffer[--u],this.buffer[u]=v,n.normalImpulse=v.impulse,n.warmStarted=!0):(n.normalImpulse=0,n.warmStarted=!1)}},attach:function(n,t){this.shape1=n,this.shape2=t,this.body1=n.parent,this.body2=t.parent,this.manifold.body1=this.body1,this.manifold.body2=this.body2,this.constraint.body1=this.body1,this.constraint.body2=this.body2,this.constraint.attach(),this.s1Link.shape=t,this.s1Link.body=this.body2,this.s2Link.shape=n,this.s2Link.body=this.body1,n.contactLink!=null?(this.s1Link.next=n.contactLink).prev=this.s1Link:this.s1Link.next=null,n.contactLink=this.s1Link,n.numContacts++,t.contactLink!=null?(this.s2Link.next=t.contactLink).prev=this.s2Link:this.s2Link.next=null,t.contactLink=this.s2Link,t.numContacts++,this.b1Link.shape=t,this.b1Link.body=this.body2,this.b2Link.shape=n,this.b2Link.body=this.body1,this.body1.contactLink!=null?(this.b1Link.next=this.body1.contactLink).prev=this.b1Link:this.b1Link.next=null,this.body1.contactLink=this.b1Link,this.body1.numContacts++,this.body2.contactLink!=null?(this.b2Link.next=this.body2.contactLink).prev=this.b2Link:this.b2Link.next=null,this.body2.contactLink=this.b2Link,this.body2.numContacts++,this.prev=null,this.next=null,this.persisting=!0,this.sleeping=this.body1.sleeping&&this.body2.sleeping,this.manifold.numPoints=0},detach:function(){var t=this.s1Link.prev,n=this.s1Link.next;t!=null&&(t.next=n),n!=null&&(n.prev=t),this.shape1.contactLink==this.s1Link&&(this.shape1.contactLink=n),this.s1Link.prev=null,this.s1Link.next=null,this.s1Link.shape=null,this.s1Link.body=null,this.shape1.numContacts--,t=this.s2Link.prev,n=this.s2Link.next,t!=null&&(t.next=n),n!=null&&(n.prev=t),this.shape2.contactLink==this.s2Link&&(this.shape2.contactLink=n),this.s2Link.prev=null,this.s2Link.next=null,this.s2Link.shape=null,this.s2Link.body=null,this.shape2.numContacts--,t=this.b1Link.prev,n=this.b1Link.next,t!=null&&(t.next=n),n!=null&&(n.prev=t),this.body1.contactLink==this.b1Link&&(this.body1.contactLink=n),this.b1Link.prev=null,this.b1Link.next=null,this.b1Link.shape=null,this.b1Link.body=null,this.body1.numContacts--,t=this.b2Link.prev,n=this.b2Link.next,t!=null&&(t.next=n),n!=null&&(n.prev=t),this.body2.contactLink==this.b2Link&&(this.body2.contactLink=n),this.b2Link.prev=null,this.b2Link.next=null,this.b2Link.shape=null,this.b2Link.body=null,this.body2.numContacts--,this.manifold.body1=null,this.manifold.body2=null,this.constraint.body1=null,this.constraint.body2=null,this.constraint.detach(),this.shape1=null,this.shape2=null,this.body1=null,this.body2=null}},OIMO.ContactConstraint=function(n){OIMO.Constraint.call(this),this.restitution=NaN,this.friction=NaN,this.p1=null,this.p2=null,this.lv1=null,this.lv2=null,this.av1=null,this.av2=null,this.i1=null,this.i2=null,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.m1=NaN,this.m2=NaN,this.num=0,this.manifold=n,this.ps=n.points,this.cs=new OIMO.ContactPointDataBuffer,this.cs.next=new OIMO.ContactPointDataBuffer,this.cs.next.next=new OIMO.ContactPointDataBuffer,this.cs.next.next.next=new OIMO.ContactPointDataBuffer},OIMO.ContactConstraint.prototype=Object.create(OIMO.Constraint.prototype),OIMO.ContactConstraint.prototype.attach=function(){this.p1=this.body1.position,this.p2=this.body2.position,this.lv1=this.body1.linearVelocity,this.av1=this.body1.angularVelocity,this.lv2=this.body2.linearVelocity,this.av2=this.body2.angularVelocity,this.i1=this.body1.inverseInertia,this.i2=this.body2.inverseInertia},OIMO.ContactConstraint.prototype.detach=function(){this.p1=null,this.p2=null,this.lv1=null,this.lv2=null,this.av1=null,this.av2=null,this.i1=null,this.i2=null},OIMO.ContactConstraint.prototype.preSolve=function(n,t){var i,ui,d,r,u,f,g,nt,tt,bi,ki,di,k,fi,oi;this.m1=this.body1.inverseMass,this.m2=this.body2.inverseMass,this.i1e00=this.i1.e00,this.i1e01=this.i1.e01,this.i1e02=this.i1.e02,this.i1e10=this.i1.e10,this.i1e11=this.i1.e11,this.i1e12=this.i1.e12,this.i1e20=this.i1.e20,this.i1e21=this.i1.e21,this.i1e22=this.i1.e22,this.i2e00=this.i2.e00,this.i2e01=this.i2.e01,this.i2e02=this.i2.e02,this.i2e10=this.i2.e10,this.i2e11=this.i2.e11,this.i2e12=this.i2.e12,this.i2e20=this.i2.e20,this.i2e21=this.i2.e21,this.i2e22=this.i2.e22;var gi=this.p1.x,nr=this.p1.y,tr=this.p1.z,ir=this.p2.x,rr=this.p2.y,ur=this.p2.z,ei=this.m1+this.m2;for(this.num=this.manifold.numPoints,i=this.cs,ui=0;ui<this.num;ui++){d=this.ps[ui],r=d.position.x,u=d.position.y,f=d.position.z;var a=r-gi,v=u-nr,y=f-tr,p=r-ir,w=u-rr,b=f-ur;i.rp1X=a,i.rp1Y=v,i.rp1Z=y,i.rp2X=p,i.rp2Y=w,i.rp2Z=b,i.norImp=d.normalImpulse,i.tanImp=d.tangentImpulse,i.binImp=d.binormalImpulse;var e=d.normal.x,o=d.normal.y,s=d.normal.z,si=this.lv2.x+this.av2.y*b-this.av2.z*w-(this.lv1.x+this.av1.y*y-this.av1.z*v),hi=this.lv2.y+this.av2.z*p-this.av2.x*b-(this.lv1.y+this.av1.z*a-this.av1.x*y),ci=this.lv2.z+this.av2.x*w-this.av2.y*p-(this.lv1.z+this.av1.x*v-this.av1.y*a),ft=e*si+o*hi+s*ci,h=si-ft*e,c=hi-ft*o,l=ci-ft*s,et=h*h+c*c+l*l;et>.04?et=1/Math.sqrt(et):(h=o*e-s*s,c=-s*o-e*e,l=e*s+o*o,et=1/Math.sqrt(h*h+c*c+l*l)),h*=et,c*=et,l*=et;var it=o*l-s*c,rt=s*h-e*l,ut=e*c-o*h;i.norX=e,i.norY=o,i.norZ=s,i.tanX=h,i.tanY=c,i.tanZ=l,i.binX=it,i.binY=rt,i.binZ=ut,i.norU1X=e*this.m1,i.norU1Y=o*this.m1,i.norU1Z=s*this.m1,i.norU2X=e*this.m2,i.norU2Y=o*this.m2,i.norU2Z=s*this.m2,i.tanU1X=h*this.m1,i.tanU1Y=c*this.m1,i.tanU1Z=l*this.m1,i.tanU2X=h*this.m2,i.tanU2Y=c*this.m2,i.tanU2Z=l*this.m2,i.binU1X=it*this.m1,i.binU1Y=rt*this.m1,i.binU1Z=ut*this.m1,i.binU2X=it*this.m2,i.binU2Y=rt*this.m2,i.binU2Z=ut*this.m2;var ot=v*s-y*o,st=y*e-a*s,ht=a*o-v*e,ct=w*s-b*o,lt=b*e-p*s,at=p*o-w*e,vt=v*l-y*c,yt=y*h-a*l,pt=a*c-v*h,wt=w*l-b*c,bt=b*h-p*l,kt=p*c-w*h,dt=v*ut-y*rt,gt=y*it-a*ut,ni=a*rt-v*it,ti=w*ut-b*rt,ii=b*it-p*ut,ri=p*rt-w*it,li=ot*this.i1e00+st*this.i1e01+ht*this.i1e02,ai=ot*this.i1e10+st*this.i1e11+ht*this.i1e12,vi=ot*this.i1e20+st*this.i1e21+ht*this.i1e22,yi=ct*this.i2e00+lt*this.i2e01+at*this.i2e02,pi=ct*this.i2e10+lt*this.i2e11+at*this.i2e12,wi=ct*this.i2e20+lt*this.i2e21+at*this.i2e22,fr=vt*this.i1e00+yt*this.i1e01+pt*this.i1e02,er=vt*this.i1e10+yt*this.i1e11+pt*this.i1e12,or=vt*this.i1e20+yt*this.i1e21+pt*this.i1e22,sr=wt*this.i2e00+bt*this.i2e01+kt*this.i2e02,hr=wt*this.i2e10+bt*this.i2e11+kt*this.i2e12,cr=wt*this.i2e20+bt*this.i2e21+kt*this.i2e22,lr=dt*this.i1e00+gt*this.i1e01+ni*this.i1e02,ar=dt*this.i1e10+gt*this.i1e11+ni*this.i1e12,vr=dt*this.i1e20+gt*this.i1e21+ni*this.i1e22,yr=ti*this.i2e00+ii*this.i2e01+ri*this.i2e02,pr=ti*this.i2e10+ii*this.i2e11+ri*this.i2e12,wr=ti*this.i2e20+ii*this.i2e21+ri*this.i2e22;i.norT1X=ot,i.norT1Y=st,i.norT1Z=ht,i.tanT1X=vt,i.tanT1Y=yt,i.tanT1Z=pt,i.binT1X=dt,i.binT1Y=gt,i.binT1Z=ni,i.norT2X=ct,i.norT2Y=lt,i.norT2Z=at,i.tanT2X=wt,i.tanT2Y=bt,i.tanT2Z=kt,i.binT2X=ti,i.binT2Y=ii,i.binT2Z=ri,i.norTU1X=li,i.norTU1Y=ai,i.norTU1Z=vi,i.tanTU1X=fr,i.tanTU1Y=er,i.tanTU1Z=or,i.binTU1X=lr,i.binTU1Y=ar,i.binTU1Z=vr,i.norTU2X=yi,i.norTU2Y=pi,i.norTU2Z=wi,i.tanTU2X=sr,i.tanTU2Y=hr,i.tanTU2Z=cr,i.binTU2X=yr,i.binTU2Y=pr,i.binTU2Z=wr,r=ot*this.i1e00+st*this.i1e01+ht*this.i1e02,u=ot*this.i1e10+st*this.i1e11+ht*this.i1e12,f=ot*this.i1e20+st*this.i1e21+ht*this.i1e22,g=u*y-f*v,nt=f*a-r*y,tt=r*v-u*a,r=ct*this.i2e00+lt*this.i2e01+at*this.i2e02,u=ct*this.i2e10+lt*this.i2e11+at*this.i2e12,f=ct*this.i2e20+lt*this.i2e21+at*this.i2e22,g+=u*b-f*w,nt+=f*p-r*b,tt+=r*w-u*p,bi=1/(ei+e*g+o*nt+s*tt),r=vt*this.i1e00+yt*this.i1e01+pt*this.i1e02,u=vt*this.i1e10+yt*this.i1e11+pt*this.i1e12,f=vt*this.i1e20+yt*this.i1e21+pt*this.i1e22,g=u*y-f*v,nt=f*a-r*y,tt=r*v-u*a,r=wt*this.i2e00+bt*this.i2e01+kt*this.i2e02,u=wt*this.i2e10+bt*this.i2e11+kt*this.i2e12,f=wt*this.i2e20+bt*this.i2e21+kt*this.i2e22,g+=u*b-f*w,nt+=f*p-r*b,tt+=r*w-u*p,ki=1/(ei+h*g+c*nt+l*tt),r=dt*this.i1e00+gt*this.i1e01+ni*this.i1e02,u=dt*this.i1e10+gt*this.i1e11+ni*this.i1e12,f=dt*this.i1e20+gt*this.i1e21+ni*this.i1e22,g=u*y-f*v,nt=f*a-r*y,tt=r*v-u*a,r=ti*this.i2e00+ii*this.i2e01+ri*this.i2e02,u=ti*this.i2e10+ii*this.i2e11+ri*this.i2e12,f=ti*this.i2e20+ii*this.i2e21+ri*this.i2e22,g+=u*b-f*w,nt+=f*p-r*b,tt+=r*w-u*p,di=1/(ei+it*g+rt*nt+ut*tt),i.norDen=bi,i.tanDen=ki,i.binDen=di,d.warmStarted?(k=d.normalImpulse,this.lv1.x+=i.norU1X*k,this.lv1.y+=i.norU1Y*k,this.lv1.z+=i.norU1Z*k,this.av1.x+=li*k,this.av1.y+=ai*k,this.av1.z+=vi*k,this.lv2.x-=i.norU2X*k,this.lv2.y-=i.norU2Y*k,this.lv2.z-=i.norU2Z*k,this.av2.x-=yi*k,this.av2.y-=pi*k,this.av2.z-=wi*k,i.norImp=k,i.tanImp=0,i.binImp=0,ft=0):(i.norImp=0,i.tanImp=0,i.binImp=0),ft>-1&&(ft=0),fi=this.restitution*-ft,oi=-(d.penetration+.005)*t*.05,fi<oi&&(fi=oi),i.norTar=fi,i.last=ui==this.num-1,i=i.next}},OIMO.ContactConstraint.prototype.solve=function(){for(var y=this.lv1.x,p=this.lv1.y,w=this.lv1.z,b=this.lv2.x,k=this.lv2.y,d=this.lv2.z,e=this.av1.x,o=this.av1.y,s=this.av1.z,h=this.av2.x,c=this.av2.y,l=this.av2.z,n=this.cs,v;;){var g,t,tt,i,a,r=n.norImp,u=n.tanImp,f=n.binImp,nt=-r*this.friction,it=b-y,rt=k-p,ut=d-w;if(a=it*n.tanX+rt*n.tanY+ut*n.tanZ+h*n.tanT2X+c*n.tanT2Y+l*n.tanT2Z-e*n.tanT1X-o*n.tanT1Y-s*n.tanT1Z,g=u,t=a*n.tanDen,u+=t,a=it*n.binX+rt*n.binY+ut*n.binZ+h*n.binT2X+c*n.binT2Y+l*n.binT2Z-e*n.binT1X-o*n.binT1Y-s*n.binT1Z,tt=f,i=a*n.binDen,f+=i,v=u*u+f*f,v>nt*nt&&(v=nt/Math.sqrt(v),u*=v,f*=v),t=u-g,i=f-tt,y+=n.tanU1X*t+n.binU1X*i,p+=n.tanU1Y*t+n.binU1Y*i,w+=n.tanU1Z*t+n.binU1Z*i,e+=n.tanTU1X*t+n.binTU1X*i,o+=n.tanTU1Y*t+n.binTU1Y*i,s+=n.tanTU1Z*t+n.binTU1Z*i,b-=n.tanU2X*t+n.binU2X*i,k-=n.tanU2Y*t+n.binU2Y*i,d-=n.tanU2Z*t+n.binU2Z*i,h-=n.tanTU2X*t+n.binTU2X*i,c-=n.tanTU2Y*t+n.binTU2Y*i,l-=n.tanTU2Z*t+n.binTU2Z*i,a=(b-y)*n.norX+(k-p)*n.norY+(d-w)*n.norZ+h*n.norT2X+c*n.norT2Y+l*n.norT2Z-e*n.norT1X-o*n.norT1Y-s*n.norT1Z,g=r,t=(a-n.norTar)*n.norDen,r+=t,r>0&&(r=0),t=r-g,y+=n.norU1X*t,p+=n.norU1Y*t,w+=n.norU1Z*t,e+=n.norTU1X*t,o+=n.norTU1Y*t,s+=n.norTU1Z*t,b-=n.norU2X*t,k-=n.norU2Y*t,d-=n.norU2Z*t,h-=n.norTU2X*t,c-=n.norTU2Y*t,l-=n.norTU2Z*t,n.norImp=r,n.tanImp=u,n.binImp=f,n.last)break;n=n.next}this.lv1.x=y,this.lv1.y=p,this.lv1.z=w,this.lv2.x=b,this.lv2.y=k,this.lv2.z=d,this.av1.x=e,this.av1.y=o,this.av1.z=s,this.av2.x=h,this.av2.y=c,this.av2.z=l},OIMO.ContactConstraint.prototype.postSolve=function(){for(var n=this.cs,t,i=0;i<this.num;i++)t=this.ps[i],t.normal.x=n.norX,t.normal.y=n.norY,t.normal.z=n.norZ,t.tangent.x=n.tanX,t.tangent.y=n.tanY,t.tangent.z=n.tanZ,t.binormal.x=n.binX,t.binormal.y=n.binY,t.binormal.z=n.binZ,t.normalImpulse=n.norImp,t.tangentImpulse=n.tanImp,t.binormalImpulse=n.binImp,t.normalDenominator=n.norDen,t.tangentDenominator=n.tanDen,t.binormalDenominator=n.binDen,n=n.next},OIMO.AngularConstraint=function(n,t){this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.d00=NaN,this.d01=NaN,this.d02=NaN,this.d10=NaN,this.d11=NaN,this.d12=NaN,this.d20=NaN,this.d21=NaN,this.d22=NaN,this.ax=NaN,this.ay=NaN,this.az=NaN,this.velx=NaN,this.vely=NaN,this.velz=NaN,this.joint=n,this.targetOrientation=(new OIMO.Quat).invert(t),this.relativeOrientation=new OIMO.Quat,this.b1=n.body1,this.b2=n.body2,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.impx=0,this.impy=0,this.impz=0},OIMO.AngularConstraint.prototype={constructor:OIMO.AngularConstraint,preSolve:function(n,t){var r;this.i1e00=this.i1.e00,this.i1e01=this.i1.e01,this.i1e02=this.i1.e02,this.i1e10=this.i1.e10,this.i1e11=this.i1.e11,this.i1e12=this.i1.e12,this.i1e20=this.i1.e20,this.i1e21=this.i1.e21,this.i1e22=this.i1.e22,this.i2e00=this.i2.e00,this.i2e01=this.i2.e01,this.i2e02=this.i2.e02,this.i2e10=this.i2.e10,this.i2e11=this.i2.e11,this.i2e12=this.i2.e12,this.i2e20=this.i2.e20,this.i2e21=this.i2.e21,this.i2e22=this.i2.e22;var c=this.i1e00+this.i2e00,u=this.i1e01+this.i2e01,f=this.i1e02+this.i2e02,l=this.i1e10+this.i2e10,e=this.i1e11+this.i2e11,o=this.i1e12+this.i2e12,a=this.i1e20+this.i2e20,s=this.i1e21+this.i2e21,h=this.i1e22+this.i2e22,i=1/(c*(e*h-s*o)+l*(s*f-u*h)+a*(u*o-e*f));this.d00=(e*h-o*s)*i,this.d01=(f*s-u*h)*i,this.d02=(u*o-f*e)*i,this.d10=(o*a-l*h)*i,this.d11=(c*h-f*a)*i,this.d12=(f*l-c*o)*i,this.d20=(l*s-e*a)*i,this.d21=(u*a-c*s)*i,this.d22=(c*e-u*l)*i,this.relativeOrientation.invert(this.b1.orientation),this.relativeOrientation.mul(this.targetOrientation,this.relativeOrientation),this.relativeOrientation.mul(this.b2.orientation,this.relativeOrientation),i=this.relativeOrientation.s*2,this.velx=this.relativeOrientation.x*i,this.vely=this.relativeOrientation.y*i,this.velz=this.relativeOrientation.z*i,r=Math.sqrt(this.velx*this.velx+this.vely*this.vely+this.velz*this.velz),r>.02?(r=(.02-r)/r*t*.05,this.velx*=r,this.vely*=r,this.velz*=r):(this.velx=0,this.vely=0,this.velz=0),this.a1.x+=this.impx*this.i1e00+this.impy*this.i1e01+this.impz*this.i1e02,this.a1.y+=this.impx*this.i1e10+this.impy*this.i1e11+this.impz*this.i1e12,this.a1.z+=this.impx*this.i1e20+this.impy*this.i1e21+this.impz*this.i1e22,this.a2.x-=this.impx*this.i2e00+this.impy*this.i2e01+this.impz*this.i2e02,this.a2.y-=this.impx*this.i2e10+this.impy*this.i2e11+this.impz*this.i2e12,this.a2.z-=this.impx*this.i2e20+this.impy*this.i2e21+this.impz*this.i2e22},solve:function(){var r=this.a2.x-this.a1.x-this.velx,u=this.a2.y-this.a1.y-this.vely,f=this.a2.z-this.a1.z-this.velz,n=r*this.d00+u*this.d01+f*this.d02,t=r*this.d10+u*this.d11+f*this.d12,i=r*this.d20+u*this.d21+f*this.d22;this.impx+=n,this.impy+=t,this.impz+=i,this.a1.x+=n*this.i1e00+t*this.i1e01+i*this.i1e02,this.a1.y+=n*this.i1e10+t*this.i1e11+i*this.i1e12,this.a1.z+=n*this.i1e20+t*this.i1e21+i*this.i1e22,this.a2.x-=n*this.i2e00+t*this.i2e01+i*this.i2e02,this.a2.y-=n*this.i2e10+t*this.i2e11+i*this.i2e12,this.a2.z-=n*this.i2e20+t*this.i2e21+i*this.i2e22}},OIMO.LinearConstraint=function(n){this.m1=NaN,this.m2=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.d00=NaN,this.d01=NaN,this.d02=NaN,this.d10=NaN,this.d11=NaN,this.d12=NaN,this.d20=NaN,this.d21=NaN,this.d22=NaN,this.r1x=NaN,this.r1y=NaN,this.r1z=NaN,this.r2x=NaN,this.r2y=NaN,this.r2z=NaN,this.ax1x=NaN,this.ax1y=NaN,this.ax1z=NaN,this.ay1x=NaN,this.ay1y=NaN,this.ay1z=NaN,this.az1x=NaN,this.az1y=NaN,this.az1z=NaN,this.ax2x=NaN,this.ax2y=NaN,this.ax2z=NaN,this.ay2x=NaN,this.ay2y=NaN,this.ay2z=NaN,this.az2x=NaN,this.az2y=NaN,this.az2z=NaN,this.vel=NaN,this.velx=NaN,this.vely=NaN,this.velz=NaN,this.joint=n,this.r1=n.relativeAnchorPoint1,this.r2=n.relativeAnchorPoint2,this.p1=n.anchorPoint1,this.p2=n.anchorPoint2,this.b1=n.body1,this.b2=n.body2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.impx=0,this.impy=0,this.impz=0},OIMO.LinearConstraint.prototype={constructor:OIMO.LinearConstraint,preSolve:function(n,t){var i,c;this.r1x=this.r1.x,this.r1y=this.r1.y,this.r1z=this.r1.z,this.r2x=this.r2.x,this.r2y=this.r2.y,this.r2z=this.r2.z,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass,this.i1e00=this.i1.e00,this.i1e01=this.i1.e01,this.i1e02=this.i1.e02,this.i1e10=this.i1.e10,this.i1e11=this.i1.e11,this.i1e12=this.i1.e12,this.i1e20=this.i1.e20,this.i1e21=this.i1.e21,this.i1e22=this.i1.e22,this.i2e00=this.i2.e00,this.i2e01=this.i2.e01,this.i2e02=this.i2.e02,this.i2e10=this.i2.e10,this.i2e11=this.i2.e11,this.i2e12=this.i2.e12,this.i2e20=this.i2.e20,this.i2e21=this.i2.e21,this.i2e22=this.i2.e22,this.ax1x=this.r1z*this.i1e01+-this.r1y*this.i1e02,this.ax1y=this.r1z*this.i1e11+-this.r1y*this.i1e12,this.ax1z=this.r1z*this.i1e21+-this.r1y*this.i1e22,this.ay1x=-this.r1z*this.i1e00+this.r1x*this.i1e02,this.ay1y=-this.r1z*this.i1e10+this.r1x*this.i1e12,this.ay1z=-this.r1z*this.i1e20+this.r1x*this.i1e22,this.az1x=this.r1y*this.i1e00+-this.r1x*this.i1e01,this.az1y=this.r1y*this.i1e10+-this.r1x*this.i1e11,this.az1z=this.r1y*this.i1e20+-this.r1x*this.i1e21,this.ax2x=this.r2z*this.i2e01+-this.r2y*this.i2e02,this.ax2y=this.r2z*this.i2e11+-this.r2y*this.i2e12,this.ax2z=this.r2z*this.i2e21+-this.r2y*this.i2e22,this.ay2x=-this.r2z*this.i2e00+this.r2x*this.i2e02,this.ay2y=-this.r2z*this.i2e10+this.r2x*this.i2e12,this.ay2z=-this.r2z*this.i2e20+this.r2x*this.i2e22,this.az2x=this.r2y*this.i2e00+-this.r2x*this.i2e01,this.az2y=this.r2y*this.i2e10+-this.r2x*this.i2e11,this.az2z=this.r2y*this.i2e20+-this.r2x*this.i2e21;var r=this.m1+this.m2,u=0,f=0,l=0,e=r,o=0,a=0,s=0,h=r;r+=this.i1e11*this.r1z*this.r1z-(this.i1e21+this.i1e12)*this.r1y*this.r1z+this.i1e22*this.r1y*this.r1y,u+=(this.i1e20*this.r1y+this.i1e12*this.r1x)*this.r1z-this.i1e10*this.r1z*this.r1z-this.i1e22*this.r1x*this.r1y,f+=(this.i1e10*this.r1y-this.i1e11*this.r1x)*this.r1z-this.i1e20*this.r1y*this.r1y+this.i1e21*this.r1x*this.r1y,l+=(this.i1e02*this.r1y+this.i1e21*this.r1x)*this.r1z-this.i1e01*this.r1z*this.r1z-this.i1e22*this.r1x*this.r1y,e+=this.i1e00*this.r1z*this.r1z-(this.i1e20+this.i1e02)*this.r1x*this.r1z+this.i1e22*this.r1x*this.r1x,o+=(this.i1e01*this.r1x-this.i1e00*this.r1y)*this.r1z-this.i1e21*this.r1x*this.r1x+this.i1e20*this.r1x*this.r1y,a+=(this.i1e01*this.r1y-this.i1e11*this.r1x)*this.r1z-this.i1e02*this.r1y*this.r1y+this.i1e12*this.r1x*this.r1y,s+=(this.i1e10*this.r1x-this.i1e00*this.r1y)*this.r1z-this.i1e12*this.r1x*this.r1x+this.i1e02*this.r1x*this.r1y,h+=this.i1e00*this.r1y*this.r1y-(this.i1e10+this.i1e01)*this.r1x*this.r1y+this.i1e11*this.r1x*this.r1x,r+=this.i2e11*this.r2z*this.r2z-(this.i2e21+this.i2e12)*this.r2y*this.r2z+this.i2e22*this.r2y*this.r2y,u+=(this.i2e20*this.r2y+this.i2e12*this.r2x)*this.r2z-this.i2e10*this.r2z*this.r2z-this.i2e22*this.r2x*this.r2y,f+=(this.i2e10*this.r2y-this.i2e11*this.r2x)*this.r2z-this.i2e20*this.r2y*this.r2y+this.i2e21*this.r2x*this.r2y,l+=(this.i2e02*this.r2y+this.i2e21*this.r2x)*this.r2z-this.i2e01*this.r2z*this.r2z-this.i2e22*this.r2x*this.r2y,e+=this.i2e00*this.r2z*this.r2z-(this.i2e20+this.i2e02)*this.r2x*this.r2z+this.i2e22*this.r2x*this.r2x,o+=(this.i2e01*this.r2x-this.i2e00*this.r2y)*this.r2z-this.i2e21*this.r2x*this.r2x+this.i2e20*this.r2x*this.r2y,a+=(this.i2e01*this.r2y-this.i2e11*this.r2x)*this.r2z-this.i2e02*this.r2y*this.r2y+this.i2e12*this.r2x*this.r2y,s+=(this.i2e10*this.r2x-this.i2e00*this.r2y)*this.r2z-this.i2e12*this.r2x*this.r2x+this.i2e02*this.r2x*this.r2y,h+=this.i2e00*this.r2y*this.r2y-(this.i2e10+this.i2e01)*this.r2x*this.r2y+this.i2e11*this.r2x*this.r2x,i=1/(r*(e*h-s*o)+l*(s*f-u*h)+a*(u*o-e*f)),this.d00=(e*h-o*s)*i,this.d01=(f*s-u*h)*i,this.d02=(u*o-f*e)*i,this.d10=(o*a-l*h)*i,this.d11=(r*h-f*a)*i,this.d12=(f*l-r*o)*i,this.d20=(l*s-e*a)*i,this.d21=(u*a-r*s)*i,this.d22=(r*e-u*l)*i,this.velx=this.p2.x-this.p1.x,this.vely=this.p2.y-this.p1.y,this.velz=this.p2.z-this.p1.z,c=Math.sqrt(this.velx*this.velx+this.vely*this.vely+this.velz*this.velz),c>.005?(c=(.005-c)/c*t*.05,this.velx*=c,this.vely*=c,this.velz*=c):(this.velx=0,this.vely=0,this.velz=0),this.impx*=.95,this.impy*=.95,this.impz*=.95,this.l1.x+=this.impx*this.m1,this.l1.y+=this.impy*this.m1,this.l1.z+=this.impz*this.m1,this.a1.x+=this.impx*this.ax1x+this.impy*this.ay1x+this.impz*this.az1x,this.a1.y+=this.impx*this.ax1y+this.impy*this.ay1y+this.impz*this.az1y,this.a1.z+=this.impx*this.ax1z+this.impy*this.ay1z+this.impz*this.az1z,this.l2.x-=this.impx*this.m2,this.l2.y-=this.impy*this.m2,this.l2.z-=this.impz*this.m2,this.a2.x-=this.impx*this.ax2x+this.impy*this.ay2x+this.impz*this.az2x,this.a2.y-=this.impx*this.ax2y+this.impy*this.ay2y+this.impz*this.az2y,this.a2.z-=this.impx*this.ax2z+this.impy*this.ay2z+this.impz*this.az2z},solve:function(){var r=this.l2.x-this.l1.x+this.a2.y*this.r2z-this.a2.z*this.r2y-this.a1.y*this.r1z+this.a1.z*this.r1y-this.velx,u=this.l2.y-this.l1.y+this.a2.z*this.r2x-this.a2.x*this.r2z-this.a1.z*this.r1x+this.a1.x*this.r1z-this.vely,f=this.l2.z-this.l1.z+this.a2.x*this.r2y-this.a2.y*this.r2x-this.a1.x*this.r1y+this.a1.y*this.r1x-this.velz,n=r*this.d00+u*this.d01+f*this.d02,t=r*this.d10+u*this.d11+f*this.d12,i=r*this.d20+u*this.d21+f*this.d22;this.impx+=n,this.impy+=t,this.impz+=i,this.l1.x+=n*this.m1,this.l1.y+=t*this.m1,this.l1.z+=i*this.m1,this.a1.x+=n*this.ax1x+t*this.ay1x+i*this.az1x,this.a1.y+=n*this.ax1y+t*this.ay1y+i*this.az1y,this.a1.z+=n*this.ax1z+t*this.ay1z+i*this.az1z,this.l2.x-=n*this.m2,this.l2.y-=t*this.m2,this.l2.z-=i*this.m2,this.a2.x-=n*this.ax2x+t*this.ay2x+i*this.az2x,this.a2.y-=n*this.ax2y+t*this.ay2y+i*this.az2y,this.a2.z-=n*this.ax2z+t*this.ay2z+i*this.az2z}},OIMO.Rotational3Constraint=function(n,t,i,r){this.cfm1=NaN,this.cfm2=NaN,this.cfm3=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.ax1=NaN,this.ay1=NaN,this.az1=NaN,this.ax2=NaN,this.ay2=NaN,this.az2=NaN,this.ax3=NaN,this.ay3=NaN,this.az3=NaN,this.a1x1=NaN,this.a1y1=NaN,this.a1z1=NaN,this.a2x1=NaN,this.a2y1=NaN,this.a2z1=NaN,this.a1x2=NaN,this.a1y2=NaN,this.a1z2=NaN,this.a2x2=NaN,this.a2y2=NaN,this.a2z2=NaN,this.a1x3=NaN,this.a1y3=NaN,this.a1z3=NaN,this.a2x3=NaN,this.a2y3=NaN,this.a2z3=NaN,this.lowerLimit1=NaN,this.upperLimit1=NaN,this.limitVelocity1=NaN,this.limitState1=0,this.enableMotor1=!1,this.motorSpeed1=NaN,this.maxMotorForce1=NaN,this.maxMotorImpulse1=NaN,this.lowerLimit2=NaN,this.upperLimit2=NaN,this.limitVelocity2=NaN,this.limitState2=0,this.enableMotor2=!1,this.motorSpeed2=NaN,this.maxMotorForce2=NaN,this.maxMotorImpulse2=NaN,this.lowerLimit3=NaN,this.upperLimit3=NaN,this.limitVelocity3=NaN,this.limitState3=0,this.enableMotor3=!1,this.motorSpeed3=NaN,this.maxMotorForce3=NaN,this.maxMotorImpulse3=NaN,this.k00=NaN,this.k01=NaN,this.k02=NaN,this.k10=NaN,this.k11=NaN,this.k12=NaN,this.k20=NaN,this.k21=NaN,this.k22=NaN,this.kv00=NaN,this.kv11=NaN,this.kv22=NaN,this.dv00=NaN,this.dv11=NaN,this.dv22=NaN,this.d00=NaN,this.d01=NaN,this.d02=NaN,this.d10=NaN,this.d11=NaN,this.d12=NaN,this.d20=NaN,this.d21=NaN,this.d22=NaN,this.limitMotor1=t,this.limitMotor2=i,this.limitMotor3=r,this.b1=n.body1,this.b2=n.body2,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse1=0,this.motorImpulse1=0,this.limitImpulse2=0,this.motorImpulse2=0,this.limitImpulse3=0,this.motorImpulse3=0},OIMO.Rotational3Constraint.prototype={constructor:OIMO.Rotational3Constraint,preSolve:function(n,t){var e,o,r;this.ax1=this.limitMotor1.axis.x,this.ay1=this.limitMotor1.axis.y,this.az1=this.limitMotor1.axis.z,this.ax2=this.limitMotor2.axis.x,this.ay2=this.limitMotor2.axis.y,this.az2=this.limitMotor2.axis.z,this.ax3=this.limitMotor3.axis.x,this.ay3=this.limitMotor3.axis.y,this.az3=this.limitMotor3.axis.z,this.lowerLimit1=this.limitMotor1.lowerLimit,this.upperLimit1=this.limitMotor1.upperLimit,this.motorSpeed1=this.limitMotor1.motorSpeed,this.maxMotorForce1=this.limitMotor1.maxMotorForce,this.enableMotor1=this.maxMotorForce1>0,this.lowerLimit2=this.limitMotor2.lowerLimit,this.upperLimit2=this.limitMotor2.upperLimit,this.motorSpeed2=this.limitMotor2.motorSpeed,this.maxMotorForce2=this.limitMotor2.maxMotorForce,this.enableMotor2=this.maxMotorForce2>0,this.lowerLimit3=this.limitMotor3.lowerLimit,this.upperLimit3=this.limitMotor3.upperLimit,this.motorSpeed3=this.limitMotor3.motorSpeed,this.maxMotorForce3=this.limitMotor3.maxMotorForce,this.enableMotor3=this.maxMotorForce3>0,this.i1e00=this.i1.e00,this.i1e01=this.i1.e01,this.i1e02=this.i1.e02,this.i1e10=this.i1.e10,this.i1e11=this.i1.e11,this.i1e12=this.i1.e12,this.i1e20=this.i1.e20,this.i1e21=this.i1.e21,this.i1e22=this.i1.e22,this.i2e00=this.i2.e00,this.i2e01=this.i2.e01,this.i2e02=this.i2.e02,this.i2e10=this.i2.e10,this.i2e11=this.i2.e11,this.i2e12=this.i2.e12,this.i2e20=this.i2.e20,this.i2e21=this.i2.e21,this.i2e22=this.i2.e22;var p=this.limitMotor1.frequency,w=this.limitMotor2.frequency,b=this.limitMotor3.frequency,a=p>0,v=w>0,y=b>0,k=this.lowerLimit1<=this.upperLimit1,d=this.lowerLimit2<=this.upperLimit2,g=this.lowerLimit3<=this.upperLimit3,l=this.limitMotor1.angle;if(k?(this.lowerLimit1==this.upperLimit1?(this.limitState1!=0&&(this.limitState1=0,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-l):l<this.lowerLimit1?(this.limitState1!=-1&&(this.limitState1=-1,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-l):l>this.upperLimit1?(this.limitState1!=1&&(this.limitState1=1,this.limitImpulse1=0),this.limitVelocity1=this.upperLimit1-l):(this.limitState1=2,this.limitImpulse1=0,this.limitVelocity1=0),a||(this.limitVelocity1>.02?this.limitVelocity1-=.02:this.limitVelocity1<-.02?this.limitVelocity1+=.02:this.limitVelocity1=0)):(this.limitState1=2,this.limitImpulse1=0),e=this.limitMotor2.angle,d?(this.lowerLimit2==this.upperLimit2?(this.limitState2!=0&&(this.limitState2=0,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-e):e<this.lowerLimit2?(this.limitState2!=-1&&(this.limitState2=-1,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-e):e>this.upperLimit2?(this.limitState2!=1&&(this.limitState2=1,this.limitImpulse2=0),this.limitVelocity2=this.upperLimit2-e):(this.limitState2=2,this.limitImpulse2=0,this.limitVelocity2=0),v||(this.limitVelocity2>.02?this.limitVelocity2-=.02:this.limitVelocity2<-.02?this.limitVelocity2+=.02:this.limitVelocity2=0)):(this.limitState2=2,this.limitImpulse2=0),o=this.limitMotor3.angle,g?(this.lowerLimit3==this.upperLimit3?(this.limitState3!=0&&(this.limitState3=0,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-o):o<this.lowerLimit3?(this.limitState3!=-1&&(this.limitState3=-1,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-o):o>this.upperLimit3?(this.limitState3!=1&&(this.limitState3=1,this.limitImpulse3=0),this.limitVelocity3=this.upperLimit3-o):(this.limitState3=2,this.limitImpulse3=0,this.limitVelocity3=0),y||(this.limitVelocity3>.02?this.limitVelocity3-=.02:this.limitVelocity3<-.02?this.limitVelocity3+=.02:this.limitVelocity3=0)):(this.limitState3=2,this.limitImpulse3=0),this.enableMotor1&&(this.limitState1!=0||a)?this.maxMotorImpulse1=this.maxMotorForce1*n:(this.motorImpulse1=0,this.maxMotorImpulse1=0),this.enableMotor2&&(this.limitState2!=0||v)?this.maxMotorImpulse2=this.maxMotorForce2*n:(this.motorImpulse2=0,this.maxMotorImpulse2=0),this.enableMotor3&&(this.limitState3!=0||y)?this.maxMotorImpulse3=this.maxMotorForce3*n:(this.motorImpulse3=0,this.maxMotorImpulse3=0),this.a1x1=this.ax1*this.i1e00+this.ay1*this.i1e01+this.az1*this.i1e02,this.a1y1=this.ax1*this.i1e10+this.ay1*this.i1e11+this.az1*this.i1e12,this.a1z1=this.ax1*this.i1e20+this.ay1*this.i1e21+this.az1*this.i1e22,this.a2x1=this.ax1*this.i2e00+this.ay1*this.i2e01+this.az1*this.i2e02,this.a2y1=this.ax1*this.i2e10+this.ay1*this.i2e11+this.az1*this.i2e12,this.a2z1=this.ax1*this.i2e20+this.ay1*this.i2e21+this.az1*this.i2e22,this.a1x2=this.ax2*this.i1e00+this.ay2*this.i1e01+this.az2*this.i1e02,this.a1y2=this.ax2*this.i1e10+this.ay2*this.i1e11+this.az2*this.i1e12,this.a1z2=this.ax2*this.i1e20+this.ay2*this.i1e21+this.az2*this.i1e22,this.a2x2=this.ax2*this.i2e00+this.ay2*this.i2e01+this.az2*this.i2e02,this.a2y2=this.ax2*this.i2e10+this.ay2*this.i2e11+this.az2*this.i2e12,this.a2z2=this.ax2*this.i2e20+this.ay2*this.i2e21+this.az2*this.i2e22,this.a1x3=this.ax3*this.i1e00+this.ay3*this.i1e01+this.az3*this.i1e02,this.a1y3=this.ax3*this.i1e10+this.ay3*this.i1e11+this.az3*this.i1e12,this.a1z3=this.ax3*this.i1e20+this.ay3*this.i1e21+this.az3*this.i1e22,this.a2x3=this.ax3*this.i2e00+this.ay3*this.i2e01+this.az3*this.i2e02,this.a2y3=this.ax3*this.i2e10+this.ay3*this.i2e11+this.az3*this.i2e12,this.a2z3=this.ax3*this.i2e20+this.ay3*this.i2e21+this.az3*this.i2e22,this.k00=this.ax1*(this.a1x1+this.a2x1)+this.ay1*(this.a1y1+this.a2y1)+this.az1*(this.a1z1+this.a2z1),this.k01=this.ax1*(this.a1x2+this.a2x2)+this.ay1*(this.a1y2+this.a2y2)+this.az1*(this.a1z2+this.a2z2),this.k02=this.ax1*(this.a1x3+this.a2x3)+this.ay1*(this.a1y3+this.a2y3)+this.az1*(this.a1z3+this.a2z3),this.k10=this.ax2*(this.a1x1+this.a2x1)+this.ay2*(this.a1y1+this.a2y1)+this.az2*(this.a1z1+this.a2z1),this.k11=this.ax2*(this.a1x2+this.a2x2)+this.ay2*(this.a1y2+this.a2y2)+this.az2*(this.a1z2+this.a2z2),this.k12=this.ax2*(this.a1x3+this.a2x3)+this.ay2*(this.a1y3+this.a2y3)+this.az2*(this.a1z3+this.a2z3),this.k20=this.ax3*(this.a1x1+this.a2x1)+this.ay3*(this.a1y1+this.a2y1)+this.az3*(this.a1z1+this.a2z1),this.k21=this.ax3*(this.a1x2+this.a2x2)+this.ay3*(this.a1y2+this.a2y2)+this.az3*(this.a1z2+this.a2z2),this.k22=this.ax3*(this.a1x3+this.a2x3)+this.ay3*(this.a1y3+this.a2y3)+this.az3*(this.a1z3+this.a2z3),this.kv00=this.k00,this.kv11=this.k11,this.kv22=this.k22,this.dv00=1/this.kv00,this.dv11=1/this.kv11,this.dv22=1/this.kv22,a&&this.limitState1!=2){var i=6.2831853*p,u=i*i*n,f=t/(u+2*this.limitMotor1.dampingRatio*i);this.cfm1=this.kv00*f,this.limitVelocity1*=u*f}else this.cfm1=0,this.limitVelocity1*=t*.05;v&&this.limitState2!=2?(i=6.2831853*w,u=i*i*n,f=t/(u+2*this.limitMotor2.dampingRatio*i),this.cfm2=this.kv11*f,this.limitVelocity2*=u*f):(this.cfm2=0,this.limitVelocity2*=t*.05),y&&this.limitState3!=2?(i=6.2831853*b,u=i*i*n,f=t/(u+2*this.limitMotor3.dampingRatio*i),this.cfm3=this.kv22*f,this.limitVelocity3*=u*f):(this.cfm3=0,this.limitVelocity3*=t*.05),this.k00+=this.cfm1,this.k11+=this.cfm2,this.k22+=this.cfm3,r=1/(this.k00*(this.k11*this.k22-this.k21*this.k12)+this.k10*(this.k21*this.k02-this.k01*this.k22)+this.k20*(this.k01*this.k12-this.k11*this.k02)),this.d00=(this.k11*this.k22-this.k12*this.k21)*r,this.d01=(this.k02*this.k21-this.k01*this.k22)*r,this.d02=(this.k01*this.k12-this.k02*this.k11)*r,this.d10=(this.k12*this.k20-this.k10*this.k22)*r,this.d11=(this.k00*this.k22-this.k02*this.k20)*r,this.d12=(this.k02*this.k10-this.k00*this.k12)*r,this.d20=(this.k10*this.k21-this.k11*this.k20)*r,this.d21=(this.k01*this.k20-this.k00*this.k21)*r,this.d22=(this.k00*this.k11-this.k01*this.k10)*r,this.limitImpulse1*=.95,this.motorImpulse1*=.95,this.limitImpulse2*=.95,this.motorImpulse2*=.95,this.limitImpulse3*=.95,this.motorImpulse3*=.95;var s=this.limitImpulse1+this.motorImpulse1,h=this.limitImpulse2+this.motorImpulse2,c=this.limitImpulse3+this.motorImpulse3;this.a1.x+=s*this.a1x1+h*this.a1x2+c*this.a1x3,this.a1.y+=s*this.a1y1+h*this.a1y2+c*this.a1y3,this.a1.z+=s*this.a1z1+h*this.a1z2+c*this.a1z3,this.a2.x-=s*this.a2x1+h*this.a2x2+c*this.a2x3,this.a2.y-=s*this.a2y1+h*this.a2y2+c*this.a2y3,this.a2.z-=s*this.a2z1+h*this.a2z2+c*this.a2z3},solve_:function(){var r=this.a2.x-this.a1.x,u=this.a2.y-this.a1.y,f=this.a2.z-this.a1.z;this.limitVelocity3=30;var e=r*this.ax1+u*this.ay1+f*this.az1-this.limitVelocity1,o=r*this.ax2+u*this.ay2+f*this.az2-this.limitVelocity2,s=r*this.ax3+u*this.ay3+f*this.az3-this.limitVelocity3,n=e*this.d00+o*this.d01+s*this.d02,t=e*this.d10+o*this.d11+s*this.d12,i=e*this.d20+o*this.d21+s*this.d22;this.limitImpulse1+=n,this.limitImpulse2+=t,this.limitImpulse3+=i,this.a1.x+=n*this.a1x1+t*this.a1x2+i*this.a1x3,this.a1.y+=n*this.a1y1+t*this.a1y2+i*this.a1y3,this.a1.z+=n*this.a1z1+t*this.a1z2+i*this.a1z3,this.a2.x-=n*this.a2x1+t*this.a2x2+i*this.a2x3,this.a2.y-=n*this.a2y1+t*this.a2y2+i*this.a2y3,this.a2.z-=n*this.a2z1+t*this.a2z2+i*this.a2z3},solve:function(){var v=this.a2.x-this.a1.x,y=this.a2.y-this.a1.y,p=this.a2.z-this.a1.z,t=v*this.ax1+y*this.ay1+p*this.az1,n=v*this.ax2+y*this.ay2+p*this.az2,i=v*this.ax3+y*this.ay3+p*this.az3,g=this.motorImpulse1,nt=this.motorImpulse2,tt=this.motorImpulse3,o=0,s=0,h=0,w,e;this.enableMotor1&&(o=(t-this.motorSpeed1)*this.dv00,this.motorImpulse1+=o,this.motorImpulse1>this.maxMotorImpulse1?this.motorImpulse1=this.maxMotorImpulse1:this.motorImpulse1<-this.maxMotorImpulse1&&(this.motorImpulse1=-this.maxMotorImpulse1),o=this.motorImpulse1-g),this.enableMotor2&&(s=(n-this.motorSpeed2)*this.dv11,this.motorImpulse2+=s,this.motorImpulse2>this.maxMotorImpulse2?this.motorImpulse2=this.maxMotorImpulse2:this.motorImpulse2<-this.maxMotorImpulse2&&(this.motorImpulse2=-this.maxMotorImpulse2),s=this.motorImpulse2-nt),this.enableMotor3&&(h=(i-this.motorSpeed3)*this.dv22,this.motorImpulse3+=h,this.motorImpulse3>this.maxMotorImpulse3?this.motorImpulse3=this.maxMotorImpulse3:this.motorImpulse3<-this.maxMotorImpulse3&&(this.motorImpulse3=-this.maxMotorImpulse3),h=this.motorImpulse3-tt),t+=o*this.kv00+s*this.k01+h*this.k02,n+=o*this.k10+s*this.kv11+h*this.k12,i+=o*this.k20+s*this.k21+h*this.kv22,t-=this.limitVelocity1+this.limitImpulse1*this.cfm1,n-=this.limitVelocity2+this.limitImpulse2*this.cfm2,i-=this.limitVelocity3+this.limitImpulse3*this.cfm3;var b=this.limitImpulse1,k=this.limitImpulse2,d=this.limitImpulse3,r=t*this.d00+n*this.d01+i*this.d02,u=t*this.d10+n*this.d11+i*this.d12,f=t*this.d20+n*this.d21+i*this.d22;this.limitImpulse1+=r,this.limitImpulse2+=u,this.limitImpulse3+=f,w=0,(this.limitState1==2||this.limitImpulse1*this.limitState1<0)&&(r=-b,n+=r*this.k10,i+=r*this.k20,w|=1),(this.limitState2==2||this.limitImpulse2*this.limitState2<0)&&(u=-k,t+=u*this.k01,i+=u*this.k21,w|=2),(this.limitState3==2||this.limitImpulse3*this.limitState3<0)&&(f=-d,t+=f*this.k02,n+=f*this.k12,w|=4);switch(w){case 1:e=1/(this.k11*this.k22-this.k12*this.k21),u=(this.k22*n+-this.k12*i)*e,f=(-this.k21*n+this.k11*i)*e;break;case 2:e=1/(this.k00*this.k22-this.k02*this.k20),r=(this.k22*t+-this.k02*i)*e,f=(-this.k20*t+this.k00*i)*e;break;case 3:f=i/this.k22;break;case 4:e=1/(this.k00*this.k11-this.k01*this.k10),r=(this.k11*t+-this.k01*n)*e,u=(-this.k10*t+this.k00*n)*e;break;case 5:u=n/this.k11;break;case 6:r=t/this.k00}this.limitImpulse1=r+b,this.limitImpulse2=u+k,this.limitImpulse3=f+d;var c=o+r,l=s+u,a=h+f;this.a1.x+=c*this.a1x1+l*this.a1x2+a*this.a1x3,this.a1.y+=c*this.a1y1+l*this.a1y2+a*this.a1y3,this.a1.z+=c*this.a1z1+l*this.a1z2+a*this.a1z3,this.a2.x-=c*this.a2x1+l*this.a2x2+a*this.a2x3,this.a2.y-=c*this.a2y1+l*this.a2y2+a*this.a2y3,this.a2.z-=c*this.a2z1+l*this.a2z2+a*this.a2z3,v=this.a2.x-this.a1.x,y=this.a2.y-this.a1.y,p=this.a2.z-this.a1.z,n=v*this.ax2+y*this.ay2+p*this.az2}},OIMO.RotationalConstraint=function(n,t){this.cfm=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.motorDenom=NaN,this.invMotorDenom=NaN,this.invDenom=NaN,this.ax=NaN,this.ay=NaN,this.az=NaN,this.a1x=NaN,this.a1y=NaN,this.a1z=NaN,this.a2x=NaN,this.a2y=NaN,this.a2z=NaN,this.enableLimit=!1,this.lowerLimit=NaN,this.upperLimit=NaN,this.limitVelocity=NaN,this.limitState=0,this.enableMotor=!1,this.motorSpeed=NaN,this.maxMotorForce=NaN,this.maxMotorImpulse=NaN,this.limitMotor=t,this.b1=n.body1,this.b2=n.body2,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse=0,this.motorImpulse=0},OIMO.RotationalConstraint.prototype={constructor:OIMO.RotationalConstraint,preSolve:function(n,t){var i;this.ax=this.limitMotor.axis.x,this.ay=this.limitMotor.axis.y,this.az=this.limitMotor.axis.z,this.lowerLimit=this.limitMotor.lowerLimit,this.upperLimit=this.limitMotor.upperLimit,this.motorSpeed=this.limitMotor.motorSpeed,this.maxMotorForce=this.limitMotor.maxMotorForce,this.enableMotor=this.maxMotorForce>0,this.i1e00=this.i1.e00,this.i1e01=this.i1.e01,this.i1e02=this.i1.e02,this.i1e10=this.i1.e10,this.i1e11=this.i1.e11,this.i1e12=this.i1.e12,this.i1e20=this.i1.e20,this.i1e21=this.i1.e21,this.i1e22=this.i1.e22,this.i2e00=this.i2.e00,this.i2e01=this.i2.e01,this.i2e02=this.i2.e02,this.i2e10=this.i2.e10,this.i2e11=this.i2.e11,this.i2e12=this.i2.e12,this.i2e20=this.i2.e20,this.i2e21=this.i2.e21,this.i2e22=this.i2.e22;var e=this.limitMotor.frequency,u=e>0,h=this.lowerLimit<=this.upperLimit,r=this.limitMotor.angle;if(h?(this.lowerLimit==this.upperLimit?(this.limitState!=0&&(this.limitState=0,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-r):r<this.lowerLimit?(this.limitState!=-1&&(this.limitState=-1,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-r):r>this.upperLimit?(this.limitState!=1&&(this.limitState=1,this.limitImpulse=0),this.limitVelocity=this.upperLimit-r):(this.limitState=2,this.limitImpulse=0,this.limitVelocity=0),u||(this.limitVelocity>.02?this.limitVelocity-=.02:this.limitVelocity<-.02?this.limitVelocity+=.02:this.limitVelocity=0)):(this.limitState=2,this.limitImpulse=0),this.enableMotor&&(this.limitState!=0||u)?this.maxMotorImpulse=this.maxMotorForce*n:(this.motorImpulse=0,this.maxMotorImpulse=0),this.a1x=this.ax*this.i1e00+this.ay*this.i1e01+this.az*this.i1e02,this.a1y=this.ax*this.i1e10+this.ay*this.i1e11+this.az*this.i1e12,this.a1z=this.ax*this.i1e20+this.ay*this.i1e21+this.az*this.i1e22,this.a2x=this.ax*this.i2e00+this.ay*this.i2e01+this.az*this.i2e02,this.a2y=this.ax*this.i2e10+this.ay*this.i2e11+this.az*this.i2e12,this.a2z=this.ax*this.i2e20+this.ay*this.i2e21+this.az*this.i2e22,this.motorDenom=this.ax*(this.a1x+this.a2x)+this.ay*(this.a1y+this.a2y)+this.az*(this.a1z+this.a2z),this.invMotorDenom=1/this.motorDenom,u&&this.limitState!=2){var f=6.2831853*e,o=f*f*n,s=t/(o+2*this.limitMotor.dampingRatio*f);this.cfm=this.motorDenom*s,this.limitVelocity*=o*s}else this.cfm=0,this.limitVelocity*=t*.05;this.invDenom=1/(this.motorDenom+this.cfm),this.limitImpulse*=.95,this.motorImpulse*=.95,i=this.limitImpulse+this.motorImpulse,this.a1.x+=i*this.a1x,this.a1.y+=i*this.a1y,this.a1.z+=i*this.a1z,this.a2.x-=i*this.a2x,this.a2.y-=i*this.a2y,this.a2.z-=i*this.a2z},solve:function(){var r=this.ax*(this.a2.x-this.a1.x)+this.ay*(this.a2.y-this.a1.y)+this.az*(this.a2.z-this.a1.z),t,u,i,f,n;this.enableMotor?(t=(r-this.motorSpeed)*this.invMotorDenom,u=this.motorImpulse,this.motorImpulse+=t,this.motorImpulse>this.maxMotorImpulse?this.motorImpulse=this.maxMotorImpulse:this.motorImpulse<-this.maxMotorImpulse&&(this.motorImpulse=-this.maxMotorImpulse),t=this.motorImpulse-u,r-=t*this.motorDenom):t=0,this.limitState!=2?(i=(r-this.limitVelocity-this.limitImpulse*this.cfm)*this.invDenom,f=this.limitImpulse,this.limitImpulse+=i,this.limitImpulse*this.limitState<0&&(this.limitImpulse=0),i=this.limitImpulse-f):i=0,n=i+t,this.a1.x+=n*this.a1x,this.a1.y+=n*this.a1y,this.a1.z+=n*this.a1z,this.a2.x-=n*this.a2x,this.a2.y-=n*this.a2y,this.a2.z-=n*this.a2z}},OIMO.Translational3Constraint=function(n,t,i,r){this.m1=NaN,this.m2=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.ax1=NaN,this.ay1=NaN,this.az1=NaN,this.ax2=NaN,this.ay2=NaN,this.az2=NaN,this.ax3=NaN,this.ay3=NaN,this.az3=NaN,this.r1x=NaN,this.r1y=NaN,this.r1z=NaN,this.r2x=NaN,this.r2y=NaN,this.r2z=NaN,this.t1x1=NaN,this.t1y1=NaN,this.t1z1=NaN,this.t2x1=NaN,this.t2y1=NaN,this.t2z1=NaN,this.l1x1=NaN,this.l1y1=NaN,this.l1z1=NaN,this.l2x1=NaN,this.l2y1=NaN,this.l2z1=NaN,this.a1x1=NaN,this.a1y1=NaN,this.a1z1=NaN,this.a2x1=NaN,this.a2y1=NaN,this.a2z1=NaN,this.t1x2=NaN,this.t1y2=NaN,this.t1z2=NaN,this.t2x2=NaN,this.t2y2=NaN,this.t2z2=NaN,this.l1x2=NaN,this.l1y2=NaN,this.l1z2=NaN,this.l2x2=NaN,this.l2y2=NaN,this.l2z2=NaN,this.a1x2=NaN,this.a1y2=NaN,this.a1z2=NaN,this.a2x2=NaN,this.a2y2=NaN,this.a2z2=NaN,this.t1x3=NaN,this.t1y3=NaN,this.t1z3=NaN,this.t2x3=NaN,this.t2y3=NaN,this.t2z3=NaN,this.l1x3=NaN,this.l1y3=NaN,this.l1z3=NaN,this.l2x3=NaN,this.l2y3=NaN,this.l2z3=NaN,this.a1x3=NaN,this.a1y3=NaN,this.a1z3=NaN,this.a2x3=NaN,this.a2y3=NaN,this.a2z3=NaN,this.lowerLimit1=NaN,this.upperLimit1=NaN,this.limitVelocity1=NaN,this.limitState1=0,this.enableMotor1=!1,this.motorSpeed1=NaN,this.maxMotorForce1=NaN,this.maxMotorImpulse1=NaN,this.lowerLimit2=NaN,this.upperLimit2=NaN,this.limitVelocity2=NaN,this.limitState2=0,this.enableMotor2=!1,this.motorSpeed2=NaN,this.maxMotorForce2=NaN,this.maxMotorImpulse2=NaN,this.lowerLimit3=NaN,this.upperLimit3=NaN,this.limitVelocity3=NaN,this.limitState3=0,this.enableMotor3=!1,this.motorSpeed3=NaN,this.maxMotorForce3=NaN,this.maxMotorImpulse3=NaN,this.k00=NaN,this.k01=NaN,this.k02=NaN,this.k10=NaN,this.k11=NaN,this.k12=NaN,this.k20=NaN,this.k21=NaN,this.k22=NaN,this.kv00=NaN,this.kv11=NaN,this.kv22=NaN,this.dv00=NaN,this.dv11=NaN,this.dv22=NaN,this.d00=NaN,this.d01=NaN,this.d02=NaN,this.d10=NaN,this.d11=NaN,this.d12=NaN,this.d20=NaN,this.d21=NaN,this.d22=NaN,this.limitMotor1=t,this.limitMotor2=i,this.limitMotor3=r,this.b1=n.body1,this.b2=n.body2,this.p1=n.anchorPoint1,this.p2=n.anchorPoint2,this.r1=n.relativeAnchorPoint1,this.r2=n.relativeAnchorPoint2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse1=0,this.motorImpulse1=0,this.limitImpulse2=0,this.motorImpulse2=0,this.limitImpulse3=0,this.motorImpulse3=0,this.cfm1=0,this.cfm2=0,this.cfm3=0,this.weight=-1},OIMO.Translational3Constraint.prototype={constructor:OIMO.Translational3Constraint,preSolve:function(n,t){var b,h,c;this.ax1=this.limitMotor1.axis.x,this.ay1=this.limitMotor1.axis.y,this.az1=this.limitMotor1.axis.z,this.ax2=this.limitMotor2.axis.x,this.ay2=this.limitMotor2.axis.y,this.az2=this.limitMotor2.axis.z,this.ax3=this.limitMotor3.axis.x,this.ay3=this.limitMotor3.axis.y,this.az3=this.limitMotor3.axis.z,this.lowerLimit1=this.limitMotor1.lowerLimit,this.upperLimit1=this.limitMotor1.upperLimit,this.motorSpeed1=this.limitMotor1.motorSpeed,this.maxMotorForce1=this.limitMotor1.maxMotorForce,this.enableMotor1=this.maxMotorForce1>0,this.lowerLimit2=this.limitMotor2.lowerLimit,this.upperLimit2=this.limitMotor2.upperLimit,this.motorSpeed2=this.limitMotor2.motorSpeed,this.maxMotorForce2=this.limitMotor2.maxMotorForce,this.enableMotor2=this.maxMotorForce2>0,this.lowerLimit3=this.limitMotor3.lowerLimit,this.upperLimit3=this.limitMotor3.upperLimit,this.motorSpeed3=this.limitMotor3.motorSpeed,this.maxMotorForce3=this.limitMotor3.maxMotorForce,this.enableMotor3=this.maxMotorForce3>0,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass,this.i1e00=this.i1.e00,this.i1e01=this.i1.e01,this.i1e02=this.i1.e02,this.i1e10=this.i1.e10,this.i1e11=this.i1.e11,this.i1e12=this.i1.e12,this.i1e20=this.i1.e20,this.i1e21=this.i1.e21,this.i1e22=this.i1.e22,this.i2e00=this.i2.e00,this.i2e01=this.i2.e01,this.i2e02=this.i2.e02,this.i2e10=this.i2.e10,this.i2e11=this.i2.e11,this.i2e12=this.i2.e12,this.i2e20=this.i2.e20,this.i2e21=this.i2.e21,this.i2e22=this.i2.e22;var k=this.p2.x-this.p1.x,d=this.p2.y-this.p1.y,g=this.p2.z-this.p1.z,i=k*this.ax1+d*this.ay1+g*this.az1,r=k*this.ax2+d*this.ay2+g*this.az2,u=k*this.ax3+d*this.ay3+g*this.az3,nt=this.limitMotor1.frequency,tt=this.limitMotor2.frequency,it=this.limitMotor3.frequency,l=nt>0,a=tt>0,v=it>0,et=this.lowerLimit1<=this.upperLimit1,ot=this.lowerLimit2<=this.upperLimit2,st=this.lowerLimit3<=this.upperLimit3;(l&&i>20||i<-20)&&(l=!1),(a&&r>20||r<-20)&&(a=!1),(v&&u>20||u<-20)&&(v=!1),et?(this.lowerLimit1==this.upperLimit1?(this.limitState1!=0&&(this.limitState1=0,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-i,l||(i=this.lowerLimit1)):i<this.lowerLimit1?(this.limitState1!=-1&&(this.limitState1=-1,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-i,l||(i=this.lowerLimit1)):i>this.upperLimit1?(this.limitState1!=1&&(this.limitState1=1,this.limitImpulse1=0),this.limitVelocity1=this.upperLimit1-i,l||(i=this.upperLimit1)):(this.limitState1=2,this.limitImpulse1=0,this.limitVelocity1=0),l||(this.limitVelocity1>.005?this.limitVelocity1-=.005:this.limitVelocity1<-.005?this.limitVelocity1+=.005:this.limitVelocity1=0)):(this.limitState1=2,this.limitImpulse1=0),ot?(this.lowerLimit2==this.upperLimit2?(this.limitState2!=0&&(this.limitState2=0,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-r,a||(r=this.lowerLimit2)):r<this.lowerLimit2?(this.limitState2!=-1&&(this.limitState2=-1,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-r,a||(r=this.lowerLimit2)):r>this.upperLimit2?(this.limitState2!=1&&(this.limitState2=1,this.limitImpulse2=0),this.limitVelocity2=this.upperLimit2-r,a||(r=this.upperLimit2)):(this.limitState2=2,this.limitImpulse2=0,this.limitVelocity2=0),a||(this.limitVelocity2>.005?this.limitVelocity2-=.005:this.limitVelocity2<-.005?this.limitVelocity2+=.005:this.limitVelocity2=0)):(this.limitState2=2,this.limitImpulse2=0),st?(this.lowerLimit3==this.upperLimit3?(this.limitState3!=0&&(this.limitState3=0,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-u,v||(u=this.lowerLimit3)):u<this.lowerLimit3?(this.limitState3!=-1&&(this.limitState3=-1,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-u,v||(u=this.lowerLimit3)):u>this.upperLimit3?(this.limitState3!=1&&(this.limitState3=1,this.limitImpulse3=0),this.limitVelocity3=this.upperLimit3-u,v||(u=this.upperLimit3)):(this.limitState3=2,this.limitImpulse3=0,this.limitVelocity3=0),v||(this.limitVelocity3>.005?this.limitVelocity3-=.005:this.limitVelocity3<-.005?this.limitVelocity3+=.005:this.limitVelocity3=0)):(this.limitState3=2,this.limitImpulse3=0),this.enableMotor1&&(this.limitState1!=0||l)?this.maxMotorImpulse1=this.maxMotorForce1*n:(this.motorImpulse1=0,this.maxMotorImpulse1=0),this.enableMotor2&&(this.limitState2!=0||a)?this.maxMotorImpulse2=this.maxMotorForce2*n:(this.motorImpulse2=0,this.maxMotorImpulse2=0),this.enableMotor3&&(this.limitState3!=0||v)?this.maxMotorImpulse3=this.maxMotorForce3*n:(this.motorImpulse3=0,this.maxMotorImpulse3=0);var rt=i*this.ax1+r*this.ax2+u*this.ax2,ut=i*this.ay1+r*this.ay2+u*this.ay2,ft=i*this.az1+r*this.az2+u*this.az2,w=this.m2/(this.m1+this.m2);if(this.weight>=0&&(w=this.weight),b=1-w,this.r1x=this.r1.x+rt*w,this.r1y=this.r1.y+ut*w,this.r1z=this.r1.z+ft*w,this.r2x=this.r2.x-rt*b,this.r2y=this.r2.y-ut*b,this.r2z=this.r2.z-ft*b,this.t1x1=this.r1y*this.az1-this.r1z*this.ay1,this.t1y1=this.r1z*this.ax1-this.r1x*this.az1,this.t1z1=this.r1x*this.ay1-this.r1y*this.ax1,this.t2x1=this.r2y*this.az1-this.r2z*this.ay1,this.t2y1=this.r2z*this.ax1-this.r2x*this.az1,this.t2z1=this.r2x*this.ay1-this.r2y*this.ax1,this.l1x1=this.ax1*this.m1,this.l1y1=this.ay1*this.m1,this.l1z1=this.az1*this.m1,this.l2x1=this.ax1*this.m2,this.l2y1=this.ay1*this.m2,this.l2z1=this.az1*this.m2,this.a1x1=this.t1x1*this.i1e00+this.t1y1*this.i1e01+this.t1z1*this.i1e02,this.a1y1=this.t1x1*this.i1e10+this.t1y1*this.i1e11+this.t1z1*this.i1e12,this.a1z1=this.t1x1*this.i1e20+this.t1y1*this.i1e21+this.t1z1*this.i1e22,this.a2x1=this.t2x1*this.i2e00+this.t2y1*this.i2e01+this.t2z1*this.i2e02,this.a2y1=this.t2x1*this.i2e10+this.t2y1*this.i2e11+this.t2z1*this.i2e12,this.a2z1=this.t2x1*this.i2e20+this.t2y1*this.i2e21+this.t2z1*this.i2e22,this.t1x2=this.r1y*this.az2-this.r1z*this.ay2,this.t1y2=this.r1z*this.ax2-this.r1x*this.az2,this.t1z2=this.r1x*this.ay2-this.r1y*this.ax2,this.t2x2=this.r2y*this.az2-this.r2z*this.ay2,this.t2y2=this.r2z*this.ax2-this.r2x*this.az2,this.t2z2=this.r2x*this.ay2-this.r2y*this.ax2,this.l1x2=this.ax2*this.m1,this.l1y2=this.ay2*this.m1,this.l1z2=this.az2*this.m1,this.l2x2=this.ax2*this.m2,this.l2y2=this.ay2*this.m2,this.l2z2=this.az2*this.m2,this.a1x2=this.t1x2*this.i1e00+this.t1y2*this.i1e01+this.t1z2*this.i1e02,this.a1y2=this.t1x2*this.i1e10+this.t1y2*this.i1e11+this.t1z2*this.i1e12,this.a1z2=this.t1x2*this.i1e20+this.t1y2*this.i1e21+this.t1z2*this.i1e22,this.a2x2=this.t2x2*this.i2e00+this.t2y2*this.i2e01+this.t2z2*this.i2e02,this.a2y2=this.t2x2*this.i2e10+this.t2y2*this.i2e11+this.t2z2*this.i2e12,this.a2z2=this.t2x2*this.i2e20+this.t2y2*this.i2e21+this.t2z2*this.i2e22,this.t1x3=this.r1y*this.az3-this.r1z*this.ay3,this.t1y3=this.r1z*this.ax3-this.r1x*this.az3,this.t1z3=this.r1x*this.ay3-this.r1y*this.ax3,this.t2x3=this.r2y*this.az3-this.r2z*this.ay3,this.t2y3=this.r2z*this.ax3-this.r2x*this.az3,this.t2z3=this.r2x*this.ay3-this.r2y*this.ax3,this.l1x3=this.ax3*this.m1,this.l1y3=this.ay3*this.m1,this.l1z3=this.az3*this.m1,this.l2x3=this.ax3*this.m2,this.l2y3=this.ay3*this.m2,this.l2z3=this.az3*this.m2,this.a1x3=this.t1x3*this.i1e00+this.t1y3*this.i1e01+this.t1z3*this.i1e02,this.a1y3=this.t1x3*this.i1e10+this.t1y3*this.i1e11+this.t1z3*this.i1e12,this.a1z3=this.t1x3*this.i1e20+this.t1y3*this.i1e21+this.t1z3*this.i1e22,this.a2x3=this.t2x3*this.i2e00+this.t2y3*this.i2e01+this.t2z3*this.i2e02,this.a2y3=this.t2x3*this.i2e10+this.t2y3*this.i2e11+this.t2z3*this.i2e12,this.a2z3=this.t2x3*this.i2e20+this.t2y3*this.i2e21+this.t2z3*this.i2e22,h=this.m1+this.m2,this.k00=(this.ax1*this.ax1+this.ay1*this.ay1+this.az1*this.az1)*h,this.k01=(this.ax1*this.ax2+this.ay1*this.ay2+this.az1*this.az2)*h,this.k02=(this.ax1*this.ax3+this.ay1*this.ay3+this.az1*this.az3)*h,this.k10=(this.ax2*this.ax1+this.ay2*this.ay1+this.az2*this.az1)*h,this.k11=(this.ax2*this.ax2+this.ay2*this.ay2+this.az2*this.az2)*h,this.k12=(this.ax2*this.ax3+this.ay2*this.ay3+this.az2*this.az3)*h,this.k20=(this.ax3*this.ax1+this.ay3*this.ay1+this.az3*this.az1)*h,this.k21=(this.ax3*this.ax2+this.ay3*this.ay2+this.az3*this.az2)*h,this.k22=(this.ax3*this.ax3+this.ay3*this.ay3+this.az3*this.az3)*h,this.k00+=this.t1x1*this.a1x1+this.t1y1*this.a1y1+this.t1z1*this.a1z1,this.k01+=this.t1x1*this.a1x2+this.t1y1*this.a1y2+this.t1z1*this.a1z2,this.k02+=this.t1x1*this.a1x3+this.t1y1*this.a1y3+this.t1z1*this.a1z3,this.k10+=this.t1x2*this.a1x1+this.t1y2*this.a1y1+this.t1z2*this.a1z1,this.k11+=this.t1x2*this.a1x2+this.t1y2*this.a1y2+this.t1z2*this.a1z2,this.k12+=this.t1x2*this.a1x3+this.t1y2*this.a1y3+this.t1z2*this.a1z3,this.k20+=this.t1x3*this.a1x1+this.t1y3*this.a1y1+this.t1z3*this.a1z1,this.k21+=this.t1x3*this.a1x2+this.t1y3*this.a1y2+this.t1z3*this.a1z2,this.k22+=this.t1x3*this.a1x3+this.t1y3*this.a1y3+this.t1z3*this.a1z3,this.k00+=this.t2x1*this.a2x1+this.t2y1*this.a2y1+this.t2z1*this.a2z1,this.k01+=this.t2x1*this.a2x2+this.t2y1*this.a2y2+this.t2z1*this.a2z2,this.k02+=this.t2x1*this.a2x3+this.t2y1*this.a2y3+this.t2z1*this.a2z3,this.k10+=this.t2x2*this.a2x1+this.t2y2*this.a2y1+this.t2z2*this.a2z1,this.k11+=this.t2x2*this.a2x2+this.t2y2*this.a2y2+this.t2z2*this.a2z2,this.k12+=this.t2x2*this.a2x3+this.t2y2*this.a2y3+this.t2z2*this.a2z3,this.k20+=this.t2x3*this.a2x1+this.t2y3*this.a2y1+this.t2z3*this.a2z1,this.k21+=this.t2x3*this.a2x2+this.t2y3*this.a2y2+this.t2z3*this.a2z2,this.k22+=this.t2x3*this.a2x3+this.t2y3*this.a2y3+this.t2z3*this.a2z3,this.kv00=this.k00,this.kv11=this.k11,this.kv22=this.k22,this.dv00=1/this.kv00,this.dv11=1/this.kv11,this.dv22=1/this.kv22,l&&this.limitState1!=2){var s=6.2831853*nt,y=s*s*n,p=t/(y+2*this.limitMotor1.dampingRatio*s);this.cfm1=this.kv00*p,this.limitVelocity1*=y*p}else this.cfm1=0,this.limitVelocity1*=t*.05;a&&this.limitState2!=2?(s=6.2831853*tt,y=s*s*n,p=t/(y+2*this.limitMotor2.dampingRatio*s),this.cfm2=this.kv11*p,this.limitVelocity2*=y*p):(this.cfm2=0,this.limitVelocity2*=t*.05),v&&this.limitState3!=2?(s=6.2831853*it,y=s*s*n,p=t/(y+2*this.limitMotor3.dampingRatio*s),this.cfm3=this.kv22*p,this.limitVelocity3*=y*p):(this.cfm3=0,this.limitVelocity3*=t*.05),this.k00+=this.cfm1,this.k11+=this.cfm2,this.k22+=this.cfm3,c=1/(this.k00*(this.k11*this.k22-this.k21*this.k12)+this.k10*(this.k21*this.k02-this.k01*this.k22)+this.k20*(this.k01*this.k12-this.k11*this.k02)),this.d00=(this.k11*this.k22-this.k12*this.k21)*c,this.d01=(this.k02*this.k21-this.k01*this.k22)*c,this.d02=(this.k01*this.k12-this.k02*this.k11)*c,this.d10=(this.k12*this.k20-this.k10*this.k22)*c,this.d11=(this.k00*this.k22-this.k02*this.k20)*c,this.d12=(this.k02*this.k10-this.k00*this.k12)*c,this.d20=(this.k10*this.k21-this.k11*this.k20)*c,this.d21=(this.k01*this.k20-this.k00*this.k21)*c,this.d22=(this.k00*this.k11-this.k01*this.k10)*c;var f=this.limitImpulse1+this.motorImpulse1,e=this.limitImpulse2+this.motorImpulse2,o=this.limitImpulse3+this.motorImpulse3;this.l1.x+=f*this.l1x1+e*this.l1x2+o*this.l1x3,this.l1.y+=f*this.l1y1+e*this.l1y2+o*this.l1y3,this.l1.z+=f*this.l1z1+e*this.l1z2+o*this.l1z3,this.a1.x+=f*this.a1x1+e*this.a1x2+o*this.a1x3,this.a1.y+=f*this.a1y1+e*this.a1y2+o*this.a1y3,this.a1.z+=f*this.a1z1+e*this.a1z2+o*this.a1z3,this.l2.x-=f*this.l2x1+e*this.l2x2+o*this.l2x3,this.l2.y-=f*this.l2y1+e*this.l2y2+o*this.l2y3,this.l2.z-=f*this.l2z1+e*this.l2z2+o*this.l2z3,this.a2.x-=f*this.a2x1+e*this.a2x2+o*this.a2x3,this.a2.y-=f*this.a2y1+e*this.a2y2+o*this.a2y3,this.a2.z-=f*this.a2z1+e*this.a2z2+o*this.a2z3},solve:function(){var y=this.l2.x-this.l1.x+this.a2.y*this.r2z-this.a2.z*this.r2y-this.a1.y*this.r1z+this.a1.z*this.r1y,p=this.l2.y-this.l1.y+this.a2.z*this.r2x-this.a2.x*this.r2z-this.a1.z*this.r1x+this.a1.x*this.r1z,w=this.l2.z-this.l1.z+this.a2.x*this.r2y-this.a2.y*this.r2x-this.a1.x*this.r1y+this.a1.y*this.r1x,n=y*this.ax1+p*this.ay1+w*this.az1,t=y*this.ax2+p*this.ay2+w*this.az2,i=y*this.ax3+p*this.ay3+w*this.az3,g=this.motorImpulse1,nt=this.motorImpulse2,tt=this.motorImpulse3,c=0,l=0,a=0,v,h;this.enableMotor1&&(c=(n-this.motorSpeed1)*this.dv00,this.motorImpulse1+=c,this.motorImpulse1>this.maxMotorImpulse1?this.motorImpulse1=this.maxMotorImpulse1:this.motorImpulse1<-this.maxMotorImpulse1&&(this.motorImpulse1=-this.maxMotorImpulse1),c=this.motorImpulse1-g),this.enableMotor2&&(l=(t-this.motorSpeed2)*this.dv11,this.motorImpulse2+=l,this.motorImpulse2>this.maxMotorImpulse2?this.motorImpulse2=this.maxMotorImpulse2:this.motorImpulse2<-this.maxMotorImpulse2&&(this.motorImpulse2=-this.maxMotorImpulse2),l=this.motorImpulse2-nt),this.enableMotor3&&(a=(i-this.motorSpeed3)*this.dv22,this.motorImpulse3+=a,this.motorImpulse3>this.maxMotorImpulse3?this.motorImpulse3=this.maxMotorImpulse3:this.motorImpulse3<-this.maxMotorImpulse3&&(this.motorImpulse3=-this.maxMotorImpulse3),a=this.motorImpulse3-tt),n+=c*this.kv00+l*this.k01+a*this.k02,t+=c*this.k10+l*this.kv11+a*this.k12,i+=c*this.k20+l*this.k21+a*this.kv22,n-=this.limitVelocity1+this.limitImpulse1*this.cfm1,t-=this.limitVelocity2+this.limitImpulse2*this.cfm2,i-=this.limitVelocity3+this.limitImpulse3*this.cfm3;var b=this.limitImpulse1,k=this.limitImpulse2,d=this.limitImpulse3,e=n*this.d00+t*this.d01+i*this.d02,o=n*this.d10+t*this.d11+i*this.d12,s=n*this.d20+t*this.d21+i*this.d22;this.limitImpulse1+=e,this.limitImpulse2+=o,this.limitImpulse3+=s,v=0,(this.limitState1==2||this.limitImpulse1*this.limitState1<0)&&(e=-b,t+=e*this.k10,i+=e*this.k20,v|=1),(this.limitState2==2||this.limitImpulse2*this.limitState2<0)&&(o=-k,n+=o*this.k01,i+=o*this.k21,v|=2),(this.limitState3==2||this.limitImpulse3*this.limitState3<0)&&(s=-d,n+=s*this.k02,t+=s*this.k12,v|=4);switch(v){case 1:h=1/(this.k11*this.k22-this.k12*this.k21),o=(this.k22*t+-this.k12*i)*h,s=(-this.k21*t+this.k11*i)*h;break;case 2:h=1/(this.k00*this.k22-this.k02*this.k20),e=(this.k22*n+-this.k02*i)*h,s=(-this.k20*n+this.k00*i)*h;break;case 3:s=i/this.k22;break;case 4:h=1/(this.k00*this.k11-this.k01*this.k10),e=(this.k11*n+-this.k01*t)*h,o=(-this.k10*n+this.k00*t)*h;break;case 5:o=t/this.k11;break;case 6:e=n/this.k00}this.limitImpulse1=b+e,this.limitImpulse2=k+o,this.limitImpulse3=d+s;var r=c+e,u=l+o,f=a+s;this.l1.x+=r*this.l1x1+u*this.l1x2+f*this.l1x3,this.l1.y+=r*this.l1y1+u*this.l1y2+f*this.l1y3,this.l1.z+=r*this.l1z1+u*this.l1z2+f*this.l1z3,this.a1.x+=r*this.a1x1+u*this.a1x2+f*this.a1x3,this.a1.y+=r*this.a1y1+u*this.a1y2+f*this.a1y3,this.a1.z+=r*this.a1z1+u*this.a1z2+f*this.a1z3,this.l2.x-=r*this.l2x1+u*this.l2x2+f*this.l2x3,this.l2.y-=r*this.l2y1+u*this.l2y2+f*this.l2y3,this.l2.z-=r*this.l2z1+u*this.l2z2+f*this.l2z3,this.a2.x-=r*this.a2x1+u*this.a2x2+f*this.a2x3,this.a2.y-=r*this.a2y1+u*this.a2y2+f*this.a2y3,this.a2.z-=r*this.a2z1+u*this.a2z2+f*this.a2z3}},OIMO.TranslationalConstraint=function(n,t){this.cfm=NaN,this.m1=NaN,this.m2=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.motorDenom=NaN,this.invMotorDenom=NaN,this.invDenom=NaN,this.ax=NaN,this.ay=NaN,this.az=NaN,this.r1x=NaN,this.r1y=NaN,this.r1z=NaN,this.r2x=NaN,this.r2y=NaN,this.r2z=NaN,this.t1x=NaN,this.t1y=NaN,this.t1z=NaN,this.t2x=NaN,this.t2y=NaN,this.t2z=NaN,this.l1x=NaN,this.l1y=NaN,this.l1z=NaN,this.l2x=NaN,this.l2y=NaN,this.l2z=NaN,this.a1x=NaN,this.a1y=NaN,this.a1z=NaN,this.a2x=NaN,this.a2y=NaN,this.a2z=NaN,this.lowerLimit=NaN,this.upperLimit=NaN,this.limitVelocity=NaN,this.limitState=0,this.enableMotor=!1,this.motorSpeed=NaN,this.maxMotorForce=NaN,this.maxMotorImpulse=NaN,this.limitMotor=t,this.b1=n.body1,this.b2=n.body2,this.p1=n.anchorPoint1,this.p2=n.anchorPoint2,this.r1=n.relativeAnchorPoint1,this.r2=n.relativeAnchorPoint2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse=0,this.motorImpulse=0},OIMO.TranslationalConstraint.prototype={constructor:OIMO.TranslationalConstraint,preSolve:function(n,t){var r;this.ax=this.limitMotor.axis.x,this.ay=this.limitMotor.axis.y,this.az=this.limitMotor.axis.z,this.lowerLimit=this.limitMotor.lowerLimit,this.upperLimit=this.limitMotor.upperLimit,this.motorSpeed=this.limitMotor.motorSpeed,this.maxMotorForce=this.limitMotor.maxMotorForce,this.enableMotor=this.maxMotorForce>0,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass,this.i1e00=this.i1.e00,this.i1e01=this.i1.e01,this.i1e02=this.i1.e02,this.i1e10=this.i1.e10,this.i1e11=this.i1.e11,this.i1e12=this.i1.e12,this.i1e20=this.i1.e20,this.i1e21=this.i1.e21,this.i1e22=this.i1.e22,this.i2e00=this.i2.e00,this.i2e01=this.i2.e01,this.i2e02=this.i2.e02,this.i2e10=this.i2.e10,this.i2e11=this.i2.e11,this.i2e12=this.i2.e12,this.i2e20=this.i2.e20,this.i2e21=this.i2.e21,this.i2e22=this.i2.e22;var y=this.p2.x-this.p1.x,p=this.p2.y-this.p1.y,w=this.p2.z-this.p1.z,i=y*this.ax+p*this.ay+w*this.az,s=this.limitMotor.frequency,u=s>0,b=this.lowerLimit<=this.upperLimit;(u&&i>20||i<-20)&&(u=!1),b?(this.lowerLimit==this.upperLimit?(this.limitState!=0&&(this.limitState=0,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-i,u||(i=this.lowerLimit)):i<this.lowerLimit?(this.limitState!=-1&&(this.limitState=-1,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-i,u||(i=this.lowerLimit)):i>this.upperLimit?(this.limitState!=1&&(this.limitState=1,this.limitImpulse=0),this.limitVelocity=this.upperLimit-i,u||(i=this.upperLimit)):(this.limitState=2,this.limitImpulse=0,this.limitVelocity=0),u||(this.limitVelocity>.005?this.limitVelocity-=.005:this.limitVelocity<-.005?this.limitVelocity+=.005:this.limitVelocity=0)):(this.limitState=2,this.limitImpulse=0),this.enableMotor&&(this.limitState!=0||u)?this.maxMotorImpulse=this.maxMotorForce*n:(this.motorImpulse=0,this.maxMotorImpulse=0);var h=i*this.ax,c=i*this.ay,l=i*this.az,f=this.m1/(this.m1+this.m2),e=1-f;if(this.r1x=this.r1.x+h*f,this.r1y=this.r1.y+c*f,this.r1z=this.r1.z+l*f,this.r2x=this.r2.x-h*e,this.r2y=this.r2.y-c*e,this.r2z=this.r2.z-l*e,this.t1x=this.r1y*this.az-this.r1z*this.ay,this.t1y=this.r1z*this.ax-this.r1x*this.az,this.t1z=this.r1x*this.ay-this.r1y*this.ax,this.t2x=this.r2y*this.az-this.r2z*this.ay,this.t2y=this.r2z*this.ax-this.r2x*this.az,this.t2z=this.r2x*this.ay-this.r2y*this.ax,this.l1x=this.ax*this.m1,this.l1y=this.ay*this.m1,this.l1z=this.az*this.m1,this.l2x=this.ax*this.m2,this.l2y=this.ay*this.m2,this.l2z=this.az*this.m2,this.a1x=this.t1x*this.i1e00+this.t1y*this.i1e01+this.t1z*this.i1e02,this.a1y=this.t1x*this.i1e10+this.t1y*this.i1e11+this.t1z*this.i1e12,this.a1z=this.t1x*this.i1e20+this.t1y*this.i1e21+this.t1z*this.i1e22,this.a2x=this.t2x*this.i2e00+this.t2y*this.i2e01+this.t2z*this.i2e02,this.a2y=this.t2x*this.i2e10+this.t2y*this.i2e11+this.t2z*this.i2e12,this.a2z=this.t2x*this.i2e20+this.t2y*this.i2e21+this.t2z*this.i2e22,this.motorDenom=this.m1+this.m2+this.ax*(this.a1y*this.r1z-this.a1z*this.r1y+this.a2y*this.r2z-this.a2z*this.r2y)+this.ay*(this.a1z*this.r1x-this.a1x*this.r1z+this.a2z*this.r2x-this.a2x*this.r2z)+this.az*(this.a1x*this.r1y-this.a1y*this.r1x+this.a2x*this.r2y-this.a2y*this.r2x),this.invMotorDenom=1/this.motorDenom,u&&this.limitState!=2){var o=6.2831853*s,a=o*o*n,v=t/(a+2*this.limitMotor.dampingRatio*o);this.cfm=this.motorDenom*v,this.limitVelocity*=a*v}else this.cfm=0,this.limitVelocity*=t*.05;this.invDenom=1/(this.motorDenom+this.cfm),r=this.limitImpulse+this.motorImpulse,this.l1.x+=r*this.l1x,this.l1.y+=r*this.l1y,this.l1.z+=r*this.l1z,this.a1.x+=r*this.a1x,this.a1.y+=r*this.a1y,this.a1.z+=r*this.a1z,this.l2.x-=r*this.l2x,this.l2.y-=r*this.l2y,this.l2.z-=r*this.l2z,this.a2.x-=r*this.a2x,this.a2.y-=r*this.a2y,this.a2.z-=r*this.a2z},solve:function(){var r=this.ax*(this.l2.x-this.l1.x)+this.ay*(this.l2.y-this.l1.y)+this.az*(this.l2.z-this.l1.z)+this.t2x*this.a2.x-this.t1x*this.a1.x+this.t2y*this.a2.y-this.t1y*this.a1.y+this.t2z*this.a2.z-this.t1z*this.a1.z,t,u,i,f,n;this.enableMotor?(t=(r-this.motorSpeed)*this.invMotorDenom,u=this.motorImpulse,this.motorImpulse+=t,this.motorImpulse>this.maxMotorImpulse?this.motorImpulse=this.maxMotorImpulse:this.motorImpulse<-this.maxMotorImpulse&&(this.motorImpulse=-this.maxMotorImpulse),t=this.motorImpulse-u,r-=t*this.motorDenom):t=0,this.limitState!=2?(i=(r-this.limitVelocity-this.limitImpulse*this.cfm)*this.invDenom,f=this.limitImpulse,this.limitImpulse+=i,this.limitImpulse*this.limitState<0&&(this.limitImpulse=0),i=this.limitImpulse-f):i=0,n=i+t,this.l1.x+=n*this.l1x,this.l1.y+=n*this.l1y,this.l1.z+=n*this.l1z,this.a1.x+=n*this.a1x,this.a1.y+=n*this.a1y,this.a1.z+=n*this.a1z,this.l2.x-=n*this.l2x,this.l2.y-=n*this.l2y,this.l2.z-=n*this.l2z,this.a2.x-=n*this.a2x,this.a2.y-=n*this.a2y,this.a2.z-=n*this.a2z}},OIMO.JointLink=function(n){this.prev=null,this.next=null,this.body=null,this.joint=n},OIMO.JointConfig=function(){this.body1=null,this.body2=null,this.localAnchorPoint1=new OIMO.Vec3,this.localAnchorPoint2=new OIMO.Vec3,this.localAxis1=new OIMO.Vec3,this.localAxis2=new OIMO.Vec3,this.allowCollision=!1},OIMO.LimitMotor=function(n,t){this.axis=n,this.angle=0,this.lowerLimit=t?0:1,this.upperLimit=0,this.motorSpeed=0,this.maxMotorForce=0,this.frequency=0,this.dampingRatio=0},OIMO.LimitMotor.prototype={constructor:OIMO.LimitMotor,setLimit:function(n,t){this.lowerLimit=n,this.upperLimit=t},setMotor:function(n,t){this.motorSpeed=n,this.maxMotorForce=t},setSpring:function(n,t){this.frequency=n,this.dampingRatio=t}},OIMO.Joint=function(n){OIMO.Constraint.call(this),this.JOINT_DISTANCE=1,this.JOINT_BALL_AND_SOCKET=2,this.JOINT_HINGE=3,this.JOINT_WHEEL=4,this.JOINT_SLIDER=5,this.JOINT_PRISMATIC=6,this.type=0,this.prev=null,this.next=null,this.body1=n.body1,this.body2=n.body2,this.localAnchorPoint1=(new OIMO.Vec3).copy(n.localAnchorPoint1),this.localAnchorPoint2=(new OIMO.Vec3).copy(n.localAnchorPoint2),this.relativeAnchorPoint1=new OIMO.Vec3,this.relativeAnchorPoint2=new OIMO.Vec3,this.anchorPoint1=new OIMO.Vec3,this.anchorPoint2=new OIMO.Vec3,this.allowCollision=n.allowCollision,this.b1Link=new OIMO.JointLink(this),this.b2Link=new OIMO.JointLink(this)},OIMO.Joint.prototype=Object.create(OIMO.Constraint.prototype),OIMO.Joint.prototype.updateAnchorPoints=function(){var i=this.body1.position,r=this.body2.position,n=this.body1.rotation,t=this.body2.rotation,u=this.localAnchorPoint1.x,f=this.localAnchorPoint1.y,e=this.localAnchorPoint1.z,o=this.localAnchorPoint2.x,s=this.localAnchorPoint2.y,h=this.localAnchorPoint2.z,c=u*n.e00+f*n.e01+e*n.e02,l=u*n.e10+f*n.e11+e*n.e12,a=u*n.e20+f*n.e21+e*n.e22,v=o*t.e00+s*t.e01+h*t.e02,y=o*t.e10+s*t.e11+h*t.e12,p=o*t.e20+s*t.e21+h*t.e22;this.relativeAnchorPoint1.x=c,this.relativeAnchorPoint1.y=l,this.relativeAnchorPoint1.z=a,this.relativeAnchorPoint2.x=v,this.relativeAnchorPoint2.y=y,this.relativeAnchorPoint2.z=p;var w=c+i.x,b=l+i.y,k=a+i.z,d=v+r.x,g=y+r.y,nt=p+r.z;this.anchorPoint1.x=w,this.anchorPoint1.y=b,this.anchorPoint1.z=k,this.anchorPoint2.x=d,this.anchorPoint2.y=g,this.anchorPoint2.z=nt},OIMO.Joint.prototype.attach=function(){this.b1Link.body=this.body2,this.b2Link.body=this.body1,this.body1.jointLink!=null?(this.b1Link.next=this.body1.jointLink).prev=this.b1Link:this.b1Link.next=null,this.body1.jointLink=this.b1Link,this.body1.numJoints++,this.body2.jointLink!=null?(this.b2Link.next=this.body2.jointLink).prev=this.b2Link:this.b2Link.next=null,this.body2.jointLink=this.b2Link,this.body2.numJoints++},OIMO.Joint.prototype.detach=function(){var t=this.b1Link.prev,n=this.b1Link.next;t!=null&&(t.next=n),n!=null&&(n.prev=t),this.body1.jointLink==this.b1Link&&(this.body1.jointLink=n),this.b1Link.prev=null,this.b1Link.next=null,this.b1Link.body=null,this.body1.numJoints--,t=this.b2Link.prev,n=this.b2Link.next,t!=null&&(t.next=n),n!=null&&(n.prev=t),this.body2.jointLink==this.b2Link&&(this.body2.jointLink=n),this.b2Link.prev=null,this.b2Link.next=null,this.b2Link.body=null,this.body2.numJoints--,this.b1Link.body=null,this.b2Link.body=null},OIMO.Joint.prototype.awake=function(){this.body1.awake(),this.body2.awake()},OIMO.Joint.prototype.preSolve=function(){},OIMO.Joint.prototype.solve=function(){},OIMO.Joint.prototype.postSolve=function(){},OIMO.BallAndSocketJoint=function(n){OIMO.Joint.call(this,n),this.type=this.JOINT_BALL_AND_SOCKET,this.lc=new OIMO.LinearConstraint(this)},OIMO.BallAndSocketJoint.prototype=Object.create(OIMO.Joint.prototype),OIMO.BallAndSocketJoint.prototype.preSolve=function(n,t){this.updateAnchorPoints(),this.lc.preSolve(n,t)},OIMO.BallAndSocketJoint.prototype.solve=function(){this.lc.solve()},OIMO.BallAndSocketJoint.prototype.postSolve=function(){},OIMO.DistanceJoint=function(n,t,i){OIMO.Joint.call(this,n),this.type=this.JOINT_DISTANCE,this.normal=new OIMO.Vec3,this.limitMotor=new OIMO.LimitMotor(this.normal,!0),this.limitMotor.lowerLimit=t,this.limitMotor.upperLimit=i,this.t=new OIMO.TranslationalConstraint(this,this.limitMotor)},OIMO.DistanceJoint.prototype=Object.create(OIMO.Joint.prototype),OIMO.DistanceJoint.prototype.preSolve=function(n,t){this.updateAnchorPoints();var r=this.anchorPoint2.x-this.anchorPoint1.x,u=this.anchorPoint2.y-this.anchorPoint1.y,f=this.anchorPoint2.z-this.anchorPoint1.z,i=Math.sqrt(r*r+u*u+f*f);i>0&&(i=1/i),this.normal.init(r*i,u*i,f*i),this.t.preSolve(n,t)},OIMO.DistanceJoint.prototype.solve=function(){this.t.solve()},OIMO.DistanceJoint.prototype.postSolve=function(){},OIMO.HingeJoint=function(n,t,i){var u,r;OIMO.Joint.call(this,n),this.localAxis1=(new OIMO.Vec3).normalize(n.localAxis1),this.localAxis2=(new OIMO.Vec3).normalize(n.localAxis2),this.localAxis1X=this.localAxis1.x,this.localAxis1Y=this.localAxis1.y,this.localAxis1Z=this.localAxis1.z,this.localAngAxis1X=this.localAxis1Y*this.localAxis1X-this.localAxis1Z*this.localAxis1Z,this.localAngAxis1Y=-this.localAxis1Z*this.localAxis1Y-this.localAxis1X*this.localAxis1X,this.localAngAxis1Z=this.localAxis1X*this.localAxis1Z+this.localAxis1Y*this.localAxis1Y,u=1/Math.sqrt(this.localAngAxis1X*this.localAngAxis1X+this.localAngAxis1Y*this.localAngAxis1Y+this.localAngAxis1Z*this.localAngAxis1Z),this.localAngAxis1X*=u,this.localAngAxis1Y*=u,this.localAngAxis1Z*=u,this.localAxis2X=this.localAxis2.x,this.localAxis2Y=this.localAxis2.y,this.localAxis2Z=this.localAxis2.z,r=(new OIMO.Mat33).setQuat((new OIMO.Quat).arc(this.localAxis1,this.localAxis2)),this.localAngAxis2X=this.localAngAxis1X*r.e00+this.localAngAxis1Y*r.e01+this.localAngAxis1Z*r.e02,this.localAngAxis2Y=this.localAngAxis1X*r.e10+this.localAngAxis1Y*r.e11+this.localAngAxis1Z*r.e12,this.localAngAxis2Z=this.localAngAxis1X*r.e20+this.localAngAxis1Y*r.e21+this.localAngAxis1Z*r.e22,this.type=this.JOINT_HINGE,this.nor=new OIMO.Vec3,this.tan=new OIMO.Vec3,this.bin=new OIMO.Vec3,this.limitMotor=new OIMO.LimitMotor(this.nor,!1),this.limitMotor.lowerLimit=t,this.limitMotor.upperLimit=i,this.lc=new OIMO.LinearConstraint(this),this.r3=new OIMO.Rotational3Constraint(this,this.limitMotor,new OIMO.LimitMotor(this.tan,!0),new OIMO.LimitMotor(this.bin,!0))},OIMO.HingeJoint.prototype=Object.create(OIMO.Joint.prototype),OIMO.HingeJoint.prototype.preSolve=function(n,t){var i,r,w,b;this.updateAnchorPoints(),i=this.body1.rotation;var k=this.localAxis1X*i.e00+this.localAxis1Y*i.e01+this.localAxis1Z*i.e02,d=this.localAxis1X*i.e10+this.localAxis1Y*i.e11+this.localAxis1Z*i.e12,g=this.localAxis1X*i.e20+this.localAxis1Y*i.e21+this.localAxis1Z*i.e22,c=this.localAngAxis1X*i.e00+this.localAngAxis1Y*i.e01+this.localAngAxis1Z*i.e02,l=this.localAngAxis1X*i.e10+this.localAngAxis1Y*i.e11+this.localAngAxis1Z*i.e12,a=this.localAngAxis1X*i.e20+this.localAngAxis1Y*i.e21+this.localAngAxis1Z*i.e22;i=this.body2.rotation;var nt=this.localAxis2X*i.e00+this.localAxis2Y*i.e01+this.localAxis2Z*i.e02,tt=this.localAxis2X*i.e10+this.localAxis2Y*i.e11+this.localAxis2Z*i.e12,it=this.localAxis2X*i.e20+this.localAxis2Y*i.e21+this.localAxis2Z*i.e22,v=this.localAngAxis2X*i.e00+this.localAngAxis2Y*i.e01+this.localAngAxis2Z*i.e02,y=this.localAngAxis2X*i.e10+this.localAngAxis2Y*i.e11+this.localAngAxis2Z*i.e12,p=this.localAngAxis2X*i.e20+this.localAngAxis2Y*i.e21+this.localAngAxis2Z*i.e22,u=k*this.body2.inverseMass+nt*this.body1.inverseMass,f=d*this.body2.inverseMass+tt*this.body1.inverseMass,e=g*this.body2.inverseMass+it*this.body1.inverseMass;r=Math.sqrt(u*u+f*f+e*e),r>0&&(r=1/r),u*=r,f*=r,e*=r;var o=f*u-e*e,s=-e*f-u*u,h=u*e+f*f;r=1/Math.sqrt(o*o+s*s+h*h),o*=r,s*=r,h*=r;var rt=f*h-e*s,ut=e*o-u*h,ft=u*s-f*o;this.nor.init(u,f,e),this.tan.init(o,s,h),this.bin.init(rt,ut,ft),this.limitMotor.angle=u*(l*p-a*y)+f*(a*v-c*p)+e*(c*y-l*v)<0?-this.acosClamp(c*v+l*y+a*p):this.acosClamp(c*v+l*y+a*p),r=d*it-g*tt,w=g*nt-k*it,b=k*tt-d*nt,this.r3.limitMotor2.angle=o*r+s*w+h*b,this.r3.limitMotor3.angle=rt*r+ut*w+ft*b,this.r3.preSolve(n,t),this.lc.preSolve(n,t)},OIMO.HingeJoint.prototype.solve=function(){this.r3.solve(),this.lc.solve()},OIMO.HingeJoint.prototype.postSolve=function(){},OIMO.HingeJoint.prototype.acosClamp=function(n){return n>1?0:n<-1?Math.PI:Math.acos(n)},OIMO.PrismaticJoint=function(n,t,i){OIMO.Joint.call(this,n),this.localAxis1=(new OIMO.Vec3).normalize(n.localAxis1),this.localAxis2=(new OIMO.Vec3).normalize(n.localAxis2),this.localAxis1X=this.localAxis1.x,this.localAxis1Y=this.localAxis1.y,this.localAxis1Z=this.localAxis1.z,this.localAxis2X=this.localAxis2.x,this.localAxis2Y=this.localAxis2.y,this.localAxis2Z=this.localAxis2.z,this.type=this.JOINT_PRISMATIC,this.nor=new OIMO.Vec3,this.tan=new OIMO.Vec3,this.bin=new OIMO.Vec3,this.ac=new OIMO.AngularConstraint(this,(new OIMO.Quat).arc(this.localAxis1,this.localAxis2)),this.limitMotor=new OIMO.LimitMotor(this.nor,!0),this.limitMotor.lowerLimit=t,this.limitMotor.upperLimit=i,this.t3=new OIMO.Translational3Constraint(this,this.limitMotor,new OIMO.LimitMotor(this.tan,!0),new OIMO.LimitMotor(this.bin,!0))},OIMO.PrismaticJoint.prototype=Object.create(OIMO.Joint.prototype),OIMO.PrismaticJoint.prototype.preSolve=function(n,t){var i,r,d,g;this.updateAnchorPoints(),i=this.body1.rotation;var c=this.localAxis1X*i.e00+this.localAxis1Y*i.e01+this.localAxis1Z*i.e02,l=this.localAxis1X*i.e10+this.localAxis1Y*i.e11+this.localAxis1Z*i.e12,a=this.localAxis1X*i.e20+this.localAxis1Y*i.e21+this.localAxis1Z*i.e22;i=this.body2.rotation;var v=this.localAxis2X*i.e00+this.localAxis2Y*i.e01+this.localAxis2Z*i.e02,y=this.localAxis2X*i.e10+this.localAxis2Y*i.e11+this.localAxis2Z*i.e12,p=this.localAxis2X*i.e20+this.localAxis2Y*i.e21+this.localAxis2Z*i.e22,u=c*this.body2.inverseMass+v*this.body1.inverseMass,f=l*this.body2.inverseMass+y*this.body1.inverseMass,e=a*this.body2.inverseMass+p*this.body1.inverseMass;r=Math.sqrt(u*u+f*f+e*e),r>0&&(r=1/r),u*=r,f*=r,e*=r;var o=f*u-e*e,s=-e*f-u*u,h=u*e+f*f;r=1/Math.sqrt(o*o+s*s+h*h),o*=r,s*=r,h*=r;var w=f*h-e*s,b=e*o-u*h,k=u*s-f*o;this.nor.init(u,f,e),this.tan.init(o,s,h),this.bin.init(w,b,k),this.ac.preSolve(n,t),this.t3.preSolve(n,t)},OIMO.PrismaticJoint.prototype.solve=function(){this.ac.solve(),this.t3.solve()},OIMO.PrismaticJoint.prototype.postSolve=function(){},OIMO.SliderJoint=function(n,t,i){var u,r;OIMO.Joint.call(this,n),this.localAxis1=(new OIMO.Vec3).normalize(n.localAxis1),this.localAxis2=(new OIMO.Vec3).normalize(n.localAxis2),this.localAxis1X=this.localAxis1.x,this.localAxis1Y=this.localAxis1.y,this.localAxis1Z=this.localAxis1.z,this.localAngAxis1X=this.localAxis1Y*this.localAxis1X-this.localAxis1Z*this.localAxis1Z,this.localAngAxis1Y=-this.localAxis1Z*this.localAxis1Y-this.localAxis1X*this.localAxis1X,this.localAngAxis1Z=this.localAxis1X*this.localAxis1Z+this.localAxis1Y*this.localAxis1Y,u=1/Math.sqrt(this.localAngAxis1X*this.localAngAxis1X+this.localAngAxis1Y*this.localAngAxis1Y+this.localAngAxis1Z*this.localAngAxis1Z),this.localAngAxis1X*=u,this.localAngAxis1Y*=u,this.localAngAxis1Z*=u,this.localAxis2X=this.localAxis2.x,this.localAxis2Y=this.localAxis2.y,this.localAxis2Z=this.localAxis2.z,r=(new OIMO.Mat33).setQuat((new OIMO.Quat).arc(this.localAxis1,this.localAxis2)),this.localAngAxis2X=this.localAngAxis1X*r.e00+this.localAngAxis1Y*r.e01+this.localAngAxis1Z*r.e02,this.localAngAxis2Y=this.localAngAxis1X*r.e10+this.localAngAxis1Y*r.e11+this.localAngAxis1Z*r.e12,this.localAngAxis2Z=this.localAngAxis1X*r.e20+this.localAngAxis1Y*r.e21+this.localAngAxis1Z*r.e22,this.type=this.joint.Joint.JOINT_SLIDER,this.nor=new OIMO.Vec3,this.tan=new OIMO.Vec3,this.bin=new OIMO.Vec3,this.rotationalLimitMotor=new OIMO.LimitMotor(this.nor,!1),this.r3=new OIMO.Rotational3Constraint(this,this.rotationalLimitMotor,new OIMO.LimitMotor(this.tan,!0),new OIMO.LimitMotor(this.bin,!0)),this.translationalLimitMotor=new OIMO.LimitMotor(this.nor,!0),this.translationalLimitMotor.lowerLimit=t,this.translationalLimitMotor.upperLimit=i,this.t3=new OIMO.Translational3Constraint(this,this.translationalLimitMotor,new OIMO.LimitMotor(this.tan,!0),new OIMO.LimitMotor(this.bin,!0))},OIMO.SliderJoint.prototype=Object.create(OIMO.Joint.prototype),OIMO.SliderJoint.prototype.preSolve=function(n,t){var i,r,w,b;this.updateAnchorPoints(),i=this.body1.rotation;var k=this.localAxis1X*i.e00+this.localAxis1Y*i.e01+this.localAxis1Z*i.e02,d=this.localAxis1X*i.e10+this.localAxis1Y*i.e11+this.localAxis1Z*i.e12,g=this.localAxis1X*i.e20+this.localAxis1Y*i.e21+this.localAxis1Z*i.e22,c=this.localAngAxis1X*i.e00+this.localAngAxis1Y*i.e01+this.localAngAxis1Z*i.e02,l=this.localAngAxis1X*i.e10+this.localAngAxis1Y*i.e11+this.localAngAxis1Z*i.e12,a=this.localAngAxis1X*i.e20+this.localAngAxis1Y*i.e21+this.localAngAxis1Z*i.e22;i=this.body2.rotation;var nt=this.localAxis2X*i.e00+this.localAxis2Y*i.e01+this.localAxis2Z*i.e02,tt=this.localAxis2X*i.e10+this.localAxis2Y*i.e11+this.localAxis2Z*i.e12,it=this.localAxis2X*i.e20+this.localAxis2Y*i.e21+this.localAxis2Z*i.e22,v=this.localAngAxis2X*i.e00+this.localAngAxis2Y*i.e01+this.localAngAxis2Z*i.e02,y=this.localAngAxis2X*i.e10+this.localAngAxis2Y*i.e11+this.localAngAxis2Z*i.e12,p=this.localAngAxis2X*i.e20+this.localAngAxis2Y*i.e21+this.localAngAxis2Z*i.e22,u=k*this.body2.inverseMass+nt*this.body1.inverseMass,f=d*this.body2.inverseMass+tt*this.body1.inverseMass,e=g*this.body2.inverseMass+it*this.body1.inverseMass;r=Math.sqrt(u*u+f*f+e*e),r>0&&(r=1/r),u*=r,f*=r,e*=r;var o=f*u-e*e,s=-e*f-u*u,h=u*e+f*f;r=1/Math.sqrt(o*o+s*s+h*h),o*=r,s*=r,h*=r;var rt=f*h-e*s,ut=e*o-u*h,ft=u*s-f*o;this.nor.init(u,f,e),this.tan.init(o,s,h),this.bin.init(rt,ut,ft),this.rotationalLimitMotor.angle=u*(l*p-a*y)+f*(a*v-c*p)+e*(c*y-l*v)<0?-this.acosClamp(c*v+l*y+a*p):this.acosClamp(c*v+l*y+a*p),r=d*it-g*tt,w=g*nt-k*it,b=k*tt-d*nt,this.r3.limitMotor2.angle=o*r+s*w+h*b,this.r3.limitMotor3.angle=rt*r+ut*w+ft*b,this.r3.preSolve(n,t),this.t3.preSolve(n,t)},OIMO.SliderJoint.prototype.solve=function(){this.r3.solve(),this.t3.solve()},OIMO.SliderJoint.prototype.postSolve=function(){},OIMO.SliderJoint.prototype.acosClamp=function(n){return n>1?0:n<-1?Math.PI:Math.acos(n)},OIMO.WheelJoint=function(n){var t,r,i;OIMO.Joint.call(this,n),this.localAxis1=(new OIMO.Vec3).normalize(n.localAxis1),this.localAxis2=(new OIMO.Vec3).normalize(n.localAxis2),this.localAxis1X=this.localAxis1.x,this.localAxis1Y=this.localAxis1.y,this.localAxis1Z=this.localAxis1.z,this.localAxis2X=this.localAxis2.x,this.localAxis2Y=this.localAxis2.y,this.localAxis2Z=this.localAxis2.z,r=this.localAxis1X*this.localAxis2X+this.localAxis1Y*this.localAxis2Y+this.localAxis1Z*this.localAxis2Z,r>-1&&r<1?(this.localAngAxis1X=this.localAxis2X-r*this.localAxis1X,this.localAngAxis1Y=this.localAxis2Y-r*this.localAxis1Y,this.localAngAxis1Z=this.localAxis2Z-r*this.localAxis1Z,this.localAngAxis2X=this.localAxis1X-r*this.localAxis2X,this.localAngAxis2Y=this.localAxis1Y-r*this.localAxis2Y,this.localAngAxis2Z=this.localAxis1Z-r*this.localAxis2Z,t=1/Math.sqrt(this.localAngAxis1X*this.localAngAxis1X+this.localAngAxis1Y*this.localAngAxis1Y+this.localAngAxis1Z*this.localAngAxis1Z),this.localAngAxis1X*=t,this.localAngAxis1Y*=t,this.localAngAxis1Z*=t,t=1/Math.sqrt(this.localAngAxis2X*this.localAngAxis2X+this.localAngAxis2Y*this.localAngAxis2Y+this.localAngAxis2Z*this.localAngAxis2Z),this.localAngAxis2X*=t,this.localAngAxis2Y*=t,this.localAngAxis2Z*=t):(this.localAngAxis1X=this.localAxis1Y*this.localAxis1X-this.localAxis1Z*this.localAxis1Z,this.localAngAxis1Y=-this.localAxis1Z*this.localAxis1Y-this.localAxis1X*this.localAxis1X,this.localAngAxis1Z=this.localAxis1X*this.localAxis1Z+this.localAxis1Y*this.localAxis1Y,t=1/Math.sqrt(this.localAngAxis1X*this.localAngAxis1X+this.localAngAxis1Y*this.localAngAxis1Y+this.localAngAxis1Z*this.localAngAxis1Z),this.localAngAxis1X*=t,this.localAngAxis1Y*=t,this.localAngAxis1Z*=t,i=(new OIMO.Mat33).setQuat((new OIMO.Quat).arc(this.localAxis1,this.localAxis2)),this.localAngAxis2X=this.localAngAxis1X*i.e00+this.localAngAxis1Y*i.e01+this.localAngAxis1Z*i.e02,this.localAngAxis2Y=this.localAngAxis1X*i.e10+this.localAngAxis1Y*i.e11+this.localAngAxis1Z*i.e12,this.localAngAxis2Z=this.localAngAxis1X*i.e20+this.localAngAxis1Y*i.e21+this.localAngAxis1Z*i.e22),this.type=this.JOINT_WHEEL,this.nor=new OIMO.Vec3,this.tan=new OIMO.Vec3,this.bin=new OIMO.Vec3,this.translationalLimitMotor=new OIMO.LimitMotor(this.tan,!0),this.translationalLimitMotor.frequency=8,this.translationalLimitMotor.dampingRatio=1,this.rotationalLimitMotor1=new OIMO.LimitMotor(this.tan,!1),this.rotationalLimitMotor2=new OIMO.LimitMotor(this.bin,!1),this.t3=new OIMO.Translational3Constraint(this,new OIMO.LimitMotor(this.nor,!0),this.translationalLimitMotor,new OIMO.LimitMotor(this.bin,!0)),this.t3.weight=1,this.r3=new OIMO.Rotational3Constraint(this,new OIMO.LimitMotor(this.nor,!0),this.rotationalLimitMotor1,this.rotationalLimitMotor2)},OIMO.WheelJoint.prototype=Object.create(OIMO.Joint.prototype),OIMO.WheelJoint.prototype.preSolve=function(n,t){var i,r,ut,ft;this.updateAnchorPoints(),i=this.body1.rotation;var u=this.localAxis1X*i.e00+this.localAxis1Y*i.e01+this.localAxis1Z*i.e02,f=this.localAxis1X*i.e10+this.localAxis1Y*i.e11+this.localAxis1Z*i.e12,e=this.localAxis1X*i.e20+this.localAxis1Y*i.e21+this.localAxis1Z*i.e22,v=this.localAngAxis1X*i.e00+this.localAngAxis1Y*i.e01+this.localAngAxis1Z*i.e02,y=this.localAngAxis1X*i.e10+this.localAngAxis1Y*i.e11+this.localAngAxis1Z*i.e12,p=this.localAngAxis1X*i.e20+this.localAngAxis1Y*i.e21+this.localAngAxis1Z*i.e22;i=this.body2.rotation;var o=this.localAxis2X*i.e00+this.localAxis2Y*i.e01+this.localAxis2Z*i.e02,s=this.localAxis2X*i.e10+this.localAxis2Y*i.e11+this.localAxis2Z*i.e12,h=this.localAxis2X*i.e20+this.localAxis2Y*i.e21+this.localAxis2Z*i.e22,w=this.localAngAxis2X*i.e00+this.localAngAxis2Y*i.e01+this.localAngAxis2Z*i.e02,b=this.localAngAxis2X*i.e10+this.localAngAxis2Y*i.e11+this.localAngAxis2Z*i.e12,k=this.localAngAxis2X*i.e20+this.localAngAxis2Y*i.e21+this.localAngAxis2Z*i.e22;this.r3.limitMotor1.angle=u*o+f*s+e*h,this.rotationalLimitMotor1.angle=u*(y*h-p*s)+f*(p*o-v*h)+e*(v*s-y*o)<0?-this.acosClamp(v*o+y*s+p*h):this.acosClamp(v*o+y*s+p*h),this.rotationalLimitMotor2.angle=o*(b*e-k*f)+s*(k*u-w*e)+h*(w*f-b*u)<0?this.acosClamp(w*u+b*f+k*e):-this.acosClamp(w*u+b*f+k*e);var c=s*e-h*f,l=h*u-o*e,a=o*f-s*u;r=Math.sqrt(c*c+l*l+a*a),r>0&&(r=1/r),c*=r,l*=r,a*=r;var d=l*h-a*s,g=a*o-c*h,nt=c*s-l*o;r=Math.sqrt(d*d+g*g+nt*nt),r>0&&(r=1/r),d*=r,g*=r,nt*=r;var tt=f*a-e*l,it=e*c-u*a,rt=u*l-f*c;r=Math.sqrt(tt*tt+it*it+rt*rt),r>0&&(r=1/r),tt*=r,it*=r,rt*=r,this.nor.init(c,l,a),this.tan.init(d,g,nt),this.bin.init(tt,it,rt),this.r3.preSolve(n,t),this.t3.preSolve(n,t)},OIMO.WheelJoint.prototype.solve=function(){this.r3.solve(),this.t3.solve()},OIMO.WheelJoint.prototype.postSolve=function(){},OIMO.WheelJoint.prototype.acosClamp=function(n){return n>1?0:n<-1?Math.PI:Math.acos(n)},OIMO.Mat33=function(n,t,i,r,u,f,e,o,s){this.e00=n||1,this.e01=t||0,this.e02=i||0,this.e10=r||0,this.e11=u||1,this.e12=f||0,this.e20=e||0,this.e21=o||0,this.e22=s||1},OIMO.Mat33.prototype={constructor:OIMO.Mat33,init:function(n,t,i,r,u,f,e,o,s){return this.e00=n,this.e01=t,this.e02=i,this.e10=r,this.e11=u,this.e12=f,this.e20=e,this.e21=o,this.e22=s,this},add:function(n,t){return this.e00=n.e00+t.e00,this.e01=n.e01+t.e01,this.e02=n.e02+t.e02,this.e10=n.e10+t.e10,this.e11=n.e11+t.e11,this.e12=n.e12+t.e12,this.e20=n.e20+t.e20,this.e21=n.e21+t.e21,this.e22=n.e22+t.e22,this},addEqual:function(n){return this.e00+=n.e00,this.e01+=n.e01,this.e02+=n.e02,this.e10+=n.e10,this.e11+=n.e11,this.e12+=n.e12,this.e20+=n.e20,this.e21+=n.e21,this.e22+=n.e22,this},sub:function(n,t){return this.e00=n.e00-t.e00,this.e01=n.e01-t.e01,this.e02=n.e02-t.e02,this.e10=n.e10-t.e10,this.e11=n.e11-t.e11,this.e12=n.e12-t.e12,this.e20=n.e20-t.e20,this.e21=n.e21-t.e21,this.e22=n.e22-t.e22,this},subEqual:function(n){return this.e00-=n.e00,this.e01-=n.e01,this.e02-=n.e02,this.e10-=n.e10,this.e11-=n.e11,this.e12-=n.e12,this.e20-=n.e20,this.e21-=n.e21,this.e22-=n.e22,this},scale:function(n,t){return this.e00=n.e00*t,this.e01=n.e01*t,this.e02=n.e02*t,this.e10=n.e10*t,this.e11=n.e11*t,this.e12=n.e12*t,this.e20=n.e20*t,this.e21=n.e21*t,this.e22=n.e22*t,this},scaleEqual:function(n){return this.e00*=n,this.e01*=n,this.e02*=n,this.e10*=n,this.e11*=n,this.e12*=n,this.e20*=n,this.e21*=n,this.e22*=n,this},mul:function(n,t){var i=n.e00*t.e00+n.e01*t.e10+n.e02*t.e20,r=n.e00*t.e01+n.e01*t.e11+n.e02*t.e21,u=n.e00*t.e02+n.e01*t.e12+n.e02*t.e22,f=n.e10*t.e00+n.e11*t.e10+n.e12*t.e20,e=n.e10*t.e01+n.e11*t.e11+n.e12*t.e21,o=n.e10*t.e02+n.e11*t.e12+n.e12*t.e22,s=n.e20*t.e00+n.e21*t.e10+n.e22*t.e20,h=n.e20*t.e01+n.e21*t.e11+n.e22*t.e21,c=n.e20*t.e02+n.e21*t.e12+n.e22*t.e22;return this.e00=i,this.e01=r,this.e02=u,this.e10=f,this.e11=e,this.e12=o,this.e20=s,this.e21=h,this.e22=c,this},mulScale:function(n,t,i,r,u){var y=u||!1,f,e,o,s,h,c,l,a,v;return y?(f=t*n.e00,e=t*n.e01,o=t*n.e02,s=i*n.e10,h=i*n.e11,c=i*n.e12,l=r*n.e20,a=r*n.e21,v=r*n.e22,this.e00=f,this.e01=e,this.e02=o,this.e10=s,this.e11=h,this.e12=c,this.e20=l,this.e21=a,this.e22=v):(f=n.e00*t,e=n.e01*i,o=n.e02*r,s=n.e10*t,h=n.e11*i,c=n.e12*r,l=n.e20*t,a=n.e21*i,v=n.e22*r,this.e00=f,this.e01=e,this.e02=o,this.e10=s,this.e11=h,this.e12=c,this.e20=l,this.e21=a,this.e22=v),this},mulRotate:function(n,t,i,r,u,f){var et=f||!1,o=Math.sin(t),b=Math.cos(t),e=1-b,s=i*i*e+b,h=i*r*e-u*o,c=i*u*e+r*o,l=r*i*e+u*o,a=r*r*e+b,v=r*u*e-i*o,y=u*i*e-r*o,p=u*r*e+i*o,w=u*u*e+b,k,d,g,nt,tt,it,rt,ut,ft;return et?(k=s*n.e00+h*n.e10+c*n.e20,d=s*n.e01+h*n.e11+c*n.e21,g=s*n.e02+h*n.e12+c*n.e22,nt=l*n.e00+a*n.e10+v*n.e20,tt=l*n.e01+a*n.e11+v*n.e21,it=l*n.e02+a*n.e12+v*n.e22,rt=y*n.e00+p*n.e10+w*n.e20,ut=y*n.e01+p*n.e11+w*n.e21,ft=y*n.e02+p*n.e12+w*n.e22,this.e00=k,this.e01=d,this.e02=g,this.e10=nt,this.e11=tt,this.e12=it,this.e20=rt,this.e21=ut,this.e22=ft):(k=n.e00*s+n.e01*l+n.e02*y,d=n.e00*h+n.e01*a+n.e02*p,g=n.e00*c+n.e01*v+n.e02*w,nt=n.e10*s+n.e11*l+n.e12*y,tt=n.e10*h+n.e11*a+n.e12*p,it=n.e10*c+n.e11*v+n.e12*w,rt=n.e20*s+n.e21*l+n.e22*y,ut=n.e20*h+n.e21*a+n.e22*p,ft=n.e20*c+n.e21*v+n.e22*w,this.e00=k,this.e01=d,this.e02=g,this.e10=nt,this.e11=tt,this.e12=it,this.e20=rt,this.e21=ut,this.e22=ft),this},transpose:function(n){var t=n.e10,i=n.e20,r=n.e01,u=n.e21,f=n.e02,e=n.e12;return this.e00=n.e00,this.e01=t,this.e02=i,this.e10=r,this.e11=n.e11,this.e12=u,this.e20=f,this.e21=e,this.e22=n.e22,this},setQuat:function(n){var r=2*n.x,i=2*n.y,t=2*n.z,u=n.x*r,f=n.y*i,e=n.z*t,o=n.x*i,s=n.y*t,h=n.x*t,c=n.s*r,l=n.s*i,a=n.s*t;return this.e00=1-f-e,this.e01=o-a,this.e02=h+l,this.e10=o+a,this.e11=1-u-e,this.e12=s-c,this.e20=h-l,this.e21=s+c,this.e22=1-u-f,this},invert:function(n){var t=n.e00*(n.e11*n.e22-n.e21*n.e12)+n.e10*(n.e21*n.e02-n.e01*n.e22)+n.e20*(n.e01*n.e12-n.e11*n.e02);t!=0&&(t=1/t);var i=n.e11*n.e22-n.e12*n.e21,r=n.e02*n.e21-n.e01*n.e22,u=n.e01*n.e12-n.e02*n.e11,f=n.e12*n.e20-n.e10*n.e22,e=n.e00*n.e22-n.e02*n.e20,o=n.e02*n.e10-n.e00*n.e12,s=n.e10*n.e21-n.e11*n.e20,h=n.e01*n.e20-n.e00*n.e21,c=n.e00*n.e11-n.e01*n.e10;return this.e00=t*i,this.e01=t*r,this.e02=t*u,this.e10=t*f,this.e11=t*e,this.e12=t*o,this.e20=t*s,this.e21=t*h,this.e22=t*c,this},copy:function(n){return this.e00=n.e00,this.e01=n.e01,this.e02=n.e02,this.e10=n.e10,this.e11=n.e11,this.e12=n.e12,this.e20=n.e20,this.e21=n.e21,this.e22=n.e22,this},copyMat44:function(n){return this.e00=n.e00,this.e01=n.e01,this.e02=n.e02,this.e10=n.e10,this.e11=n.e11,this.e12=n.e12,this.e20=n.e20,this.e21=n.e21,this.e22=n.e22,this},clone:function(){return new OIMO.Mat33(this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22)},toString:function(){return"Mat33|"+this.e00.toFixed(4)+", "+this.e01.toFixed(4)+", "+this.e02.toFixed(4)+"|\n     |"+this.e10.toFixed(4)+", "+this.e11.toFixed(4)+", "+this.e12.toFixed(4)+"|\n     |"+this.e20.toFixed(4)+", "+this.e21.toFixed(4)+", "+this.e22.toFixed(4)+"|"}},OIMO.Mat44=function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){this.e00=n||1,this.e01=t||0,this.e02=i||0,this.e03=r||0,this.e10=u||0,this.e11=f||1,this.e12=e||0,this.e13=o||0,this.e20=s||0,this.e21=h||0,this.e22=c||1,this.e23=l||0,this.e30=a||0,this.e31=v||0,this.e32=y||0,this.e33=p||1},OIMO.Mat44.prototype={constructor:OIMO.Mat44,init:function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){return this.e00=n,this.e01=t,this.e02=i,this.e03=r,this.e10=u,this.e11=f,this.e12=e,this.e13=o,this.e20=s,this.e21=h,this.e22=c,this.e23=l,this.e30=a,this.e31=v,this.e32=y,this.e33=p,this},add:function(n,t){return this.e00=n.e00+t.e00,this.e01=n.e01+t.e01,this.e02=n.e02+t.e02,this.e03=n.e03+t.e03,this.e10=n.e10+t.e10,this.e11=n.e11+t.e11,this.e12=n.e12+t.e12,this.e13=n.e13+t.e13,this.e20=n.e20+t.e20,this.e21=n.e21+t.e21,this.e22=n.e22+t.e22,this.e23=n.e23+t.e23,this.e30=n.e30+t.e30,this.e31=n.e31+t.e31,this.e32=n.e32+t.e32,this.e33=n.e33+t.e33,this},sub:function(n,t){return this.e00=n.e00-t.e00,this.e01=n.e01-t.e01,this.e02=n.e02-t.e02,this.e03=n.e03-t.e03,this.e10=n.e10-t.e10,this.e11=n.e11-t.e11,this.e12=n.e12-t.e12,this.e13=n.e13-t.e13,this.e20=n.e20-t.e20,this.e21=n.e21-t.e21,this.e22=n.e22-t.e22,this.e23=n.e23-t.e23,this.e30=n.e30-t.e30,this.e31=n.e31-t.e31,this.e32=n.e32-t.e32,this.e33=n.e33-t.e33,this},scale:function(n,t){return this.e00=n.e00*t,this.e01=n.e01*t,this.e02=n.e02*t,this.e03=n.e03*t,this.e10=n.e10*t,this.e11=n.e11*t,this.e12=n.e12*t,this.e13=n.e13*t,this.e20=n.e20*t,this.e21=n.e21*t,this.e22=n.e22*t,this.e23=n.e23*t,this.e30=n.e30*t,this.e31=n.e31*t,this.e32=n.e32*t,this.e33=n.e33*t,this},mul:function(n,t){var i=n.e00*t.e00+n.e01*t.e10+n.e02*t.e20+n.e03*t.e30,r=n.e00*t.e01+n.e01*t.e11+n.e02*t.e21+n.e03*t.e31,u=n.e00*t.e02+n.e01*t.e12+n.e02*t.e22+n.e03*t.e32,f=n.e00*t.e03+n.e01*t.e13+n.e02*t.e23+n.e03*t.e33,e=n.e10*t.e00+n.e11*t.e10+n.e12*t.e20+n.e13*t.e30,o=n.e10*t.e01+n.e11*t.e11+n.e12*t.e21+n.e13*t.e31,s=n.e10*t.e02+n.e11*t.e12+n.e12*t.e22+n.e13*t.e32,h=n.e10*t.e03+n.e11*t.e13+n.e12*t.e23+n.e13*t.e33,c=n.e20*t.e00+n.e21*t.e10+n.e22*t.e20+n.e23*t.e30,l=n.e20*t.e01+n.e21*t.e11+n.e22*t.e21+n.e23*t.e31,a=n.e20*t.e02+n.e21*t.e12+n.e22*t.e22+n.e23*t.e32,v=n.e20*t.e03+n.e21*t.e13+n.e22*t.e23+n.e23*t.e33,y=n.e30*t.e00+n.e31*t.e10+n.e32*t.e20+n.e33*t.e30,p=n.e30*t.e01+n.e31*t.e11+n.e32*t.e21+n.e33*t.e31,w=n.e30*t.e02+n.e31*t.e12+n.e32*t.e22+n.e33*t.e32,b=n.e30*t.e03+n.e31*t.e13+n.e32*t.e23+n.e33*t.e33;return this.e00=i,this.e01=r,this.e02=u,this.e03=f,this.e10=e,this.e11=o,this.e12=s,this.e13=h,this.e20=c,this.e21=l,this.e22=a,this.e23=v,this.e30=y,this.e31=p,this.e32=w,this.e33=b,this},mulScale:function(n,t,i,r,u){var nt=u||!1,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g;return nt?(f=t*n.e00,e=t*n.e01,o=t*n.e02,s=t*n.e03,h=i*n.e10,c=i*n.e11,l=i*n.e12,a=i*n.e13,v=r*n.e20,y=r*n.e21,p=r*n.e22,w=r*n.e23,b=n.e30,k=n.e31,d=n.e32,g=n.e33,this.e00=f,this.e01=e,this.e02=o,this.e03=s,this.e10=h,this.e11=c,this.e12=l,this.e13=a,this.e20=v,this.e21=y,this.e22=p,this.e23=w,this.e30=b,this.e31=k,this.e32=d,this.e33=g):(f=n.e00*t,e=n.e01*i,o=n.e02*r,s=n.e03,h=n.e10*t,c=n.e11*i,l=n.e12*r,a=n.e13,v=n.e20*t,y=n.e21*i,p=n.e22*r,w=n.e23,b=n.e30*t,k=n.e31*i,d=n.e32*r,g=n.e33,this.e00=f,this.e01=e,this.e02=o,this.e03=s,this.e10=h,this.e11=c,this.e12=l,this.e13=a,this.e20=v,this.e21=y,this.e22=p,this.e23=w,this.e30=b,this.e31=k,this.e32=d,this.e33=g),this},mulRotate:function(n,t,i,r,u,f){var vt=f||!1,w=Math.sin(t),b=Math.cos(t),e=1-b,o=i*i*e+b,s=i*r*e-u*w,h=i*u*e+r*w,c=r*i*e+u*w,l=r*r*e+b,a=r*u*e-i*w,v=u*i*e-r*w,y=u*r*e+i*w,p=u*u*e+b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at;return vt?(k=o*n.e00+s*n.e10+h*n.e20,d=o*n.e01+s*n.e11+h*n.e21,g=o*n.e02+s*n.e12+h*n.e22,nt=o*n.e03+s*n.e13+h*n.e23,tt=c*n.e00+l*n.e10+a*n.e20,it=c*n.e01+l*n.e11+a*n.e21,rt=c*n.e02+l*n.e12+a*n.e22,ut=c*n.e03+l*n.e13+a*n.e23,ft=v*n.e00+y*n.e10+p*n.e20,et=v*n.e01+y*n.e11+p*n.e21,ot=v*n.e02+y*n.e12+p*n.e22,st=v*n.e03+y*n.e13+p*n.e23,ht=n.e30,ct=n.e31,lt=n.e32,at=n.e33,this.e00=k,this.e01=d,this.e02=g,this.e03=nt,this.e10=tt,this.e11=it,this.e12=rt,this.e13=ut,this.e20=ft,this.e21=et,this.e22=ot,this.e23=st,this.e30=ht,this.e31=ct,this.e32=lt,this.e33=at):(k=n.e00*o+n.e01*c+n.e02*v,d=n.e00*s+n.e01*l+n.e02*y,g=n.e00*h+n.e01*a+n.e02*p,nt=n.e03,tt=n.e10*o+n.e11*c+n.e12*v,it=n.e10*s+n.e11*l+n.e12*y,rt=n.e10*h+n.e11*a+n.e12*p,ut=n.e13,ft=n.e20*o+n.e21*c+n.e22*v,et=n.e20*s+n.e21*l+n.e22*y,ot=n.e20*h+n.e21*a+n.e22*p,st=n.e23,ht=n.e30*o+n.e31*c+n.e32*v,ct=n.e30*s+n.e31*l+n.e32*y,lt=n.e30*h+n.e31*a+n.e32*p,at=n.e33,this.e00=k,this.e01=d,this.e02=g,this.e03=nt,this.e10=tt,this.e11=it,this.e12=rt,this.e13=ut,this.e20=ft,this.e21=et,this.e22=ot,this.e23=st,this.e30=ht,this.e31=ct,this.e32=lt,this.e33=at),this},mulTranslate:function(n,t,i,r,u){var nt=u||!1,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g;return nt?(f=n.e00+t*n.e30,e=n.e01+t*n.e31,o=n.e02+t*n.e32,s=n.e03+t*n.e33,h=n.e10+i*n.e30,c=n.e11+i*n.e31,l=n.e12+i*n.e32,a=n.e13+i*n.e33,v=n.e20+r*n.e30,y=n.e21+r*n.e31,p=n.e22+r*n.e32,w=n.e23+r*n.e33,b=n.e30,k=n.e31,d=n.e32,g=n.e33,this.e00=f,this.e01=e,this.e02=o,this.e03=s,this.e10=h,this.e11=c,this.e12=l,this.e13=a,this.e20=v,this.e21=y,this.e22=p,this.e23=w,this.e30=b,this.e31=k,this.e32=d,this.e33=g):(f=n.e00,e=n.e01,o=n.e02,s=n.e00*t+n.e01*i+n.e02*r+n.e03,h=n.e10,c=n.e11,l=n.e12,a=n.e10*t+n.e11*i+n.e12*r+n.e13,v=n.e20,y=n.e21,p=n.e22,w=n.e20*t+n.e21*i+n.e22*r+n.e23,b=n.e30,k=n.e31,d=n.e32,g=n.e30*t+n.e31*i+n.e32*r+n.e33,this.e00=f,this.e01=e,this.e02=o,this.e03=s,this.e10=h,this.e11=c,this.e12=l,this.e13=a,this.e20=v,this.e21=y,this.e22=p,this.e23=w,this.e30=b,this.e31=k,this.e32=d,this.e33=g),this},transpose:function(n){var t=n.e10,i=n.e20,r=n.e30,u=n.e01,f=n.e21,e=n.e31,o=n.e02,s=n.e12,h=n.e32,c=n.e03,l=n.e13,a=n.e23;return this.e00=n.e00,this.e01=t,this.e02=i,this.e03=r,this.e10=u,this.e11=n.e11,this.e12=f,this.e13=e,this.e20=o,this.e21=s,this.e22=n.e22,this.e23=h,this.e30=c,this.e31=l,this.e32=a,this.e33=n.e33,this},setQuat:function(n){var r=2*n.x,i=2*n.y,t=2*n.z,u=n.x*r,f=n.y*i,e=n.z*t,o=n.x*i,s=n.y*t,h=n.x*t,c=n.s*r,l=n.s*i,a=n.s*t;return this.e00=1-f-e,this.e01=o-a,this.e02=h+l,this.e03=0,this.e10=o+a,this.e11=1-u-e,this.e12=s-c,this.e13=0,this.e20=h-l,this.e21=s+c,this.e22=1-u-f,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this},invert:function(n){var s=n.e10*n.e21-n.e11*n.e20,k=n.e10*n.e22-n.e12*n.e20,h=n.e10*n.e23-n.e13*n.e20,c=n.e10*n.e31-n.e11*n.e30,l=n.e10*n.e32-n.e12*n.e30,a=n.e10*n.e33-n.e13*n.e30,v=n.e11*n.e22-n.e12*n.e21,y=n.e11*n.e23-n.e13*n.e21,p=n.e11*n.e32-n.e12*n.e31,w=n.e11*n.e33-n.e13*n.e31,d=n.e12*n.e20-n.e20*n.e22,g=n.e12*n.e23-n.e13*n.e22,nt=n.e12*n.e33-n.e22*n.e23,b=n.e12*n.e33-n.e13*n.e32,i=n.e20*n.e31-n.e21*n.e30,tt=n.e20*n.e32-n.e20*n.e33,e=n.e20*n.e32-n.e22*n.e30,o=n.e20*n.e33-n.e23*n.e30,r=n.e21*n.e32-n.e22*n.e31,u=n.e21*n.e33-n.e23*n.e31,it=n.e22*n.e30-n.e23*n.e30,f=n.e22*n.e33-n.e23*n.e32,t=n.e00*(n.e11*f-n.e12*u+n.e13*r)+n.e01*(-n.e10*f-n.e12*tt+n.e13*it)+n.e02*(n.e10*u-n.e11*o+n.e13*i)+n.e03*(-n.e10*r+n.e11*e-n.e12*i);t!=0&&(t=1/t);var rt=n.e11*f-n.e12*u+n.e13*r,ut=-n.e01*f+n.e02*u-n.e03*r,ft=n.e01*b-n.e02*w+n.e03*p,et=-n.e01*nt+n.e02*y-n.e03*v,ot=-n.e10*f+n.e12*o-n.e13*e,st=n.e00*f-n.e02*o+n.e03*e,ht=-n.e00*b+n.e02*a-n.e03*l,ct=n.e00*g-n.e02*h-n.e03*d,lt=n.e10*u-n.e11*o+n.e13*i,at=-n.e00*u+n.e01*o-n.e03*i,vt=n.e00*w-n.e01*a+n.e03*c,yt=-n.e00*y+n.e01*h-n.e03*s,pt=-n.e10*r+n.e11*e-n.e12*i,wt=n.e00*r-n.e01*e+n.e02*i,bt=-n.e00*p+n.e01*l-n.e02*c,kt=n.e00*v-n.e01*k+n.e02*s;return this.e00=t*rt,this.e01=t*ut,this.e02=t*ft,this.e03=t*et,this.e10=t*ot,this.e11=t*st,this.e12=t*ht,this.e13=t*ct,this.e20=t*lt,this.e21=t*at,this.e22=t*vt,this.e23=t*yt,this.e30=t*pt,this.e31=t*wt,this.e32=t*bt,this.e33=t*kt,this},lookAt:function(n,t,i,r,u,f,e,o,s){var h=n-r,c=t-u,l=i-f,a=1/Math.sqrt(h*h+c*c+l*l);h*=a,c*=a,l*=a;var v=o*l-s*c,y=s*h-e*l,p=e*c-o*h;a=1/Math.sqrt(v*v+y*y+p*p),v*=a,y*=a,p*=a;var w=c*p-l*y,b=l*v-h*p,k=h*y-c*v;return this.e00=v,this.e01=y,this.e02=p,this.e03=-(v*n+y*t+p*i),this.e10=w,this.e11=b,this.e12=k,this.e13=-(w*n+b*t+k*i),this.e20=h,this.e21=c,this.e22=l,this.e23=-(h*n+c*t+l*i),this.e30=0,this.e31=0,this.e32=0,this.e33=1,this},perspective:function(n,t,i,r){var u=1/Math.tan(n*.5),f=r/(i-r);return this.e00=u/t,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=u,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=f,this.e23=i*f,this.e30=0,this.e31=0,this.e32=-1,this.e33=0,this},ortho:function(n,t,i,r){var u=1/(i-r);return this.e00=2/n,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=2/t,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=u,this.e23=i*u,this.e30=0,this.e31=0,this.e32=0,this.e33=0,this},copy:function(n){return this.e00=n.e00,this.e01=n.e01,this.e02=n.e02,this.e03=n.e03,this.e10=n.e10,this.e11=n.e11,this.e12=n.e12,this.e13=n.e13,this.e20=n.e20,this.e21=n.e21,this.e22=n.e22,this.e23=n.e23,this.e30=n.e30,this.e31=n.e31,this.e32=n.e32,this.e33=n.e33,this},copyMat33:function(n){return this.e00=n.e00,this.e01=n.e01,this.e02=n.e02,this.e03=0,this.e10=n.e10,this.e11=n.e11,this.e12=n.e12,this.e13=0,this.e20=n.e20,this.e21=n.e21,this.e22=n.e22,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this},clone:function(){return new OIMO.Mat44(this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33)},toString:function(){return"Mat44|"+this.e00.toFixed(4)+", "+this.e01.toFixed(4)+", "+this.e02.toFixed(4)+", "+this.e03.toFixed(4)+"|\n     |"+this.e10.toFixed(4)+", "+this.e11.toFixed(4)+", "+this.e12.toFixed(4)+", "+this.e13.toFixed(4)+"|\n     |"+this.e20.toFixed(4)+", "+this.e21.toFixed(4)+", "+this.e22.toFixed(4)+", "+this.e23.toFixed(4)+"|\n     |"+this.e30.toFixed(4)+", "+this.e31.toFixed(4)+", "+this.e32.toFixed(4)+", "+this.e33.toFixed(4)+"|\n"}},OIMO.Quat=function(n,t,i,r){this.s=n||1,this.x=t||0,this.y=i||0,this.z=r||0},OIMO.Quat.prototype={constructor:OIMO.Quat,init:function(n,t,i,r){return this.s=n,this.x=t,this.y=i,this.z=r,this},add:function(n,t){return this.s=n.s+t.s,this.x=n.x+t.x,this.y=n.y+t.y,this.z=n.z+t.z,this},sub:function(n,t){return this.s=n.s-t.s,this.x=n.x-t.x,this.y=n.y-t.y,this.z=n.z-t.z,this},scale:function(n,t){return this.s=n.s*t,this.x=n.x*t,this.y=n.y*t,this.z=n.z*t,this},mul:function(n,t){var i=n.s*t.s-n.x*t.x-n.y*t.y-n.z*t.z,r=n.s*t.x+n.x*t.s+n.y*t.z-n.z*t.y,u=n.s*t.y-n.x*t.z+n.y*t.s+n.z*t.x,f=n.s*t.z+n.x*t.y-n.y*t.x+n.z*t.s;return this.s=i,this.x=r,this.y=u,this.z=f,this},arc:function(n,t){var r=n.x,u=n.y,f=n.z,e=t.x,o=t.y,s=t.z,i=r*e+u*o+f*s;if(i==-1)return e=u*r-f*f,o=-f*u-r*r,s=r*f+u*u,i=1/Math.sqrt(e*e+o*o+s*s),this.s=0,this.x=e*i,this.y=o*i,this.z=s*i,this;var h=u*s-f*o,c=f*e-r*s,l=r*o-u*e;return this.s=Math.sqrt((1+i)*.5),i=.5/this.s,this.x=h*i,this.y=c*i,this.z=l*i,this},normalize:function(n){var t=Math.sqrt(n.s*n.s+n.x*n.x+n.y*n.y+n.z*n.z);return t>0&&(t=1/t),this.s=n.s*t,this.x=n.x*t,this.y=n.y*t,this.z=n.z*t,this},invert:function(n){return this.s=n.s,this.x=-n.x,this.y=-n.y,this.z=-n.z,this},length:function(){return Math.sqrt(this.s*this.s+this.x*this.x+this.y*this.y+this.z*this.z)},copy:function(n){return this.s=n.s,this.x=n.x,this.y=n.y,this.z=n.z,this},clone:function(){return new OIMO.Quat(this.s,this.x,this.y,this.z)},toString:function(){return"Quat["+this.s.toFixed(4)+", ("+this.x.toFixed(4)+", "+this.y.toFixed(4)+", "+this.z.toFixed(4)+")]"}},OIMO.Vec3=function(n,t,i){this.x=n||0,this.y=t||0,this.z=i||0},OIMO.Vec3.prototype={constructor:OIMO.Vec3,init:function(n,t,i){return this.x=n,this.y=t,this.z=i,this},add:function(n,t){return this.x=n.x+t.x,this.y=n.y+t.y,this.z=n.z+t.z,this},addEqual:function(n){return this.x+=n.x,this.y+=n.y,this.z+=n.z,this},sub:function(n,t){return this.x=n.x-t.x,this.y=n.y-t.y,this.z=n.z-t.z,this},subEqual:function(n){return this.x-=n.x,this.y-=n.y,this.z-=n.z,this},scale:function(n,t){return this.x=n.x*t,this.y=n.y*t,this.z=n.z*t,this},scaleEqual:function(n){return this.x*=n,this.y*=n,this.z*=n,this},dot:function(n){return this.x*n.x+this.y*n.y+this.z*n.z},cross:function(n,t){var i=n.y*t.z-n.z*t.y,r=n.z*t.x-n.x*t.z,u=n.x*t.y-n.y*t.x;return this.x=i,this.y=r,this.z=u,this},mulMat:function(n,t){var i=n.e00*t.x+n.e01*t.y+n.e02*t.z,r=n.e10*t.x+n.e11*t.y+n.e12*t.z,u=n.e20*t.x+n.e21*t.y+n.e22*t.z;return this.x=i,this.y=r,this.z=u,this},normalize:function(n){var t=Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z);return t>0&&(t=1/t),this.x=n.x*t,this.y=n.y*t,this.z=n.z*t,this},invert:function(n){return this.x=-n.x,this.y=-n.y,this.z=-n.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},copy:function(n){return this.x=n.x,this.y=n.y,this.z=n.z,this},clone:function(){return new OIMO.Vec3(this.x,this.y,this.z)},toString:function(){return"Vec3["+this.x.toFixed(4)+", "+this.y.toFixed(4)+", "+this.z.toFixed(4)+"]"}}