<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Kinematic Human</title>
<meta name="Description" content="" />
<meta name="Keywords"  content="" />
<style>
body{ padding: 0; margin: 0; overflow: hidden; background-color: #333;}
#walk{ position: fixed; z-index: 2; top: 10px; right: 10px; background-color: #fff; border: 1px solid #000; font-weight: bold; cursor: pointer; }
#run{ position: fixed; z-index: 2; top: 50px; right: 10px; background-color: #fff; border: 1px solid #000; font-weight: bold; cursor: pointer; }
</style>
</head>
<body>
<script src="../js/slider.js"></script>
<script src="Human.js"></script>
<!-- @Author _ishibashijun - http://jsdo.it/_ishibashijun -->
<button id="walk">Walk</button>
<button id="run">Run</button>
<canvas id="c"></canvas>

<script>
var canvas, ctx, human, sliders;

function drawHuman(h){
    drawSegment(h.bones.LeftUpArm);
	drawSegment(h.bones.LeftLowArm);
	drawSegment(h.bones.LeftUpLeg);
	drawSegment(h.bones.LeftLowLeg);
	drawSegment(h.bones.neck);
	drawHead(h.bones.head);
	drawSegment(h.bones.body);
	drawSegment(h.bones.RightLowLeg);
	drawSegment(h.bones.RightUpLeg);
	drawSegment(h.bones.RightLowArm);
	drawSegment(h.bones.RightUpArm);
}

function drawHead(s){
	ctx.beginPath();
	ctx.fillStyle = "#fff";
	ctx.strokeStyle = "#000";
	ctx.lineWidth = 1;
	ctx.arc( s.x, s.y, 15, 0, 2 * Math.PI );
	ctx.closePath();
	ctx.fill();
	ctx.stroke();
}

function drawSegment(s){
	var height = s.height,
		diagonal = s.width + height,
		cornerRadius = height / 2,
		cornerRadius2 = cornerRadius * 2;
		
	ctx.save();
	ctx.translate( s.x, s.y );
	ctx.rotate( s.rotation );
	ctx.lineWidth = s.lineWidth;
	ctx.strokeStyle = s.color;
	ctx.fillStyle = "#fff";
	ctx.beginPath();
	ctx.moveTo( 0, -cornerRadius );
	ctx.lineTo( diagonal - cornerRadius2, -cornerRadius );
	ctx.quadraticCurveTo( -cornerRadius + diagonal, -cornerRadius, -cornerRadius + diagonal, 0 );
	ctx.lineTo( -cornerRadius + diagonal, height - cornerRadius2 );
	ctx.quadraticCurveTo( -cornerRadius + diagonal, -cornerRadius + height, diagonal - cornerRadius2, -cornerRadius + height );
	ctx.lineTo( 0, -cornerRadius + height );
	ctx.quadraticCurveTo( -cornerRadius, -cornerRadius + height, -cornerRadius, height - cornerRadius2 );
	ctx.lineTo( -cornerRadius, 0 );
	ctx.quadraticCurveTo( -cornerRadius, -cornerRadius, 0, -cornerRadius );
	ctx.closePath();
	ctx.fill();
	ctx.stroke();
	ctx.beginPath();
	ctx.arc( 0, 0, 2, 0, 2 * Math.PI );
	ctx.stroke();
	ctx.closePath();
	ctx.beginPath();
	ctx.arc( s.width, 0, 2, 0, 2 * Math.PI );
	ctx.stroke();
	ctx.closePath();
	ctx.restore();
}

function initWalk() {
	human.initWalk();
	slideUpdate();
}

function initRun() {
	human.initRun();
	slideUpdate();
}

function slideUpdate() {
	for ( var key in sliders ){
		sliders[ key ].value = human.sets[ key ];
	    sliders[ key ].updatePosition();
	}
}

function humanSets() {
    for ( var key in sliders ){
		human.sets[ key ] = sliders[ key ].value;
	}
}

function render() {
	ctx.clearRect( 0, 0, canvas.width, canvas.height );
	human.update();
	drawHuman(human);
	
	setTimeout( render, 1000/60 );
}

function onLoad() {
	canvas = document.getElementById( "c" );
	canvas.width = window.innerWidth;
	canvas.height =  window.innerHeight;
	ctx = canvas.getContext( "2d" );

	human = new Human();
	human.zw = window.innerWidth;
	human.zh = window.innerHeight;

	var older = document.body;
	sliders = {
		speed : new UI.Slide(older, "speed", humanSets, 0.3, [5,100, 150, 20], 0.5, 0, ' ', 2),
        thighRange : new UI.Slide(older, "thigh Range", humanSets, 50, [5,140, 150, 20], 90,0, '°'),
        thighBase : new UI.Slide(older, "thigh Base", humanSets, 100, [5,180, 150, 20], 180, 0, '°'),
        calfRange : new UI.Slide(older, "calf Range", humanSets, 30, [5,220, 150, 20], 90,0, '°'),
        calfOffset : new UI.Slide(older, "calf Offset", humanSets, -1.57, [5,260, 150, 20], 3.14, -3.14, '°', 2),
        armRange : new UI.Slide(older, "arm Range", humanSets, 55, [5,300, 150, 20], 360,0, '°'),
        foreArmRange : new UI.Slide(older, "foreArm Range", humanSets, 20, [5,340, 150, 20], 75, 0, '°'),
        foreArmOffset : new UI.Slide(older, "foreArm Offset", humanSets, -1.57, [5,380, 150, 20], 3.14, -3.14, '°', 2),
        gravity : new UI.Slide(older, "gravity", humanSets, 0.88, [5,420, 150, 20], 1,0, 'g', 2),
	}

	document.getElementById( "walk" ).addEventListener( "click", initWalk, false );
	document.getElementById( "run" ).addEventListener( "click", initRun, false );

	initWalk();
	
	render();
}

window.addEventListener(  "load", onLoad, false  );	
	
</script>
</body>
</html>
