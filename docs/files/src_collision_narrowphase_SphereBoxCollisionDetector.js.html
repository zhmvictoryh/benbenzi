<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\collision\narrowphase\SphereBoxCollisionDetector.js - oimo</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="oimo" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.4</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/BoxShape.html">BoxShape</a></li>
                                <li><a href="../classes/CylinderShape.html">CylinderShape</a></li>
                                <li><a href="../classes/MassInfo.html">MassInfo</a></li>
                                <li><a href="../classes/Proxy.html">Proxy</a></li>
                                <li><a href="../classes/Shape.html">Shape</a></li>
                                <li><a href="../classes/ShapeConfig.html">ShapeConfig</a></li>
                                <li><a href="../classes/SphereShape.html">SphereShape</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src\collision\narrowphase\SphereBoxCollisionDetector.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
import { CollisionDetector } from &#x27;./CollisionDetector&#x27;;
import { _Math } from &#x27;../../math/Math&#x27;;


/**
 * A collision detector which detects collisions between sphere and box.
 * @author saharan
 */
function SphereBoxCollisionDetector ( flip ) {
    
    CollisionDetector.call( this );
    this.flip = flip;

};

SphereBoxCollisionDetector.prototype = Object.create( CollisionDetector.prototype );
SphereBoxCollisionDetector.prototype.constructor = SphereBoxCollisionDetector;

SphereBoxCollisionDetector.prototype.detectCollision = function ( shape1, shape2, manifold ) {

    var s;
    var b;
    if(this.flip){
        s=(shape2);
        b=(shape1);
    }else{
        s=(shape1);
        b=(shape2);
    }

    var D = b.dimentions;

    var ps=s.position;
    var psx=ps.x;
    var psy=ps.y;
    var psz=ps.z;
    var pb=b.position;
    var pbx=pb.x;
    var pby=pb.y;
    var pbz=pb.z;
    var rad=s.radius;

    var hw=b.halfWidth;
    var hh=b.halfHeight;
    var hd=b.halfDepth;

    var dx=psx-pbx;
    var dy=psy-pby;
    var dz=psz-pbz;
    var sx=D[0]*dx+D[1]*dy+D[2]*dz;
    var sy=D[3]*dx+D[4]*dy+D[5]*dz;
    var sz=D[6]*dx+D[7]*dy+D[8]*dz;
    var cx;
    var cy;
    var cz;
    var len;
    var invLen;
    var overlap=0;
    if(sx&gt;hw){
        sx=hw;
    }else if(sx&lt;-hw){
        sx=-hw;
    }else{
        overlap=1;
    }
    if(sy&gt;hh){
        sy=hh;
    }else if(sy&lt;-hh){
        sy=-hh;
    }else{
        overlap|=2;
    }
    if(sz&gt;hd){
        sz=hd;
    }else if(sz&lt;-hd){
        sz=-hd;
    }else{
        overlap|=4;
    }
    if(overlap==7){
        // center of sphere is in the box
        if(sx&lt;0){
            dx=hw+sx;
        }else{
            dx=hw-sx;
        }
        if(sy&lt;0){
            dy=hh+sy;
        }else{
            dy=hh-sy;
        }
        if(sz&lt;0){
            dz=hd+sz;
        }else{
            dz=hd-sz;
        }
        if(dx&lt;dy){
            if(dx&lt;dz){
                len=dx-hw;
            if(sx&lt;0){
                sx=-hw;
                dx=D[0];
                dy=D[1];
                dz=D[2];
            }else{
                sx=hw;
                dx=-D[0];
                dy=-D[1];
                dz=-D[2];
            }
        }else{
            len=dz-hd;
            if(sz&lt;0){
                sz=-hd;
                dx=D[6];
                dy=D[7];
                dz=D[8];
            }else{
                sz=hd;
                dx=-D[6];
                dy=-D[7];
                dz=-D[8];
            }
        }
        }else{
            if(dy&lt;dz){
                len=dy-hh;
                if(sy&lt;0){
                    sy=-hh;
                    dx=D[3];
                    dy=D[4];
                    dz=D[5];
                }else{
                    sy=hh;
                    dx=-D[3];
                    dy=-D[4];
                    dz=-D[5];
                }
            }else{
                len=dz-hd;
                if(sz&lt;0){
                    sz=-hd;
                    dx=D[6];
                    dy=D[7];
                    dz=D[8];
                }else{
                    sz=hd;
                    dx=-D[6];
                    dy=-D[7];
                    dz=-D[8];
            }
        }
    }
    cx=pbx+sx*D[0]+sy*D[3]+sz*D[6];
    cy=pby+sx*D[1]+sy*D[4]+sz*D[7];
    cz=pbz+sx*D[2]+sy*D[5]+sz*D[8];
    manifold.addPoint(psx+rad*dx,psy+rad*dy,psz+rad*dz,dx,dy,dz,len-rad,this.flip);
    }else{
        cx=pbx+sx*D[0]+sy*D[3]+sz*D[6];
        cy=pby+sx*D[1]+sy*D[4]+sz*D[7];
        cz=pbz+sx*D[2]+sy*D[5]+sz*D[8];
        dx=cx-ps.x;
        dy=cy-ps.y;
        dz=cz-ps.z;
        len=dx*dx+dy*dy+dz*dz;
        if(len&gt;0&amp;&amp;len&lt;rad*rad){
            len=_Math.sqrt(len);
            invLen=1/len;
            dx*=invLen;
            dy*=invLen;
            dz*=invLen;
            manifold.addPoint(psx+rad*dx,psy+rad*dy,psz+rad*dz,dx,dy,dz,len-rad,this.flip);
        }
    }

};

export { SphereBoxCollisionDetector };
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
